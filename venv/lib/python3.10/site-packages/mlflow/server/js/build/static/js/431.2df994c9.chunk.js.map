{"version":3,"file":"static/js/431.2df994c9.chunk.js","mappings":"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","sources":["experiment-tracking/components/experiment-page/hooks/useAsyncDispatch.ts","experiment-tracking/components/experiment-page/contexts/GetExperimentsContext.tsx","common/static/permission-denied-lock.svg","experiment-tracking/components/PermissionDeniedView.tsx","experiment-tracking/components/experiment-page/components/ExperimentViewArtifactLocation.tsx","experiment-tracking/components/experiment-page/components/ExperimentViewDescriptions.tsx","experiment-tracking/components/experiment-page/hooks/useFetchExperiments.ts","experiment-tracking/components/experiment-page/components/ExperimentViewNotes.tsx","experiment-tracking/components/experiment-page/components/header/ExperimentViewCopyTitle.tsx","shared/building_blocks/CopyButton.tsx","shared/building_blocks/CopyBox.tsx","experiment-tracking/components/modals/GetLinkModal.tsx","experiment-tracking/components/experiment-page/components/header/ExperimentViewHeaderShareButton.tsx","experiment-tracking/components/experiment-page/components/header/ExperimentViewHeader.tsx","experiment-tracking/components/experiment-page/components/header/ExperimentViewHeaderCompare.tsx","experiment-tracking/components/experiment-page/utils/experimentRuns.selector.ts","experiment-tracking/components/experiment-page/components/runs/cells/ColumnHeaderCell.tsx","experiment-tracking/components/experiment-page/components/runs/cells/DateCellRenderer.tsx","experiment-tracking/components/experiment-page/components/runs/cells/ExperimentNameCellRenderer.tsx","common/components/TrimmedText.tsx","common/static/logged-model.svg","common/static/registered-model.svg","experiment-tracking/components/experiment-page/components/runs/cells/ModelsCellRenderer.tsx","experiment-tracking/components/experiment-page/components/runs/cells/SourceCellRenderer.tsx","experiment-tracking/components/experiment-page/components/runs/cells/VersionCellRenderer.tsx","experiment-tracking/components/experiment-page/components/runs/cells/RowActionsCellRenderer.tsx","experiment-tracking/components/experiment-page/components/runs/cells/RowActionsHeaderCellRenderer.tsx","experiment-tracking/components/experiment-page/components/runs/cells/RunNameCellRenderer.tsx","experiment-tracking/components/experiment-page/components/runs/cells/LoadMoreRowRenderer.tsx","experiment-tracking/components/experiment-page/components/runs/cells/DatasetsCellRenderer.tsx","experiment-tracking/components/experiment-page/utils/experimentPage.column-utils.ts","experiment-tracking/components/modals/DeleteRunModal.tsx","experiment-tracking/components/modals/RestoreRunModal.tsx","experiment-tracking/components/experiment-page/hooks/useExperimentIds.ts","experiment-tracking/components/experiment-page/models/SearchExperimentRunsFacetsState.ts","experiment-tracking/components/experiment-page/utils/experimentPage.fetch-utils.ts","experiment-tracking/components/experiment-page/utils/persistSearchFacets.serializers.ts","experiment-tracking/components/experiment-page/utils/persistSearchFacets.ts","experiment-tracking/components/experiment-page/contexts/GetExperimentRunsContext.tsx","experiment-tracking/components/experiment-page/hooks/useFetchExperimentRuns.ts","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRunModals.tsx","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRunsControlsActions.tsx","common/components/ToggleIconButton.tsx","../node_modules/antd/es/badge/SingleNumber.js","../node_modules/antd/es/badge/ScrollNumber.js","../node_modules/antd/es/badge/utils.js","../node_modules/antd/es/badge/Ribbon.js","../node_modules/antd/es/badge/index.js","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRefreshButton.tsx","experiment-tracking/components/experiment-page/hooks/useExperimentViewLocalStore.ts","experiment-tracking/components/experiment-page/components/runs/RunsSearchTooltipContent.tsx","experiment-tracking/components/experiment-page/components/runs/RunsSearchAutoComplete.utils.tsx","experiment-tracking/components/experiment-page/components/runs/RunsSearchAutoComplete.tsx","experiment-tracking/utils/DatasetUtils.ts","../node_modules/react-syntax-highlighter/dist/esm/prism-light.js","shared/web-shared/snippet/theme/databricks-duotone-dark.ts","shared/web-shared/snippet/theme/databricks-light.ts","shared/web-shared/snippet/index.tsx","experiment-tracking/components/evaluation-artifacts-compare/CreateNotebookRunModal.tsx","experiment-tracking/utils/RunNameUtils.ts","experiment-tracking/components/evaluation-artifacts-compare/hooks/usePromptEvaluationParameters.tsx","experiment-tracking/components/evaluation-artifacts-compare/EvaluationCreatePromptParameters.tsx","experiment-tracking/components/evaluation-artifacts-compare/hooks/usePromptEvaluationPromptTemplateValue.ts","experiment-tracking/components/evaluation-artifacts-compare/components/EvaluationCreateRunPromptTemplateErrors.tsx","experiment-tracking/components/evaluation-artifacts-compare/utils/PromptExamples.ts","experiment-tracking/components/evaluation-artifacts-compare/EvaluationCreatePromptRunModalExamples.tsx","experiment-tracking/components/evaluation-artifacts-compare/EvaluationCreatePromptRunModal.tsx","experiment-tracking/components/evaluation-artifacts-compare/hooks/usePromptEvaluationInputValues.tsx","experiment-tracking/components/experiment-page/hooks/useCreateNewRun.tsx","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRunsControlsFilters.tsx","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRunsSortSelector.tsx","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRunsColumnSelector.tsx","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRunsModeSwitch.tsx","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRunsControls.tsx","experiment-tracking/components/experiment-page/hooks/useRunSortOptions.ts","common/components/ag-grid/AgGridLoader.tsx","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRunsEmptyTable.tsx","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRunsTableAddColumnCTA.tsx","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRunsTableStatusBar.tsx","common/components/PreviewSidebar.tsx","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRunsTable.tsx","experiment-tracking/components/experiment-page/models/SearchExperimentRunsViewState.ts","experiment-tracking/components/runs-compare/runs-compare.types.ts","common/static/chart-bar.svg","common/static/chart-contour.svg","common/static/chart-line.svg","common/static/chart-parallel.svg","common/static/chart-scatter.svg","experiment-tracking/components/runs-compare/RunsCompareAddChartMenu.tsx","experiment-tracking/components/runs-compare/hooks/useMutableHoverCallback.tsx","experiment-tracking/components/runs-compare/hooks/useCompareRunsTraceHighlight.ts","experiment-tracking/components/runs-compare/charts/CompareRunsMetricsBarPlot.tsx","experiment-tracking/components/runs-compare/hooks/useCompareRunsTooltip.tsx","experiment-tracking/components/runs-compare/cards/ChartCard.common.tsx","experiment-tracking/components/runs-compare/cards/RunsCompareBarChartCard.tsx","common/static/parallel-chart-placeholder.svg","experiment-tracking/components/runs-compare/charts/LazyParallelCoordinatesPlot.tsx","experiment-tracking/components/runs-compare/cards/RunsCompareParallelChartCard.tsx","experiment-tracking/components/runs-compare/charts/CompareRunsScatterPlot.tsx","experiment-tracking/components/runs-compare/cards/RunsCompareScatterChartCard.tsx","experiment-tracking/components/runs-compare/charts/CompareRunsContourPlot.tsx","experiment-tracking/components/runs-compare/cards/RunsCompareContourChartCard.tsx","experiment-tracking/components/runs-compare/charts/CompareRunsMetricsLinePlot.tsx","experiment-tracking/components/runs-compare/cards/RunsCompareLineChartCard.tsx","experiment-tracking/components/runs-compare/RunsCompareCharts.tsx","experiment-tracking/components/runs-compare/config/RunsCompareConfigure.common.tsx","experiment-tracking/components/runs-compare/config/RunsCompareConfigureBarChart.tsx","experiment-tracking/components/runs-compare/config/RunsCompareConfigureParallelChart.tsx","experiment-tracking/components/runs-compare/config/RunsCompareConfigureLineChart.tsx","experiment-tracking/components/runs-compare/hooks/useFetchCompareRunsMetricHistory.ts","experiment-tracking/components/runs-compare/config/RunsCompareConfigureLineChart.preview.tsx","experiment-tracking/components/runs-compare/config/RunsCompareConfigureParallelChart.preview.tsx","experiment-tracking/components/runs-compare/config/RunsCompareConfigureContourChart.tsx","experiment-tracking/components/runs-compare/config/RunsCompareConfigureScatterChart.tsx","experiment-tracking/components/runs-compare/RunsCompareTooltipBody.tsx","experiment-tracking/components/runs-compare/RunsCompareConfigureModal.tsx","experiment-tracking/components/runs-compare/config/RunsCompareConfigureBarChart.preview.tsx","experiment-tracking/components/runs-compare/config/RunsCompareConfigureContourChart.preview.tsx","experiment-tracking/components/runs-compare/config/RunsCompareConfigureScatterChart.preview.tsx","experiment-tracking/components/runs-compare/RunsCompare.tsx","experiment-tracking/components/runs-compare/hooks/useMultipleChartsMetricHistory.ts","experiment-tracking/components/experiment-page/hooks/useFetchedRunsNotification.tsx","experiment-tracking/components/experiment-page/hooks/useAutoExpandRunRows.ts","experiment-tracking/components/evaluation-artifacts-compare/hooks/useEvaluateAllRows.tsx","experiment-tracking/components/evaluation-artifacts-compare/contexts/PromptEngineeringContext.tsx","experiment-tracking/components/evaluation-artifacts-compare/components/EvaluationRunHeaderModelIndicator.tsx","experiment-tracking/components/evaluation-artifacts-compare/components/EvaluationRunHeaderDatasetIndicator.tsx","experiment-tracking/components/evaluation-artifacts-compare/components/EvaluationTableHeader.tsx","experiment-tracking/components/evaluation-artifacts-compare/components/EvaluationRunHeaderCellRenderer.tsx","experiment-tracking/components/evaluation-artifacts-compare/components/EvaluationCellEvaluateButton.tsx","experiment-tracking/components/evaluation-artifacts-compare/components/EvaluationTextCellRenderer.tsx","experiment-tracking/components/evaluation-artifacts-compare/EvaluationArtifactCompare.utils.ts","experiment-tracking/components/evaluation-artifacts-compare/components/EvaluationGroupByHeaderCellRenderer.tsx","experiment-tracking/components/evaluation-artifacts-compare/hooks/useEvaluationAddNewInputsModal.tsx","experiment-tracking/components/evaluation-artifacts-compare/components/EvaluationTableActionsColumnRenderer.tsx","experiment-tracking/components/evaluation-artifacts-compare/components/EvaluationTableActionsCellRenderer.tsx","experiment-tracking/components/evaluation-artifacts-compare/components/EvaluationArtifactCompareTable.tsx","experiment-tracking/components/evaluation-artifacts-compare/hooks/useEvaluationArtifactTableData.ts","common/hooks/useBrowserKeyShortcutListener.ts","experiment-tracking/components/evaluation-artifacts-compare/EvaluationArtifactCompareView.tsx","experiment-tracking/components/evaluation-artifacts-compare/hooks/useEvaluationArtifactViewState.tsx","experiment-tracking/components/evaluation-artifacts-compare/hooks/useEvaluationArtifactWriteBack.tsx","experiment-tracking/components/evaluation-artifacts-compare/hooks/useEvaluationArtifactTables.ts","experiment-tracking/components/evaluation-artifacts-compare/hooks/useEvaluationArtifactColumns.ts","experiment-tracking/components/experiment-page/components/runs/ExperimentViewRuns.tsx","experiment-tracking/components/experiment-page/hooks/useChartViewByDefault.ts","experiment-tracking/components/experiment-page/ExperimentView.tsx","experiment-tracking/components/experiment-page/hooks/useExperiments.ts","common/utils/useElementHeight.ts","experiment-tracking/components/experiment-page/ExperimentPage.tsx","experiment-tracking/components/runs-compare/charts/CompareRunsCharts.common.ts","../node_modules/react-syntax-highlighter/dist/cjs/languages/prism/python.js"],"sourcesContent":["import { useDispatch } from 'react-redux';\nimport type { AnyAction } from 'redux';\n\n/**\n * Since we're using redux middlewares that promisify action dispatch\n * ('redux-promise-middleware'), we use this method as a sugar for useDispatch()\n * with correct typings.\n */\nexport const useAsyncDispatch = useDispatch as () => (action: AnyAction) => Promise<AnyAction>;\n","import { isEqual } from 'lodash';\nimport React, { createContext, useCallback, useMemo, useState } from 'react';\nimport { ErrorWrapper } from '../../../../common/utils/ErrorWrapper';\nimport RequestStateWrapper from '../../../../common/components/RequestStateWrapper';\nimport Utils from '../../../../common/utils/Utils';\n\nimport type {\n  getExperimentApi,\n  setCompareExperiments,\n  setExperimentTagApi,\n} from '../../../actions';\nimport { useAsyncDispatch } from '../hooks/useAsyncDispatch';\n\nexport interface GetExperimentsContextActions {\n  setExperimentTagApi: typeof setExperimentTagApi;\n  getExperimentApi: typeof getExperimentApi;\n  setCompareExperiments: typeof setCompareExperiments;\n}\n\nexport interface GetExperimentsContextType {\n  /**\n   * Function used to (re)fetch experiments using their IDs.\n   */\n  fetchExperiments: (experimentIds: string[]) => void;\n\n  /**\n   * Indicates if experiments are being loaded at the moment\n   */\n  isLoadingExperiment: boolean;\n\n  /**\n   * Contains error descriptor if fetching runs failed\n   */\n  requestError: ErrorWrapper | null;\n\n  /**\n   * All experiment-related actions creators\n   */\n  actions: GetExperimentsContextActions;\n}\n\n/**\n * Wrapper context that aggregates concrete redux actions necessary to fetch experiments.\n */\nexport const GetExperimentsContext = createContext<GetExperimentsContextType | null>(null);\n\n/**\n * Provider component for GetExperimentsContext.\n * Accepts concrete redux actions for searching experiments.\n */\nexport const GetExperimentsContextProvider = ({\n  children,\n  actions,\n}: React.PropsWithChildren<{\n  actions: GetExperimentsContextActions;\n}>) => {\n  const [fetchExperimentsRequestIds, setFetchExperimentsRequestIds] = useState<string[]>([]);\n  const [isLoadingExperiment, setIsLoadingExperiment] = useState(false);\n\n  const [requestError, setRequestError] = useState<any>(null);\n\n  const dispatch = useAsyncDispatch();\n\n  const fetchExperiments = useCallback(\n    (experimentIds: string[]) => {\n      const fetchFn = () => {\n        const newRequestIds = experimentIds.map((experimentId) => {\n          const requestAction = actions.getExperimentApi(experimentId);\n          dispatch(requestAction).catch((e) => {\n            Utils.logErrorAndNotifyUser(e);\n          });\n          return requestAction.meta.id;\n        });\n        setFetchExperimentsRequestIds((requestIds) =>\n          isEqual(newRequestIds, requestIds) ? requestIds : newRequestIds,\n        );\n      };\n\n      setRequestError(null);\n      fetchFn();\n    },\n    [actions, dispatch],\n  );\n\n  const contextValue = useMemo(\n    () => ({\n      fetchExperiments,\n      isLoadingExperiment,\n      requestError: requestError,\n      actions,\n    }),\n    [actions, fetchExperiments, isLoadingExperiment, requestError],\n  );\n\n  const renderFn = (_isLoading: false, _renderError: any, requests: any[]) => {\n    /**\n     * TODO:\n     * Defer setting this state because currently it might happen inside\n     * RequestStateWrapper's render function which causes React to act up.\n     * Either rebuild RequestStateWrapper or introduce some workaround.\n     */\n    setIsLoadingExperiment(\n      requests.some((r) => fetchExperimentsRequestIds.includes(r.id) && r.active),\n    );\n\n    if (!requestError) {\n      requests.forEach((request) => {\n        if (request.error) {\n          setRequestError(request.error);\n        }\n      });\n    }\n\n    return children;\n  };\n\n  return (\n    <GetExperimentsContext.Provider value={contextValue}>\n      <RequestStateWrapper\n        shouldOptimisticallyRender\n        // eslint-disable-next-line no-trailing-spaces\n        requestIds={fetchExperimentsRequestIds}\n      >\n        {renderFn}\n      </RequestStateWrapper>\n    </GetExperimentsContext.Provider>\n  );\n};\n","var _desc, _g;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nfunction SvgPermissionDeniedLock(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: \"58px\",\n    height: \"75px\",\n    viewBox: \"0 0 58 75\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    xmlnsXlink: \"http://www.w3.org/1999/xlink\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title === undefined ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, \"Privacy_Lock\") : title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _desc || (_desc = /*#__PURE__*/React.createElement(\"desc\", null, \"Created with Sketch.\")), _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n    id: \"EmptyState\",\n    stroke: \"none\",\n    strokeWidth: 1,\n    fill: \"none\",\n    fillRule: \"evenodd\"\n  }, /*#__PURE__*/React.createElement(\"g\", {\n    id: \"ErrorPage-noPermission\",\n    transform: \"translate(-691.000000, -194.000000)\",\n    fill: \"#43C8EC\"\n  }, /*#__PURE__*/React.createElement(\"g\", {\n    id: \"Privacy_Lock\",\n    transform: \"translate(691.000000, 194.250000)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M45.8,24.31 L45.8,17.16 C45.8,7.84295627 38.2470437,0.29 28.93,0.29 C19.6129563,0.29 12.06,7.84295627 12.06,17.16 L12.06,24.3 L0.14,24.3 L0.14,74.64 L57.71,74.64 L57.71,24.31 L45.8,24.31 Z M14.05,17.16 C14.05,8.94752577 20.7075258,2.29 28.92,2.29 C37.1324742,2.29 43.79,8.94752577 43.79,17.16 L43.79,24.3 L14.05,24.3 L14.05,17.16 Z M55.71,72.64 L2.14,72.64 L2.14,26.31 L55.71,26.31 L55.71,72.64 Z\",\n    id: \"Shape\",\n    fillRule: \"nonzero\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M28.93,37.33 C26.5550177,37.3567611 24.5749652,39.154747 24.319954,41.5161505 C24.0649429,43.8775541 25.6154871,46.0568139 27.93,46.59 L27.93,62.54 L29.93,62.54 L29.93,46.6 C32.2445129,46.0668139 33.7950571,43.8875541 33.540046,41.5261505 C33.2850348,39.164747 31.3049823,37.3667611 28.93,37.34 L28.93,37.33 Z\",\n    id: \"Path\"\n  }))))));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgPermissionDeniedLock);\nexport default __webpack_public_path__ + \"static/media/permission-denied-lock.16036747d57cd663d7df223781a447b2.svg\";\nexport { ForwardRef as ReactComponent };","/**\n * NOTE: this code file was automatically migrated to TypeScript using ts-migrate and\n * may contain multiple `any` type annotations and `@ts-expect-error` directives.\n * If possible, please improve types while making changes to this file. If the type\n * annotations are already looking good, please remove this comment.\n */\n\nimport React from 'react';\nimport permissionDeniedLock from '../../common/static/permission-denied-lock.svg';\nimport { useDesignSystemTheme } from '@databricks/design-system';\n\nconst defaultMessage = 'The current user does not have permission to view this page.';\n\ntype Props = {\n  errorMessage?: string;\n};\n\nexport function PermissionDeniedView({ errorMessage }: Props) {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div className='center'>\n      <img\n        style={{ height: 300, marginTop: 80 }}\n        src={permissionDeniedLock}\n        alt='permission denied'\n      />\n      <h1 style={{ paddingTop: 10 }}>Permission Denied</h1>\n      <h2 data-testid='error-message' css={{ color: theme.colors.textSecondary }}>\n        {errorMessage || defaultMessage}\n      </h2>\n    </div>\n  );\n}\n","import React from 'react';\n\nexport interface ExperimentViewArtifactLocationProps {\n  artifactLocation: string;\n}\n\nexport const ExperimentViewArtifactLocation = ({\n  artifactLocation,\n}: ExperimentViewArtifactLocationProps) => {\n  return <>{artifactLocation}</>;\n};\n","import { Typography } from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { ExperimentEntity } from '../../../types';\nimport { ExperimentViewArtifactLocation } from './ExperimentViewArtifactLocation';\n\nexport const ExperimentViewDescriptions = React.memo(\n  ({ experiment }: { experiment: ExperimentEntity }) => (\n    <div css={styles.container}>\n      <Typography.Text color='secondary'>\n        <FormattedMessage\n          defaultMessage='Experiment ID'\n          description='Label for displaying the current experiment in view'\n        />\n        : {experiment.experiment_id}\n      </Typography.Text>\n      <Typography.Text color='secondary'>\n        <FormattedMessage\n          defaultMessage='Artifact Location'\n          description='Label for displaying the experiment artifact location'\n        />\n        : <ExperimentViewArtifactLocation artifactLocation={experiment.artifact_location} />\n      </Typography.Text>\n    </div>\n  ),\n);\n\nconst styles = {\n  container: (theme: Theme) => ({\n    display: 'flex' as const,\n    gap: theme.spacing.lg,\n  }),\n};\n","import { useContext } from 'react';\n\nimport { GetExperimentsContext } from '../contexts/GetExperimentsContext';\n\nexport const useFetchExperiments = () => {\n  const getExperimentsContext = useContext(GetExperimentsContext);\n\n  if (!getExperimentsContext) {\n    throw new Error('Trying to use GetExperimentsContext actions outside of the context!');\n  }\n\n  return getExperimentsContext;\n};\n","import { Button } from '@databricks/design-system';\nimport React, { useCallback, useState } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { useSelector } from 'react-redux';\nimport { CollapsibleSection } from '../../../../common/components/CollapsibleSection';\nimport { EditableNote } from '../../../../common/components/EditableNote';\nimport { getExperimentTags } from '../../../reducers/Reducers';\nimport { ExperimentEntity, KeyValueEntity } from '../../../types';\nimport { NOTE_CONTENT_TAG } from '../../../utils/NoteUtils';\nimport { useAsyncDispatch } from '../hooks/useAsyncDispatch';\nimport { useFetchExperiments } from '../hooks/useFetchExperiments';\n\nconst extractNoteFromTags = (tags: Record<string, KeyValueEntity>) =>\n  Object.values(tags).find((t) => t.getKey() === NOTE_CONTENT_TAG)?.value || undefined;\n\nexport interface ExperimentViewNotesProps {\n  experiment: ExperimentEntity;\n}\n\n/**\n * ExperimentView part responsible for displaying/editing note.\n *\n * Consumes note from the redux store and dispatches\n * `setExperimentTagApi` redux action from the context.\n */\nexport const ExperimentViewNotes = React.memo(({ experiment }: ExperimentViewNotesProps) => {\n  const storedNote = useSelector((state) => {\n    const tags = getExperimentTags(experiment.experiment_id, state);\n    return tags ? extractNoteFromTags(tags) : '';\n  });\n\n  const [showNotesEditor, setShowNotesEditor] = useState(false);\n\n  const {\n    actions: { setExperimentTagApi },\n  } = useFetchExperiments();\n\n  const dispatch = useAsyncDispatch();\n\n  const handleSubmitEditNote = useCallback(\n    (updatedNote: any) => {\n      const action = setExperimentTagApi(experiment.experiment_id, NOTE_CONTENT_TAG, updatedNote);\n      dispatch(action).then(() => setShowNotesEditor(false));\n    },\n    [experiment.experiment_id, setExperimentTagApi, dispatch],\n  );\n\n  return (\n    <CollapsibleSection\n      title={\n        <span css={styles.collapsibleSectionHeader}>\n          <FormattedMessage\n            defaultMessage='Description'\n            description='Header for displaying notes for the experiment table'\n          />{' '}\n          {!showNotesEditor && (\n            <Button type='link' onClick={() => setShowNotesEditor(true)}>\n              <FormattedMessage\n                defaultMessage='Edit'\n                // eslint-disable-next-line max-len\n                description='Text for the edit button next to the description section title on the experiment view page'\n              />\n            </Button>\n          )}\n        </span>\n      }\n      forceOpen={showNotesEditor}\n      defaultCollapsed={!storedNote}\n      data-test-id='experiment-notes-section'\n    >\n      <EditableNote\n        // @ts-expect-error TS(2322): Type '{ defaultMarkdown: string | undefined; onSub... Remove this comment to see the full error message\n        defaultMarkdown={storedNote}\n        onSubmit={handleSubmitEditNote}\n        onCancel={() => setShowNotesEditor(false)}\n        showEditor={showNotesEditor}\n      />\n    </CollapsibleSection>\n  );\n});\n\nconst styles = {\n  collapsibleSectionHeader: {\n    height: '32px',\n    lineHeight: '32px',\n  },\n};\n","import { CopyIcon, Typography } from '@databricks/design-system';\nimport { useIntl } from 'react-intl';\nimport { ExperimentEntity } from '../../../../types';\n\n/**\n * Experiment page header part responsible for copying\n * the title after clicking on the icon\n */\nexport const ExperimentViewCopyTitle = ({ experiment }: { experiment: ExperimentEntity }) => {\n  const intl = useIntl();\n\n  return (\n    <Typography.Text\n      size='xl'\n      dangerouslySetAntdProps={{\n        copyable: {\n          text: experiment.name,\n          icon: <CopyIcon />,\n          tooltips: [\n            intl.formatMessage({\n              defaultMessage: 'Copy path',\n              description: 'Copy tooltip to copy experiment path from experiment runs table header',\n            }),\n            intl.formatMessage({\n              defaultMessage: 'Path copied',\n              description:\n                'Tooltip displayed after experiment path was successfully copied to clipboard',\n            }),\n          ],\n        },\n      }}\n    />\n  );\n};\n","/**\n * NOTE: this code file was automatically migrated to TypeScript using ts-migrate and\n * may contain multiple `any` type annotations and `@ts-expect-error` directives.\n * If possible, please improve types while making changes to this file. If the type\n * annotations are already looking good, please remove this comment.\n */\n\nimport React, { useState } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { Button, Tooltip } from '@databricks/design-system';\n\ntype Props = {\n  copyText: string;\n  showLabel?: React.ReactNode;\n  icon?: React.ReactNode;\n};\n\nexport const CopyButton = ({ copyText, showLabel = true, icon }: Props) => {\n  const [showTooltip, setShowTooltip] = useState(false);\n\n  const handleClick = () => {\n    navigator.clipboard.writeText(copyText);\n    setShowTooltip(true);\n    setTimeout(() => {\n      setShowTooltip(false);\n    }, 3000);\n  };\n\n  const handleMouseLeave = () => {\n    setShowTooltip(false);\n  };\n\n  return (\n    <Tooltip\n      title={\n        <FormattedMessage\n          defaultMessage='Copied'\n          description='Tooltip text shown when copy operation completes'\n        />\n      }\n      dangerouslySetAntdProps={{\n        visible: showTooltip,\n      }}\n    >\n      <Button\n        type='primary'\n        onClick={handleClick}\n        onMouseLeave={handleMouseLeave}\n        icon={icon}\n        css={{ 'z-index': 1 }}\n      >\n        {showLabel && (\n          <FormattedMessage defaultMessage='Copy' description='Button text for copy button' />\n        )}\n      </Button>\n    </Tooltip>\n  );\n};\n","/**\n * NOTE: this code file was automatically migrated to TypeScript using ts-migrate and\n * may contain multiple `any` type annotations and `@ts-expect-error` directives.\n * If possible, please improve types while making changes to this file. If the type\n * annotations are already looking good, please remove this comment.\n */\n\nimport React from 'react';\nimport { Input } from '@databricks/design-system';\nimport { CopyButton } from './CopyButton';\n\ntype Props = {\n  copyText: string;\n};\n\nexport const CopyBox = ({ copyText }: Props) => (\n  <div css={{ display: 'flex', gap: 4 }}>\n    <Input readOnly value={copyText} data-test-id='copy-box' />\n    <CopyButton copyText={copyText} />\n  </div>\n);\n","/**\n * NOTE: this code file was automatically migrated to TypeScript using ts-migrate and\n * may contain multiple `any` type annotations and `@ts-expect-error` directives.\n * If possible, please improve types while making changes to this file. If the type\n * annotations are already looking good, please remove this comment.\n */\n\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { Modal } from '@databricks/design-system';\nimport { CopyBox } from '../../../shared/building_blocks/CopyBox';\n\ntype Props = {\n  visible: boolean;\n  onCancel: (...args: any[]) => any;\n  link: string;\n};\n\nexport const GetLinkModal = ({ visible, onCancel, link }: Props) => {\n  return (\n    <Modal\n      title={\n        <FormattedMessage defaultMessage='Get Link' description={'Title text for get-link modal'} />\n      }\n      visible={visible}\n      onCancel={onCancel}\n    >\n      <CopyBox copyText={link} />\n    </Modal>\n  );\n};\n","import { Button } from '@databricks/design-system';\nimport { useState } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { GetLinkModal } from '../../../modals/GetLinkModal';\n\n/**\n * Experiment page header part responsible for displaying button\n * that displays modal for sharing the link\n */\nexport const ExperimentViewHeaderShareButton = () => {\n  const [showGetLinkModal, setShowGetLinkModal] = useState(false);\n\n  return (\n    <>\n      <GetLinkModal\n        link={window.location.href}\n        visible={showGetLinkModal}\n        onCancel={() => setShowGetLinkModal(false)}\n      />\n      {/* TODO: ensure that E2E tests are working after refactor is complete */}\n      <Button type='primary' onClick={() => setShowGetLinkModal(true)} data-test-id='share-button'>\n        <FormattedMessage\n          defaultMessage='Share'\n          description='Text for share button on experiment view page header'\n        />\n      </Button>\n    </>\n  );\n};\n","import React, { useMemo } from 'react';\nimport { Theme } from '@emotion/react';\nimport { Button, NewWindowIcon } from '@databricks/design-system';\nimport { FormattedMessage } from 'react-intl';\nimport { PageHeader } from '../../../../../shared/building_blocks/PageHeader';\nimport { ExperimentViewCopyTitle } from './ExperimentViewCopyTitle';\nimport { ExperimentViewHeaderShareButton } from './ExperimentViewHeaderShareButton';\nimport { ExperimentEntity } from '../../../../types';\nimport { useExperimentPageFeedbackUrl } from '../../hooks/useExperimentPageFeedbackUrl';\n\n/**\n * Header for a single experiment page. Displays title, breadcrumbs and provides\n * controls for renaming, deleting and editing permissions.\n */\nexport const ExperimentViewHeader = React.memo(\n  ({ experiment }: { experiment: ExperimentEntity }) => {\n    // eslint-disable-next-line prefer-const\n    let breadcrumbs: React.ReactNode[] = [];\n\n    /**\n     * Extract the last part of the experiment name\n     */\n    const normalizedExperimentName = useMemo(\n      () => experiment.name.split('/').pop(),\n      [experiment.name],\n    );\n\n    const feedbackFormUrl = useExperimentPageFeedbackUrl();\n\n    /* eslint-disable prettier/prettier */\n    return (\n      <PageHeader\n        title={\n          <div css={styles.headerWrapper}>\n            {normalizedExperimentName} <ExperimentViewCopyTitle experiment={experiment} />{' '}\n            {feedbackFormUrl && (\n                <a href={feedbackFormUrl} target='_blank' rel='noreferrer'>\n                  <Button css={{ marginLeft: 16 }} type='link' size='small'>\n                    <FormattedMessage\n                      defaultMessage='Provide Feedback'\n                      description='Link to a survey for users to give feedback'\n                    />\n                  </Button>\n                  <NewWindowIcon css={{ marginLeft: 4 }} />\n                </a>\n            )}\n          </div>\n        }\n        breadcrumbs={breadcrumbs}\n      >\n          <ExperimentViewHeaderShareButton />\n      </PageHeader>\n    );\n    /* eslint-enable prettier/prettier */\n  },\n);\n\nconst styles = {\n  sendFeedbackPopoverContent: {\n    display: 'flex',\n    maxWidth: 250,\n    flexDirection: 'column' as const,\n    alignItems: 'flex-end',\n  },\n  headerWrapper: (theme: Theme) => ({\n    display: 'inline-flex',\n    gap: theme.spacing.sm,\n    alignItems: 'center',\n  }),\n};\n","import React, { useMemo } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { PageHeader } from '../../../../../shared/building_blocks/PageHeader';\nimport { ExperimentViewHeaderShareButton } from './ExperimentViewHeaderShareButton';\nimport { ExperimentEntity } from '../../../../types';\n\n/**\n * Header for experiment compare page. Displays title and breadcrumbs.\n */\nexport const ExperimentViewHeaderCompare = React.memo(\n  ({ experiments }: { experiments: ExperimentEntity[] }) => {\n    const pageTitle = useMemo(\n      () => (\n        <FormattedMessage\n          defaultMessage='Displaying Runs from {numExperiments} Experiments'\n          description='Message shown when displaying runs from multiple experiments'\n          values={{\n            numExperiments: experiments.length,\n          }}\n        />\n      ),\n      [experiments.length],\n    );\n\n    // eslint-disable-next-line prefer-const\n    let breadcrumbs: React.ReactNode[] = [];\n\n    /* eslint-disable prettier/prettier */\n    return (\n      <PageHeader title={pageTitle} breadcrumbs={breadcrumbs}>\n        <ExperimentViewHeaderShareButton />\n      </PageHeader>\n    );\n    /* eslint-enable prettier/prettier */\n  },\n);\n","import {\n  ExperimentEntity,\n  ExperimentStoreEntities,\n  KeyValueEntity,\n  LIFECYCLE_FILTER,\n  ModelVersionInfoEntity,\n  MODEL_VERSION_FILTER,\n  DatasetSummary,\n  RunInfoEntity,\n  RunDatasetWithTags,\n} from '../../../types';\nimport { getLatestMetrics } from '../../../reducers/MetricReducer';\nimport {\n  getExperimentTags,\n  getParams,\n  getRunDatasets,\n  getRunInfo,\n  getRunTags,\n} from '../../../reducers/Reducers';\n\nexport type ExperimentRunsSelectorResult = {\n  /**\n   * Array of run infos\n   */\n  runInfos: RunInfoEntity[];\n\n  /**\n   * List of unique metric keys\n   */\n  runUuidsMatchingFilter: string[];\n\n  /**\n   * List of unique metric keys\n   */\n  metricKeyList: string[];\n\n  /**\n   * List of unique param keys\n   */\n  paramKeyList: string[];\n\n  /**\n   * List of metrics indexed by the respective runs.\n   * Example: metricsList[2] contains list of all\n   * metrics corresponding to the 3rd run in the run list\n   */\n  metricsList: KeyValueEntity[][];\n\n  /**\n   * List of metrics indexed by the respective runs.\n   * Example: paramsList[2] contains list of all\n   * params corresponding to the 3rd run in the run list\n   */\n  paramsList: KeyValueEntity[][];\n\n  /**\n   * List of tags indexed by the respective runs.\n   * Example: tagsList[2] contains dictionary of all\n   * tags corresponding to the 3rd run in the run list\n   */\n  tagsList: Record<string, KeyValueEntity>[];\n\n  /**\n   * Dictionary containing model information objects indexed by run uuid\n   */\n  modelVersionsByRunUuid: Record<string, ModelVersionInfoEntity[]>;\n\n  /**\n   * Dictionary containing all tags assigned to a experiment\n   * (single experiment only)\n   */\n  experimentTags: Record<string, KeyValueEntity>;\n\n  /**\n   * List of dataset arrays indexed by the respective runs.\n   * E.g. datasetsList[2] yields an array of all\n   * datasets corresponding to the 3rd run in the run list\n   */\n  datasetsList: RunDatasetWithTags[][];\n};\n\nexport type ExperimentRunsSelectorParams = {\n  experiments: ExperimentEntity[];\n  lifecycleFilter?: LIFECYCLE_FILTER;\n  modelVersionFilter?: MODEL_VERSION_FILTER;\n  datasetsFilter?: DatasetSummary[];\n};\n\n/**\n * Extracts run infos filtered by lifecycle filter and model version filter\n */\nconst extractRunInfos = (\n  runUuids: string[],\n  state: { entities: ExperimentStoreEntities },\n  {\n    lifecycleFilter = LIFECYCLE_FILTER.ACTIVE,\n    modelVersionFilter = MODEL_VERSION_FILTER.ALL_RUNS,\n    datasetsFilter = [],\n  }: ExperimentRunsSelectorParams,\n): RunInfoEntity[] => {\n  const { modelVersionsByRunUuid } = state.entities;\n\n  return (\n    runUuids\n      // Get the basic run info\n      .map((run_id) => [getRunInfo(run_id, state), getRunDatasets(run_id, state)])\n      // Filter out runs by given lifecycle filter\n      .filter(([rInfo, _]) => {\n        if (lifecycleFilter === LIFECYCLE_FILTER.ACTIVE) {\n          return rInfo.lifecycle_stage === 'active';\n        } else {\n          return rInfo.lifecycle_stage === 'deleted';\n        }\n      })\n      // Filter out runs by given model version filter\n      .filter(([rInfo, _]) => {\n        if (modelVersionFilter === MODEL_VERSION_FILTER.ALL_RUNS) {\n          return true;\n        } else if (modelVersionFilter === MODEL_VERSION_FILTER.WITH_MODEL_VERSIONS) {\n          return rInfo.run_uuid in modelVersionsByRunUuid;\n        } else if (modelVersionFilter === MODEL_VERSION_FILTER.WTIHOUT_MODEL_VERSIONS) {\n          return !(rInfo.run_uuid in modelVersionsByRunUuid);\n        } else {\n          console.warn('Invalid input to model version filter - defaulting to showing all runs.');\n          return true;\n        }\n      })\n      .filter(([_, datasets]) => {\n        if (!datasetsFilter || datasetsFilter.length === 0) return true;\n        if (!datasets) return false;\n\n        // Returns true if there exists a dataset that is in datasetsFilter\n        return datasets.some((datasetWithTags: RunDatasetWithTags) => {\n          const datasetName = datasetWithTags.dataset.name;\n          const datasetDigest = datasetWithTags.dataset.digest;\n          const datasetTag = datasetWithTags.tags\n            ? datasetWithTags.tags.find((tag) => tag.key === 'mlflow.data.context')\n            : undefined;\n          return datasetsFilter.some(\n            ({ name, digest, context }) =>\n              name === datasetName &&\n              digest === datasetDigest &&\n              (datasetTag ? context === datasetTag.value : context === undefined),\n          );\n        });\n      })\n      .map(([rInfo, _]) => rInfo)\n  );\n};\n\nexport const experimentRunsSelector = (\n  state: { entities: ExperimentStoreEntities },\n  params: ExperimentRunsSelectorParams,\n): ExperimentRunsSelectorResult => {\n  const { experiments } = params;\n  const experimentIds = experiments.map((e) => e.experiment_id);\n  const comparingExperiments = experimentIds.length > 1;\n\n  /**\n   * Extract run UUIDs relevant to selected experiments\n   */\n  const runUuids = Object.values(state.entities.runInfosByUuid)\n    .filter(({ experiment_id }) => experimentIds.includes(experiment_id))\n    .map(({ run_uuid }) => run_uuid);\n\n  /**\n   * Extract model version and runs matching filter directly from the store\n   */\n  const { modelVersionsByRunUuid, runUuidsMatchingFilter } = state.entities;\n\n  /**\n   * Extract run infos\n   */\n  const runInfos = extractRunInfos(runUuids, state, params);\n\n  /**\n   * Set of unique metric keys\n   */\n  const metricKeysSet = new Set<string>();\n\n  /**\n   * Set of unique param keys\n   */\n  const paramKeysSet = new Set<string>();\n\n  const datasetsList = runInfos.map((runInfo) => {\n    return state.entities.runDatasetsByUuid[runInfo.run_uuid];\n  });\n\n  /**\n   * Extracting lists of metrics by run index\n   */\n  const metricsList = runInfos.map((runInfo) => {\n    const metricsByRunUuid = getLatestMetrics(runInfo.run_uuid, state);\n    const metrics = Object.values(metricsByRunUuid || {}) as any[];\n    metrics.forEach((metric) => {\n      metricKeysSet.add(metric.key);\n    });\n    return metrics;\n  }) as KeyValueEntity[][];\n\n  /**\n   * Extracting lists of params by run index\n   */\n  const paramsList = runInfos.map((runInfo) => {\n    const paramValues = Object.values(getParams(runInfo.run_uuid, state)) as any[];\n    paramValues.forEach((param) => {\n      paramKeysSet.add(param.key);\n    });\n    return paramValues;\n  }) as KeyValueEntity[][];\n\n  /**\n   * Extracting dictionaries of tags by run index\n   */\n  const tagsList = runInfos.map((runInfo) => getRunTags(runInfo.run_uuid, state)) as Record<\n    string,\n    KeyValueEntity\n  >[];\n\n  const firstExperimentId = experimentIds[0];\n\n  /**\n   * If there is only one experiment, extract experiment tags as well\n   */\n  const experimentTags = (\n    comparingExperiments ? {} : getExperimentTags(firstExperimentId, state)\n  ) as Record<string, KeyValueEntity>;\n\n  return {\n    modelVersionsByRunUuid,\n    experimentTags,\n    runInfos,\n    paramsList,\n    tagsList,\n    metricsList,\n    runUuidsMatchingFilter,\n    datasetsList,\n    metricKeyList: Array.from(metricKeysSet.values()).sort(),\n    paramKeyList: Array.from(paramKeysSet.values()).sort(),\n  };\n};\n","import { SortAscendingIcon, SortDescendingIcon } from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport React from 'react';\n\nexport interface ColumnHeaderCellProps {\n  enableSorting: boolean;\n  displayName: string;\n  canonicalSortKey: string;\n  orderByAsc: boolean;\n  orderByKey: string;\n  onSortBy: (sortKey: string, newOrder: boolean) => void;\n  getClassName: (sortKey: string) => string;\n}\n\nexport class ColumnHeaderCell extends React.Component<ColumnHeaderCellProps> {\n  handleSortBy() {\n    const { canonicalSortKey, orderByAsc, orderByKey } = this.props;\n    let newOrderByAsc = !orderByAsc;\n\n    // If the new sortKey is not equal to the previous sortKey, reset the orderByAsc\n    if (canonicalSortKey !== orderByKey) {\n      newOrderByAsc = false;\n    }\n\n    this.props.onSortBy(canonicalSortKey, newOrderByAsc);\n  }\n\n  render() {\n    const {\n      enableSorting,\n      canonicalSortKey,\n      displayName,\n      getClassName = () => '',\n      orderByKey,\n      orderByAsc,\n    } = this.props;\n\n    return (\n      // eslint-disable-next-line jsx-a11y/click-events-have-key-events, jsx-a11y/interactive-supports-focus\n      <div\n        role='columnheader'\n        css={styles.headerLabelWrapper(enableSorting)}\n        className={getClassName(canonicalSortKey)}\n        onClick={enableSorting ? () => this.handleSortBy() : undefined}\n      >\n        <span data-test-id={`sort-header-${displayName}`}>{displayName}</span>\n        {enableSorting && canonicalSortKey === orderByKey ? (\n          orderByAsc ? (\n            <SortAscendingIcon />\n          ) : (\n            <SortDescendingIcon />\n          )\n        ) : null}\n      </div>\n    );\n  }\n}\n\nconst styles = {\n  headerLabelWrapper: (sortable: boolean) => (theme: Theme) => ({\n    height: '100%',\n    width: '100%',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    padding: '0 12px',\n    svg: {\n      color: theme.colors.textSecondary,\n    },\n    '&:hover': {\n      color: sortable ? theme.colors.actionTertiaryTextHover : 'unset',\n      svg: {\n        color: theme.colors.actionTertiaryTextHover,\n      },\n    },\n  }),\n\n  headerSortIcon: {\n    marginRight: 4,\n  },\n};\n","import { CheckCircleIcon, ClockIcon, XCircleIcon } from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport React from 'react';\nimport Utils from '../../../../../../common/utils/Utils';\nimport { RunRowDateAndNestInfo } from '../../../utils/experimentPage.row-types';\n\nconst ErrorIcon = () => (\n  <XCircleIcon css={(theme) => ({ color: theme.colors.textValidationDanger })} />\n);\n\nconst FinishedIcon = () => (\n  <CheckCircleIcon css={(theme) => ({ color: theme.colors.textValidationSuccess })} />\n);\n\nconst getRunStatusIcon = (status: string) => {\n  switch (status) {\n    case 'FAILED':\n    case 'KILLED':\n      return <ErrorIcon />;\n    case 'FINISHED':\n      return <FinishedIcon />;\n    case 'SCHEDULED':\n      return <ClockIcon />; // This one is the same color as the link\n    default:\n      return null;\n  }\n};\n\nexport interface DateCellRendererProps {\n  value: RunRowDateAndNestInfo;\n}\n\nexport const DateCellRenderer = React.memo(\n  ({ value: { startTime, referenceTime, runStatus } }: DateCellRendererProps) => {\n    return (\n      <span css={styles.cellWrapper} title={Utils.formatTimestamp(startTime)}>\n        {getRunStatusIcon(runStatus)}\n        {Utils.timeSinceStr(startTime, referenceTime)}\n      </span>\n    );\n  },\n);\n\nconst styles = {\n  cellWrapper: (theme: Theme) => ({\n    display: 'flex',\n    alignItems: 'center',\n    gap: theme.spacing.sm,\n    svg: {\n      width: 14,\n      height: 14,\n    },\n  }),\n};\n","import React from 'react';\nimport { Link } from '../../../../../../common/utils/RoutingUtils';\nimport Routes from '../../../../../routes';\nimport { RunRowType } from '../../../utils/experimentPage.row-types';\n\nexport interface ExperimentNameCellRendererProps {\n  value: {\n    name: string;\n    basename: string;\n  };\n  data: RunRowType;\n}\n\nexport const ExperimentNameCellRenderer = React.memo(\n  ({ data, value }: ExperimentNameCellRendererProps) => (\n    <Link to={Routes.getExperimentPageRoute(data.experimentId)} title={value.name}>\n      {value.basename}\n    </Link>\n  ),\n);\n","/**\n * NOTE: this code file was automatically migrated to TypeScript using ts-migrate and\n * may contain multiple `any` type annotations and `@ts-expect-error` directives.\n * If possible, please improve types while making changes to this file. If the type\n * annotations are already looking good, please remove this comment.\n */\n\nimport React, { useState } from 'react';\nimport { Button } from '@databricks/design-system';\n\ntype Props = {\n  text: string;\n  maxSize: number;\n  className: string;\n  allowShowMore?: boolean;\n};\n\nexport const TrimmedText = ({ text, maxSize, className, allowShowMore = false }: Props) => {\n  if (text.length <= maxSize) {\n    return <span className={className}>{text}</span>;\n  }\n  const trimmedText = `${text.substr(0, maxSize)}...`;\n  // Reported during ESLint upgrade\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const [showMore, setShowMore] = useState(false);\n  return (\n    <span className={className}>\n      {showMore ? text : trimmedText}\n      {allowShowMore && (\n        <Button\n          type='link'\n          onClick={() => setShowMore(!showMore)}\n          size='small'\n          css={styles.expandButton}\n          data-test-id='trimmed-text-button'\n        >\n          {showMore ? 'collapse' : 'expand'}\n        </Button>\n      )}\n    </span>\n  );\n};\n\nconst styles = {\n  expandButton: {\n    display: 'inline-block',\n  },\n};\n","var _path;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nfunction SvgLoggedModel(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 12,\n    height: 14,\n    viewBox: \"0 0 12 14\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M7.7265 0.726585C7.47317 0.473252 7.13317 0.333252 6.77984 0.333252H1.99984C1.2665 0.333252 0.666504 0.933252 0.666504 1.66659V12.3333C0.666504 13.0666 1.25984 13.6666 1.99317 13.6666H9.99984C10.7332 13.6666 11.3332 13.0666 11.3332 12.3333V4.88658C11.3332 4.53325 11.1932 4.19325 10.9398 3.94659L7.7265 0.726585ZM6.66648 4.33333V1.33333L10.3331 5H7.33315C6.96648 5 6.66648 4.7 6.66648 4.33333ZM5.99982 6.33333C5.99982 6.64213 5.92984 6.93457 5.80487 7.19568L7.13747 8.52828C7.39858 8.40331 7.69103 8.33333 7.99982 8.33333C9.10439 8.33333 9.99982 9.22876 9.99982 10.3333C9.99982 11.4379 9.10439 12.3333 7.99982 12.3333C6.89525 12.3333 5.99982 11.4379 5.99982 10.3333C5.99982 10.0246 6.06977 9.7322 6.1947 9.47113L4.86202 8.13845C4.60095 8.26338 4.30855 8.33333 3.99982 8.33333C2.89525 8.33333 1.99982 7.4379 1.99982 6.33333C1.99982 5.22876 2.89525 4.33333 3.99982 4.33333C5.10439 4.33333 5.99982 5.22876 5.99982 6.33333ZM3.99982 7.00008C4.36801 7.00008 4.66648 6.7016 4.66648 6.33342C4.66648 5.96523 4.36801 5.66675 3.99982 5.66675C3.63163 5.66675 3.33315 5.96523 3.33315 6.33342C3.33315 6.7016 3.63163 7.00008 3.99982 7.00008ZM8.66648 10.3334C8.66648 10.7016 8.36801 11.0001 7.99982 11.0001C7.63163 11.0001 7.33315 10.7016 7.33315 10.3334C7.33315 9.96522 7.63163 9.66675 7.99982 9.66675C8.36801 9.66675 8.66648 9.96522 8.66648 10.3334Z\",\n    fill: \"#6B6B6B\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgLoggedModel);\nexport default __webpack_public_path__ + \"static/media/logged-model.dd9b21ff4fb07f3cadeada8046a2693b.svg\";\nexport { ForwardRef as ReactComponent };","var _circle, _circle2, _circle3, _circle4, _line, _line2, _line3, _line4, _line5;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nfunction SvgRegisteredModel(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 14,\n    height: 14,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 9,\n    cy: 20,\n    r: 2,\n    stroke: \"#2374bb\",\n    strokeWidth: 2\n  })), _circle2 || (_circle2 = /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 4,\n    cy: 7,\n    r: 2,\n    stroke: \"#2374bb\",\n    strokeWidth: 2\n  })), _circle3 || (_circle3 = /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 20,\n    cy: 4,\n    r: 2,\n    stroke: \"#2374bb\",\n    strokeWidth: 2\n  })), _circle4 || (_circle4 = /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 19,\n    cy: 15,\n    r: 2,\n    stroke: \"#2374bb\",\n    strokeWidth: 2\n  })), _line || (_line = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 8.05132,\n    y1: 18.3162,\n    x2: 5.05132,\n    y2: 9.31623,\n    stroke: \"#2374bb\",\n    strokeWidth: 2\n  })), _line2 || (_line2 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 5.77514,\n    y1: 7.02561,\n    x2: 18.7751,\n    y2: 4.02561,\n    stroke: \"#2374bb\",\n    strokeWidth: 2\n  })), _line3 || (_line3 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 19.0101,\n    y1: 12.8586,\n    x2: 20.01,\n    y2: 5.85858,\n    stroke: \"#2374bb\",\n    strokeWidth: 2\n  })), _line4 || (_line4 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 11.5528,\n    y1: 19.1056,\n    x2: 17.5528,\n    y2: 16.1056,\n    stroke: \"#2374bb\",\n    strokeWidth: 2\n  })), _line5 || (_line5 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 17.5528,\n    y1: 13.8944,\n    x2: 5.55279,\n    y2: 7.89443,\n    stroke: \"#2374bb\",\n    strokeWidth: 2\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgRegisteredModel);\nexport default __webpack_public_path__ + \"static/media/registered-model.24429a4f6158e57b01b3928e2605aa25.svg\";\nexport { ForwardRef as ReactComponent };","import React from 'react';\nimport { Tooltip } from '@databricks/design-system';\nimport { TrimmedText } from '../../../../../../common/components/TrimmedText';\nimport loggedModelSvg from '../../../../../../common/static/logged-model.svg';\nimport registeredModelSvg from '../../../../../../common/static/registered-model.svg';\nimport Utils from '../../../../../../common/utils/Utils';\nimport { getModelVersionPageRoute } from '../../../../../../model-registry/routes';\nimport Routes from '../../../../../routes';\nimport { RunRowModelsInfo } from '../../../utils/experimentPage.row-types';\n\nconst EMPTY_CELL_PLACEHOLDER = '-';\n\nexport interface ModelsCellRendererProps {\n  value: RunRowModelsInfo;\n}\n\nexport const ModelsCellRenderer = React.memo((props: ModelsCellRendererProps) => {\n  const { registeredModels, loggedModels, experimentId, runUuid } = props.value;\n  const models = Utils.mergeLoggedAndRegisteredModels(loggedModels, registeredModels);\n\n  if (models && models.length) {\n    // TODO: type is wrongly inferred as boolean\n    const modelToRender = models[0] as any;\n    let modelDiv;\n    if (modelToRender.registeredModelName) {\n      const { registeredModelName, registeredModelVersion } = modelToRender;\n      // eslint-disable-next-line prefer-const\n      let mvPageRoute = Utils.getIframeCorrectedRoute(\n        getModelVersionPageRoute(registeredModelName, registeredModelVersion),\n      );\n      // eslint-disable-next-line prefer-const\n      let displayName = registeredModelName;\n      const displayFullName = `${registeredModelName} version ${registeredModelVersion}`;\n      modelDiv = (\n        <>\n          <img\n            data-test-id='registered-model-icon'\n            alt=''\n            title='Registered Model'\n            src={registeredModelSvg}\n          />\n          <Tooltip title={displayFullName}>\n            <a\n              href={mvPageRoute}\n              className='registered-model-link'\n              target='_blank'\n              rel='noreferrer'\n            >\n              <TrimmedText text={displayName} maxSize={10} className={'model-name'} />\n              {`/${registeredModelVersion}`}\n            </a>\n          </Tooltip>\n        </>\n      );\n    } else if (modelToRender.flavors) {\n      const loggedModelFlavorText = modelToRender.flavors ? modelToRender.flavors[0] : 'Model';\n      const loggedModelLink = Utils.getIframeCorrectedRoute(\n        `${Routes.getRunPageRoute(experimentId, runUuid)}/artifactPath/${\n          modelToRender.artifactPath\n        }`,\n      );\n      modelDiv = (\n        <>\n          <img data-test-id='logged-model-icon' alt='' title='Logged Model' src={loggedModelSvg} />\n          {/* Reported during ESLint upgrade */}\n          {/* eslint-disable-next-line react/jsx-no-target-blank */}\n          <a href={loggedModelLink} target='_blank' className='logged-model-link'>\n            {loggedModelFlavorText}\n          </a>\n        </>\n      );\n    }\n\n    return (\n      <div className='logged-model-cell' css={styles.imageWrapper}>\n        {modelDiv}\n        {loggedModels.length > 1 ? `, ${loggedModels.length - 1} more` : ''}\n      </div>\n    );\n  }\n  return <>{EMPTY_CELL_PLACEHOLDER}</>;\n});\n\nconst styles = {\n  imageWrapper: {\n    img: {\n      height: '15px',\n      position: 'relative' as const,\n      marginRight: '4px',\n    },\n  },\n};\n","import React from 'react';\nimport Utils from '../../../../../../common/utils/Utils';\nimport { RunRowType } from '../../../utils/experimentPage.row-types';\n\nexport const SourceCellRenderer = React.memo(({ value }: { value: RunRowType['tags'] }) => {\n  const sourceType = Utils.renderSource(value, undefined, undefined);\n  return sourceType ? (\n    <>\n      {Utils.renderSourceTypeIcon(value)}\n      {sourceType}\n    </>\n  ) : (\n    <>-</>\n  );\n});\n","import React from 'react';\nimport Utils from '../../../../../../common/utils/Utils';\nimport { RunRowVersionInfo } from '../../../utils/experimentPage.row-types';\n\nexport const VersionCellRenderer = React.memo(\n  ({\n    value: {\n      // Run row version object parameters\n      version,\n      name,\n      type,\n    },\n  }: {\n    value: RunRowVersionInfo;\n  }) =>\n    Utils.renderSourceVersion(\n      // Using function from utils to render the source link\n      version,\n      name,\n      type,\n    ) || <>-</>,\n);\n","import {\n  PinIcon,\n  PinFillIcon,\n  Tooltip,\n  VisibleIcon,\n  VisibleOffIcon,\n} from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { RunRowType } from '../../../utils/experimentPage.row-types';\n\n// Mouse enter/leave delays passed to tooltips are set to 0 so swift toggling/pinning runs is not hampered\nconst MOUSE_DELAYS = { mouseEnterDelay: 0, mouseLeaveDelay: 0 };\n\nexport const RowActionsCellRenderer = React.memo(\n  (props: {\n    data: RunRowType;\n    value: { pinned: boolean; hidden: boolean };\n    onTogglePin: (runUuid: string) => void;\n    onToggleVisibility: (runUuid: string) => void;\n  }) => {\n    const { pinned, hidden } = props.value;\n    return (\n      <div css={styles.actionsContainer}>\n        {/* Hide/show icon is part of compare runs UI */}\n        <Tooltip\n          dangerouslySetAntdProps={MOUSE_DELAYS}\n          placement='right'\n          title={\n            hidden ? (\n              <FormattedMessage\n                defaultMessage='Unhide run'\n                description='A tooltip for the visibility icon button in the runs table next to the hidden run'\n              />\n            ) : (\n              <FormattedMessage\n                defaultMessage='Hide run'\n                description='A tooltip for the visibility icon button in the runs table next to the visible run'\n              />\n            )\n          }\n        >\n          <label css={styles.actionCheckbox} className='is-visibility-toggle'>\n            <input\n              type='checkbox'\n              checked={!hidden}\n              onChange={() => {\n                props.onToggleVisibility(props.data.runUuid);\n              }}\n            />\n            {!hidden ? <VisibleIcon /> : <VisibleOffIcon />}\n          </label>\n        </Tooltip>\n        {props.data.pinnable && (\n          <Tooltip\n            dangerouslySetAntdProps={MOUSE_DELAYS}\n            placement='right'\n            title={\n              pinned ? (\n                <FormattedMessage\n                  defaultMessage='Unpin run'\n                  description='A tooltip for the pin icon button in the runs table next to the pinned run'\n                />\n              ) : (\n                <FormattedMessage\n                  defaultMessage='Pin run'\n                  description='A tooltip for the pin icon button in the runs table next to the not pinned run'\n                />\n              )\n            }\n          >\n            <label\n              css={styles.actionCheckbox}\n              className='is-pin-toggle'\n              data-testid='column-pin-toggle'\n            >\n              <input\n                type='checkbox'\n                checked={pinned}\n                onChange={() => {\n                  props.onTogglePin(props.data.runUuid);\n                }}\n              />\n              {pinned ? <PinFillIcon /> : <PinIcon />}\n            </label>\n          </Tooltip>\n        )}\n      </div>\n    );\n  },\n  (prevProps, nextProps) =>\n    prevProps.value.hidden === nextProps.value.hidden &&\n    prevProps.value.pinned === nextProps.value.pinned,\n);\n\nconst styles = {\n  actionsContainer: () => ({\n    display: 'flex',\n    gap: 18, // In design there's 20 px of gutter, it's minus 2 px due to pin icon's internal padding\n  }),\n  actionCheckbox: (theme: Theme) => ({\n    input: { width: 0, appearance: 'none' as const },\n    cursor: 'pointer',\n    display: 'flex',\n    svg: {\n      width: 14,\n      height: 14,\n      cursor: 'pointer',\n    },\n    // Styling for the pin button - it's transparent when unpinned and not hovered\n    '&.is-pin-toggle svg': {\n      color: 'transparent',\n      '.ag-row:hover &': {\n        color: theme.colors.grey600,\n      },\n    },\n    // Styling for the show/hide button - it uses different color for active/inactive\n    '&.is-visibility-toggle svg': {\n      color: theme.colors.grey400,\n      '.ag-row:hover &': {\n        color: theme.colors.grey600,\n      },\n    },\n    '& input:checked + span svg': {\n      color: theme.colors.grey600,\n    },\n  }),\n};\n","import { DropdownMenu, VisibleIcon, VisibleOffIcon } from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { RUNS_VISIBILITY_MODE } from '../../../utils/experimentPage.common-utils';\n\n/**\n * A component used to render \"eye\" icon in the table header used to hide/show all runs\n */\nexport const RowActionsHeaderCellRenderer = React.memo(\n  (props: { onToggleVisibility: (runUuidOrToggle: string) => void }) => (\n    <DropdownMenu.Root modal={false}>\n      <DropdownMenu.Trigger asChild>\n        <button\n          css={styles.actionButton}\n          data-testid='experiment-view-runs-visibility-column-header'\n        >\n          <VisibleIcon />\n        </button>\n      </DropdownMenu.Trigger>\n\n      <DropdownMenu.Content>\n        <DropdownMenu.Item\n          onClick={() => props.onToggleVisibility(RUNS_VISIBILITY_MODE.HIDEALL)}\n          data-testid='experiment-view-runs-visibility-hide-all'\n        >\n          <DropdownMenu.IconWrapper>\n            <VisibleOffIcon />\n          </DropdownMenu.IconWrapper>\n          <FormattedMessage\n            defaultMessage='Hide all runs'\n            description='Menu option for hiding all runs in the experiment view runs compare mode'\n          />\n        </DropdownMenu.Item>\n        <DropdownMenu.Item\n          onClick={() => props.onToggleVisibility(RUNS_VISIBILITY_MODE.SHOWALL)}\n          data-testid='experiment-view-runs-visibility-show-all'\n        >\n          <DropdownMenu.IconWrapper>\n            <VisibleIcon />\n          </DropdownMenu.IconWrapper>\n          <FormattedMessage\n            defaultMessage='Show all runs'\n            description='Menu option for revealing all hidden runs in the experiment view runs compare mode'\n          />\n        </DropdownMenu.Item>\n      </DropdownMenu.Content>\n\n      {/*  */}\n    </DropdownMenu.Root>\n  ),\n);\n\nconst styles = {\n  actionButton: (theme: Theme) => ({\n    background: 'transparent',\n    border: 'none',\n    cursor: 'pointer',\n    padding: '8px',\n    // When visibility icon is next to the ag-grid checkbox, remove the bonus padding\n    '.ag-checkbox:not(.ag-hidden) + &': { padding: '0 1px' },\n    svg: {\n      width: 14,\n      height: 14,\n      cursor: 'pointer',\n      color: theme.colors.grey600,\n    },\n  }),\n};\n","import { ICellRendererParams } from '@ag-grid-community/core';\nimport { Button, MinusBoxIcon, PlusSquareIcon } from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport React from 'react';\nimport { Link } from '../../../../../../common/utils/RoutingUtils';\nimport Routes from '../../../../../routes';\nimport { RunRowType } from '../../../utils/experimentPage.row-types';\n\nexport interface RunNameCellRendererProps extends ICellRendererParams {\n  data: RunRowType;\n  onExpand: (runUuid: string, childrenIds?: string[]) => void;\n}\n\nexport const RunNameCellRenderer = React.memo(\n  ({\n    onExpand,\n    data: { runName, experimentId, runUuid, runDateAndNestInfo, color },\n  }: RunNameCellRendererProps) => {\n    const { hasExpander, expanderOpen, childrenIds, level } = runDateAndNestInfo || {};\n\n    const renderingAsParent = !isNaN(level) && hasExpander;\n\n    return (\n      <div css={styles.cellWrapper}>\n        <div css={styles.expanderWrapper}>\n          <div css={styles.nestLevel(level)}>\n            {renderingAsParent && (\n              <Button\n                css={styles.expanderButton}\n                size='small'\n                onClick={() => {\n                  onExpand(runUuid, childrenIds);\n                }}\n                key={'Expander-' + runUuid}\n                type='link'\n                icon={expanderOpen ? <MinusBoxIcon /> : <PlusSquareIcon />}\n              />\n            )}\n          </div>\n        </div>\n        <Link to={Routes.getRunPageRoute(experimentId, runUuid)} css={styles.runLink}>\n          <div\n            css={styles.colorPill}\n            data-testid='experiment-view-table-run-color'\n            style={{ backgroundColor: color }}\n          />\n          <span css={styles.runName}>{runName}</span>\n        </Link>\n      </div>\n    );\n  },\n);\n\nconst styles = {\n  link: (theme: Theme) => ({\n    display: 'inline-block',\n    minWidth: theme.typography.fontSizeBase,\n    minHeight: theme.typography.fontSizeBase,\n  }),\n  cellWrapper: {\n    display: 'flex',\n  },\n  expanderButton: {\n    svg: {\n      width: 12,\n      height: 12,\n    },\n  },\n  runLink: {\n    overflow: 'hidden',\n    display: 'flex',\n    gap: 8,\n    alignItems: 'center',\n  },\n  runName: {\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n  },\n  expanderWrapper: {\n    display: 'none',\n    '.ag-grid-expanders-visible &': {\n      display: 'block',\n    },\n  },\n  colorPill: {\n    width: 12,\n    height: 12,\n    borderRadius: 6,\n    flexShrink: 0,\n    // Straighten it up on retina-like screens\n    '@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)': {\n      marginBottom: 1,\n    },\n  },\n  nestLevel: (level: number) => (theme: Theme) => ({\n    display: 'flex',\n    justifyContent: 'flex-end',\n    width: (level + 1) * theme.spacing.lg,\n    height: theme.spacing.lg,\n  }),\n};\n","import type { ICellRendererParams } from '@ag-grid-community/core';\nimport { Button } from '@databricks/design-system';\nimport { uniqueId } from 'lodash';\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nexport const createLoadMoreRow = () => ({\n  runUuid: uniqueId('load_more'),\n  isLoadMoreRow: true,\n});\n\n/**\n * A cell renderer for special type of full width rows housing \"Load more\"\n * button displayed at the bottom of the grid\n */\nexport const LoadMoreRowRenderer = React.memo(\n  ({ loadMoreRunsFunc }: ICellRendererParams & { loadMoreRunsFunc: () => void }) => (\n    <div css={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: 32 }}>\n      <Button type='primary' onClick={loadMoreRunsFunc} size='small'>\n        <FormattedMessage\n          defaultMessage='Load more'\n          description='Load more button text to load more experiment runs'\n        />\n      </Button>\n    </div>\n  ),\n);\n","import { throttle } from 'lodash';\nimport {\n  Button,\n  Popover,\n  TableIcon,\n  Tag,\n  Typography,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport React, { useRef, useEffect, useState, useMemo } from 'react';\nimport {\n  ATTRIBUTE_COLUMN_LABELS,\n  COLUMN_TYPES,\n  MLFLOW_RUN_DATASET_CONTEXT_TAG,\n} from '../../../../../constants';\nimport type { RunDatasetWithTags } from '../../../../../types';\nimport { RunRowType } from '../../../utils/experimentPage.row-types';\nimport { makeCanonicalSortKey } from '../../../utils/experimentPage.column-utils';\nimport { shouldEnableExperimentDatasetTracking } from '../../../../../../common/utils/FeatureUtils';\nimport { EXPERIMENT_RUNS_TABLE_ROW_HEIGHT } from '../../../utils/experimentPage.common-utils';\nimport { SearchExperimentRunsFacetsState } from 'experiment-tracking/components/experiment-page/models/SearchExperimentRunsFacetsState';\nconst MAX_DATASETS_VISIBLE = 3;\n\n/**\n * Local component, used to render a single dataset within a cell\n * or a context menu\n */\nconst SingleDataset = ({\n  datasetWithTags,\n  onDatasetSelected,\n  appendComma = false,\n  inPopover = false,\n}: {\n  datasetWithTags: RunDatasetWithTags;\n  onDatasetSelected: () => void;\n  appendComma?: boolean;\n  inPopover?: boolean;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const { dataset, tags } = datasetWithTags;\n  if (!dataset) {\n    return null;\n  }\n  const contextTag = tags?.find(({ key }) => key === MLFLOW_RUN_DATASET_CONTEXT_TAG);\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexShrink: 0,\n        alignItems: 'center',\n        overflow: 'hidden',\n        marginRight: theme.spacing.xs,\n      }}\n    >\n      <TableIcon css={{ color: theme.colors.textSecondary, marginRight: theme.spacing.xs }} />{' '}\n      <span css={{ minWidth: 32, marginRight: theme.spacing.xs, flexShrink: 0 }}>\n        {inPopover ? (\n          <Popover.Close asChild>\n            <Button type='link' onClick={onDatasetSelected}>\n              <span css={{ fontSize: 12 }}>\n                {dataset.name} ({dataset.digest})\n              </span>\n            </Button>\n          </Popover.Close>\n        ) : (\n          <Button type='link' onClick={onDatasetSelected}>\n            <span>\n              {dataset.name} ({dataset.digest})\n            </span>\n          </Button>\n        )}\n      </span>\n      {contextTag && (\n        <Tag css={{ textTransform: 'capitalize', marginRight: theme.spacing.xs }}>\n          <span css={{ fontSize: 12 }}>{contextTag.value}</span>\n        </Tag>\n      )}\n      {appendComma && <>,</>}\n    </div>\n  );\n};\n\nexport interface DatasetsCellRendererProps {\n  value: RunDatasetWithTags[];\n  data: RunRowType;\n  onDatasetSelected: (dataset: RunDatasetWithTags, run: RunRowType) => void;\n  expandRows: boolean;\n}\n\nexport const DatasetsCellRenderer = React.memo(\n  ({ value, data, onDatasetSelected, expandRows }: DatasetsCellRendererProps) => {\n    const containerElement = useRef<HTMLDivElement>(null);\n    const [datasetsVisible, setDatasetsVisible] = useState(0);\n    const clampedDatasets = useMemo(() => value.slice(0, MAX_DATASETS_VISIBLE), [value]);\n    const { theme } = useDesignSystemTheme();\n\n    useEffect(() => {\n      if (!containerElement.current) {\n        return () => {};\n      }\n      const callback: ResizeObserverCallback = throttle(([entry]) => {\n        if (expandRows) {\n          const availableHeight = entry.contentRect.height;\n          let elementsFit = 0;\n          let stackedHeight = 0;\n          for (let i = 0; i < entry.target.children.length; i++) {\n            const item = entry.target.children.item(i) as Element;\n            if (stackedHeight + item.clientHeight > availableHeight) {\n              break;\n            }\n            stackedHeight += item.clientHeight;\n            elementsFit++;\n          }\n          setDatasetsVisible(elementsFit);\n        } else {\n          const availableWidth = entry.contentRect.width;\n          let elementsFit = 0;\n          let stackedWidth = 0;\n          for (let i = 0; i < entry.target.children.length; i++) {\n            const item = entry.target.children.item(i) as Element;\n            if (stackedWidth + item.clientWidth >= availableWidth) {\n              break;\n            }\n            stackedWidth += item.clientWidth;\n            elementsFit++;\n          }\n          setDatasetsVisible(elementsFit);\n        }\n      }, 100);\n\n      const resizeObserver = new ResizeObserver(callback);\n\n      resizeObserver.observe(containerElement.current);\n      return () => resizeObserver.disconnect();\n    }, [expandRows]);\n\n    const moreItemsToShow = value.length - datasetsVisible;\n    if (!value || value.length < 1) {\n      return <>-</>;\n    }\n\n    const datasetsToShow = expandRows ? clampedDatasets : value;\n\n    return (\n      <div css={{ display: 'flex' }}>\n        <div\n          css={{\n            overflow: 'hidden',\n            display: 'flex',\n            flexDirection: expandRows ? 'column' : 'row',\n          }}\n          ref={containerElement}\n        >\n          {datasetsToShow.map((datasetWithTags, index) => (\n            <SingleDataset\n              appendComma={expandRows ? false : index < clampedDatasets.length - 1}\n              key={`${datasetWithTags.dataset.name}-${datasetWithTags.dataset.digest}`}\n              datasetWithTags={datasetWithTags}\n              onDatasetSelected={() => onDatasetSelected?.(datasetWithTags, data)}\n            />\n          ))}\n        </div>\n        {moreItemsToShow > 0 && (\n          <div css={{ display: 'flex', alignItems: 'flex-end' }}>\n            {!expandRows && (\n              <span css={{ paddingLeft: theme.spacing.xs, paddingRight: theme.spacing.xs }}>\n                &hellip;\n              </span>\n            )}\n            <Popover.Root modal={false}>\n              <Popover.Trigger asChild>\n                <Button size='small' style={{ borderRadius: '8px', width: '40px' }}>\n                  <Typography.Text color='secondary'>+{moreItemsToShow}</Typography.Text>\n                </Button>\n              </Popover.Trigger>\n              <Popover.Content align='start' css={{ maxHeight: '400px', overflow: 'auto' }}>\n                {value.slice(value.length - moreItemsToShow).map((datasetWithTags) => (\n                  <div\n                    css={{ height: theme.general.heightSm, display: 'flex', alignItems: 'center' }}\n                    key={`${datasetWithTags.dataset.name}-${datasetWithTags.dataset.digest}`}\n                  >\n                    <SingleDataset\n                      datasetWithTags={datasetWithTags}\n                      onDatasetSelected={() => onDatasetSelected?.(datasetWithTags, data)}\n                      inPopover\n                    />\n                  </div>\n                ))}\n              </Popover.Content>\n            </Popover.Root>\n          </div>\n        )}\n      </div>\n    );\n  },\n);\n\nexport const getDatasetsCellHeight = (\n  searchFacetsState: SearchExperimentRunsFacetsState,\n  row: { data: RunRowType },\n) => {\n  const datasetColumnId = makeCanonicalSortKey(\n    COLUMN_TYPES.ATTRIBUTES,\n    ATTRIBUTE_COLUMN_LABELS.DATASET,\n  );\n  if (\n    shouldEnableExperimentDatasetTracking() &&\n    searchFacetsState.selectedColumns.includes(datasetColumnId)\n  ) {\n    const { data } = row;\n\n    // Display at least 1, but at most 5 text lines in the cell.\n    const datasetsCount = Math.min(data.datasets?.length || 1, MAX_DATASETS_VISIBLE);\n    return EXPERIMENT_RUNS_TABLE_ROW_HEIGHT * datasetsCount;\n  }\n  return EXPERIMENT_RUNS_TABLE_ROW_HEIGHT;\n};\n","import type { ColDef, ColGroupDef, ColumnApi, IsFullWidthRowParams } from '@ag-grid-community/core';\nimport { Spinner } from '@databricks/design-system';\nimport { useEffect, useMemo, useRef } from 'react';\nimport { isEqual } from 'lodash';\nimport Utils from '../../../../common/utils/Utils';\nimport {\n  ATTRIBUTE_COLUMN_LABELS,\n  ATTRIBUTE_COLUMN_SORT_KEY,\n  COLUMN_TYPES,\n} from '../../../constants';\nimport { ColumnHeaderCell } from '../components/runs/cells/ColumnHeaderCell';\nimport { DateCellRenderer } from '../components/runs/cells/DateCellRenderer';\nimport { ExperimentNameCellRenderer } from '../components/runs/cells/ExperimentNameCellRenderer';\nimport { ModelsCellRenderer } from '../components/runs/cells/ModelsCellRenderer';\nimport { SourceCellRenderer } from '../components/runs/cells/SourceCellRenderer';\nimport { VersionCellRenderer } from '../components/runs/cells/VersionCellRenderer';\nimport type { SearchExperimentRunsFacetsState } from '../models/SearchExperimentRunsFacetsState';\nimport {\n  EXPERIMENT_FIELD_PREFIX_METRIC,\n  EXPERIMENT_FIELD_PREFIX_PARAM,\n  EXPERIMENT_FIELD_PREFIX_TAG,\n  getQualifiedEntityName,\n} from './experimentPage.common-utils';\nimport { RunRowType } from './experimentPage.row-types';\nimport { RowActionsCellRenderer } from '../components/runs/cells/RowActionsCellRenderer';\nimport { RowActionsHeaderCellRenderer } from '../components/runs/cells/RowActionsHeaderCellRenderer';\nimport { RunNameCellRenderer } from '../components/runs/cells/RunNameCellRenderer';\nimport { LoadMoreRowRenderer } from '../components/runs/cells/LoadMoreRowRenderer';\nimport { shouldEnableExperimentDatasetTracking } from '../../../../common/utils/FeatureUtils';\nimport { DatasetsCellRenderer } from '../components/runs/cells/DatasetsCellRenderer';\nimport { RunDatasetWithTags } from '../../../types';\n\n/**\n * Width for \"run name\" column.\n */\nconst RUN_NAME_COLUMN_WIDTH = 310;\n\n/**\n * Calculates width for \"actions\" column. \"compactMode\" should be set to true\n * for compare runs mode when checkboxes are hidden.\n */\nconst getActionsColumnWidth = (compactMode?: boolean) =>\n  // 70px when checkboxes are hidden, 104px otherwise\n  compactMode ? 70 : 104;\n\n/**\n * Creates canonical sort key name for metrics and params in form\n * of \"keyType.`keyName`\", e.g. \"params.`paramName`\"\n */\nexport const makeCanonicalSortKey = (keyType: string, keyName: string) =>\n  keyType + '.`' + keyName + '`';\n\n/**\n * Creates canonical sort key name for metrics and params\n */\nexport const isCanonicalSortKeyOfType = (canonicalKey: string, keyType: string) =>\n  canonicalKey.startsWith(keyType);\n\n/**\n * Extracts param/metric/tag name from the canonical key\n */\nexport const extractCanonicalSortKey = (canonicalKey: string, keyType: string) =>\n  canonicalKey.substring(keyType.length + 2).slice(0, -1);\n\n/*\n * Functions used to generate grid field names for params, metrics and prefixes\n */\nexport const createParamFieldName = (key: string) => `${EXPERIMENT_FIELD_PREFIX_PARAM}-${key}`;\nconst createMetricFieldName = (key: string) => `${EXPERIMENT_FIELD_PREFIX_METRIC}-${key}`;\nconst createTagFieldName = (key: string) => `${EXPERIMENT_FIELD_PREFIX_TAG}-${key}`;\n\n/**\n * Functions returns all framework components to be used by agGrid\n */\nexport const getFrameworkComponents = () => ({\n  agColumnHeader: ColumnHeaderCell,\n  loadingOverlayComponent: Spinner,\n\n  /**\n   * We're saving cell renderer component references, otherwise\n   * agGrid will unnecessarily flash cells' content (e.g. when changing sort order)\n   */\n  LoadMoreRowRenderer,\n  SourceCellRenderer,\n  ModelsCellRenderer,\n  VersionCellRenderer,\n  DateCellRenderer,\n  ExperimentNameCellRenderer,\n  RowActionsCellRenderer,\n  RowActionsHeaderCellRenderer,\n  RunNameCellRenderer,\n  DatasetsCellRenderer,\n});\n\n/**\n * Certain columns are described as run attributes (opposed to metrics, params etc.), however\n * they actually source their data from the run tags. This objects maps tag names to column identifiers.\n */\nexport const TAGS_TO_COLUMNS_MAP = {\n  [ATTRIBUTE_COLUMN_SORT_KEY.USER]: makeCanonicalSortKey(COLUMN_TYPES.ATTRIBUTES, 'User'),\n  [ATTRIBUTE_COLUMN_SORT_KEY.RUN_NAME]: makeCanonicalSortKey(COLUMN_TYPES.ATTRIBUTES, 'Run Name'),\n  [ATTRIBUTE_COLUMN_SORT_KEY.SOURCE]: makeCanonicalSortKey(COLUMN_TYPES.ATTRIBUTES, 'Source'),\n  [ATTRIBUTE_COLUMN_SORT_KEY.VERSION]: makeCanonicalSortKey(COLUMN_TYPES.ATTRIBUTES, 'Version'),\n};\n\n/**\n * Function returns unique row ID to be used in runs table\n */\nexport const getRowId = ({ data }: { data: RunRowType }) => data.runUuid;\n\n/**\n * Determines if a data row houses \"load more\" button\n */\nexport const getRowIsLoadMore = ({ rowNode }: IsFullWidthRowParams) => rowNode.data.isLoadMoreRow;\n\n/**\n * Parameters used by `useRunsColumnDefinitions()` hook\n */\nexport interface UseRunsColumnDefinitionsParams {\n  searchFacetsState: SearchExperimentRunsFacetsState;\n  onSortBy: (newOrderByKey: string, newOrderByAsc: boolean) => void;\n  onExpand: (parentUuid: string, childrenIds: string[]) => void;\n  onTogglePin: (runUuid: string) => void;\n  onToggleVisibility: (runUuidOrToggle: string) => void;\n  compareExperiments: boolean;\n  metricKeyList: string[];\n  paramKeyList: string[];\n  tagKeyList: string[];\n  columnApi?: ColumnApi;\n  isComparingRuns?: boolean;\n  onDatasetSelected?: (dataset: RunDatasetWithTags, run: RunRowType) => void;\n  expandRows?: boolean;\n}\n\n/**\n * List of all attribute columns that can be shown/hidden by user\n * - when displaying a single experiment (ADJUSTABLE_ATTRIBUTE_COLUMNS_SINGLE_EXPERIMENT)\n * - when comparing experiments (ADJUSTABLE_ATTRIBUTE_COLUMNS)\n */\n\nexport const getAdjustableAttributeColumns = (isComparingExperiments = false) => {\n  const result = [\n    ATTRIBUTE_COLUMN_LABELS.USER,\n    ATTRIBUTE_COLUMN_LABELS.SOURCE,\n    ATTRIBUTE_COLUMN_LABELS.VERSION,\n    ATTRIBUTE_COLUMN_LABELS.MODELS,\n  ];\n\n  if (shouldEnableExperimentDatasetTracking()) {\n    result.push(ATTRIBUTE_COLUMN_LABELS.DATASET);\n  }\n\n  if (isComparingExperiments) {\n    result.push(ATTRIBUTE_COLUMN_LABELS.EXPERIMENT_NAME);\n  }\n  return result;\n};\n\n/**\n * This internal hook passes through the list of all metric/param/tag keys.\n * The lists are memoized internally so if somehow a particular param/metric/tag key is not present\n * in the new runs set (e.g. due to reverse sorting), the relevant column will be still displayed.\n * This prevents weirdly disappearing columns on exotic run sets.\n */\nconst useCumulativeColumnKeys = ({\n  paramKeyList,\n  metricKeyList,\n  tagKeyList,\n}: Pick<UseRunsColumnDefinitionsParams, 'tagKeyList' | 'metricKeyList' | 'paramKeyList'>) => {\n  const cachedMetricKeys = useRef<Set<string>>(new Set());\n  const cachedParamKeys = useRef<Set<string>>(new Set());\n  const cachedTagKeys = useRef<Set<string>>(new Set());\n\n  const paramKeys = useMemo(() => {\n    paramKeyList.forEach((key) => cachedParamKeys.current.add(key));\n    return Array.from(cachedParamKeys.current);\n  }, [paramKeyList]);\n\n  const metricKeys = useMemo(() => {\n    metricKeyList.forEach((key) => cachedMetricKeys.current.add(key));\n    return Array.from(cachedMetricKeys.current);\n  }, [metricKeyList]);\n\n  const tagKeys = useMemo(() => {\n    tagKeyList.forEach((key) => cachedTagKeys.current.add(key));\n    return Array.from(cachedTagKeys.current);\n  }, [tagKeyList]);\n\n  const cumulativeColumns = useMemo(\n    () => ({\n      paramKeys,\n      metricKeys,\n      tagKeys,\n    }),\n    [metricKeys, paramKeys, tagKeys],\n  );\n\n  return cumulativeColumns;\n};\n\n/**\n * This hook creates a agGrid-compatible column set definition basing on currently\n * used sort-filter model and provided list of metrics, params and tags.\n *\n * Internally, it reacts to changes to `selectedColumns` and hides/shows relevant columns\n * if necessary.\n *\n * @param params see UseRunsColumnDefinitionsParams\n */\nexport const useRunsColumnDefinitions = ({\n  searchFacetsState,\n  onSortBy,\n  compareExperiments,\n  onTogglePin,\n  onToggleVisibility,\n  onExpand,\n  paramKeyList,\n  metricKeyList,\n  tagKeyList,\n  columnApi,\n  onDatasetSelected,\n  isComparingRuns,\n  expandRows,\n}: UseRunsColumnDefinitionsParams) => {\n  const { orderByAsc, orderByKey, selectedColumns } = searchFacetsState;\n\n  const cumulativeColumns = useCumulativeColumnKeys({\n    metricKeyList,\n    tagKeyList,\n    paramKeyList,\n  });\n\n  const columnSet = useMemo(() => {\n    const commonSortOrderProps = { orderByKey, orderByAsc, onSortBy };\n\n    const getOrderedByClassName = (key: string) =>\n      key === orderByKey ? 'is-ordered-by' : undefined;\n\n    const getHeaderClassName = (key: string) => getOrderedByClassName(key);\n    const getCellClassName = ({ colDef }: { colDef: ColDef }) =>\n      getOrderedByClassName(colDef.headerComponentParams.canonicalSortKey);\n\n    const columns: (ColDef | ColGroupDef)[] = [];\n\n    // Checkbox selection column\n    columns.push({\n      valueGetter: ({ data: { pinned, hidden } }) => ({ pinned, hidden }),\n      checkboxSelection: !isComparingRuns,\n      headerComponent: 'RowActionsHeaderCellRenderer',\n      headerComponentParams: { onToggleVisibility },\n      headerCheckboxSelection: !isComparingRuns,\n      headerName: '',\n      cellClass: 'is-checkbox-cell',\n      cellRenderer: 'RowActionsCellRenderer',\n      cellRendererParams: { onTogglePin, onToggleVisibility },\n      pinned: 'left',\n      minWidth: getActionsColumnWidth(isComparingRuns),\n      width: getActionsColumnWidth(isComparingRuns),\n      maxWidth: getActionsColumnWidth(isComparingRuns),\n      resizable: false,\n    });\n\n    // Run name column\n    columns.push({\n      headerName: ATTRIBUTE_COLUMN_LABELS.RUN_NAME,\n      colId: TAGS_TO_COLUMNS_MAP[ATTRIBUTE_COLUMN_SORT_KEY.RUN_NAME],\n      headerTooltip: ATTRIBUTE_COLUMN_SORT_KEY.RUN_NAME,\n      pinned: 'left',\n      sortable: true,\n      field: 'runDateAndNestInfo',\n      cellRenderer: 'RunNameCellRenderer',\n      cellRendererParams: { onExpand },\n      equals: (dateInfo1, dateInfo2) => isEqual(dateInfo1, dateInfo2),\n      headerComponentParams: {\n        ...commonSortOrderProps,\n        canonicalSortKey: ATTRIBUTE_COLUMN_SORT_KEY.RUN_NAME,\n        getClassName: getHeaderClassName,\n      },\n      cellClass: getCellClassName,\n      initialWidth: RUN_NAME_COLUMN_WIDTH,\n      resizable: !isComparingRuns,\n    });\n\n    // If we are only comparing runs, that's it - we cut off the list after the run name column.\n    // This behavior might be revisited and changed later.\n    if (isComparingRuns) {\n      return columns;\n    }\n\n    // Date and expander selection column\n    columns.push({\n      headerName: ATTRIBUTE_COLUMN_LABELS.DATE,\n      headerTooltip: ATTRIBUTE_COLUMN_SORT_KEY.DATE,\n      pinned: 'left',\n      sortable: true,\n      field: 'runDateAndNestInfo',\n      cellRenderer: 'DateCellRenderer',\n      cellRendererParams: { onExpand },\n      equals: (dateInfo1, dateInfo2) => isEqual(dateInfo1, dateInfo2),\n      headerComponentParams: {\n        ...commonSortOrderProps,\n        canonicalSortKey: ATTRIBUTE_COLUMN_SORT_KEY.DATE,\n        getClassName: getHeaderClassName,\n      },\n      cellClass: getCellClassName,\n      initialWidth: 150,\n    });\n\n    // Datasets column - guarded by a feature flag\n    if (shouldEnableExperimentDatasetTracking()) {\n      columns.push({\n        headerName: ATTRIBUTE_COLUMN_LABELS.DATASET,\n        colId: makeCanonicalSortKey(COLUMN_TYPES.ATTRIBUTES, ATTRIBUTE_COLUMN_LABELS.DATASET),\n        headerTooltip: ATTRIBUTE_COLUMN_LABELS.DATASET,\n        sortable: false,\n        field: 'datasets',\n        cellRenderer: 'DatasetsCellRenderer',\n        cellRendererParams: { onDatasetSelected, expandRows },\n        cellClass: 'is-multiline-cell',\n        initialWidth: 300,\n      });\n    }\n\n    // Duration column\n    columns.push({\n      headerName: ATTRIBUTE_COLUMN_LABELS.DURATION,\n      field: 'duration',\n      initialWidth: 80,\n      cellClass: getCellClassName,\n    });\n\n    // Experiment name column\n    if (compareExperiments) {\n      columns.push({\n        headerName: ATTRIBUTE_COLUMN_LABELS.EXPERIMENT_NAME,\n        colId: makeCanonicalSortKey(\n          COLUMN_TYPES.ATTRIBUTES,\n          ATTRIBUTE_COLUMN_LABELS.EXPERIMENT_NAME,\n        ),\n        field: 'experimentName',\n        cellRenderer: 'ExperimentNameCellRenderer',\n        equals: (experimentName1, experimentName2) => isEqual(experimentName1, experimentName2),\n        initialWidth: 140,\n        cellClass: getCellClassName,\n        initialHide: true,\n      });\n    }\n\n    // User column\n    columns.push({\n      headerName: ATTRIBUTE_COLUMN_LABELS.USER,\n      colId: TAGS_TO_COLUMNS_MAP[ATTRIBUTE_COLUMN_SORT_KEY.USER],\n      headerTooltip: ATTRIBUTE_COLUMN_SORT_KEY.USER,\n      field: 'user',\n      sortable: true,\n      headerComponentParams: {\n        ...commonSortOrderProps,\n        canonicalSortKey: ATTRIBUTE_COLUMN_SORT_KEY.USER,\n        getClassName: getHeaderClassName,\n      },\n      cellClass: getCellClassName,\n      initialHide: true,\n    });\n\n    // Source column\n    columns.push({\n      headerName: ATTRIBUTE_COLUMN_LABELS.SOURCE,\n      colId: TAGS_TO_COLUMNS_MAP[ATTRIBUTE_COLUMN_SORT_KEY.SOURCE],\n      field: 'tags',\n      cellRenderer: 'SourceCellRenderer',\n      equals: (tags1, tags2) => Utils.getSourceName(tags1) === Utils.getSourceName(tags2),\n      sortable: true,\n      headerComponentParams: {\n        ...commonSortOrderProps,\n        canonicalSortKey: ATTRIBUTE_COLUMN_SORT_KEY.SOURCE,\n        getClassName: getHeaderClassName,\n      },\n      cellClass: getCellClassName,\n      initialHide: true,\n    });\n\n    // Version column\n    columns.push({\n      headerName: ATTRIBUTE_COLUMN_LABELS.VERSION,\n      colId: TAGS_TO_COLUMNS_MAP[ATTRIBUTE_COLUMN_SORT_KEY.VERSION],\n      field: 'version',\n      cellRenderer: 'VersionCellRenderer',\n      equals: (version1, version2) => isEqual(version1, version2),\n      sortable: true,\n      headerComponentParams: {\n        ...commonSortOrderProps,\n        canonicalSortKey: ATTRIBUTE_COLUMN_SORT_KEY.VERSION,\n        getClassName: getHeaderClassName,\n      },\n      cellClass: getCellClassName,\n      initialHide: true,\n    });\n\n    // Models column\n    columns.push({\n      headerName: ATTRIBUTE_COLUMN_LABELS.MODELS,\n      colId: makeCanonicalSortKey(COLUMN_TYPES.ATTRIBUTES, ATTRIBUTE_COLUMN_LABELS.MODELS),\n      field: 'models',\n      cellRenderer: 'ModelsCellRenderer',\n      initialWidth: 200,\n      equals: (models1, models2) => isEqual(models1, models2),\n      initialHide: true,\n    });\n\n    const { metricKeys, paramKeys, tagKeys } = cumulativeColumns;\n\n    // Metrics columns\n    if (metricKeys.length) {\n      columns.push({\n        headerName: 'Metrics',\n        groupId: COLUMN_TYPES.METRICS,\n        children: metricKeys.map((metricKey) => {\n          const canonicalSortKey = makeCanonicalSortKey(COLUMN_TYPES.METRICS, metricKey);\n          return {\n            headerName: metricKey,\n            colId: canonicalSortKey,\n            headerTooltip: getQualifiedEntityName(COLUMN_TYPES.METRICS, metricKey),\n            field: createMetricFieldName(metricKey),\n            tooltipField: createMetricFieldName(metricKey),\n            initialWidth: 100,\n            initialHide: true,\n            sortable: true,\n            headerComponentParams: {\n              ...commonSortOrderProps,\n              canonicalSortKey,\n              getClassName: getHeaderClassName,\n            },\n            cellClass: (def) => `${getCellClassName(def)} is-previewable-cell`,\n          };\n        }),\n      });\n    }\n\n    // Parameter columns\n    if (paramKeys.length) {\n      columns.push({\n        headerName: 'Parameters',\n        groupId: COLUMN_TYPES.PARAMS,\n        children: paramKeys.map((paramKey) => {\n          const canonicalSortKey = makeCanonicalSortKey(COLUMN_TYPES.PARAMS, paramKey);\n          return {\n            colId: canonicalSortKey,\n            headerName: paramKey,\n            headerTooltip: getQualifiedEntityName(COLUMN_TYPES.PARAMS, paramKey),\n            field: createParamFieldName(paramKey),\n            tooltipField: createParamFieldName(paramKey),\n            initialHide: true,\n            initialWidth: 100,\n            sortable: true,\n            headerComponentParams: {\n              ...commonSortOrderProps,\n              canonicalSortKey,\n              getClassName: getHeaderClassName,\n            },\n            cellClass: (def) => `${getCellClassName(def)} is-previewable-cell`,\n          };\n        }),\n      });\n    }\n\n    // Tags columns\n    if (tagKeys.length) {\n      columns.push({\n        headerName: 'Tags',\n        colId: COLUMN_TYPES.TAGS,\n        children: tagKeys.map((tagKey) => {\n          const canonicalSortKey = makeCanonicalSortKey(COLUMN_TYPES.TAGS, tagKey);\n          return {\n            colId: canonicalSortKey,\n            headerName: tagKey,\n            initialHide: true,\n            initialWidth: 100,\n            headerTooltip: getQualifiedEntityName(COLUMN_TYPES.TAGS, tagKey),\n            field: createTagFieldName(tagKey),\n            tooltipField: createTagFieldName(tagKey),\n          };\n        }),\n      });\n    }\n\n    return columns;\n  }, [\n    orderByKey,\n    orderByAsc,\n    onSortBy,\n    onTogglePin,\n    onToggleVisibility,\n    onExpand,\n    compareExperiments,\n    cumulativeColumns,\n    isComparingRuns,\n    onDatasetSelected,\n    expandRows,\n  ]);\n\n  const canonicalSortKeys = useMemo(\n    () => [\n      ...getAdjustableAttributeColumns(true).map((key) =>\n        makeCanonicalSortKey(COLUMN_TYPES.ATTRIBUTES, key),\n      ),\n      ...cumulativeColumns.paramKeys.map((key) => makeCanonicalSortKey(COLUMN_TYPES.PARAMS, key)),\n      ...cumulativeColumns.metricKeys.map((key) => makeCanonicalSortKey(COLUMN_TYPES.METRICS, key)),\n      ...cumulativeColumns.tagKeys.map((key) => makeCanonicalSortKey(COLUMN_TYPES.TAGS, key)),\n    ],\n    [cumulativeColumns],\n  );\n\n  useEffect(() => {\n    if (!columnApi || isComparingRuns) {\n      return;\n    }\n    for (const canonicalKey of canonicalSortKeys) {\n      const visible = selectedColumns.includes(canonicalKey);\n      columnApi.setColumnVisible(canonicalKey, visible);\n    }\n  }, [selectedColumns, columnApi, canonicalSortKeys, isComparingRuns]);\n\n  return columnSet;\n};\n\nexport const EXPERIMENTS_DEFAULT_COLUMN_SETUP = {\n  initialWidth: 100,\n  autoSizePadding: 0,\n  headerComponentParams: { menuIcon: 'fa-bars' },\n  resizable: true,\n  filter: true,\n  suppressMenu: true,\n  suppressMovable: true,\n};\n","/**\n * NOTE: this code file was automatically migrated to TypeScript using ts-migrate and\n * may contain multiple `any` type annotations and `@ts-expect-error` directives.\n * If possible, please improve types while making changes to this file. If the type\n * annotations are already looking good, please remove this comment.\n */\n\nimport React, { Component } from 'react';\nimport { ConfirmModal } from './ConfirmModal';\nimport { deleteRunApi, openErrorModal } from '../../actions';\nimport { connect } from 'react-redux';\nimport Utils from '../../../common/utils/Utils';\n\ntype Props = {\n  isOpen: boolean;\n  onClose: (...args: any[]) => any;\n  selectedRunIds: string[];\n  openErrorModal: (...args: any[]) => any;\n  deleteRunApi: (...args: any[]) => any;\n};\n\nexport class DeleteRunModalImpl extends Component<Props> {\n  constructor(props: Props) {\n    super(props);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleSubmit() {\n    const deletePromises: any = [];\n    this.props.selectedRunIds.forEach((runId) => {\n      deletePromises.push(this.props.deleteRunApi(runId));\n    });\n    return Promise.all(deletePromises).catch(() => {\n      this.props.openErrorModal('While deleting an experiment run, an error occurred.');\n    });\n  }\n\n  render() {\n    const number = this.props.selectedRunIds.length;\n    return (\n      <ConfirmModal\n        isOpen={this.props.isOpen}\n        onClose={this.props.onClose}\n        handleSubmit={this.handleSubmit}\n        title={`Delete Experiment ${Utils.pluralize('Run', number)}`}\n        helpText={\n          <div>\n            <p>\n              <b>\n                {number} experiment {Utils.pluralize('run', number)} will be deleted.\n              </b>\n            </p>\n            {/* @ts-expect-error TS(4111): Property 'SHOW_GDPR_PURGING_MESSAGES' comes from a... Remove this comment to see the full error message */}\n            {process.env.SHOW_GDPR_PURGING_MESSAGES === 'true' ? (\n              <p>\n                Deleted runs are restorable for 30 days, after which they are purged along with\n                associated metrics, params, tags, and artifacts.\n              </p>\n            ) : (\n              ''\n            )}\n          </div>\n        }\n        confirmButtonText={'Delete'}\n      />\n    );\n  }\n}\n\nconst mapDispatchToProps = {\n  deleteRunApi,\n  openErrorModal,\n};\n\nexport default connect(null, mapDispatchToProps)(DeleteRunModalImpl);\n","/**\n * NOTE: this code file was automatically migrated to TypeScript using ts-migrate and\n * may contain multiple `any` type annotations and `@ts-expect-error` directives.\n * If possible, please improve types while making changes to this file. If the type\n * annotations are already looking good, please remove this comment.\n */\n\nimport React, { Component } from 'react';\nimport { ConfirmModal } from './ConfirmModal';\nimport { connect } from 'react-redux';\nimport { openErrorModal, restoreRunApi } from '../../actions';\nimport Utils from '../../../common/utils/Utils';\n\ntype Props = {\n  isOpen: boolean;\n  onClose: (...args: any[]) => any;\n  selectedRunIds: string[];\n  openErrorModal: (...args: any[]) => any;\n  restoreRunApi: (...args: any[]) => any;\n};\n\nexport class RestoreRunModalImpl extends Component<Props> {\n  constructor(props: Props) {\n    super(props);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleSubmit() {\n    const restorePromises: any = [];\n    this.props.selectedRunIds.forEach((runId) => {\n      restorePromises.push(this.props.restoreRunApi(runId));\n    });\n    return Promise.all(restorePromises).catch((e) => {\n      let errorMessage = 'While restoring an experiment run, an error occurred.';\n      if (e.textJson && e.textJson.error_code === 'RESOURCE_LIMIT_EXCEEDED') {\n        errorMessage = errorMessage + ' ' + e.textJson.message;\n      }\n      this.props.openErrorModal(errorMessage);\n    });\n  }\n\n  render() {\n    const number = this.props.selectedRunIds.length;\n    return (\n      <ConfirmModal\n        isOpen={this.props.isOpen}\n        onClose={this.props.onClose}\n        handleSubmit={this.handleSubmit}\n        title={`Restore Experiment ${Utils.pluralize('Run', number)}`}\n        helpText={`${number} experiment ${Utils.pluralize('run', number)} will be restored.`}\n        confirmButtonText={'Restore'}\n      />\n    );\n  }\n}\n\nconst mapDispatchToProps = {\n  restoreRunApi,\n  openErrorModal,\n};\n\nexport default connect(null, mapDispatchToProps)(RestoreRunModalImpl);\n","import qs from 'qs';\nimport { useMemo } from 'react';\nimport { useParams, useLocation } from '../../../../common/utils/RoutingUtils';\nimport Utils from '../../../../common/utils/Utils';\n\nexport type UseExperimentIdsResult = string[];\n\n/**\n * Hook that returns requested experiment IDs basing on the URL.\n * It extracts ids basing on either route match (in case of a single experiment)\n * or query params (in case of comparing experiments.).\n *\n * @returns array of strings with experiment IDs\n */\n\nexport const useExperimentIds = (): UseExperimentIdsResult => {\n  const params = useParams<{ experimentId?: string }>();\n  const location = useLocation();\n\n  const normalizedLocationSearch = useMemo(\n    () => decodeURIComponent(location.search),\n    [location.search],\n  );\n\n  /**\n   * Memoized string containing experiment IDs for comparison (\"?experiments=...\")\n   */\n  const compareExperimentIdsQueryParam = useMemo(() => {\n    const queryParams = qs.parse(normalizedLocationSearch.substring(1));\n    if (queryParams['experiments']) {\n      const experimentIdsRaw = queryParams['experiments'];\n      return experimentIdsRaw?.toString() || '';\n    }\n\n    return '';\n  }, [normalizedLocationSearch]);\n\n  return useMemo(() => {\n    // Case #1: single experiment\n    if (params?.experimentId) {\n      return [params?.experimentId];\n    }\n\n    // Case #2: multiple (compare) experiments\n    if (compareExperimentIdsQueryParam) {\n      try {\n        return JSON.parse(compareExperimentIdsQueryParam);\n      } catch {\n        // Apparently URL is malformed\n        Utils.logErrorAndNotifyUser(\n          `Could not parse experiment query parameter ${compareExperimentIdsQueryParam}`,\n        );\n        return '';\n      }\n    }\n\n    return [];\n  }, [compareExperimentIdsQueryParam, params?.experimentId]);\n};\n","import {\n  ATTRIBUTE_COLUMN_LABELS,\n  COLUMN_TYPES,\n  DEFAULT_LIFECYCLE_FILTER,\n  DEFAULT_MODEL_VERSION_FILTER,\n  DEFAULT_ORDER_BY_ASC,\n  DEFAULT_ORDER_BY_KEY,\n  DEFAULT_START_TIME,\n} from '../../../constants';\nimport { SerializedRunsCompareCardConfigCard } from '../../runs-compare/runs-compare.types';\nimport { makeCanonicalSortKey } from '../utils/experimentPage.column-utils';\nimport { shouldEnableExperimentDatasetTracking } from '../../../../common/utils/FeatureUtils';\nimport type { DatasetSummary, ExperimentViewRunsCompareMode } from '../../../types';\n\nconst getDefaultSelectedColumns = () => {\n  const result = [\n    // \"Source\" and \"Model\" columns are visible by default\n    makeCanonicalSortKey(COLUMN_TYPES.ATTRIBUTES, ATTRIBUTE_COLUMN_LABELS.SOURCE),\n    makeCanonicalSortKey(COLUMN_TYPES.ATTRIBUTES, ATTRIBUTE_COLUMN_LABELS.MODELS),\n  ];\n\n  if (shouldEnableExperimentDatasetTracking()) {\n    result.push(makeCanonicalSortKey(COLUMN_TYPES.ATTRIBUTES, ATTRIBUTE_COLUMN_LABELS.DATASET));\n  }\n\n  return result;\n};\n\n/**\n * Function consumes a search state facets object and returns one\n * with cleared filter-related fields while leaving\n * selected columns, chart state etc.\n */\nexport const clearSearchExperimentsFacetsFilters = (\n  currentSearchFacetsState: SearchExperimentRunsFacetsState,\n) => {\n  const {\n    lifecycleFilter,\n    datasetsFilter,\n    modelVersionFilter,\n    searchFilter,\n    startTime,\n    orderByAsc,\n    orderByKey,\n  } = new SearchExperimentRunsFacetsState();\n  return {\n    ...currentSearchFacetsState,\n    lifecycleFilter,\n    datasetsFilter,\n    modelVersionFilter,\n    searchFilter,\n    startTime,\n    orderByAsc,\n    orderByKey,\n  };\n};\n\n/**\n * Function consumes a search state facets object and returns `true`\n * if at least one filter-related facet is not-default meaning that runs\n * are currently filtered.\n */\nexport const isSearchFacetsFilterUsed = (\n  currentSearchFacetsState: SearchExperimentRunsFacetsState,\n) => {\n  const { lifecycleFilter, modelVersionFilter, datasetsFilter, searchFilter, startTime } =\n    currentSearchFacetsState;\n  return Boolean(\n    lifecycleFilter !== DEFAULT_LIFECYCLE_FILTER ||\n      modelVersionFilter !== DEFAULT_MODEL_VERSION_FILTER ||\n      datasetsFilter.length !== 0 ||\n      searchFilter ||\n      startTime !== DEFAULT_START_TIME,\n  );\n};\n\n/**\n * Defines persistable model representing sort and filter values\n * used by runs table and controls\n */\nexport class SearchExperimentRunsFacetsState {\n  /**\n   * SQL-like query string used to filter runs, e.g. \"params.alpha = '0.5'\"\n   */\n  searchFilter = '';\n\n  /**\n   * Canonical order_by key like \"params.`alpha`\". May be null to indicate the table\n   * should use the natural row ordering provided by the server.\n   */\n  orderByKey = DEFAULT_ORDER_BY_KEY;\n\n  /**\n   * Whether the order imposed by orderByKey should be ascending or descending.\n   */\n  orderByAsc = DEFAULT_ORDER_BY_ASC;\n\n  /**\n   * Filter key to show results based on start time\n   */\n  startTime = DEFAULT_START_TIME;\n\n  /**\n   * Lifecycle filter of runs to display\n   */\n  lifecycleFilter = DEFAULT_LIFECYCLE_FILTER;\n\n  /**\n   * Datasets filter of runs to display\n   */\n  datasetsFilter: DatasetSummary[] = [];\n\n  /**\n   * Filter of model versions to display\n   */\n  modelVersionFilter = DEFAULT_MODEL_VERSION_FILTER;\n\n  /**\n   * Currently selected columns\n   */\n  selectedColumns: string[] = getDefaultSelectedColumns();\n\n  /**\n   * Object mapping run UUIDs (strings) to booleans, where a boolean value of true indicates that\n   * a run has been expanded (its child runs are visible).\n   */\n  runsExpanded: Record<string, boolean> = {};\n\n  /**\n   * List of pinned row UUIDs\n   */\n  runsPinned: string[] = [];\n\n  /**\n   * List of hidden row UUIDs\n   */\n  runsHidden: string[] = [];\n\n  /**\n   * Current run comparison mode (either chart or artifact).\n   * If set to \"undefined\", the table view should be displayed.\n   */\n  compareRunsMode: ExperimentViewRunsCompareMode = undefined;\n\n  /**\n   * Currently configured charts for comparing runs, if any.\n   */\n  compareRunCharts?: SerializedRunsCompareCardConfigCard[];\n}\n","import { chunk, isEqual } from 'lodash';\nimport { AnyAction } from 'redux';\nimport { searchModelVersionsApi } from '../../../../model-registry/actions';\nimport { MAX_RUNS_IN_SEARCH_MODEL_VERSIONS_FILTER } from '../../../../model-registry/constants';\nimport { ATTRIBUTE_COLUMN_SORT_KEY } from '../../../constants';\nimport { ViewType } from '../../../sdk/MlflowEnums';\nimport { KeyValueEntity, LIFECYCLE_FILTER } from '../../../types';\nimport { SearchExperimentRunsFacetsState } from '../models/SearchExperimentRunsFacetsState';\nimport { EXPERIMENT_LOG_MODEL_HISTORY_TAG } from './experimentPage.common-utils';\n\nconst START_TIME_COLUMN_OFFSET = {\n  ALL: null,\n  LAST_HOUR: 1 * 60 * 60 * 1000,\n  LAST_24_HOURS: 24 * 60 * 60 * 1000,\n  LAST_7_DAYS: 7 * 24 * 60 * 60 * 1000,\n  LAST_30_DAYS: 30 * 24 * 60 * 60 * 1000,\n  LAST_YEAR: 12 * 30 * 24 * 60 * 60 * 1000,\n};\n\n/**\n * This function checks if the sort+model state update has\n * been updated enough and if the change should invoke re-fetching\n * the runs from the back-end. This enables differentiation between\n * front-end and back-end filtering.\n */\nexport const shouldRefetchRuns = (\n  currentSearchFacetsState: SearchExperimentRunsFacetsState,\n  newSearchFacetsState: SearchExperimentRunsFacetsState,\n) =>\n  !isEqual(currentSearchFacetsState.searchFilter, newSearchFacetsState.searchFilter) ||\n  !isEqual(currentSearchFacetsState.orderByAsc, newSearchFacetsState.orderByAsc) ||\n  !isEqual(currentSearchFacetsState.orderByKey, newSearchFacetsState.orderByKey) ||\n  !isEqual(currentSearchFacetsState.lifecycleFilter, newSearchFacetsState.lifecycleFilter) ||\n  !isEqual(currentSearchFacetsState.startTime, newSearchFacetsState.startTime) ||\n  !isEqual(currentSearchFacetsState.datasetsFilter, newSearchFacetsState.datasetsFilter);\n\n/**\n * Creates \"order by\" SQL expression\n */\nconst createOrderByExpression = ({ orderByKey, orderByAsc }: SearchExperimentRunsFacetsState) => {\n  if (orderByKey) {\n    return orderByAsc ? [orderByKey + ' ASC'] : [orderByKey + ' DESC'];\n  }\n  return [];\n};\n\n/**\n * Creates SQL expression for filtering by run start time\n */\nconst createStartTimeExpression = (\n  { startTime }: SearchExperimentRunsFacetsState,\n  referenceTime: number,\n) => {\n  const offset = START_TIME_COLUMN_OFFSET[startTime as keyof typeof START_TIME_COLUMN_OFFSET];\n  if (!startTime || !offset || startTime === 'ALL') {\n    return null;\n  }\n  const startTimeOffset = referenceTime - offset;\n\n  return `attributes.start_time >= ${startTimeOffset}`;\n};\n\n/**\n * Creates SQL expression for filtering by selected datasets\n */\nconst createDatasetsFilterExpression = ({ datasetsFilter }: SearchExperimentRunsFacetsState) => {\n  if (datasetsFilter.length === 0) {\n    return null;\n  }\n  const datasetNames = datasetsFilter.map((dataset) => `'${dataset.name}'`).join(',');\n  const datasetDigests = datasetsFilter.map((dataset) => `'${dataset.digest}'`).join(',');\n\n  return `dataset.name IN (${datasetNames}) AND dataset.digest IN (${datasetDigests})`;\n};\n\n/**\n * Combines search filter and start time SQL expressions\n */\nconst createFilterExpression = (\n  { searchFilter }: SearchExperimentRunsFacetsState,\n  startTimeExpression: string | null,\n  datasetsFilterExpression: string | null,\n) => {\n  const activeFilters = [];\n  if (searchFilter) activeFilters.push(searchFilter);\n  if (startTimeExpression) activeFilters.push(startTimeExpression);\n  if (datasetsFilterExpression) activeFilters.push(datasetsFilterExpression);\n\n  if (activeFilters.length === 0) return undefined;\n  return activeFilters.join(' and ');\n};\n\n/**\n * If this function returns true, the ExperimentView should nest children underneath their parents\n * and fetch all root level parents of visible runs. If this function returns false, the views will\n * not nest children or fetch any additional parents. Will always return true if the orderByKey is\n * 'attributes.start_time'\n */\nconst shouldNestChildrenAndFetchParents = ({\n  orderByKey,\n  searchFilter,\n}: SearchExperimentRunsFacetsState) =>\n  (!orderByKey && !searchFilter) || orderByKey === ATTRIBUTE_COLUMN_SORT_KEY.DATE;\n\n/**\n *\n * Function creates API-compatible query object basing on the given criteria.\n * @param experimentIds IDs of experiments to be queries for runs\n * @param searchFacetsState the sort/filter model to use\n * @param referenceTime reference time to calculate startTime filter\n * @param pageToken next page token if fetching the next page\n */\nexport const createSearchRunsParams = (\n  experimentIds: (number | string)[],\n  searchFacetsState: SearchExperimentRunsFacetsState,\n  referenceTime: number,\n  pageToken?: string,\n) => {\n  const runViewType =\n    searchFacetsState.lifecycleFilter === LIFECYCLE_FILTER.ACTIVE\n      ? ViewType.ACTIVE_ONLY\n      : ViewType.DELETED_ONLY;\n\n  const { runsPinned = undefined } = searchFacetsState;\n\n  const orderBy = createOrderByExpression(searchFacetsState);\n  const startTimeExpression = createStartTimeExpression(searchFacetsState, referenceTime);\n  const datasetsFilterExpression = createDatasetsFilterExpression(searchFacetsState);\n  const filter = createFilterExpression(\n    searchFacetsState,\n    startTimeExpression,\n    datasetsFilterExpression,\n  );\n  const shouldFetchParents = shouldNestChildrenAndFetchParents(searchFacetsState);\n\n  return {\n    // Experiment IDs\n    experimentIds,\n\n    // Filters and sort options\n    filter,\n    runViewType,\n    orderBy,\n    shouldFetchParents,\n\n    // Next page token for loading more runs\n    pageToken,\n    runsPinned,\n  };\n};\n/**\n * Function checks if given runs set contain info about log model history and if true,\n * fetches model versions for them\n *\n * @param runsPayload runs payload returned from the searchRuns API\n * @param actionCreator redux-thunk action creator that for search model versions action\n * @param dispatch redux-compatible dispatch function\n */\nexport const fetchModelVersionsForRuns = (\n  runsPayload: {\n    info: {\n      run_id: string;\n    };\n    data: {\n      tags: KeyValueEntity[];\n    };\n  }[],\n  actionCreator: typeof searchModelVersionsApi,\n  dispatch: (action: AnyAction) => Promise<AnyAction>,\n) => {\n  const runsWithLogModelHistory = runsPayload.filter((run) =>\n    run.data.tags.some((t) => t.key === EXPERIMENT_LOG_MODEL_HISTORY_TAG),\n  );\n\n  chunk(runsWithLogModelHistory, MAX_RUNS_IN_SEARCH_MODEL_VERSIONS_FILTER).forEach((runsChunk) => {\n    const action = actionCreator({ run_id: runsChunk.map((run) => run.info.run_id) });\n    dispatch(action);\n  });\n};\n","import { isArray } from 'lodash';\nimport { atobUtf8, btoaUtf8 } from '../../../../common/utils/StringUtils';\nimport { SearchExperimentRunsFacetsState } from '../models/SearchExperimentRunsFacetsState';\nimport { DatasetSummary } from '../../../types';\n\ntype PersistSearchSerializeFunctions<Serialized = any, Unserialized = any> = {\n  serializeLocalStorage?(input: Unserialized): Serialized;\n  serializeQueryString?(input: Unserialized): Serialized;\n  deserializeLocalStorage?(input: Serialized): Unserialized;\n  deserializeQueryString?(input: Serialized): Unserialized;\n};\n\n/**\n * \"Flattens\" the strings array, i.e. merges it into a single value\n */\nconst flattenString = (input: string | string[]) => (isArray(input) ? input.join() : input);\n\n/**\n * All known field serialization and deserialization mechanisms used in search facets state persisting mechanism.\n */\nconst persistSearchStateFieldSerializers: Record<string, PersistSearchSerializeFunctions> = {\n  /**\n   * In rare cases, search filter might contain commas that interfere with `querystring` library\n   * parsing causing it to return array instead of string. Since it's difficult to selectively\n   * change `querystring`'s parsing action, we are making sure that the parsed values are always strings.\n   */\n  searchFilter: {\n    deserializeLocalStorage: flattenString,\n    deserializeQueryString: flattenString,\n  },\n  datasetsFilter: {\n    serializeQueryString(inputs: SearchExperimentRunsFacetsState['datasetsFilter']) {\n      const inputsWithoutExperimentId = inputs.map(({ name, digest, context }) => ({\n        name,\n        digest,\n        context,\n      }));\n      return btoaUtf8(JSON.stringify(inputsWithoutExperimentId));\n    },\n    deserializeQueryString(input: string): SearchExperimentRunsFacetsState['datasetsFilter'] {\n      try {\n        // Process the URL defensively against intended and unintended malformation\n        const parsedResult = JSON.parse(atobUtf8(input));\n        if (!Array.isArray(parsedResult)) {\n          return [];\n        }\n        return parsedResult;\n      } catch {\n        return [];\n      }\n    },\n  },\n  /**\n   * Array of visible configured charts are serialized into base64-encoded JSON when put into query string\n   */\n  compareRunCharts: {\n    serializeQueryString(input: SearchExperimentRunsFacetsState['compareRunCharts']) {\n      return btoaUtf8(JSON.stringify(input));\n    },\n    deserializeQueryString(input: string): SearchExperimentRunsFacetsState['compareRunCharts'] {\n      try {\n        // Process the URL defensively against intended and unintended malformation\n        const parsedResult = JSON.parse(atobUtf8(input));\n        if (!Array.isArray(parsedResult)) {\n          return undefined;\n        }\n        return parsedResult;\n      } catch {\n        return undefined;\n      }\n    },\n  },\n  /**\n   * For \"compareRunsMode\", we will always save \"undefined\" value to local storage so users will\n   * get back to default view after visiting the view once more.\n   */\n  compareRunsMode: {\n    serializeLocalStorage() {\n      return undefined;\n    },\n  },\n};\n\ntype StateKey = keyof Partial<SearchExperimentRunsFacetsState>;\n\n/**\n * Consumes an object with persistable search facets and transforms relevant fields\n * with the registered serialization functions specific to query string.\n * Example scenario: serializing an array of visible configured charts into base64-encoded JSON.\n */\nexport const serializeFieldsToQueryString = (input: Partial<SearchExperimentRunsFacetsState>) => {\n  const resultObject: Partial<Record<StateKey, any>> = { ...input };\n  for (const field of Object.keys(resultObject) as StateKey[]) {\n    const serializeFn = persistSearchStateFieldSerializers[field]?.serializeQueryString;\n    if (serializeFn) {\n      resultObject[field] = serializeFn(resultObject[field]);\n    }\n  }\n  return resultObject;\n};\n\n/**\n * Consumes an object with search facets extracted from query string and transforms relevant fields\n * with the registered deserialization functions. Example scenario: deserializing an array of\n * visible configured charts from base64-encoded JSON.\n */\nexport const deserializeFieldsFromQueryString = (\n  input: Partial<SearchExperimentRunsFacetsState> | Record<string, any>,\n) => {\n  const resultObject: Partial<Record<StateKey, any>> = { ...input };\n  for (const field of Object.keys(resultObject) as StateKey[]) {\n    const deserializeFn = persistSearchStateFieldSerializers[field]?.deserializeQueryString;\n    if (deserializeFn) {\n      resultObject[field] = deserializeFn(resultObject[field]);\n    }\n  }\n  return resultObject;\n};\n\n/**\n * Consumes an object with persistable search facets and transforms relevant fields\n * with the registered serialization functions specific to local storage.\n * Example scenario: serializing an array of visible configured charts into base64-encoded JSON.\n */\nexport const serializeFieldsToLocalStorage = (input: Partial<SearchExperimentRunsFacetsState>) => {\n  const resultObject: Partial<Record<StateKey, any>> = { ...input };\n  for (const field of Object.keys(resultObject) as StateKey[]) {\n    const serializeFn = persistSearchStateFieldSerializers[field]?.serializeLocalStorage;\n    if (serializeFn) {\n      resultObject[field] = serializeFn(resultObject[field]);\n    }\n  }\n  return resultObject;\n};\n\n/**\n * Consumes an object with search facets extracted from local storage and transforms relevant fields\n * with the registered deserialization functions. Example scenario: deserializing an array of\n * visible configured charts from base64-encoded JSON.\n */\nexport const deserializeFieldsFromLocalStorage = (\n  input: Partial<SearchExperimentRunsFacetsState> | Record<string, any>,\n) => {\n  const resultObject: Partial<Record<StateKey, any>> = { ...input };\n  for (const field of Object.keys(resultObject) as StateKey[]) {\n    const deserializeFn = persistSearchStateFieldSerializers[field]?.deserializeLocalStorage;\n    if (deserializeFn) {\n      resultObject[field] = deserializeFn(resultObject[field]);\n    }\n  }\n  return resultObject;\n};\n","import { isArray, isObject } from 'lodash';\nimport QueryString, { IParseOptions } from 'qs';\nimport LocalStorageUtils from '../../../../common/utils/LocalStorageUtils';\nimport Utils from '../../../../common/utils/Utils';\n\nimport { SearchExperimentRunsFacetsState } from '../models/SearchExperimentRunsFacetsState';\nimport {\n  deserializeFieldsFromLocalStorage,\n  deserializeFieldsFromQueryString,\n  serializeFieldsToLocalStorage,\n  serializeFieldsToQueryString,\n} from './persistSearchFacets.serializers';\n\nconst KNOWN_STATE_KEYS = Object.keys(new SearchExperimentRunsFacetsState());\n\n/**\n * Function used by QueryString.parse(), implements better handling of booleans and undefined values\n */\nconst urlParserDecoder: IParseOptions['decoder'] = (str, defaultDecoder, _, type) => {\n  if (type === 'value') {\n    if (str === 'true') {\n      return true;\n    } else if (str === 'false') {\n      return false;\n    } else if (str === undefined) {\n      return '';\n    }\n  }\n  return defaultDecoder(str);\n};\n\n/**\n * Function used for merging two facets search states.\n */\nconst mergeFacetsStates = (\n  base: SearchExperimentRunsFacetsState,\n  object: Partial<SearchExperimentRunsFacetsState>,\n): SearchExperimentRunsFacetsState =>\n  Object.assign(new SearchExperimentRunsFacetsState(), {\n    ...base,\n    ...object,\n  });\n\n/**\n * Performs basic checks on partial facets state model. Returns false if\n * fields expected to be objects or arrays are not what they are supposed to be.\n */\nfunction validateFacetsState(model: Partial<SearchExperimentRunsFacetsState>) {\n  if (model.runsExpanded && !isObject(model.runsExpanded)) {\n    return false;\n  }\n\n  if (model.selectedColumns && !isArray(model.selectedColumns)) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Persists current facets state in local storage.\n */\nfunction persistLocalStorage(data: Partial<SearchExperimentRunsFacetsState>, idKey: string) {\n  // TODO: decide if we want to use LocalStorageUtils store or fall back to direct use of localStorage\n  const localStorageInstance = LocalStorageUtils.getStoreForComponent('ExperimentPage', idKey);\n  const sortFilterModelToSave = serializeFieldsToLocalStorage(data);\n  localStorageInstance.saveComponentState(sortFilterModelToSave);\n}\n\n/**\n * Creates the URL query string representing the current search facets state.\n */\nfunction createPersistedQueryString(\n  sortFilterModelToSave: Partial<SearchExperimentRunsFacetsState> & { experiments?: any },\n) {\n  const serializedSortFilterModelToSave = serializeFieldsToQueryString(sortFilterModelToSave);\n\n  return QueryString.stringify(serializedSortFilterModelToSave, {\n    addQueryPrefix: true,\n    arrayFormat: 'comma',\n    encodeValuesOnly: true,\n  });\n}\n\n/**\n * Consumes object containing all fields parsed from search query and\n * separates those relevant to the search state from the rest.\n */\nfunction extractExperimentSearchFacetsState<\n  // Template for partial state type\n  PartialState extends Partial<SearchExperimentRunsFacetsState>,\n  // Template for partial state + the rest type\n  URLObject extends PartialState,\n>(rawURLSearchData: URLObject) {\n  const stateData: PartialState = {} as PartialState;\n  const restData: Omit<URLObject, keyof PartialState> = {} as Omit<URLObject, keyof PartialState>;\n\n  for (const field in rawURLSearchData) {\n    if (rawURLSearchData.hasOwnProperty(field)) {\n      const isKnownField = KNOWN_STATE_KEYS.includes(field);\n      Object.assign(isKnownField ? stateData : restData, { [field]: rawURLSearchData[field] });\n    }\n  }\n  return { stateData, restData };\n}\n\n/**\n * Persists current facets state in local storage and returns query string to be persisted in the URL.\n */\nexport function persistExperimentSearchFacetsState(\n  sortFilterModelToSave: SearchExperimentRunsFacetsState,\n  idKey: string,\n  currentLocationSearch = '',\n) {\n  const currentParameters = QueryString.parse(currentLocationSearch, {\n    ignoreQueryPrefix: true,\n    comma: true,\n    arrayLimit: 500,\n    decoder: urlParserDecoder,\n  });\n  // Extract current query params and re-persist relevant ones.\n  // In this case, it's only \"experiments\" field used for comparison.\n  const { experiments } = currentParameters;\n  persistLocalStorage(sortFilterModelToSave, idKey);\n  return createPersistedQueryString({ experiments, ...sortFilterModelToSave });\n}\n\n/**\n * Restores facets state from local storage and URL query string.\n *\n * @param location extracted e.g. from useLocation\n * @param idKey unique key for the storage\n * @param persistCombinedToLocalStorage if true, the combined state will be re-persisted to local storage\n */\nexport function restoreExperimentSearchFacetsState(locationSearch: string, idKey: string) {\n  // Step 1: prepare base value\n  let baseState = new SearchExperimentRunsFacetsState();\n\n  // Step 2: extract current state from local storage\n  try {\n    // TODO: decide if we want to use LocalStorageUtils store or fall back to direct use of localStorage\n    const localStorageInstance = LocalStorageUtils.getStoreForComponent('ExperimentPage', idKey);\n    const rawLocalStorageValue = localStorageInstance.loadComponentState();\n    if (validateFacetsState(rawLocalStorageValue)) {\n      const localStorageValue = deserializeFieldsFromLocalStorage(rawLocalStorageValue);\n      // Merge it with the base state only if it's valid\n      baseState = mergeFacetsStates(baseState, localStorageValue);\n    }\n  } catch {\n    Utils.logErrorAndNotifyUser(\n      `Error: malformed persisted search state for experiment(s) ${idKey}`,\n    );\n  }\n\n  // Preliminarily decode the search query, despite QueryString.parse doing the same.\n  // In certain scenarios the search values can arrive double-encoded\n  // (e.g. after being redirected from the login page) so by doing this, we ensure\n  // that the values will be properly decoded at the end.\n  const normalizedLocationSearch = decodeURIComponent(locationSearch);\n\n  // Step 3: extract data from URL...\n  const rawUrlData = QueryString.parse(normalizedLocationSearch, {\n    ignoreQueryPrefix: true,\n    comma: true,\n    arrayLimit: 500,\n    decoder: urlParserDecoder,\n  });\n  const { restData, stateData } = extractExperimentSearchFacetsState(rawUrlData);\n\n  const transformedStateData = deserializeFieldsFromQueryString(stateData);\n\n  // If the is at least one relevant query params in URL, take URL into consideration.\n  const isURLStateEmpty = Object.keys(transformedStateData).length < 1;\n  if (!isURLStateEmpty) {\n    // We need merge specified fields from the URL query to the empty state.\n    // In certain scenarios, parts of the state (e.g. empty arrays) are not being persisted in the URL\n    // and we need to regenerate them.\n    const urlState = Object.assign(new SearchExperimentRunsFacetsState(), transformedStateData);\n    baseState = mergeFacetsStates(baseState, urlState);\n  }\n\n  // Step 4: persist combined state again\n  persistLocalStorage(baseState, idKey);\n\n  return {\n    state: baseState,\n    queryString: createPersistedQueryString({ ...restData, ...baseState }),\n  };\n}\n","import { isFunction } from 'lodash';\nimport React, { createContext, useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { useLocation, useNavigate } from '../../../../common/utils/RoutingUtils';\nimport RequestStateWrapper from '../../../../common/components/RequestStateWrapper';\nimport { loadMoreRunsApi, searchRunsApi, searchRunsPayload } from '../../../actions';\nimport { useExperimentIds } from '../hooks/useExperimentIds';\nimport { SearchExperimentRunsFacetsState } from '../models/SearchExperimentRunsFacetsState';\nimport Utils from '../../../../common/utils/Utils';\nimport { searchModelVersionsApi } from '../../../../model-registry/actions';\nimport { RunEntity, UpdateExperimentSearchFacetsFn } from '../../../types';\nimport { useAsyncDispatch } from '../hooks/useAsyncDispatch';\nimport {\n  createSearchRunsParams,\n  fetchModelVersionsForRuns,\n  shouldRefetchRuns,\n} from '../utils/experimentPage.fetch-utils';\nimport {\n  persistExperimentSearchFacetsState,\n  restoreExperimentSearchFacetsState,\n} from '../utils/persistSearchFacets';\nimport { ErrorWrapper } from '../../../../common/utils/ErrorWrapper';\n\nexport interface GetExperimentRunsContextActions {\n  searchRunsApi: typeof searchRunsApi;\n  loadMoreRunsApi: typeof loadMoreRunsApi;\n  searchRunsPayload: typeof searchRunsPayload;\n  searchModelVersionsApi: typeof searchModelVersionsApi;\n}\n\nexport interface GetExperimentRunsContextType {\n  /**\n   * Represents the currently used filter/sort model\n   */\n  searchFacetsState: SearchExperimentRunsFacetsState;\n\n  /**\n   * Indicates if runs are being loaded at the moment\n   */\n  isLoadingRuns: boolean;\n\n  /**\n   * Function used to (re)fetch runs with the currently used filter set.\n   * Use scenarios: initial fetch, refreshing the list.\n   */\n  fetchExperimentRuns: () => void;\n\n  /**\n   * Function used to update the filter set and fetch new set of runs.\n   * First parameter is the subset of fields that the current sort/filter model will be merged with.\n   * If the second parameter is set to true, it will force re-fetching even if there\n   * are no sufficient changes to the model.\n   */\n  updateSearchFacets: UpdateExperimentSearchFacetsFn;\n\n  /**\n   * Function used to refresh the runs\n   */\n  refreshRuns: () => void;\n\n  /**\n   * Function used to load more runs (if available) using currently used filters\n   */\n  loadMoreRuns: () => Promise<RunEntity[]>;\n\n  /**\n   * Contains error descriptor if fetching runs failed\n   */\n  requestError: ErrorWrapper | null;\n\n  /**\n   * All run-related actions creators\n   */\n  actions: GetExperimentRunsContextActions;\n\n  /**\n   * True if there are more paginated runs available\n   */\n  moreRunsAvailable: boolean;\n\n  /**\n   * Returns true if user has not changed sort/filter model and is using the default one\n   */\n  isPristine: () => boolean;\n}\n\n/**\n * Wrapper context that serves two purposes:\n * - aggregates concrete redux actions necessary to perform experiments run search\n * - holds currently used state with sort and filter options, also is responsible for persisting it\n */\nexport const GetExperimentRunsContext = createContext<GetExperimentRunsContextType | null>(null);\n\n/**\n * Provider component for SearchExperimentRunsContext.\n * Accepts concrete redux actions for searching runs.\n */\nexport const GetExperimentRunsContextProvider = ({\n  children,\n  actions,\n}: React.PropsWithChildren<{\n  actions: GetExperimentRunsContextActions;\n}>) => {\n  const navigate = useNavigate();\n  const experimentIds = useExperimentIds();\n  const dispatch = useAsyncDispatch();\n  const location = useLocation();\n\n  const [searchRunsRequestId, setSearchRunsRequestId] = useState<string>('');\n  const [isLoadingRuns, setIsLoadingRuns] = useState(false);\n  const [initialSearchPath, setInitialSearchPath] = useState('');\n  const [moreRunsAvailable, setMoreRunsAvailable] = useState(false);\n  const [requestError, setRequestError] = useState<any>(null);\n\n  const experimentIdsHash = useMemo(() => JSON.stringify(experimentIds.sort()), [experimentIds]);\n\n  // Value storing the last parsed query string, used\n  // to prevent unnecessary state recalculations.\n  const lastSearchFacetsQueryString = useRef('');\n\n  const [searchFacetsState, setSearchFacetsState] = useState<SearchExperimentRunsFacetsState>(\n    new SearchExperimentRunsFacetsState(),\n  );\n\n  // Let's save the immediate array of active requests so\n  // it will be checked against later on\n  const activeRequests = useRef<{ active: boolean; id: string }[]>([]);\n\n  // Next page token is not a stateful field and can be mutable.\n  const nextPageToken = useRef<string>('');\n\n  // Indicates reference time for fetching subsuquent pages which\n  // requires us to keep the same startTime parameter value.\n  // Not a stateful field.\n  const referenceTime = useRef<string>('');\n\n  // Indicates if user has explicitly changed the sort/filter state\n  const isPristineFlag = useRef(true);\n  // Immutable method that returns value from the mutable flag\n  const isPristine = useCallback(() => isPristineFlag.current, []);\n\n  const internalFetchExperimentRuns = useCallback(\n    (\n      requestSearchFacetsState: SearchExperimentRunsFacetsState,\n      requestExperimentIds: string[],\n      requestReferenceTime = Date.now(),\n      requestNextPageToken?: string,\n    ) => {\n      const loadMore = Boolean(requestNextPageToken);\n      if (!loadMore) {\n        referenceTime.current = requestReferenceTime;\n      }\n\n      const actionToUse = loadMore ? actions.loadMoreRunsApi : actions.searchRunsApi;\n\n      const action = actionToUse(\n        createSearchRunsParams(\n          requestExperimentIds,\n          requestSearchFacetsState,\n          requestReferenceTime,\n          requestNextPageToken || undefined,\n        ),\n      );\n\n      // Immediately set loading runs flag, don't wait for RequestStateWrapper\n      // otherwise it will result in the unnecessary rerender\n      setIsLoadingRuns(true);\n      const fetchPromise = dispatch(action)\n        .then((data) => {\n          const { value } = data;\n          nextPageToken.current = value.next_page_token;\n          setMoreRunsAvailable(Boolean(value.next_page_token));\n          fetchModelVersionsForRuns(value.runs || [], actions.searchModelVersionsApi, dispatch);\n\n          // If this request is the current one (meaning found in the active requests list), set loading flag to false\n          if (\n            activeRequests.current.some(\n              (activeRequest) => activeRequest.id === action.meta.id && !activeRequest.active,\n            )\n          ) {\n            setIsLoadingRuns(false);\n          }\n          return value.runs || [];\n        })\n        .catch((e) => {\n          Utils.logErrorAndNotifyUser(e, 0);\n          setIsLoadingRuns(false);\n        });\n\n      setSearchRunsRequestId(action.meta.id);\n\n      return fetchPromise;\n    },\n    [dispatch, actions],\n  );\n\n  const loadMoreRuns = useCallback(() => {\n    return internalFetchExperimentRuns(\n      searchFacetsState,\n      experimentIds,\n      referenceTime.current || undefined,\n      nextPageToken.current || undefined,\n    );\n  }, [internalFetchExperimentRuns, searchFacetsState, experimentIds]);\n\n  /**\n   * Fetches fresh batch of runs using current sort model\n   */\n  const fetchExperimentRuns = useCallback(() => {\n    internalFetchExperimentRuns(searchFacetsState, experimentIds);\n  }, [experimentIds, internalFetchExperimentRuns, searchFacetsState]);\n\n  const persistState = useCallback(\n    (sortFilterModelToSave: SearchExperimentRunsFacetsState, replaceHistory: boolean) => {\n      const newQueryString = persistExperimentSearchFacetsState(\n        sortFilterModelToSave,\n        experimentIdsHash,\n        location.search,\n      );\n\n      // Memoize the last search query so we won't need to\n      // rebuild the search state after the location changes\n      lastSearchFacetsQueryString.current = newQueryString;\n\n      if (location.search !== newQueryString) {\n        navigate(`${location.pathname}${newQueryString}`, { replace: replaceHistory });\n      }\n    },\n    [navigate, location, experimentIdsHash],\n  );\n\n  /**\n   * Updates current search facets model and invokes re-fetching runs if necessary.\n   * Persists new search state in storage and URL.\n   *\n   * @param newFilterModel A search facets model to replace the current one. It can\n   *                       be provided in the form of the partial object that will be merged\n   *                       with the current one or the setter function having the current model\n   *                       provided as a parameter and returning the merged model, similarly to the\n   *                       React's `setState()` pattern.\n   * @param updateOptions  Additional update options provided:\n   *                       - `forceRefresh` - if set to `true`, will force re-fetching runs\n   *                         regardless of the resulting search facets model.\n   *                       - `preservePristine` - if set to `true`, will not change internal \"pristine\"\n   *                         flag used to detect if user have tampered with the search model.\n   *\n   * @examples\n   * ```\n   * // Simple use, updates search filter\n   * updateSearchFacets({\n   *   searchFilter: 'attributes.start_time > 1000',\n   * });\n   *\n   * // Setter function variant, updates selected columns\n   * updateSearchFacets((currentModel) => ({\n   *   ...currentModel,\n   *   selectedColumns: [...currentModel.selectedColumns, 'someColumn'],\n   * }));\n   *\n   * // Using function to force re-fetch while retaining pristine flag\n   * const forceRefreshModel = updateSearchFacets({}, {\n   *   forceRefresh: true,\n   *   preservePristine: true,\n   * });\n   * ```\n   */\n  const updateSearchFacets = useCallback<UpdateExperimentSearchFacetsFn>(\n    (newFilterModel, updateOptions = {}) => {\n      const {\n        forceRefresh = false,\n        preservePristine = false,\n        replaceHistory = false,\n      } = updateOptions;\n      // While dispatching new state, append new filter model\n      // and fetch new runs using it\n      setSearchFacetsState((oldModel) => {\n        const newModel = isFunction(newFilterModel)\n          ? newFilterModel(oldModel)\n          : { ...oldModel, ...newFilterModel };\n        if (forceRefresh || shouldRefetchRuns(oldModel, newModel)) {\n          internalFetchExperimentRuns(newModel, experimentIds);\n        }\n        persistState(newModel, replaceHistory);\n        return newModel;\n      });\n      // Update the flag which indicates that the user have performed\n      // a search with changed sort/filter model\n      if (!preservePristine) {\n        isPristineFlag.current = false;\n      }\n    },\n    [experimentIds, internalFetchExperimentRuns, persistState],\n  );\n\n  // Refreshes the runs\n  const refreshRuns = useCallback(\n    () =>\n      updateSearchFacets(\n        {},\n        {\n          forceRefresh: true,\n          preservePristine: true,\n        },\n      ),\n    [updateSearchFacets],\n  );\n\n  // Update/initialize internal filter/search state after the location has changed\n  useEffect(() => {\n    // If we are sure that the fingerprint of the search facets\n    // is already up to date, we can skip the restoration\n    if (location.search && lastSearchFacetsQueryString.current === location.search) {\n      return;\n    }\n    const { state } = restoreExperimentSearchFacetsState(location.search, experimentIdsHash);\n    updateSearchFacets(state, { replaceHistory: true, forceRefresh: true, preservePristine: true });\n  }, [location.search, updateSearchFacets, experimentIdsHash]);\n\n  const contextValue = useMemo(\n    () => ({\n      actions,\n      searchFacetsState,\n      fetchExperimentRuns,\n      updateSearchFacets,\n      loadMoreRuns,\n      requestError,\n      isLoadingRuns,\n      moreRunsAvailable,\n      isPristine,\n      refreshRuns,\n    }),\n    [\n      actions,\n      searchFacetsState,\n      fetchExperimentRuns,\n      loadMoreRuns,\n      requestError,\n      isLoadingRuns,\n      updateSearchFacets,\n      moreRunsAvailable,\n      isPristine,\n      refreshRuns,\n    ],\n  );\n\n  const renderFn = (_isLoading: false, _renderError: any, requests: any[]) => {\n    // Retain the current version of requests array\n    activeRequests.current = requests;\n\n    requests.forEach((request) => {\n      setRequestError(request.error);\n    });\n    return children;\n  };\n\n  return (\n    <GetExperimentRunsContext.Provider value={contextValue}>\n      <RequestStateWrapper\n        shouldOptimisticallyRender\n        // eslint-disable-next-line no-trailing-spaces\n        requestIds={searchRunsRequestId ? [searchRunsRequestId] : []}\n      >\n        {renderFn}\n      </RequestStateWrapper>\n    </GetExperimentRunsContext.Provider>\n  );\n};\n","import { useContext } from 'react';\n\nimport { GetExperimentRunsContext } from '../contexts/GetExperimentRunsContext';\n\nexport const useFetchExperimentRuns = () => {\n  const getExperimentRunsContextValue = useContext(GetExperimentRunsContext);\n\n  if (!getExperimentRunsContextValue) {\n    throw new Error('Trying to use SearchExperimentRunsContext actions outside of the context!');\n  }\n\n  return getExperimentRunsContextValue;\n};\n","import { useCallback } from 'react';\nimport DeleteRunModal from '../../../modals/DeleteRunModal';\nimport { RenameRunModal } from '../../../modals/RenameRunModal';\nimport RestoreRunModal from '../../../modals/RestoreRunModal';\nimport { useFetchExperimentRuns } from '../../hooks/useFetchExperimentRuns';\n\nexport interface ExperimentViewModalsProps {\n  showDeleteRunModal: boolean;\n  showRestoreRunModal: boolean;\n  showRenameRunModal: boolean;\n  runsSelected: Record<string, boolean>;\n  onCloseDeleteRunModal: () => void;\n  onCloseRestoreRunModal: () => void;\n  onCloseRenameRunModal: () => void;\n  renamedRunName: string;\n}\n\n/**\n * A component that contains modals required for the run\n * management, i.e. delete and restore actions.\n */\nexport const ExperimentViewRunModals = ({\n  showDeleteRunModal,\n  showRestoreRunModal,\n  showRenameRunModal,\n  runsSelected,\n  onCloseDeleteRunModal,\n  onCloseRestoreRunModal,\n  onCloseRenameRunModal,\n  renamedRunName,\n}: ExperimentViewModalsProps) => {\n  const { updateSearchFacets } = useFetchExperimentRuns();\n\n  const selectedRunIds = Object.entries(runsSelected)\n    .filter(([, selected]) => selected)\n    .map(([key]) => key);\n\n  /**\n   * Function used to refresh the list after renaming the run\n   */\n  const refreshRuns = useCallback(\n    () =>\n      updateSearchFacets(\n        {},\n        {\n          forceRefresh: true,\n          preservePristine: true,\n        },\n      ),\n    [updateSearchFacets],\n  );\n\n  return (\n    <>\n      <DeleteRunModal\n        isOpen={showDeleteRunModal}\n        onClose={onCloseDeleteRunModal}\n        selectedRunIds={selectedRunIds}\n      />\n      <RestoreRunModal\n        isOpen={showRestoreRunModal}\n        onClose={onCloseRestoreRunModal}\n        selectedRunIds={selectedRunIds}\n      />\n      <RenameRunModal\n        // @ts-expect-error TS(2322): Type '{ runUuid: string; onClose: () => void; runN... Remove this comment to see the full error message\n        runUuid={selectedRunIds[0]}\n        onClose={onCloseRenameRunModal}\n        runName={renamedRunName}\n        isOpen={showRenameRunModal}\n        onSuccess={() => refreshRuns()}\n      />\n    </>\n  );\n};\n","import {\n  Button,\n  Checkbox,\n  FullscreenExitIcon,\n  FullscreenIcon,\n  SidebarIcon,\n} from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport React, { useCallback, useState } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { useNavigate } from '../../../../../common/utils/RoutingUtils';\nimport { Tooltip } from '@databricks/design-system';\nimport { COLUMN_SORT_BY_ASC, LIFECYCLE_FILTER, SORT_DELIMITER_SYMBOL } from '../../../../constants';\nimport Routes from '../../../../routes';\nimport { UpdateExperimentSearchFacetsFn, UpdateExperimentViewStateFn } from '../../../../types';\nimport { SearchExperimentRunsFacetsState } from '../../models/SearchExperimentRunsFacetsState';\nimport { SearchExperimentRunsViewState } from '../../models/SearchExperimentRunsViewState';\nimport { ExperimentRunsSelectorResult } from '../../utils/experimentRuns.selector';\nimport { ExperimentViewRunModals } from './ExperimentViewRunModals';\nimport { ExperimentViewRunsSortSelector } from './ExperimentViewRunsSortSelector';\nimport { ExperimentViewRunsColumnSelector } from './ExperimentViewRunsColumnSelector';\nimport { TAGS_TO_COLUMNS_MAP } from '../../utils/experimentPage.column-utils';\nimport type { ExperimentRunSortOption } from '../../hooks/useRunSortOptions';\nimport {\n  shouldEnableArtifactBasedEvaluation,\n  shouldEnableExperimentDatasetTracking,\n} from '../../../../../common/utils/FeatureUtils';\nimport { ToggleIconButton } from '../../../../../common/components/ToggleIconButton';\nimport { useExperimentIds } from '../../hooks/useExperimentIds';\n\nexport type ExperimentViewRunsControlsActionsProps = {\n  viewState: SearchExperimentRunsViewState;\n  searchFacetsState: SearchExperimentRunsFacetsState;\n  runsData: ExperimentRunsSelectorResult;\n};\n\nconst CompareRunsButtonWrapper: React.FC = ({ children }) => <>{children}</>;\n\nexport const ExperimentViewRunsControlsActions = React.memo(\n  ({ viewState, runsData, searchFacetsState }: ExperimentViewRunsControlsActionsProps) => {\n    const { runsSelected } = viewState;\n    const { runInfos } = runsData;\n    const { lifecycleFilter } = searchFacetsState;\n\n    const navigate = useNavigate();\n\n    const [showDeleteRunModal, setShowDeleteRunModal] = useState(false);\n    const [showRestoreRunModal, setShowRestoreRunModal] = useState(false);\n    const [showRenameRunModal, setShowRenameRunModal] = useState(false);\n    const [renamedRunName, setRenamedRunName] = useState('');\n\n    const renameButtonClicked = useCallback(() => {\n      const runsSelectedList = Object.keys(runsSelected);\n      const selectedRun = runInfos.find((info) => info.run_uuid === runsSelectedList[0]);\n      if (selectedRun) {\n        setRenamedRunName(selectedRun.run_name);\n        setShowRenameRunModal(true);\n      }\n    }, [runInfos, runsSelected]);\n\n    const compareButtonClicked = useCallback(() => {\n      const runsSelectedList = Object.keys(runsSelected);\n      const experimentIds = runInfos\n        .filter(({ run_uuid }: any) => runsSelectedList.includes(run_uuid))\n        .map(({ experiment_id }: any) => experiment_id);\n\n      navigate(Routes.getCompareRunPageRoute(runsSelectedList, [...new Set(experimentIds)].sort()));\n    }, [navigate, runInfos, runsSelected]);\n\n    const onDeleteRun = useCallback(() => setShowDeleteRunModal(true), []);\n    const onRestoreRun = useCallback(() => setShowRestoreRunModal(true), []);\n    const onCloseDeleteRunModal = useCallback(() => setShowDeleteRunModal(false), []);\n    const onCloseRestoreRunModal = useCallback(() => setShowRestoreRunModal(false), []);\n    const onCloseRenameRunModal = useCallback(() => setShowRenameRunModal(false), []);\n\n    const selectedRunsCount = Object.values(viewState.runsSelected).filter(Boolean).length;\n    const canRestoreRuns = selectedRunsCount > 0;\n    const canRenameRuns = selectedRunsCount === 1;\n    const canCompareRuns = selectedRunsCount > 1;\n    const showActionButtons = canCompareRuns || canRenameRuns || canRestoreRuns;\n\n    return (\n      <>\n        <div css={styles.controlBar}>\n          <Button\n            data-testid='run-rename-button'\n            onClick={renameButtonClicked}\n            disabled={!canRenameRuns}\n          >\n            <FormattedMessage\n              defaultMessage='Rename'\n              description='Label for the rename run button above the experiment runs table'\n            />\n          </Button>\n          {lifecycleFilter === LIFECYCLE_FILTER.ACTIVE ? (\n            <Button\n              data-testid='runs-delete-button'\n              disabled={!canRestoreRuns}\n              onClick={onDeleteRun}\n              danger\n            >\n              <FormattedMessage\n                defaultMessage='Delete'\n                // eslint-disable-next-line max-len\n                description='String for the delete button to delete a particular experiment run'\n              />\n            </Button>\n          ) : null}\n          {lifecycleFilter === LIFECYCLE_FILTER.DELETED ? (\n            <Button\n              data-testid='runs-restore-button'\n              disabled={!canRestoreRuns}\n              onClick={onRestoreRun}\n            >\n              <FormattedMessage\n                defaultMessage='Restore'\n                // eslint-disable-next-line max-len\n                description='String for the restore button to undo the experiments that were deleted'\n              />\n            </Button>\n          ) : null}\n          <div css={styles.buttonSeparator} />\n          <CompareRunsButtonWrapper>\n            <Button\n              data-testid='runs-compare-button'\n              disabled={!canCompareRuns}\n              onClick={compareButtonClicked}\n            >\n              <FormattedMessage\n                defaultMessage='Compare'\n                // eslint-disable-next-line max-len\n                description='String for the compare button to compare experiment runs to find an ideal model'\n              />\n            </Button>\n          </CompareRunsButtonWrapper>\n        </div>\n        <ExperimentViewRunModals\n          runsSelected={runsSelected}\n          onCloseRenameRunModal={onCloseRenameRunModal}\n          onCloseDeleteRunModal={onCloseDeleteRunModal}\n          onCloseRestoreRunModal={onCloseRestoreRunModal}\n          showDeleteRunModal={showDeleteRunModal}\n          showRestoreRunModal={showRestoreRunModal}\n          showRenameRunModal={showRenameRunModal}\n          renamedRunName={renamedRunName}\n        />\n      </>\n    );\n  },\n);\n\nconst styles = {\n  buttonSeparator: (theme: Theme) => ({\n    borderLeft: `1px solid ${theme.colors.border}`,\n    marginLeft: theme.spacing.xs,\n    marginRight: theme.spacing.xs,\n    height: '100%',\n  }),\n  controlBar: (theme: Theme) => ({\n    display: 'flex',\n    gap: theme.spacing.sm,\n    alignItems: 'center',\n  }),\n};\n","import React from 'react';\n\nimport type { ButtonProps } from '@databricks/design-system';\nimport { useDesignSystemTheme } from '@databricks/design-system';\n\nexport interface ToggleIconButtonProps extends ButtonProps {\n  pressed?: boolean;\n}\n\n/**\n * WARNING: Temporary component!\n *\n * This component recreates \"Toggle button with icon\" pattern which is not\n * available in the design system yet.\n *\n * TODO: replace this component with the one from DuBois design system when available.\n */\nconst ToggleIconButton = React.forwardRef<HTMLButtonElement, ToggleIconButtonProps>(\n  (props: ToggleIconButtonProps, ref) => {\n    const { pressed, onClick, icon, onBlur, onFocus, onMouseEnter, onMouseLeave } = props;\n    const { theme } = useDesignSystemTheme();\n    return (\n      <button\n        onClick={onClick}\n        css={{\n          cursor: 'pointer',\n          width: theme.general.heightSm,\n          height: theme.general.heightSm,\n          borderRadius: theme.borders.borderRadiusMd,\n          lineHeight: theme.typography.lineHeightBase,\n          padding: 0,\n          border: 0,\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          background: pressed ? theme.colors.actionDefaultBackgroundPress : 'transparent',\n          color: pressed ? theme.colors.actionDefaultTextPress : theme.colors.textSecondary,\n          '&:hover': {\n            background: theme.colors.actionDefaultBackgroundHover,\n            color: theme.colors.actionDefaultTextHover,\n          },\n        }}\n        ref={ref}\n        onBlur={onBlur}\n        onFocus={onFocus}\n        onMouseEnter={onMouseEnter}\n        onMouseLeave={onMouseLeave}\n      >\n        {icon}\n      </button>\n    );\n  },\n);\n\nexport { ToggleIconButton };\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport * as React from 'react';\nimport classNames from 'classnames';\n\nfunction UnitNumber(_ref) {\n  var prefixCls = _ref.prefixCls,\n      value = _ref.value,\n      current = _ref.current,\n      _ref$offset = _ref.offset,\n      offset = _ref$offset === void 0 ? 0 : _ref$offset;\n  var style;\n\n  if (offset) {\n    style = {\n      position: 'absolute',\n      top: \"\".concat(offset, \"00%\"),\n      left: 0\n    };\n  }\n\n  return /*#__PURE__*/React.createElement(\"span\", {\n    style: style,\n    className: classNames(\"\".concat(prefixCls, \"-only-unit\"), {\n      current: current\n    })\n  }, value);\n}\n\nfunction getOffset(start, end, unit) {\n  var index = start;\n  var offset = 0;\n\n  while ((index + 10) % 10 !== end) {\n    index += unit;\n    offset += unit;\n  }\n\n  return offset;\n}\n\nexport default function SingleNumber(props) {\n  var prefixCls = props.prefixCls,\n      originCount = props.count,\n      originValue = props.value;\n  var value = Number(originValue);\n  var count = Math.abs(originCount);\n\n  var _React$useState = React.useState(value),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      prevValue = _React$useState2[0],\n      setPrevValue = _React$useState2[1];\n\n  var _React$useState3 = React.useState(count),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      prevCount = _React$useState4[0],\n      setPrevCount = _React$useState4[1]; // ============================= Events =============================\n\n\n  var onTransitionEnd = function onTransitionEnd() {\n    setPrevValue(value);\n    setPrevCount(count);\n  }; // Fallback if transition event not support\n\n\n  React.useEffect(function () {\n    var timeout = setTimeout(function () {\n      onTransitionEnd();\n    }, 1000);\n    return function () {\n      clearTimeout(timeout);\n    };\n  }, [value]); // ============================= Render =============================\n  // Render unit list\n\n  var unitNodes;\n  var offsetStyle;\n\n  if (prevValue === value || Number.isNaN(value) || Number.isNaN(prevValue)) {\n    // Nothing to change\n    unitNodes = [/*#__PURE__*/React.createElement(UnitNumber, _extends({}, props, {\n      key: value,\n      current: true\n    }))];\n    offsetStyle = {\n      transition: 'none'\n    };\n  } else {\n    unitNodes = []; // Fill basic number units\n\n    var end = value + 10;\n    var unitNumberList = [];\n\n    for (var index = value; index <= end; index += 1) {\n      unitNumberList.push(index);\n    } // Fill with number unit nodes\n\n\n    var prevIndex = unitNumberList.findIndex(function (n) {\n      return n % 10 === prevValue;\n    });\n    unitNodes = unitNumberList.map(function (n, index) {\n      var singleUnit = n % 10;\n      return /*#__PURE__*/React.createElement(UnitNumber, _extends({}, props, {\n        key: n,\n        value: singleUnit,\n        offset: index - prevIndex,\n        current: index === prevIndex\n      }));\n    }); // Calculate container offset value\n\n    var unit = prevCount < count ? 1 : -1;\n    offsetStyle = {\n      transform: \"translateY(\".concat(-getOffset(prevValue, value, unit), \"00%)\")\n    };\n  }\n\n  return /*#__PURE__*/React.createElement(\"span\", {\n    className: \"\".concat(prefixCls, \"-only\"),\n    style: offsetStyle,\n    onTransitionEnd: onTransitionEnd\n  }, unitNodes);\n}","import _extends from \"@babel/runtime/helpers/esm/extends\";\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport { ConfigContext } from '../config-provider';\nimport { cloneElement } from '../_util/reactNode';\nimport SingleNumber from './SingleNumber';\n\nvar ScrollNumber = function ScrollNumber(_a) {\n  var customizePrefixCls = _a.prefixCls,\n      count = _a.count,\n      className = _a.className,\n      motionClassName = _a.motionClassName,\n      style = _a.style,\n      title = _a.title,\n      show = _a.show,\n      _a$component = _a.component,\n      component = _a$component === void 0 ? 'sup' : _a$component,\n      children = _a.children,\n      restProps = __rest(_a, [\"prefixCls\", \"count\", \"className\", \"motionClassName\", \"style\", \"title\", \"show\", \"component\", \"children\"]);\n\n  var _React$useContext = React.useContext(ConfigContext),\n      getPrefixCls = _React$useContext.getPrefixCls;\n\n  var prefixCls = getPrefixCls('scroll-number', customizePrefixCls); // ============================ Render ============================\n\n  var newProps = _extends(_extends({}, restProps), {\n    'data-show': show,\n    style: style,\n    className: classNames(prefixCls, className, motionClassName),\n    title: title\n  }); // Only integer need motion\n\n\n  var numberNodes = count;\n\n  if (count && Number(count) % 1 === 0) {\n    var numberList = String(count).split('');\n    numberNodes = numberList.map(function (num, i) {\n      return /*#__PURE__*/React.createElement(SingleNumber, {\n        prefixCls: prefixCls,\n        count: Number(count),\n        value: num // eslint-disable-next-line react/no-array-index-key\n        ,\n        key: numberList.length - i\n      });\n    });\n  } // allow specify the border\n  // mock border-color by box-shadow for compatible with old usage:\n  // <Badge count={4} style={{ backgroundColor: '#fff', color: '#999', borderColor: '#d9d9d9' }} />\n\n\n  if (style && style.borderColor) {\n    newProps.style = _extends(_extends({}, style), {\n      boxShadow: \"0 0 0 1px \".concat(style.borderColor, \" inset\")\n    });\n  }\n\n  if (children) {\n    return cloneElement(children, function (oriProps) {\n      return {\n        className: classNames(\"\".concat(prefixCls, \"-custom-component\"), oriProps === null || oriProps === void 0 ? void 0 : oriProps.className, motionClassName)\n      };\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(component, newProps, numberNodes);\n};\n\nexport default ScrollNumber;","import { PresetColorTypes } from '../_util/colors'; // eslint-disable-next-line import/prefer-default-export\n\nexport function isPresetColor(color) {\n  return PresetColorTypes.indexOf(color) !== -1;\n}","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport { ConfigContext } from '../config-provider';\nimport { isPresetColor } from './utils';\n\nvar Ribbon = function Ribbon(_ref) {\n  var _classNames;\n\n  var className = _ref.className,\n      customizePrefixCls = _ref.prefixCls,\n      style = _ref.style,\n      color = _ref.color,\n      children = _ref.children,\n      text = _ref.text,\n      _ref$placement = _ref.placement,\n      placement = _ref$placement === void 0 ? 'end' : _ref$placement;\n\n  var _React$useContext = React.useContext(ConfigContext),\n      getPrefixCls = _React$useContext.getPrefixCls,\n      direction = _React$useContext.direction;\n\n  var prefixCls = getPrefixCls('ribbon', customizePrefixCls);\n  var colorInPreset = isPresetColor(color);\n  var ribbonCls = classNames(prefixCls, \"\".concat(prefixCls, \"-placement-\").concat(placement), (_classNames = {}, _defineProperty(_classNames, \"\".concat(prefixCls, \"-rtl\"), direction === 'rtl'), _defineProperty(_classNames, \"\".concat(prefixCls, \"-color-\").concat(color), colorInPreset), _classNames), className);\n  var colorStyle = {};\n  var cornerColorStyle = {};\n\n  if (color && !colorInPreset) {\n    colorStyle.background = color;\n    cornerColorStyle.color = color;\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(prefixCls, \"-wrapper\")\n  }, children, /*#__PURE__*/React.createElement(\"div\", {\n    className: ribbonCls,\n    style: _extends(_extends({}, colorStyle), style)\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"\".concat(prefixCls, \"-text\")\n  }, text), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(prefixCls, \"-corner\"),\n    style: cornerColorStyle\n  })));\n};\n\nexport default Ribbon;","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport * as React from 'react';\nimport { useMemo, useRef } from 'react';\nimport CSSMotion from 'rc-motion';\nimport classNames from 'classnames';\nimport ScrollNumber from './ScrollNumber';\nimport Ribbon from './Ribbon';\nimport { ConfigContext } from '../config-provider';\nimport { cloneElement } from '../_util/reactNode';\nimport { isPresetColor } from './utils';\n\nvar Badge = function Badge(_a) {\n  var _classNames, _classNames2;\n\n  var customizePrefixCls = _a.prefixCls,\n      customizeScrollNumberPrefixCls = _a.scrollNumberPrefixCls,\n      children = _a.children,\n      status = _a.status,\n      text = _a.text,\n      color = _a.color,\n      _a$count = _a.count,\n      count = _a$count === void 0 ? null : _a$count,\n      _a$overflowCount = _a.overflowCount,\n      overflowCount = _a$overflowCount === void 0 ? 99 : _a$overflowCount,\n      _a$dot = _a.dot,\n      dot = _a$dot === void 0 ? false : _a$dot,\n      _a$size = _a.size,\n      size = _a$size === void 0 ? 'default' : _a$size,\n      title = _a.title,\n      offset = _a.offset,\n      style = _a.style,\n      className = _a.className,\n      _a$showZero = _a.showZero,\n      showZero = _a$showZero === void 0 ? false : _a$showZero,\n      restProps = __rest(_a, [\"prefixCls\", \"scrollNumberPrefixCls\", \"children\", \"status\", \"text\", \"color\", \"count\", \"overflowCount\", \"dot\", \"size\", \"title\", \"offset\", \"style\", \"className\", \"showZero\"]);\n\n  var _React$useContext = React.useContext(ConfigContext),\n      getPrefixCls = _React$useContext.getPrefixCls,\n      direction = _React$useContext.direction;\n\n  var prefixCls = getPrefixCls('badge', customizePrefixCls); // ================================ Misc ================================\n\n  var numberedDisplayCount = count > overflowCount ? \"\".concat(overflowCount, \"+\") : count;\n  var hasStatus = status !== null && status !== undefined || color !== null && color !== undefined;\n  var isZero = numberedDisplayCount === '0' || numberedDisplayCount === 0;\n  var showAsDot = dot && !isZero || hasStatus;\n  var mergedCount = showAsDot ? '' : numberedDisplayCount;\n  var isHidden = useMemo(function () {\n    var isEmpty = mergedCount === null || mergedCount === undefined || mergedCount === '';\n    return (isEmpty || isZero && !showZero) && !showAsDot;\n  }, [mergedCount, isZero, showZero, showAsDot]); // Count should be cache in case hidden change it\n\n  var countRef = useRef(count);\n\n  if (!isHidden) {\n    countRef.current = count;\n  }\n\n  var livingCount = countRef.current; // We need cache count since remove motion should not change count display\n\n  var displayCountRef = useRef(mergedCount);\n\n  if (!isHidden) {\n    displayCountRef.current = mergedCount;\n  }\n\n  var displayCount = displayCountRef.current; // We will cache the dot status to avoid shaking on leaved motion\n\n  var isDotRef = useRef(showAsDot);\n\n  if (!isHidden) {\n    isDotRef.current = showAsDot;\n  } // =============================== Styles ===============================\n\n\n  var mergedStyle = useMemo(function () {\n    if (!offset) {\n      return _extends({}, style);\n    }\n\n    var offsetStyle = {\n      marginTop: offset[1]\n    };\n\n    if (direction === 'rtl') {\n      offsetStyle.left = parseInt(offset[0], 10);\n    } else {\n      offsetStyle.right = -parseInt(offset[0], 10);\n    }\n\n    return _extends(_extends({}, offsetStyle), style);\n  }, [direction, offset, style]); // =============================== Render ===============================\n  // >>> Title\n\n  var titleNode = title !== null && title !== void 0 ? title : typeof livingCount === 'string' || typeof livingCount === 'number' ? livingCount : undefined; // >>> Status Text\n\n  var statusTextNode = isHidden || !text ? null : /*#__PURE__*/React.createElement(\"span\", {\n    className: \"\".concat(prefixCls, \"-status-text\")\n  }, text); // >>> Display Component\n\n  var displayNode = !livingCount || _typeof(livingCount) !== 'object' ? undefined : cloneElement(livingCount, function (oriProps) {\n    return {\n      style: _extends(_extends({}, mergedStyle), oriProps.style)\n    };\n  }); // Shared styles\n\n  var statusCls = classNames((_classNames = {}, _defineProperty(_classNames, \"\".concat(prefixCls, \"-status-dot\"), hasStatus), _defineProperty(_classNames, \"\".concat(prefixCls, \"-status-\").concat(status), !!status), _defineProperty(_classNames, \"\".concat(prefixCls, \"-status-\").concat(color), isPresetColor(color)), _classNames));\n  var statusStyle = {};\n\n  if (color && !isPresetColor(color)) {\n    statusStyle.background = color;\n  }\n\n  var badgeClassName = classNames(prefixCls, (_classNames2 = {}, _defineProperty(_classNames2, \"\".concat(prefixCls, \"-status\"), hasStatus), _defineProperty(_classNames2, \"\".concat(prefixCls, \"-not-a-wrapper\"), !children), _defineProperty(_classNames2, \"\".concat(prefixCls, \"-rtl\"), direction === 'rtl'), _classNames2), className); // <Badge status=\"success\" />\n\n  if (!children && hasStatus) {\n    var statusTextColor = mergedStyle.color;\n    return /*#__PURE__*/React.createElement(\"span\", _extends({}, restProps, {\n      className: badgeClassName,\n      style: mergedStyle\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: statusCls,\n      style: statusStyle\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      style: {\n        color: statusTextColor\n      },\n      className: \"\".concat(prefixCls, \"-status-text\")\n    }, text));\n  } // <Badge status=\"success\" count={<Icon type=\"xxx\" />}></Badge>\n\n\n  return /*#__PURE__*/React.createElement(\"span\", _extends({}, restProps, {\n    className: badgeClassName\n  }), children, /*#__PURE__*/React.createElement(CSSMotion, {\n    visible: !isHidden,\n    motionName: \"\".concat(prefixCls, \"-zoom\"),\n    motionAppear: false\n  }, function (_ref) {\n    var _classNames3;\n\n    var motionClassName = _ref.className;\n    var scrollNumberPrefixCls = getPrefixCls('scroll-number', customizeScrollNumberPrefixCls);\n    var isDot = isDotRef.current;\n    var scrollNumberCls = classNames((_classNames3 = {}, _defineProperty(_classNames3, \"\".concat(prefixCls, \"-dot\"), isDot), _defineProperty(_classNames3, \"\".concat(prefixCls, \"-count\"), !isDot), _defineProperty(_classNames3, \"\".concat(prefixCls, \"-count-sm\"), size === 'small'), _defineProperty(_classNames3, \"\".concat(prefixCls, \"-multiple-words\"), !isDot && displayCount && displayCount.toString().length > 1), _defineProperty(_classNames3, \"\".concat(prefixCls, \"-status-\").concat(status), !!status), _defineProperty(_classNames3, \"\".concat(prefixCls, \"-status-\").concat(color), isPresetColor(color)), _classNames3));\n\n    var scrollNumberStyle = _extends({}, mergedStyle);\n\n    if (color && !isPresetColor(color)) {\n      scrollNumberStyle = scrollNumberStyle || {};\n      scrollNumberStyle.background = color;\n    }\n\n    return /*#__PURE__*/React.createElement(ScrollNumber, {\n      prefixCls: scrollNumberPrefixCls,\n      show: !isHidden,\n      motionClassName: motionClassName,\n      className: scrollNumberCls,\n      count: displayCount,\n      title: titleNode,\n      style: scrollNumberStyle,\n      key: \"scrollNumber\"\n    }, displayNode);\n  }), statusTextNode);\n};\n\nBadge.Ribbon = Ribbon;\nexport default Badge;","import { Button, SyncIcon, Tooltip } from '@databricks/design-system';\nimport React, { useCallback, useEffect, useState } from 'react';\n// TODO: de-antd-ify Badge as soon as it appears in the design system\nimport { Theme } from '@emotion/react';\nimport { Badge } from 'antd';\nimport { FormattedMessage } from 'react-intl';\nimport { connect } from 'react-redux';\nimport { MAX_DETECT_NEW_RUNS_RESULTS, POLL_INTERVAL } from '../../../../constants';\nimport { ExperimentStoreEntities } from '../../../../types';\nimport { useExperimentIds } from '../../hooks/useExperimentIds';\nimport { useFetchExperimentRuns } from '../../hooks/useFetchExperimentRuns';\n\nexport interface ExperimentViewRefreshButtonProps {\n  runInfos: ExperimentStoreEntities['runInfosByUuid'];\n}\n\n/**\n * A component that displays \"refresh runs\" button with the relevant number\n * of the new runs and handles the refresh action.\n */\nexport const ExperimentViewRefreshButtonImpl = React.memo(\n  ({ runInfos }: React.PropsWithChildren<ExperimentViewRefreshButtonProps>) => {\n    const {\n      actions: { searchRunsPayload },\n      updateSearchFacets,\n    } = useFetchExperimentRuns();\n\n    const experimentIds = useExperimentIds();\n\n    // Keeps the time of the last runs fetch\n    const [lastFetchTime, setLastFetchTime] = useState(0);\n\n    // Keeps the number of available new runs\n    const [newRunsCount, setNewRunsCount] = useState(0);\n\n    // Refreshes the runs\n    const refreshRuns = useCallback(\n      () =>\n        updateSearchFacets(\n          {},\n          {\n            forceRefresh: true,\n            preservePristine: true,\n          },\n        ),\n      [updateSearchFacets],\n    );\n\n    // We're resetting number of new runs and the fetch date\n    // every time when the runs payload has changed\n    useEffect(() => {\n      setNewRunsCount(0);\n      setLastFetchTime(() => Date.now());\n    }, [runInfos]);\n\n    useEffect(\n      () => {\n        if (!lastFetchTime) {\n          return undefined;\n        }\n        const interval = setInterval(() => {\n          // Let's query for new runs that have started after a certain time\n          const searchPayloadData: any = {\n            experimentIds,\n            filter: `attributes.start_time > ${lastFetchTime}`,\n            // We're not interested in more than 26 new runs\n            maxResults: MAX_DETECT_NEW_RUNS_RESULTS,\n          };\n          searchRunsPayload(searchPayloadData).then((result) => {\n            const newRuns = result.runs?.length || 0;\n            setNewRunsCount(newRuns);\n          });\n        }, POLL_INTERVAL);\n        return () => clearInterval(interval);\n      },\n      // We're resetting the interval each time the reference time or experiment IDs have changed\n      [lastFetchTime, searchRunsPayload, experimentIds],\n    );\n\n    return (\n      <Badge\n        count={newRunsCount}\n        offset={[-5, 5]}\n        css={styles.pill}\n        overflowCount={MAX_DETECT_NEW_RUNS_RESULTS - 1}\n      >\n        <Tooltip\n          title={\n            <FormattedMessage\n              defaultMessage='Refresh'\n              description='refresh button text to refresh the experiment runs'\n            />\n          }\n        >\n          <Button onClick={refreshRuns} data-testid='runs-refresh-button' icon={<SyncIcon />} />\n        </Tooltip>\n      </Badge>\n    );\n  },\n);\n\nconst styles = {\n  pill: (theme: Theme) => ({ sup: { backgroundColor: theme.colors.lime, zIndex: 1 } }),\n};\n\n/**\n * The only thing that we're interested in the store is the current set of runInfos.\n * We're going to monitor it so we will know when new runs are fetched.\n */\nconst mapStateToProps = (state: { entities: ExperimentStoreEntities }) => {\n  return { runInfos: state.entities.runInfosByUuid };\n};\n\nexport const ExperimentViewRefreshButton = connect(mapStateToProps, undefined, undefined, {\n  // We're interested only in \"entities\" sub-tree so we won't\n  // re-render on other state changes (e.g. API request IDs)\n  areStatesEqual: (nextState, prevState) =>\n    nextState.entities.runInfosByUuid === prevState.entities.runInfosByUuid,\n})(ExperimentViewRefreshButtonImpl);\n","import { useMemo } from 'react';\nimport LocalStorageUtils from '../../../../common/utils/LocalStorageUtils';\n\n/**\n * This hook returns a memoized version of persistable store namespaced for the ExperimentView.\n * It can serve as a store for persisting state for a particular experiment - in this case,\n * the experiment id should be provided as a `identifier` parameter. It can also serve as a store for some\n * general purpose - e.g. you can provide \"onboarding\" as a identifier to get a store specific\n * for the onboarding section of the experiment view.\n *\n * @param storeIdentifier a unique identifier of created store - can be an experiment id or a general purpose name\n */\nexport const useExperimentViewLocalStore = (storeIdentifier: string) =>\n  useMemo(\n    () => LocalStorageUtils.getStoreForComponent('ExperimentView', storeIdentifier),\n    [storeIdentifier],\n  );\n","import React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { ExperimentSearchSyntaxDocUrl } from '../../../../../common/constants';\n\nexport const RunsSearchTooltipContent = () => {\n  return (\n    <div className='search-input-tooltip-content'>\n      <FormattedMessage\n        defaultMessage='Search runs using a simplified version of the SQL {whereBold} clause.'\n        description='Tooltip string to explain how to search runs from the experiments table'\n        values={{ whereBold: <b>WHERE</b> }}\n      />{' '}\n      <FormattedMessage\n        defaultMessage='<link>Learn more</link>'\n        description='Learn more tooltip link to learn more on how to search in an experiments run table'\n        values={{\n          link: (chunks: any) => (\n            <a href={ExperimentSearchSyntaxDocUrl} target='_blank' rel='noopener noreferrer'>\n              {chunks}\n            </a>\n          ),\n        }}\n      />\n      <br />\n      <FormattedMessage\n        defaultMessage='Examples:'\n        description='Text header for examples of mlflow search syntax'\n      />\n      <br />\n      {'• metrics.rmse >= 0.8'}\n      <br />\n      {'• metrics.`f1 score` < 1'}\n      <br />\n      {\"• params.model = 'tree'\"}\n      <br />\n      {\"• attributes.run_name = 'my run'\"}\n      <br />\n      {\"• tags.`mlflow.user` = 'myUser'\"}\n      <br />\n      {\"• metric.f1_score > 0.9 AND params.model = 'tree'\"}\n      <br />\n      {\"• dataset.name IN ('dataset1', 'dataset2')\"}\n      <br />\n      {\"• attributes.run_id IN ('a1b2c3d4', 'e5f6g7h8')\"}\n      <br />\n      {\"• tags.model_class LIKE 'sklearn.linear_model%'\"}\n    </div>\n  );\n};\n","import React from 'react';\nimport { ExperimentRunsSelectorResult } from '../../utils/experimentRuns.selector';\n\nexport type Option = {\n  label?: string | React.ReactNode;\n  value: string;\n};\n\nexport type OptionGroup = {\n  label: string;\n  options: Option[];\n};\n\nexport type Entity = {\n  name: string;\n  startIndex: number;\n  endIndex: number;\n};\n\nexport type Clause = {\n  clause: string;\n  startIndex: number;\n};\n\nexport type EntityNameGroup = {\n  metricNames: string[];\n  paramNames: string[];\n  tagNames: string[];\n};\n\nexport const ATTRIBUTE_OPTIONS = [\n  'run_id',\n  'run_name',\n  'status',\n  'artifact_uri',\n  'user_id',\n  'start_time',\n  'end_time',\n  'created',\n].map((s) => ({ value: `attributes.${s}` }));\n\nexport const getEntityNamesFromRunsData = (\n  newRunsData: ExperimentRunsSelectorResult,\n  existingNames: EntityNameGroup,\n): EntityNameGroup => {\n  const mergeDedup = (list1: any[], list2: any[]) => [...new Set([...list1, ...list2])];\n  const getTagNames = (tagsList: any[]) => tagsList.flatMap((tagRecord) => Object.keys(tagRecord));\n\n  const metricNames = mergeDedup(existingNames.metricNames, newRunsData.metricKeyList);\n  const paramNames = mergeDedup(existingNames.paramNames, newRunsData.paramKeyList);\n  const tagNames = mergeDedup(\n    getTagNames(existingNames.tagNames),\n    getTagNames(newRunsData.tagsList),\n  );\n  // Filter out internal tag names and wrap names that include control characters in backticks.\n  const tagNamesCleaned = tagNames\n    .filter((s: string) => !s.startsWith('mlflow.'))\n    .map((s: string) => {\n      if (s.includes('\"') || s.includes(' ') || s.includes('.')) {\n        return `\\`${s}\\``;\n      } else if (s.includes('`')) {\n        return `\"${s}\"`;\n      } else return s;\n    });\n  return {\n    metricNames,\n    paramNames,\n    tagNames: tagNamesCleaned,\n  };\n};\n\nexport const getOptionsFromEntityNames = (entityNames: EntityNameGroup): OptionGroup[] => [\n  {\n    label: 'Metrics',\n    options: entityNames.metricNames.map((m) => ({ value: `metrics.${m}` })),\n  },\n  {\n    label: 'Parameters',\n    options: entityNames.paramNames.map((p) => ({ value: `params.${p}` })),\n  },\n  {\n    label: 'Tags',\n    options: entityNames.tagNames.map((t) => ({ value: `tags.${t}` })),\n  },\n  {\n    label: 'Attributes',\n    options: ATTRIBUTE_OPTIONS,\n  },\n];\n\n// Bolds a specified segment of `wholeText`.\nconst boldedText = (wholeText: string, shouldBeBold: string) => {\n  const textArray = wholeText.split(RegExp(shouldBeBold.replace('.', '\\\\.'), 'ig'));\n  const match = wholeText.match(RegExp(shouldBeBold.replace('.', '\\\\.'), 'ig'));\n\n  return (\n    // Autocomplete sets font weight to 600 on full match resulting in double bolding.\n    // Override this here\n    <span css={{ fontWeight: 'normal' }} data-test-id={wholeText}>\n      {textArray.map((item, index) => (\n        <>\n          {item}\n          {index !== textArray.length - 1 && match && <b>{match[index]}</b>}\n        </>\n      ))}\n    </span>\n  );\n};\n\n/**\n * Given an input string, returns a list of Clause objects\n * containing the clauses in the input and the indices of their\n * starting positions in the overall string.\n */\nconst getClausesAndStartIndex = (str: string) => {\n  const re = /and[\\s]+/gi;\n  const results: Clause[] = [];\n  let match, position;\n  while (((position = re.lastIndex), (match = re.exec(str)))) {\n    results.push({ clause: str.substring(position, match.index), startIndex: position });\n  }\n  results.push({ clause: str.substring(position), startIndex: position });\n  return results;\n};\n\n/**\n * Given an input string, returns a list of Entity objects\n * containing the search entities in the input and their\n * start and end indices in the whole string.\n */\n\nexport const getEntitiesAndIndices = (str: string) => {\n  const re = />|<|>=|<=|=|!=|like|ilike/gi;\n  const clauses = getClausesAndStartIndex(str);\n  const results: Entity[] = [];\n  clauses.forEach((clauseObj) => {\n    const clauseText = clauseObj.clause;\n    const entity = clauseText.split(re)[0];\n    const { startIndex } = clauseObj;\n    results.push({\n      name: entity,\n      startIndex: 0 + startIndex,\n      endIndex: entity.length + startIndex,\n    });\n  });\n  return results;\n};\n\nexport const getFilteredOptionsFromEntityName = (\n  baseOptions: OptionGroup[],\n  entityBeingEdited: Entity,\n  suggestionLimits: any,\n): OptionGroup[] => {\n  return baseOptions\n    .map((group) => {\n      const newOptions = group.options\n        .filter((option) =>\n          option.value.toLowerCase().includes(entityBeingEdited.name.toLowerCase().trim()),\n        )\n        .map((match) => ({\n          value: match.value,\n          label: boldedText(match.value, entityBeingEdited.name.trim()),\n        }));\n      const limitForGroup = (suggestionLimits as any)[group.label];\n      const ellipsized = [\n        ...newOptions.slice(0, limitForGroup),\n        ...(newOptions.length > limitForGroup\n          ? [{ label: '...', value: `..._${group.label}` }]\n          : []),\n      ];\n      return {\n        label: group.label,\n        options: ellipsized,\n      };\n    })\n    .filter((group) => group.options.length > 0);\n};\n","import { isEqual } from 'lodash';\nimport React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';\nimport {\n  AutoComplete,\n  Input,\n  SearchIcon,\n  Tooltip,\n  InfoIcon,\n  Button,\n  CloseIcon,\n} from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport { ExperimentRunsSelectorResult } from '../../utils/experimentRuns.selector';\nimport {\n  clearSearchExperimentsFacetsFilters,\n  SearchExperimentRunsFacetsState,\n} from '../../models/SearchExperimentRunsFacetsState';\nimport { UpdateExperimentSearchFacetsFn } from '../../../../types';\nimport { ErrorWrapper } from '../../../../../common/utils/ErrorWrapper';\nimport { useExperimentViewLocalStore } from '../../hooks/useExperimentViewLocalStore';\nimport { RunsSearchTooltipContent } from './RunsSearchTooltipContent';\nimport {\n  Entity,\n  EntityNameGroup,\n  getEntitiesAndIndices,\n  getEntityNamesFromRunsData,\n  getFilteredOptionsFromEntityName,\n  getOptionsFromEntityNames,\n  OptionGroup,\n} from './RunsSearchAutoComplete.utils';\n\n// A default placeholder for the search box\nconst SEARCH_BOX_PLACEHOLDER = 'metrics.rmse < 1 and params.model = \"tree\"';\nconst TOOLTIP_COOKIE_KEY = 'tooltipLastPopup';\nconst WEEK_IN_SECONDS = 604800;\n\nexport type RunsSearchAutoCompleteProps = {\n  runsData: ExperimentRunsSelectorResult;\n  searchFacetsState: SearchExperimentRunsFacetsState;\n  updateSearchFacets: UpdateExperimentSearchFacetsFn;\n  requestError: ErrorWrapper | null;\n};\n\n/**\n * Autocomplete component that provides suggestions for MLflow search entity names.\n */\nexport const RunsSearchAutoComplete = (props: RunsSearchAutoCompleteProps) => {\n  const { runsData, searchFacetsState, updateSearchFacets, requestError } = props;\n\n  const [text, setText] = useState<string>('');\n  const [autocompleteEnabled, setAutocompleteEnabled] = useState<boolean | undefined>(undefined);\n  const [focused, setFocused] = useState(false);\n  const onFocus = () => setFocused(true);\n  const onBlur = () => setFocused(false);\n  // Determines whether the text was changed by making a selection in the autocomplete\n  // dialog, as opposed to by typing.\n  const [lastSetBySelection, setLastSetBySelection] = useState(false);\n  const existingEntityNamesRef = useRef<EntityNameGroup>({\n    metricNames: [],\n    paramNames: [],\n    tagNames: [],\n  });\n  // How many suggestions should be shown per entity group before the group is ellipsized.\n  const [suggestionLimits, setSuggestionLimits] = useState({\n    Metrics: 10,\n    Parameters: 10,\n    Tags: 10,\n  });\n  // List of entities parsed from `text`.\n  const currentEntitiesRef = useRef<Entity[]>([]);\n  const [entityBeingEdited, setEntityBeingEdited] = useState<Entity | undefined>(undefined);\n\n  // Each time we're setting search filter externally, update it here as well\n  useEffect(() => {\n    setText(searchFacetsState.searchFilter);\n  }, [searchFacetsState]);\n\n  const baseOptions = useMemo<OptionGroup[]>(() => {\n    const existingEntityNames = existingEntityNamesRef.current;\n    const mergedEntityNames = getEntityNamesFromRunsData(runsData, existingEntityNames);\n    existingEntityNamesRef.current = mergedEntityNames;\n    return getOptionsFromEntityNames(mergedEntityNames);\n    // existingEntityNamesRef is only set here. Omit from dependencies to avoid infinite loop\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [runsData]);\n\n  useEffect(() => {\n    const previousEntities = currentEntitiesRef.current;\n    const newEntities = getEntitiesAndIndices(text);\n    currentEntitiesRef.current = newEntities;\n\n    if (lastSetBySelection) {\n      setLastSetBySelection(false);\n      return;\n    }\n    const currentEntitiesNames = newEntities.map((e) => e.name);\n    const previousEntitiesNames = previousEntities.map((e) => e.name);\n    if (\n      !isEqual(currentEntitiesNames, previousEntitiesNames) &&\n      newEntities.length >= previousEntities.length\n    ) {\n      let i = 0;\n      while (i < newEntities.length) {\n        if (\n          i >= previousEntities.length ||\n          newEntities[i].name.trim() !== previousEntities[i].name.trim()\n        ) {\n          setAutocompleteEnabled(true);\n          setEntityBeingEdited(newEntities[i]);\n          return;\n        }\n        i++;\n      }\n    }\n    // If here, no entity is being edited\n    setAutocompleteEnabled(false);\n    // currentEntitiesRef is not used anywhere else and state setters are safe to\n    // omit from hook dependencies as per react docs\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [text]);\n\n  const filteredOptions = useMemo(() => {\n    if (!entityBeingEdited) {\n      return [];\n    }\n    return getFilteredOptionsFromEntityName(baseOptions, entityBeingEdited, suggestionLimits);\n  }, [baseOptions, entityBeingEdited, suggestionLimits]);\n\n  /**\n   * Called when an option is picked from the autocomplete dropdown, either by hitting enter\n   * when selected, or clicking on it\n   * @param value\n   */\n  const onSelect = useCallback(\n    (value: string, option: any) => {\n      if (!entityBeingEdited) {\n        return;\n      }\n      if (value.startsWith('...')) {\n        // Keep the dialog open as this is not a real selection\n        setAutocompleteEnabled(true);\n        const groupName = option.value.split('_')[1];\n        setSuggestionLimits((prevSuggestionLimits) => ({\n          ...prevSuggestionLimits,\n          [groupName]: (prevSuggestionLimits as any)[groupName] + 10,\n        }));\n      } else {\n        const prefix = text.substring(0, entityBeingEdited.startIndex);\n        const suffix = text.substring(entityBeingEdited.endIndex);\n        setText(prefix + value + ' ' + suffix);\n        setLastSetBySelection(true);\n        setAutocompleteEnabled(false);\n      }\n    },\n    [text, setText, entityBeingEdited, setAutocompleteEnabled],\n  );\n\n  // Callback fired when \"clear\" button is clicked\n  const clearSearchFiltersState = useCallback(() => {\n    updateSearchFacets(clearSearchExperimentsFacetsFilters);\n  }, [updateSearchFacets]);\n\n  const localStorageInstance = useExperimentViewLocalStore(TOOLTIP_COOKIE_KEY);\n\n  const [showTooltipOnError, setShowTooltipOnError] = useState(() => {\n    const currentTimeSecs = Math.floor(Date.now() / 1000);\n    const storedItem = localStorageInstance.getItem(TOOLTIP_COOKIE_KEY);\n    // Show tooltip again if it was last shown 1 week ago or older\n    return !storedItem || parseInt(storedItem, 10) < currentTimeSecs - WEEK_IN_SECONDS;\n  });\n  const tooltipIcon = React.useRef<HTMLDivElement>(null);\n\n  // If requestError has changed and there is an error, pop up the tooltip\n  useEffect(() => {\n    if (requestError && showTooltipOnError) {\n      const currentTimeSecs = Math.floor(Date.now() / 1000);\n      localStorageInstance.setItem(TOOLTIP_COOKIE_KEY, currentTimeSecs);\n      setShowTooltipOnError(false);\n      tooltipIcon.current?.click();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [requestError]);\n\n  const noMatches = filteredOptions.flatMap((o) => o.options).length === 0;\n  const open = autocompleteEnabled && focused && !noMatches;\n\n  // Callback fired when search filter is being used\n  const triggerSearch: React.KeyboardEventHandler<HTMLInputElement> = useCallback(\n    (e) => {\n      if (e.key === 'Enter') {\n        // If the autocomplete dialog is open, use the enter key to make a selection\n        // rather than initiate search.\n        if (open) {\n          setAutocompleteEnabled(false);\n        } else {\n          updateSearchFacets({ searchFilter: text });\n        }\n      }\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        if (open) {\n          setAutocompleteEnabled(false);\n        }\n      }\n    },\n    [open, text, updateSearchFacets],\n  );\n\n  return (\n    <div css={styles.searchBox}>\n      <AutoComplete\n        dropdownMatchSelectWidth={560}\n        css={{ width: 560 }}\n        defaultOpen={false}\n        defaultActiveFirstOption\n        open={open}\n        options={filteredOptions}\n        onSelect={onSelect}\n        value={text}\n        data-test-id='runs-search-autocomplete'\n        dropdownRender={(menu) => <div css={styles.dropdownOverride}>{menu}</div>}\n      >\n        <Input\n          value={text}\n          prefix={<SearchIcon css={styles.searchBarIcon} />}\n          onKeyDown={triggerSearch}\n          onClick={onFocus}\n          onBlur={onBlur}\n          onChange={(e) => setText(e.target.value)}\n          placeholder={SEARCH_BOX_PLACEHOLDER}\n          data-test-id='search-box'\n          suffix={\n            <div css={styles.searchInputSuffix}>\n              {text && (\n                <Button onClick={clearSearchFiltersState} type='link' data-test-id='clear-button'>\n                  <CloseIcon />\n                </Button>\n              )}\n              <Tooltip\n                title={<RunsSearchTooltipContent />}\n                placement='right'\n                dangerouslySetAntdProps={{\n                  overlayInnerStyle: { width: '150%' },\n                  trigger: 'click',\n                }}\n              >\n                <div ref={tooltipIcon}>\n                  <InfoIcon css={styles.searchBarIcon} />\n                </div>\n              </Tooltip>\n            </div>\n          }\n        />\n      </AutoComplete>\n    </div>\n  );\n};\n\nconst styles = {\n  searchBox: (theme: Theme) => ({ display: 'flex', gap: theme.spacing.sm, width: 430 }),\n  searchBarIcon: (theme: Theme) => ({\n    svg: { width: 16, height: 16, color: theme.colors.textSecondary },\n  }),\n  searchInputSuffix: { display: 'flex', gap: 4, alignItems: 'center' },\n  dropdownOverride: {\n    '.du-bois-light-select-item-option-active:not(.du-bois-light-select-item-option-disabled)': {\n      // TODO: ask the design team about the color existing in the palette\n      backgroundColor: '#e6f1f5',\n    },\n  },\n};\n","import type { DatasetSummary } from '../types';\n\nexport const datasetSummariesEqual = (summary1: DatasetSummary, summary2: DatasetSummary) =>\n  summary1.digest === summary2.digest &&\n  summary1.name === summary2.name &&\n  summary1.context === summary2.context;\n","import highlight from './highlight';\nimport refractor from 'refractor/core';\nvar SyntaxHighlighter = highlight(refractor, {});\n\nSyntaxHighlighter.registerLanguage = function (_, language) {\n  return refractor.register(language);\n};\n\nexport default SyntaxHighlighter;","/**\n * Adapted from `duotone-dark`\n * Ref: https://github.com/react-syntax-highlighter/react-syntax-highlighter/blob/b2457268891948f7005ccf539a70c000f0695bde/src/styles/prism/duotone-dark.js\n */\n\nconst databricksDuotoneDarkTheme = {\n  'code[class*=\"language-\"]': {\n    fontFamily:\n      'Consolas, Menlo, Monaco, \"Andale Mono WT\", \"Andale Mono\", \"Lucida Console\", \"Lucida Sans Typewriter\", \"DejaVu Sans Mono\", \"Bitstream Vera Sans Mono\", \"Liberation Mono\", \"Nimbus Mono L\", \"Courier New\", Courier, monospace',\n    fontSize: '14px',\n    lineHeight: '1.375',\n    direction: 'ltr',\n    textAlign: 'left',\n    whiteSpace: 'pre',\n    wordSpacing: 'normal',\n    wordBreak: 'normal',\n    MozTabSize: '4',\n    OTabSize: '4',\n    tabSize: '4',\n    WebkitHyphens: 'none',\n    MozHyphens: 'none',\n    msHyphens: 'none',\n    hyphens: 'none',\n    background: '#2a2734',\n    color: '#5DFAFC', // D\n  },\n  'pre[class*=\"language-\"]': {\n    fontFamily:\n      'Consolas, Menlo, Monaco, \"Andale Mono WT\", \"Andale Mono\", \"Lucida Console\", \"Lucida Sans Typewriter\", \"DejaVu Sans Mono\", \"Bitstream Vera Sans Mono\", \"Liberation Mono\", \"Nimbus Mono L\", \"Courier New\", Courier, monospace',\n    fontSize: '14px',\n    lineHeight: '1.375',\n    direction: 'ltr',\n    textAlign: 'left',\n    whiteSpace: 'pre',\n    wordSpacing: 'normal',\n    wordBreak: 'normal',\n    MozTabSize: '4',\n    OTabSize: '4',\n    tabSize: '4',\n    WebkitHyphens: 'none',\n    MozHyphens: 'none',\n    msHyphens: 'none',\n    hyphens: 'none',\n    background: '#2a2734',\n    color: '#5DFAFC', // D\n    padding: '1em',\n    margin: '.5em 0',\n    overflow: 'auto',\n  },\n  'pre > code[class*=\"language-\"]': {\n    fontSize: '1em',\n  },\n  'pre[class*=\"language-\"]::-moz-selection': {\n    textShadow: 'none',\n    background: '#6a51e6',\n  },\n  'pre[class*=\"language-\"] ::-moz-selection': {\n    textShadow: 'none',\n    background: '#6a51e6',\n  },\n  'code[class*=\"language-\"]::-moz-selection': {\n    textShadow: 'none',\n    background: '#6a51e6',\n  },\n  'code[class*=\"language-\"] ::-moz-selection': {\n    textShadow: 'none',\n    background: '#6a51e6',\n  },\n  'pre[class*=\"language-\"]::selection': {\n    textShadow: 'none',\n    background: '#6a51e6',\n  },\n  'pre[class*=\"language-\"] ::selection': {\n    textShadow: 'none',\n    background: '#6a51e6',\n  },\n  'code[class*=\"language-\"]::selection': {\n    textShadow: 'none',\n    background: '#6a51e6',\n  },\n  'code[class*=\"language-\"] ::selection': {\n    textShadow: 'none',\n    background: '#6a51e6',\n  },\n  ':not(pre) > code[class*=\"language-\"]': {\n    padding: '.1em',\n    borderRadius: '.3em',\n  },\n  comment: {\n    color: '#6c6783',\n  },\n  prolog: {\n    color: '#6c6783',\n  },\n  doctype: {\n    color: '#6c6783',\n  },\n  cdata: {\n    color: '#6c6783',\n  },\n  punctuation: {\n    color: '#6c6783',\n  },\n  namespace: {\n    Opacity: '.7',\n  },\n  tag: {\n    color: '#3AACE2', // D\n  },\n  operator: {\n    color: '#3AACE2', // D\n  },\n  number: {\n    color: '#3AACE2', // D\n  },\n  property: {\n    color: '#5DFAFC', // D\n  },\n  function: {\n    color: '#5DFAFC', // D\n  },\n  'tag-id': {\n    color: '#eeebff',\n  },\n  selector: {\n    color: '#eeebff',\n  },\n  'atrule-id': {\n    color: '#eeebff',\n  },\n  'code.language-javascript': {\n    color: '#c4b9fe',\n  },\n  'attr-name': {\n    color: '#c4b9fe',\n  },\n  'code.language-css': {\n    color: '#ffffff', // D\n  },\n  'code.language-scss': {\n    color: '#ffffff', // D\n  },\n  boolean: {\n    color: '#ffffff', // D\n  },\n  string: {\n    color: '#ffffff', // D\n  },\n  entity: {\n    color: '#ffffff', // D\n    cursor: 'help',\n  },\n  url: {\n    color: '#ffffff', // D\n  },\n  '.language-css .token.string': {\n    color: '#ffffff', // D\n  },\n  '.language-scss .token.string': {\n    color: '#ffffff', // D\n  },\n  '.style .token.string': {\n    color: '#ffffff', // D\n  },\n  'attr-value': {\n    color: '#ffffff', // D\n  },\n  keyword: {\n    color: '#ffffff', // D\n  },\n  control: {\n    color: '#ffffff', // D\n  },\n  directive: {\n    color: '#ffffff', // D\n  },\n  unit: {\n    color: '#ffffff', // D\n  },\n  statement: {\n    color: '#ffffff', // D\n  },\n  regex: {\n    color: '#ffffff', // D\n  },\n  atrule: {\n    color: '#ffffff', // D\n  },\n  placeholder: {\n    color: '#ffffff', // D\n  },\n  variable: {\n    color: '#ffffff', // D\n  },\n  deleted: {\n    textDecoration: 'line-through',\n  },\n  inserted: {\n    borderBottom: '1px dotted #eeebff',\n    textDecoration: 'none',\n  },\n  italic: {\n    fontStyle: 'italic',\n  },\n  important: {\n    fontWeight: 'bold',\n    color: '#c4b9fe',\n  },\n  bold: {\n    fontWeight: 'bold',\n  },\n  'pre > code.highlight': {\n    Outline: '.4em solid #8a75f5',\n    OutlineOffset: '.4em',\n  },\n  '.line-numbers.line-numbers .line-numbers-rows': {\n    borderRightColor: '#2c2937',\n  },\n  '.line-numbers .line-numbers-rows > span:before': {\n    color: '#3c3949',\n  },\n  '.line-highlight.line-highlight': {\n    background: 'linear-gradient(to right, rgba(224, 145, 66, 0.2) 70%, rgba(224, 145, 66, 0))',\n  },\n};\n\nexport default databricksDuotoneDarkTheme;\n","/**\n * Adapted from `material-light`\n * Ref: https://github.com/react-syntax-highlighter/react-syntax-highlighter/blob/b2457268891948f7005ccf539a70c000f0695bde/src/styles/prism/material-light.js#L1\n *\n * This theme overwrites colors to be similiar to the `@databricks/editor` theme.\n */\n\nconst databricksLightTheme = {\n  'code[class*=\"language-\"]': {\n    textAlign: 'left',\n    whiteSpace: 'pre',\n    wordSpacing: 'normal',\n    wordBreak: 'normal',\n    wordWrap: 'normal',\n    color: 'rgb(77, 77, 76)', // D\n    background: '#fafafa',\n    fontFamily: 'Monaco, Menlo, Ubuntu Mono, Consolas, source-code-pro, monospace',\n    fontSize: '12px', // D\n    lineHeight: '1.5em',\n    MozTabSize: '4',\n    OTabSize: '4',\n    tabSize: '4',\n    WebkitHyphens: 'none',\n    MozHyphens: 'none',\n    msHyphens: 'none',\n    hyphens: 'none',\n  },\n  'pre[class*=\"language-\"]': {\n    textAlign: 'left',\n    whiteSpace: 'pre',\n    wordSpacing: 'normal',\n    wordBreak: 'normal',\n    wordWrap: 'normal',\n    color: 'rgb(77, 77, 76)', // D\n    background: '#fafafa',\n    fontFamily: 'Monaco, Menlo, Ubuntu Mono, Consolas, source-code-pro, monospace',\n    fontSize: '12px', // D\n    lineHeight: '1.5em',\n    MozTabSize: '4',\n    OTabSize: '4',\n    tabSize: '4',\n    WebkitHyphens: 'none',\n    MozHyphens: 'none',\n    msHyphens: 'none',\n    hyphens: 'none',\n    overflow: 'auto',\n    position: 'relative',\n    margin: '0.5em 0',\n    padding: '1.25em 1em',\n  },\n  'code[class*=\"language-\"]::-moz-selection': {\n    background: '#cceae7',\n    color: '#263238',\n  },\n  'pre[class*=\"language-\"]::-moz-selection': {\n    background: '#cceae7',\n    color: '#263238',\n  },\n  'code[class*=\"language-\"] ::-moz-selection': {\n    background: '#cceae7',\n    color: '#263238',\n  },\n  'pre[class*=\"language-\"] ::-moz-selection': {\n    background: '#cceae7',\n    color: '#263238',\n  },\n  'code[class*=\"language-\"]::selection': {\n    background: '#cceae7',\n    color: '#263238',\n  },\n  'pre[class*=\"language-\"]::selection': {\n    background: '#cceae7',\n    color: '#263238',\n  },\n  'code[class*=\"language-\"] ::selection': {\n    background: '#cceae7',\n    color: '#263238',\n  },\n  'pre[class*=\"language-\"] ::selection': {\n    background: '#cceae7',\n    color: '#263238',\n  },\n  ':not(pre) > code[class*=\"language-\"]': {\n    whiteSpace: 'normal',\n    borderRadius: '0.2em',\n    padding: '0.1em',\n  },\n  '.language-css > code': {\n    color: '#f5871f', // D\n  },\n  '.language-sass > code': {\n    color: '#f5871f', // D\n  },\n  '.language-scss > code': {\n    color: '#f5871f', // D\n  },\n  '[class*=\"language-\"] .namespace': {\n    Opacity: '0.7',\n  },\n  atrule: {\n    color: '#7c4dff',\n  },\n  'attr-name': {\n    color: '#39adb5',\n  },\n  'attr-value': {\n    color: '#f6a434',\n  },\n  attribute: {\n    color: '#f6a434',\n  },\n  boolean: {\n    color: '#7c4dff', // D\n  },\n  builtin: {\n    color: '#39adb5',\n  },\n  cdata: {\n    color: '#39adb5',\n  },\n  char: {\n    color: '#39adb5',\n  },\n  class: {\n    color: '#39adb5',\n  },\n  'class-name': {\n    color: '#6182b8',\n  },\n  comment: {\n    color: '#8e908c', // D\n  },\n  constant: {\n    color: '#7c4dff', // D\n  },\n  deleted: {\n    color: '#e53935',\n  },\n  doctype: {\n    color: '#aabfc9',\n  },\n  entity: {\n    color: '#e53935',\n  },\n  function: {\n    color: '#4271ae', // D\n  },\n  hexcode: {\n    color: '#f5871f', // D\n  },\n  id: {\n    color: '#7c4dff',\n    fontWeight: 'bold',\n  },\n  important: {\n    color: '#7c4dff',\n    fontWeight: 'bold',\n  },\n  inserted: {\n    color: '#39adb5',\n  },\n  keyword: {\n    color: '#8959a8', // D\n  },\n  number: {\n    color: '#f5871f', // D\n  },\n  operator: {\n    color: '#3e999f', // D\n  },\n  prolog: {\n    color: '#aabfc9',\n  },\n  property: {\n    color: '#39adb5',\n  },\n  'pseudo-class': {\n    color: '#f6a434',\n  },\n  'pseudo-element': {\n    color: '#f6a434',\n  },\n  punctuation: {\n    color: 'rgb(77, 77, 76)', // D\n  },\n  regex: {\n    color: '#6182b8',\n  },\n  selector: {\n    color: '#e53935',\n  },\n  string: {\n    color: '#3ba85f', // D\n  },\n  symbol: {\n    color: '#7c4dff',\n  },\n  tag: {\n    color: '#e53935',\n  },\n  unit: {\n    color: '#f5871f', // D\n  },\n  url: {\n    color: '#e53935',\n  },\n  variable: {\n    color: '#c72d4c', // D\n  },\n};\n\nexport default databricksLightTheme;\n","import { PrismLight as SyntaxHighlighter } from 'react-syntax-highlighter';\nimport python from 'react-syntax-highlighter/dist/cjs/languages/prism/python';\n\nSyntaxHighlighter.registerLanguage('python', python);\n\nimport duotoneDarkStyle from './theme/databricks-duotone-dark';\nimport lightStyle from './theme/databricks-light';\nimport { CSSProperties, ReactNode } from 'react';\nimport { pick } from 'lodash';\n\nexport type CodeSnippetTheme = 'duotoneDark' | 'light';\n\nexport const buttonBackgroundColorDark = 'rgba(140, 203, 255, 0)';\nexport const buttonColorDark = 'rgba(255, 255, 255, 0.84)';\nexport const buttonHoverColorDark = '#8ccbffcc';\nexport const buttonHoverBackgroundColorDark = 'rgba(140, 203, 255, 0.08)';\nexport const duboisAlertBackgroundColor = '#fff0f0';\nexport const snippetPadding = '24px';\n\nconst themesStyles: Record<CodeSnippetTheme, any> = {\n  light: lightStyle,\n  duotoneDark: duotoneDarkStyle,\n};\n\nexport type CodeSnippetLanguage = 'python';\n\nexport interface CodeSnippetProps {\n  /**\n   * The code string\n   */\n  children: string;\n  /**\n   * The actions that are displayed on the right top corner of the component\n   *  see `./actions` for built-in actions\n   */\n  actions?: NonNullable<ReactNode> | NonNullable<ReactNode>[];\n  /**\n   * The theme, default theme is `light`\n   */\n  theme?: CodeSnippetTheme;\n  /**\n   * Language of the code (`children`)\n   */\n  language: CodeSnippetLanguage;\n  /**\n   * Custom styles (passed to the internal `<pre>`)\n   */\n  style?: CSSProperties;\n  /**\n   * Whether to show line numbers on the left or not\n   */\n  showLineNumbers?: boolean;\n  /**\n   * Custom styles for line numbers\n   */\n  lineNumberStyle?: CSSProperties;\n}\n\n/**\n * `CodeSnippet` is used for highlighting code, use this instead of\n */\nexport function CodeSnippet({\n  theme = 'light',\n  language,\n  actions,\n  style,\n  children,\n  showLineNumbers,\n  lineNumberStyle,\n}: CodeSnippetProps) {\n  const customStyle = {\n    border: 'none',\n    borderRadius: 0,\n    margin: 0,\n    padding: snippetPadding,\n    ...style,\n  };\n\n  return (\n    <>\n      <SyntaxHighlighter\n        showLineNumbers={showLineNumbers}\n        lineNumberStyle={lineNumberStyle}\n        language={language}\n        style={themesStyles[theme]}\n        customStyle={customStyle}\n        codeTagProps={{\n          style: pick(style, 'backgroundColor'),\n        }}\n      >\n        {children}\n      </SyntaxHighlighter>\n    </>\n  );\n}\n","import {\n  Button,\n  CopyIcon,\n  Input,\n  Modal,\n  TabPane,\n  Tabs,\n  Typography,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { FormattedMessage } from 'react-intl';\nimport { CodeSnippet } from '@databricks/web-shared/snippet';\nimport { CopyButton } from '../../../shared/building_blocks/CopyButton';\n\ntype Props = {\n  isOpen: boolean;\n  closeModal: () => void;\n  experimentId: string;\n};\n\nexport const CreateNotebookRunModal = ({\n  isOpen,\n  closeModal,\n  experimentId,\n}: Props): JSX.Element => {\n  const { theme } = useDesignSystemTheme();\n\n  const classical_ml_text = `\n  import mlflow \n  from sklearn.model_selection import train_test_split \n  from sklearn.datasets import load_diabetes\n  import RandomForestRegressor \n  \n  # set the experiment id\n  mlflow.set_experiment(experiment_id=\"${experimentId}\")\n  \n  mlflow.autolog() \n  db = load_diabetes() \n  \n  X_train, X_test, y_train, y_test = train_test_split(db.data, db.target) \n  \n  # Create and train models. \n  rf = RandomForestRegressor(n_estimators=100, max_depth=6, max_features=3) \n  rf.fit(X_train, y_train) \n  \n  # Use the model to make predictions on the test dataset. \n  predictions = rf.predict(X_test)\n  `;\n\n  const llm_text = `\n  import mlflow\n  import openai\n  \n  # you must set the OPENAI_API_KEY environment variable\n  assert \"OPENAI_API_KEY\" in os.environ, \"Please set the OPENAI_API_KEY environment variable.\"\n  \n  # set the experiment id\n  mlflow.set_experiment(experiment_id=\"${experimentId}\")\n  \n  system_prompt = \"The following is a conversation with an AI assistant. The assistant is helpful and very friendly.\"\n  \n  # start a run\n  mlflow.start_run()\n  mlflow.log_param(\"system_prompt\", system_prompt)\n  \n  # Create a question answering model using prompt engineering with OpenAI. Log the model\n  # to MLflow Tracking\n  logged_model = mlflow.openai.log_model(\n      model=\"gpt-3.5-turbo\",\n      task=openai.ChatCompletion,\n      artifact_path=\"model\",\n      messages=[\n          {\"role\": \"system\", \"content\": system_prompt},\n          {\"role\": \"user\", \"content\": \"{question}\"},\n      ],\n  )\n  \n  # Evaluate the model on some example questions\n  questions = pd.DataFrame(\n      {\n          \"question\": [\n              \"How do you create a run with MLflow?\",\n              \"How do you log a model with MLflow?\",\n              \"What is the capital of France?\",\n          ]\n      }\n  )\n  mlflow.evaluate(\n      model=logged_model.model_uri,\n      model_type=\"question-answering\",\n      data=questions,\n  )\n  mlflow.end_run()\n  `;\n\n  return (\n    <Modal\n      verticalSizing='maxed_out'\n      visible={isOpen}\n      onCancel={closeModal}\n      onOk={closeModal}\n      footer={\n        <div css={{ display: 'flex', gap: theme.spacing.sm, justifyContent: 'flex-end' }}>\n          <Button onClick={closeModal} type='primary'>\n            <FormattedMessage\n              defaultMessage='Okay'\n              description='Experiment page > new notebook run modal > okay button label'\n            />\n          </Button>\n        </div>\n      }\n      title={\n        <div>\n          <Typography.Title\n            level={2}\n            css={{ marginTop: theme.spacing.sm, marginBottom: theme.spacing.xs }}\n          >\n            <FormattedMessage\n              defaultMessage='New run using notebook'\n              description='Experiment page > new notebook run modal > modal title'\n            />\n          </Typography.Title>\n          <Typography.Hint css={{ marginTop: 0, fontWeight: 'normal' }}>\n            Run this code snippet in a notebook or locally, to create an experiment run\n          </Typography.Hint>\n        </div>\n      }\n    >\n      <Tabs>\n        <TabPane\n          tab={\n            <FormattedMessage\n              defaultMessage='Classical ML'\n              description='Example text snippet for classical ML'\n            />\n          }\n          key='classical-ml'\n        >\n          <CodeSnippet\n            style={{ padding: '5px' }}\n            language='python'\n            actions={\n              <div\n                style={{\n                  marginRight: '8px',\n                }}\n              >\n                <CopyButton copyText={classical_ml_text} showLabel={false} icon={<CopyIcon />} />\n              </div>\n            }\n          >\n            {classical_ml_text}\n          </CodeSnippet>\n        </TabPane>\n        <TabPane\n          tab={<FormattedMessage defaultMessage='LLM' description='Example text snippet for LLM' />}\n          key='llm'\n        >\n          <CodeSnippet\n            style={{ padding: '5px' }}\n            language='python'\n            actions={\n              <div\n                style={{\n                  marginRight: '8px',\n                }}\n              >\n                <CopyButton copyText={llm_text} showLabel={false} icon={<CopyIcon />} />\n              </div>\n            }\n          >\n            {llm_text}\n          </CodeSnippet>\n        </TabPane>\n      </Tabs>\n    </Modal>\n  );\n};\n\nconst styles = {\n  formItem: { marginBottom: 16 },\n};\n","/**\n * TS implementation of\n * https://github.com/mlflow/mlflow/blob/master/mlflow/utils/name_utils.py\n */\n\nimport { RunRowType } from '../components/experiment-page/utils/experimentPage.row-types';\n\n// prettier-ignore\nconst dictionaryAdjectives = ['abundant','able','abrasive','adorable','adaptable','adventurous','aged','agreeable','ambitious','amazing','amusing','angry','auspicious','awesome','bald','beautiful','bemused','bedecked','big','bittersweet','blushing','bold','bouncy','brawny','bright','burly','bustling','calm','capable','carefree','capricious','caring','casual','charming','chill','classy','clean','clumsy','colorful','crawling','dapper','debonair','dashing','defiant','delicate','delightful','dazzling','efficient','enchanting','entertaining','enthused','exultant','fearless','flawless','fortunate','fun','funny','gaudy','gentle','gifted','glamorous','grandiose','gregarious','handsome','hilarious','honorable','illustrious','incongruous','indecisive','industrious','intelligent','inquisitive','intrigued','invincible','judicious','kindly','languid','learned','legendary','likeable','loud','luminous','luxuriant','lyrical','magnificent','marvelous','masked','melodic','merciful','mercurial','monumental','mysterious','nebulous','nervous','nimble','nosy','omniscient','orderly','overjoyed','peaceful','painted','persistent','placid','polite','popular','powerful','puzzled','rambunctious','rare','rebellious','respected','resilient','righteous','receptive','redolent','resilient','rogue','rumbling','salty','sassy','secretive','selective','sedate','serious','shivering','skillful','sincere','skittish','silent','smiling','sneaky','sophisticated','spiffy','stately','suave','stylish','tasteful','thoughtful','thundering','traveling','treasured','trusting','unequaled','upset','unique','unleashed','useful','upbeat','unruly','valuable','vaunted','victorious','welcoming','whimsical','wistful','wise','worried','youthful','zealous'];\n// prettier-ignore\nconst dictionaryNouns = ['ant','ape','asp','auk','bass','bat','bear','bee','bird','boar','bug','calf','carp','cat','chimp','cod','colt','conch','cow','crab','crane','croc','crow','cub','deer','doe','dog','dolphin','donkey','dove','duck','eel','elk','fawn','finch','fish','flea','fly','foal','fowl','fox','frog','gnat','gnu','goat','goose','grouse','grub','gull','hare','hawk','hen','hog','horse','hound','jay','kit','kite','koi','lamb','lark','loon','lynx','mare','midge','mink','mole','moose','moth','mouse','mule','newt','owl','ox','panda','penguin','perch','pig','pug','quail','ram','rat','ray','robin','roo','rook','seal','shad','shark','sheep','shoat','shrew','shrike','shrimp','skink','skunk','sloth','slug','smelt','snail','snake','snipe','sow','sponge','squid','squirrel','stag','steed','stoat','stork','swan','tern','toad','trout','turtle','vole','wasp','whale','wolf','worm','wren','yak','zebra'];\n\nconst generateString = (separator: string, integerScale: number) => {\n  const randomAdjIndex = Math.floor(Math.random() * dictionaryAdjectives.length);\n  const randomNounIndex = Math.floor(Math.random() * dictionaryNouns.length);\n  const randomAdjective = dictionaryAdjectives[randomAdjIndex];\n  const randomNoun = dictionaryNouns[randomNounIndex];\n  const randomNumber = Math.floor(Math.random() * 10 ** integerScale);\n  return [randomAdjective, randomNoun, randomNumber].join(separator);\n};\n\n/**\n * Generates a random name suitable for experiment run, e.g. invincible-mule-479\n */\nexport const generateRandomRunName = (separator = '-', integerScale = 3, maxLength = 20) => {\n  let name = '';\n  for (let i = 0; i < 10; i++) {\n    name = generateString(separator, integerScale);\n    if (name.length < maxLength) return name;\n  }\n  return name.slice(0, maxLength);\n};\n\nexport const getDuplicatedRunName = (\n  originalRunName: string,\n  alreadyExistingRunNames: string[] = [],\n) => {\n  // Check if the the run name being copied is already suffixed with number\n  const match = originalRunName.match(/\\s\\((\\d+)\\)$/);\n\n  const nameSegmentWithoutIndex = match\n    ? originalRunName.substring(0, originalRunName.length - match[0].length)\n    : originalRunName;\n\n  let newIndex = match ? parseInt(match[1], 10) + 1 : 1;\n  // If there's already a run name with increased index, increase it again\n  while (alreadyExistingRunNames.includes(nameSegmentWithoutIndex + ' (' + newIndex + ')')) {\n    newIndex++;\n  }\n  return nameSegmentWithoutIndex + ' (' + newIndex + ')';\n};\n","import { useCallback, useState } from 'react';\nimport { MessageDescriptor, defineMessage } from 'react-intl';\n\n// Hardcoded model parameter definitions\nconst parameterDefinitions: {\n  name: 'temperature' | 'max_tokens' | 'stop';\n  type: 'slider' | 'input' | 'list';\n  string: MessageDescriptor;\n  helpString: MessageDescriptor;\n  max?: number;\n  min?: number;\n  step?: number;\n}[] = [\n  {\n    type: 'slider',\n    name: 'temperature',\n    string: defineMessage({\n      defaultMessage: 'Temperature',\n      description: 'Experiment page > prompt lab > temperature parameter label',\n    }),\n    helpString: defineMessage({\n      defaultMessage: 'Increase or decrease the confidence level of the language model.',\n      description: 'Experiment page > prompt lab > temperature parameter help text',\n    }),\n    max: 1,\n    min: 0.01,\n    step: 0.01,\n  },\n  {\n    type: 'input',\n    name: 'max_tokens',\n    string: defineMessage({\n      defaultMessage: 'Max tokens',\n      description: 'Experiment page > prompt lab > max tokens parameter label',\n    }),\n    helpString: defineMessage({\n      defaultMessage: 'Maximum number of language tokens returned from evaluation.',\n      description: 'Experiment page > prompt lab > max tokens parameter help text',\n    }),\n    max: 64 * 1024,\n    min: 1,\n    step: 1,\n  },\n  {\n    type: 'list',\n    name: 'stop',\n    string: defineMessage({\n      defaultMessage: 'Stop Sequences',\n      description: 'Experiment page > prompt lab > stop parameter label',\n    }),\n    helpString: defineMessage({\n      defaultMessage: 'Specify sequences that signal the model to stop generating text.',\n      description: 'Experiment page > prompt lab > stop parameter help text',\n    }),\n  },\n];\n\n// TODO: Fetch better values for default parameters\nconst DEFAULT_PARAMETER_VALUES = {\n  temperature: 0.01,\n  max_tokens: 100,\n};\n\nexport const usePromptEvaluationParameters = () => {\n  const [parameters, updateParameters] = useState<{\n    temperature: number;\n    max_tokens: number;\n    stop?: string[] | undefined;\n  }>(DEFAULT_PARAMETER_VALUES);\n\n  const updateParameter = useCallback((name: string, value: number | string[]) => {\n    updateParameters((currentParameters) => ({ ...currentParameters, [name]: value }));\n  }, []);\n\n  return {\n    parameterDefinitions,\n    parameters,\n    updateParameter,\n  };\n};\n","import {\n  FormUI,\n  InfoIcon,\n  Input,\n  Tooltip,\n  Select,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { usePromptEvaluationParameters } from './hooks/usePromptEvaluationParameters';\nimport { FormattedMessage } from 'react-intl';\nimport { LineSmoothSlider } from '../LineSmoothSlider';\n\nexport const EvaluationCreatePromptParameters = ({\n  disabled = false,\n  parameters,\n  updateParameter,\n}: {\n  disabled?: boolean;\n  parameters: {\n    temperature: number;\n    max_tokens: number;\n    stop?: string[] | undefined;\n  };\n  updateParameter: (name: string, value: number | string[]) => void;\n}) => {\n  const { parameterDefinitions } = usePromptEvaluationParameters();\n  const { theme } = useDesignSystemTheme();\n  return (\n    <>\n      {parameterDefinitions.map((parameterDef) => (\n        <div key={parameterDef.name} css={{ marginBottom: theme.spacing.md }}>\n          <>\n            <FormUI.Label htmlFor={parameterDef.name}>\n              <FormattedMessage {...parameterDef.string} />\n              <Tooltip title={<FormattedMessage {...parameterDef.helpString} />} placement='right'>\n                <InfoIcon\n                  css={{\n                    marginLeft: theme.spacing.sm,\n                    verticalAlign: 'text-top',\n                    color: theme.colors.textSecondary,\n                  }}\n                />\n              </Tooltip>\n            </FormUI.Label>\n            <FormUI.Hint></FormUI.Hint>\n            {parameterDef.name === 'temperature' && (\n              <LineSmoothSlider\n                data-testid={parameterDef.name}\n                disabled={disabled}\n                max={parameterDef.max}\n                min={parameterDef.min}\n                step={parameterDef.step}\n                defaultValue={parameters[parameterDef.name] || 0}\n                handleLineSmoothChange={(value) => updateParameter(parameterDef.name, value)}\n              />\n            )}\n            {parameterDef.type === 'input' && (\n              <Input\n                data-testid={parameterDef.name}\n                type='number'\n                disabled={disabled}\n                max={parameterDef.max}\n                min={parameterDef.min}\n                step={parameterDef.step}\n                value={parameters[parameterDef.name] || 0}\n                onChange={(e) => updateParameter(parameterDef.name, parseInt(e.target.value, 10))}\n              />\n            )}\n            {parameterDef.type === 'list' && (\n              <Select\n                allowClear\n                mode='tags'\n                style={{ width: '100%' }}\n                open={false}\n                disabled={disabled}\n                onChange={(e) => updateParameter(parameterDef.name, e)}\n                value={parameters[parameterDef.name] || []}\n                dangerouslySetAntdProps={{ suffixIcon: null }}\n              />\n            )}\n          </>\n        </div>\n      ))}\n    </>\n  );\n};\n","import React, { useCallback, useRef, useState } from 'react';\n\nimport type { TextAreaRef } from 'antd/lib/input/TextArea';\nimport { DEFAULT_PROMPTLAB_NEW_TEMPLATE_VALUE } from '../../prompt-engineering/PromptEngineering.utils';\n\nconst newVariableStartSegment = ' {{ ';\nconst newVariableEndSegment = ' }}';\nconst newVariableNameSegment = 'new_variable';\n\n/**\n * Keeps track of the current prompt value and exports method for adding + autoselecting new variables\n */\nexport const usePromptEvaluationPromptTemplateValue = () => {\n  const [promptTemplate, updatePromptTemplate] = useState(DEFAULT_PROMPTLAB_NEW_TEMPLATE_VALUE);\n\n  const promptTemplateRef = useRef<HTMLTextAreaElement>();\n\n  const handleAddVariableToTemplate = useCallback(() => {\n    updatePromptTemplate((template) => {\n      const newValue = `${template}${newVariableStartSegment}${newVariableNameSegment}${newVariableEndSegment}`;\n\n      // Wait until the next execution frame\n      requestAnimationFrame(() => {\n        const textAreaElement = promptTemplateRef.current;\n        if (!textAreaElement) {\n          return;\n        }\n        // Focus the element and set the newly added variable name\n        textAreaElement.focus();\n        textAreaElement.setSelectionRange(\n          newValue.length - newVariableNameSegment.length - newVariableEndSegment.length,\n          newValue.length - newVariableEndSegment.length,\n        );\n      });\n      return newValue;\n    });\n  }, [updatePromptTemplate]);\n\n  const savePromptTemplateInputRef = useCallback((ref: TextAreaRef) => {\n    promptTemplateRef.current = ref?.resizableTextArea?.textArea;\n  }, []);\n\n  return {\n    savePromptTemplateInputRef,\n    handleAddVariableToTemplate,\n    promptTemplate,\n    updatePromptTemplate,\n  };\n};\n","import { Typography } from '@databricks/design-system';\nimport { getPromptInputVariableNameViolations } from '../../prompt-engineering/PromptEngineering.utils';\nimport { FormattedMessage, defineMessage, useIntl } from 'react-intl';\n\nconst whitespaceViolationMessage = defineMessage({\n  defaultMessage: 'The following variable names contain spaces which is disallowed: {invalidNames}',\n  description:\n    'Experiment page > new run modal > variable name validation > including spaces error',\n});\n\nexport const EvaluationCreateRunPromptTemplateErrors = ({\n  violations,\n}: {\n  violations: ReturnType<typeof getPromptInputVariableNameViolations>;\n}) => {\n  const { namesWithSpaces } = violations;\n  const { formatMessage } = useIntl();\n  return (\n    <>\n      {namesWithSpaces.length > 0 && (\n        <Typography.Text\n          color='warning'\n          size='sm'\n          aria-label={formatMessage(whitespaceViolationMessage, {\n            invalidNames: namesWithSpaces.join(', '),\n          })}\n        >\n          <FormattedMessage\n            {...whitespaceViolationMessage}\n            values={{\n              invalidNames: (\n                <>\n                  {namesWithSpaces.map((nameWithSpace) => (\n                    <code key={nameWithSpace}>{nameWithSpace}</code>\n                  ))}\n                </>\n              ),\n            }}\n          />\n        </Typography.Text>\n      )}\n    </>\n  );\n};\n","export const PROMPT_TEMPLATE_EXAMPLES = [\n  {\n    prompt: [\n      'You are a marketing consultant for a technology company. Develop a marketing strategy report for {{ company_name }} aiming to {{ company_goal }}',\n    ],\n    variables: [\n      {\n        name: 'company_name',\n        value: 'XYZ Company',\n      },\n      {\n        name: 'company_goal',\n        value: 'Increase top-line revenue',\n      },\n    ],\n  },\n  {\n    prompt: [\n      'You are a helpful and friendly customer support chatbot. Answer the users question \"{{ user_question }}\" clearly, based on the following documentation: {{ documentation }}',\n    ],\n    variables: [\n      {\n        name: 'user_question',\n        value: 'Is MLflow open source?',\n      },\n      {\n        name: 'documentation',\n        value:\n          'MLflow is an open source platform for managing the end-to-end machine learning lifecycle.',\n      },\n    ],\n  },\n  {\n    prompt: [\n      'Summarize the given text \"{{ text }}\" into a concise and coherent summary, capturing the main ideas and key points. Make sure that the summary does not exceed {{ word_count }} words.',\n    ],\n    variables: [\n      {\n        name: 'text',\n        value:\n          'Although C. septempunctata larvae and adults mainly eat aphids, they also feed on Thysanoptera, Aleyrodidae, on the larvae of Psyllidae and Cicadellidae, and on eggs and larvae of some beetles and butterflies. There are one or two generations per year. Adults overwinter in ground litter in parks, gardens and forest edges and under tree bark and rocks. C. septempunctata has a broad ecological range, generally living wherever there are aphids for it to eat. This includes, amongst other biotopes, meadows, fields, Pontic–Caspian steppe, parkland, gardens, Western European broadleaf forests and mixed forests. In the United Kingdom, there are fears that the seven-spot ladybird is being outcompeted for food by the harlequin ladybird. An adult seven-spot ladybird may reach a body length of 7.6–12.7 mm (0.3–0.5 in). Their distinctive spots and conspicuous colours warn of their toxicity, making them unappealing to predators. The species can secrete a fluid from joints in their legs which gives them a foul taste. A threatened ladybird may both play dead and secrete the unappetising substance to protect itself. The seven-spot ladybird synthesizes the toxic alkaloids, N-oxide coccinelline and its free base precoccinelline; depending on sex and diet, the spot size and coloration can provide some indication of how toxic the individual insect is to potential predators.',\n      },\n      {\n        name: 'word_count',\n        value: '75',\n      },\n    ],\n  },\n  {\n    prompt: [\n      'Generate a list of ten titles for my book. The book is about {{ topic }}. Each title should be between {{ word_range }} words long.',\n      '### Examples of great titles ###',\n      '{{ examples }}',\n    ],\n    variables: [\n      {\n        name: 'topic',\n        value:\n          'my journey as an adventurer who has lived an unconventional life, meeting many different personalities and finally finding peace in gardening.',\n      },\n      {\n        name: 'word_range',\n        value: 'two to five',\n      },\n      {\n        name: 'examples',\n        value: '\"Long walk to freedom\", \"Wishful drinking\", \"I know why the caged bird sings\"',\n      },\n    ],\n  },\n  {\n    prompt: [\n      'Generate a SQL query from a user’s question, using the information from the table.',\n      'Question: {{ user_question }}',\n      'Table Information: {{ table_information }}',\n    ],\n    variables: [\n      {\n        name: 'user_question',\n        value: 'Which product generated the most sales this month?',\n      },\n      {\n        name: 'table_information',\n        value:\n          'CREATE TABLE Sales (SaleID INT PRIMARY KEY, ProductID INT, SaleDate DATE, CustomerID INT, QuantitySold INT, UnitPrice DECIMAL(10, 2));',\n      },\n    ],\n  },\n];\n","import {\n  ArrowLeftIcon,\n  Button,\n  Modal,\n  Spacer,\n  Input,\n  Typography,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { Divider } from 'antd';\nimport { FormattedMessage } from 'react-intl';\nimport { PROMPT_TEMPLATE_EXAMPLES } from 'experiment-tracking/components/evaluation-artifacts-compare/utils/PromptExamples';\n\nconst { TextArea } = Input;\ntype Props = {\n  isOpen: boolean;\n  closeExamples: () => void;\n  closeModal: () => void;\n  updatePromptTemplate: (prompt: string) => void;\n  updateInputVariableValue: (name: string, value: string) => void;\n};\n\nexport const EvaluationCreatePromptRunModalExamples = ({\n  isOpen,\n  closeExamples,\n  closeModal,\n  updatePromptTemplate,\n  updateInputVariableValue,\n}: Props): JSX.Element => {\n  const { theme } = useDesignSystemTheme();\n\n  const tryPromptTemplate = (promptTemplate: {\n    prompt: string[];\n    variables: { name: string; value: string }[];\n  }) => {\n    updatePromptTemplate(promptTemplate.prompt.join('\\n'));\n    promptTemplate.variables.forEach(({ name, value }) => {\n      updateInputVariableValue(name, value);\n    });\n    closeExamples();\n  };\n\n  return (\n    <Modal\n      verticalSizing='maxed_out'\n      visible={isOpen}\n      onCancel={closeModal}\n      title={\n        <div>\n          <Typography.Title\n            level={2}\n            css={{ marginTop: theme.spacing.sm, marginBottom: theme.spacing.xs }}\n          >\n            <Button\n              css={{ marginRight: theme.spacing.sm, marginBottom: theme.spacing.sm }}\n              icon={<ArrowLeftIcon />}\n              onClick={closeExamples}\n            />\n            <FormattedMessage\n              defaultMessage='Prompt template examples'\n              description='Experiment page > new run modal > prompt examples > modal title'\n            />\n          </Typography.Title>\n        </div>\n      }\n      dangerouslySetAntdProps={{ width: 1200 }}\n    >\n      {PROMPT_TEMPLATE_EXAMPLES.map((promptTemplate) => (\n        <div\n          key={promptTemplate.prompt.join('\\n')}\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: theme.spacing.md,\n          }}\n        >\n          <div\n            css={{\n              boxSizing: 'border-box',\n              border: `1px solid ${theme.colors.actionDefaultBorderDefault}`,\n              borderRadius: theme.borders.borderRadiusMd,\n              background: theme.colors.backgroundPrimary,\n              padding: theme.spacing.md,\n              margin: 0,\n              overflow: 'hidden',\n              display: 'flex',\n              flexDirection: 'column',\n              gap: `${theme.spacing.xs}px`,\n            }}\n          >\n            <Typography.Title level={4}>\n              <FormattedMessage\n                defaultMessage='Prompt Template'\n                description='Experiment page > new run modal > prompt examples > prompt template title'\n              />\n              <Button\n                type='tertiary'\n                size='small'\n                style={{ float: 'right' }}\n                onClick={() => tryPromptTemplate(promptTemplate)}\n              >\n                <FormattedMessage\n                  defaultMessage='Try this template'\n                  description='Experiment page > new run modal > prompt examples > try template button'\n                />\n              </Button>\n            </Typography.Title>\n            {promptTemplate.prompt.map((line) => (\n              <Typography.Paragraph key={line}>{line}</Typography.Paragraph>\n            ))}\n            <Divider css={{ marginTop: theme.spacing.xs, marginBottom: theme.spacing.xs }} />\n            {promptTemplate.variables.map(({ name, value }) => (\n              <div key={name}>\n                <Typography.Title level={4}>{name}</Typography.Title>\n                <Typography.Paragraph>{value}</Typography.Paragraph>\n              </div>\n            ))}\n          </div>\n          <Spacer />\n        </div>\n      ))}\n    </Modal>\n  );\n};\n","import {\n  Alert,\n  Button,\n  DialogCombobox,\n  DialogComboboxContent,\n  DialogComboboxHintRow,\n  DialogComboboxOptionList,\n  DialogComboboxOptionListSearch,\n  DialogComboboxOptionListSelectItem,\n  DialogComboboxTrigger,\n  FormUI,\n  InfoIcon,\n  Input,\n  Modal,\n  PlayIcon,\n  PlusIcon,\n  Spinner,\n  StopIcon,\n  TableSkeleton,\n  Tooltip,\n  Typography,\n  WarningIcon,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { sortBy } from 'lodash';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { useDispatch, useSelector } from 'react-redux';\nimport Utils from '../../../common/utils/Utils';\nimport { ThunkDispatch } from '../../../redux-types';\nimport { createPromptLabRunApi } from '../../actions';\nimport {\n  queryModelGatewayRouteApi,\n  searchModelGatewayRoutesApi,\n} from '../../actions/ModelGatewayActions';\nimport { ModelGatewayReduxState } from '../../reducers/ModelGatewayReducer';\nimport {\n  GatewayErrorWrapper,\n  ModelGatewayResponseType,\n  ModelGatewayRouteType,\n  ModelGatewayService,\n} from '../../sdk/ModelGatewayService';\nimport { generateRandomRunName, getDuplicatedRunName } from '../../utils/RunNameUtils';\nimport { useExperimentIds } from '../experiment-page/hooks/useExperimentIds';\nimport { useFetchExperimentRuns } from '../experiment-page/hooks/useFetchExperimentRuns';\nimport {\n  PROMPTLAB_METADATA_COLUMN_LATENCY,\n  PROMPTLAB_METADATA_COLUMN_TOTAL_TOKENS,\n  compilePromptInputText,\n  extractEvaluationPrerequisitesForRun,\n  extractRequiredInputParamsForRun,\n} from '../prompt-engineering/PromptEngineering.utils';\nimport { EvaluationCreatePromptParameters } from './EvaluationCreatePromptParameters';\nimport { usePromptEvaluationInputValues } from './hooks/usePromptEvaluationInputValues';\nimport { usePromptEvaluationParameters } from './hooks/usePromptEvaluationParameters';\nimport { usePromptEvaluationPromptTemplateValue } from './hooks/usePromptEvaluationPromptTemplateValue';\nimport { EvaluationCreateRunPromptTemplateErrors } from './components/EvaluationCreateRunPromptTemplateErrors';\nimport type { RunRowType } from '../experiment-page/utils/experimentPage.row-types';\nimport { EvaluationCreatePromptRunModalExamples } from './EvaluationCreatePromptRunModalExamples';\n\nconst { TextArea } = Input;\ntype Props = {\n  isOpen: boolean;\n  closeModal: () => void;\n  runBeingDuplicated: RunRowType | null;\n  visibleRuns?: RunRowType[];\n};\n\nexport const EvaluationCreatePromptRunModal = ({\n  isOpen,\n  closeModal,\n  runBeingDuplicated,\n  visibleRuns = [],\n}: Props): JSX.Element => {\n  const [experimentId] = useExperimentIds();\n  const { theme } = useDesignSystemTheme();\n  const { parameters, updateParameter } = usePromptEvaluationParameters();\n\n  const [selectedModel, updateSelectedModel] = useState('');\n  const [newRunName, setNewRunName] = useState('');\n  const [isCreatingRun, setIsCreatingRun] = useState(false);\n  const [isEvaluating, setIsEvaluating] = useState(false);\n  const [lastEvaluationError, setLastEvaluationError] = useState<string | null>(null);\n  const [evaluationOutput, setEvaluationOutput] = useState('');\n  const [evaluationMetadata, setEvaluationMetadata] = useState<\n    Partial<ModelGatewayResponseType['metadata']>\n  >({});\n  const [outputDirty, setOutputDirty] = useState(false);\n  const [isViewExamplesModalOpen, setViewExamplesModalOpen] = useState(false);\n  const cancelTokenRef = useRef<string | null>(null);\n\n  const dispatch = useDispatch<ThunkDispatch>();\n\n  useEffect(() => {\n    dispatch(searchModelGatewayRoutesApi()).catch((e) => {\n      Utils.logErrorAndNotifyUser(e?.message || e);\n    });\n  }, [dispatch]);\n\n  const intl = useIntl();\n\n  const {\n    updateInputVariables,\n    inputVariables,\n    inputVariableValues,\n    updateInputVariableValue,\n    inputVariableNameViolations,\n    clearInputVariableValues,\n  } = usePromptEvaluationInputValues();\n\n  const {\n    handleAddVariableToTemplate,\n    savePromptTemplateInputRef,\n    promptTemplate,\n    updatePromptTemplate,\n  } = usePromptEvaluationPromptTemplateValue();\n\n  useEffect(() => {\n    if (isOpen && !runBeingDuplicated) {\n      setNewRunName(generateRandomRunName());\n    }\n  }, [isOpen, runBeingDuplicated]);\n\n  useEffect(() => {\n    updateInputVariables(promptTemplate);\n  }, [promptTemplate, updateInputVariables]);\n\n  /**\n   * If a run duplication is detected, pre-fill the values\n   */\n  useEffect(() => {\n    if (runBeingDuplicated) {\n      const {\n        promptTemplate: duplicatedPromptTemplate,\n        routeName: duplicatedRouteName,\n        parameters: duplicatedParameters,\n      } = extractEvaluationPrerequisitesForRun(runBeingDuplicated);\n\n      extractRequiredInputParamsForRun(runBeingDuplicated);\n      if (duplicatedPromptTemplate) {\n        updatePromptTemplate(duplicatedPromptTemplate);\n      }\n      if (duplicatedParameters.temperature) {\n        updateParameter('temperature', duplicatedParameters.temperature);\n      }\n      if (duplicatedParameters.max_tokens) {\n        updateParameter('max_tokens', duplicatedParameters.max_tokens);\n      }\n      if (duplicatedRouteName) {\n        updateSelectedModel(duplicatedRouteName);\n      }\n      setEvaluationOutput('');\n      setOutputDirty(false);\n      const duplicatedRunName = getDuplicatedRunName(\n        runBeingDuplicated.runName,\n        visibleRuns.map(({ runName }) => runName),\n      );\n      setNewRunName(duplicatedRunName);\n      clearInputVariableValues();\n    }\n  }, [\n    runBeingDuplicated,\n    clearInputVariableValues,\n    updateParameter,\n    updatePromptTemplate,\n    visibleRuns,\n  ]);\n\n  // Select model gateway routes from the state\n  const modelRoutes = useSelector(\n    ({ modelGateway }: { modelGateway: ModelGatewayReduxState }) => modelGateway.modelGatewayRoutes,\n  );\n\n  // Limit model routes to \"COMPLETIONS\" and \"CHAT\" types only and sort them alphabetically\n  const supportedModelRouteList = useMemo(\n    () =>\n      sortBy(\n        Object.values(modelRoutes).filter((modelRoute) =>\n          [ModelGatewayRouteType.LLM_V1_COMPLETIONS, ModelGatewayRouteType.LLM_V1_CHAT].includes(\n            modelRoute.route_type,\n          ),\n        ),\n        'name',\n      ),\n    [modelRoutes],\n  );\n\n  // Determines if model gateway routes are being loaded\n  const modelRoutesLoading = useSelector(\n    ({ modelGateway }: { modelGateway: ModelGatewayReduxState }) =>\n      modelGateway.modelGatewayRoutesLoading,\n  );\n  useEffect(() => {\n    if (evaluationOutput) {\n      setOutputDirty(true);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [inputVariableValues, promptTemplate, parameters, selectedModel]);\n\n  const { refreshRuns, updateSearchFacets } = useFetchExperimentRuns();\n\n  const onHandleSubmit = () => {\n    setIsCreatingRun(true);\n    const modelInput = compilePromptInputText(promptTemplate, inputVariableValues);\n    dispatch(\n      createPromptLabRunApi({\n        experimentId,\n        promptTemplate,\n        modelInput,\n        modelParameters: parameters,\n        modelRouteName: selectedModel,\n        promptParameters: inputVariableValues,\n        modelOutput: evaluationOutput,\n        runName: newRunName,\n        modelOutputParameters: evaluationMetadata,\n      }),\n    )\n      .then(() => {\n        refreshRuns();\n        closeModal();\n        setIsCreatingRun(false);\n\n        // If the view if not in the \"evaluation\" mode already, open it\n        updateSearchFacets((currentState) => {\n          if (currentState.compareRunsMode !== 'ARTIFACT') {\n            return { ...currentState, compareRunsMode: 'ARTIFACT' };\n          }\n          return currentState;\n        });\n      })\n      .catch((e) => {\n        Utils.logErrorAndNotifyUser(e?.message || e);\n        // NB: Not using .finally() due to issues with promise implementation in the Jest\n        setIsCreatingRun(false);\n      });\n  };\n\n  const handleEvaluate = useCallback(() => {\n    const modelRoute = modelRoutes[selectedModel];\n    const cancelToken = Math.random().toString(36);\n    cancelTokenRef.current = cancelToken;\n    if (!modelRoute) {\n      // Should never happen if the model is selected\n      throw new Error('No model route found!');\n    }\n    setLastEvaluationError(null);\n    setIsEvaluating(true);\n    const inputText = compilePromptInputText(promptTemplate, inputVariableValues);\n    dispatch(\n      queryModelGatewayRouteApi(modelRoute, {\n        inputText,\n        parameters,\n      }),\n    )\n      .then(({ value, action }) => {\n        if (cancelTokenRef.current === cancelToken) {\n          const { text, metadata } = ModelGatewayService.parseEvaluationResponse(value);\n\n          // TODO: Consider calculating actual model call latency on the backend side\n          const latency = performance.now() - action.meta.startTime;\n\n          setEvaluationOutput(text);\n          const metadataWithEvaluationTime = { ...metadata, latency };\n\n          // Prefix the metadata keys with \"MLFLOW_\"\n          const prefixedMetadata = Object.entries(metadataWithEvaluationTime).reduce(\n            (acc, [metadata_key, metadata_value]) => ({\n              ...acc,\n              [`MLFLOW_${metadata_key}`]: metadata_value,\n            }),\n            {},\n          );\n\n          setEvaluationMetadata(prefixedMetadata);\n          setOutputDirty(false);\n          setIsEvaluating(false);\n          // NB: Not using .finally() due to issues with promise implementation in the Jest\n          if (cancelTokenRef.current === cancelToken) {\n            cancelTokenRef.current = null;\n          }\n        }\n      })\n      .catch((e: GatewayErrorWrapper) => {\n        const errorMessage = e.getGatewayErrorMessage() || e.getUserVisibleError();\n        const wrappedMessage = intl.formatMessage(\n          {\n            defaultMessage: 'AI gateway returned the following error: \"{errorMessage}\"',\n            description: 'Experiment page > new run modal > AI gateway error message',\n          },\n          {\n            errorMessage,\n          },\n        );\n        Utils.logErrorAndNotifyUser(wrappedMessage);\n        setIsEvaluating(false);\n        setLastEvaluationError(wrappedMessage);\n        // NB: Not using .finally() due to issues with promise implementation in the Jest\n        if (cancelTokenRef.current === cancelToken) {\n          cancelTokenRef.current = null;\n        }\n      });\n  }, [dispatch, inputVariableValues, modelRoutes, parameters, promptTemplate, selectedModel, intl]);\n\n  // create a handleCancel function to terminate the evaluation if it is in progress\n  const handleCancel = useCallback(() => {\n    if (cancelTokenRef.current) {\n      setIsEvaluating(false);\n      cancelTokenRef.current = null;\n    }\n  }, [setIsEvaluating]);\n\n  const selectModelLabel = intl.formatMessage({\n    defaultMessage: 'Model',\n    description: 'Experiment page > new run modal > AI gateway selector label',\n  });\n  const selectModelPlaceholder = intl.formatMessage({\n    defaultMessage: 'Select route',\n    description: 'Experiment page > new run modal > AI gateway selector placeholder',\n  });\n\n  const promptTemplateProvided = promptTemplate.trim().length > 0;\n  const allInputValuesProvided = useMemo(\n    () => inputVariables.every((variable) => inputVariableValues[variable]?.trim()),\n    [inputVariables, inputVariableValues],\n  );\n\n  const runNameProvided = newRunName.trim().length > 0;\n\n  // We can evaluate if we have selected model, prompt template and all input values.\n  // It should be possible to evaluate without input variables for the purpose of playing around.\n  const evaluateButtonEnabled = selectedModel && promptTemplateProvided && allInputValuesProvided;\n\n  // We can log the run if we have: selected model, prompt template, all input values,\n  // output that is present and up-to-date. Also, in order to log the run, we should have at least\n  // one input variable defined (otherwise prompt engineering won't make sense).\n  const createRunButtonEnabled = Boolean(\n    selectedModel &&\n      promptTemplateProvided &&\n      allInputValuesProvided &&\n      evaluationOutput &&\n      !outputDirty &&\n      inputVariables.length > 0 &&\n      runNameProvided &&\n      !lastEvaluationError,\n  );\n\n  // Let's prepare a proper tooltip content for every scenario\n  const createRunButtonTooltip = useMemo(() => {\n    if (!selectedModel) {\n      return intl.formatMessage({\n        defaultMessage: 'You need to select a route from the AI gateway dropdown first',\n        description: 'Experiment page > new run modal > invalid state - no AI gateway selected',\n      });\n    }\n    if (!promptTemplateProvided) {\n      return intl.formatMessage({\n        defaultMessage: 'You need to provide a prompt template',\n        description:\n          'Experiment page > new run modal > invalid state - no prompt template provided',\n      });\n    }\n    if (!allInputValuesProvided) {\n      return intl.formatMessage({\n        defaultMessage: 'You need to provide values for all defined inputs',\n        description: 'Experiment page > new run modal > invalid state - no prompt inputs provided',\n      });\n    }\n    if (!evaluationOutput) {\n      return intl.formatMessage({\n        defaultMessage: 'You need to evaluate the resulting output first',\n        description: 'Experiment page > new run modal > invalid state - result not evaluated',\n      });\n    }\n    if (outputDirty) {\n      return intl.formatMessage({\n        defaultMessage:\n          'Input data or prompt template have changed since last evaluation of the output',\n        description: 'Experiment page > new run modal > dirty output (out of sync with new data)',\n      });\n    }\n    if (inputVariables.length === 0) {\n      return intl.formatMessage({\n        defaultMessage: 'You need to define at least one input variable',\n        description: 'Experiment page > new run modal > invalid state - no input variables defined',\n      });\n    }\n    if (!runNameProvided) {\n      return intl.formatMessage({\n        defaultMessage: 'Please provide run name',\n        description: 'Experiment page > new run modal > invalid state - no run name provided',\n      });\n    }\n    return null;\n  }, [\n    allInputValuesProvided,\n    inputVariables.length,\n    intl,\n    outputDirty,\n    evaluationOutput,\n    promptTemplateProvided,\n    selectedModel,\n    runNameProvided,\n  ]);\n\n  // Let's prepare a proper tooltip content for every scenario\n  const evaluateButtonTooltip = useMemo(() => {\n    if (!selectedModel) {\n      return intl.formatMessage({\n        defaultMessage: 'You need to select a route from the AI gateway dropdown first',\n        description: 'Experiment page > new run modal > invalid state - no AI gateway selected',\n      });\n    }\n    if (!promptTemplateProvided) {\n      return intl.formatMessage({\n        defaultMessage: 'You need to provide a prompt template',\n        description:\n          'Experiment page > new run modal > invalid state - no prompt template provided',\n      });\n    }\n    if (!allInputValuesProvided) {\n      return intl.formatMessage({\n        defaultMessage: 'You need to provide values for all defined inputs',\n        description: 'Experiment page > new run modal > invalid state - no prompt inputs provided',\n      });\n    }\n    return null;\n  }, [allInputValuesProvided, intl, promptTemplateProvided, selectedModel]);\n\n  const evaluateOutput = useMemo(() => {\n    if (lastEvaluationError) {\n      return (\n        <Alert\n          message={lastEvaluationError}\n          closable={false}\n          type='error'\n          css={{ marginBottom: theme.spacing.sm, marginTop: theme.spacing.sm }}\n        />\n      );\n    }\n    if (isEvaluating) {\n      return (\n        <div css={{ marginTop: theme.spacing.sm }}>\n          <TableSkeleton lines={5} />\n        </div>\n      );\n    }\n    return (\n      <TextArea\n        rows={5}\n        css={{ cursor: 'default' }}\n        data-testid='prompt-output'\n        value={evaluationOutput}\n        readOnly\n      />\n    );\n  }, [lastEvaluationError, isEvaluating, evaluationOutput, theme]);\n\n  const metadataOutput = useMemo(() => {\n    if (!evaluationMetadata) {\n      return null;\n    }\n    if (isEvaluating) {\n      return null;\n    }\n    return (\n      <div css={{ display: 'flex', gap: theme.spacing.xs, alignItems: 'center' }}>\n        {PROMPTLAB_METADATA_COLUMN_LATENCY in evaluationMetadata && (\n          <Typography.Hint size='sm'>\n            {Math.round(Number(evaluationMetadata[PROMPTLAB_METADATA_COLUMN_LATENCY]))} ms\n            {'MLFLOW_total_tokens' in evaluationMetadata ? ',' : ''}\n          </Typography.Hint>\n        )}\n        {PROMPTLAB_METADATA_COLUMN_TOTAL_TOKENS in evaluationMetadata && (\n          <Typography.Hint size='sm'>\n            <FormattedMessage\n              defaultMessage='{totalTokens} total tokens'\n              description='Experiment page > artifact compare view > results table > total number of evaluated tokens'\n              values={{ totalTokens: evaluationMetadata[PROMPTLAB_METADATA_COLUMN_TOTAL_TOKENS] }}\n            />\n          </Typography.Hint>\n        )}\n      </div>\n    );\n  }, [evaluationMetadata, evaluationOutput, isEvaluating, theme]);\n\n  if (isOpen && isViewExamplesModalOpen) {\n    return (\n      <EvaluationCreatePromptRunModalExamples\n        isOpen={isOpen && isViewExamplesModalOpen}\n        closeExamples={() => setViewExamplesModalOpen(false)}\n        closeModal={closeModal}\n        updatePromptTemplate={updatePromptTemplate}\n        updateInputVariableValue={updateInputVariableValue}\n      />\n    );\n  }\n\n  return (\n    <Modal\n      verticalSizing='maxed_out'\n      visible={isOpen}\n      onCancel={closeModal}\n      onOk={closeModal}\n      footer={\n        <div css={{ display: 'flex', gap: theme.spacing.sm, justifyContent: 'flex-end' }}>\n          <Button onClick={closeModal}>\n            <FormattedMessage\n              defaultMessage='Cancel'\n              description='Experiment page > new run modal > cancel button label'\n            />\n          </Button>\n          <Tooltip title={createRunButtonTooltip}>\n            <Button\n              onClick={onHandleSubmit}\n              data-testid='button-create-run'\n              type='primary'\n              disabled={!createRunButtonEnabled}\n            >\n              <FormattedMessage\n                defaultMessage='Create run'\n                description='Experiment page > new run modal > \"Create run\" confirm button label'\n              />\n            </Button>\n          </Tooltip>\n        </div>\n      }\n      title={\n        <div>\n          <Typography.Title\n            level={2}\n            css={{ marginTop: theme.spacing.sm, marginBottom: theme.spacing.xs }}\n          >\n            <FormattedMessage\n              defaultMessage='New run'\n              description='Experiment page > new run modal > modal title'\n            />\n          </Typography.Title>\n          <Typography.Hint css={{ marginTop: 0, fontWeight: 'normal' }}>\n            Create a new run using a large-language model by giving it a prompt template and model\n            parameters\n          </Typography.Hint>\n        </div>\n      }\n      dangerouslySetAntdProps={{ width: 1200 }}\n    >\n      <div\n        css={{\n          display: 'grid',\n          gridTemplateColumns: '300px 1fr',\n          gap: 48,\n        }}\n      >\n        <div>\n          <div css={{ ...styles.formItem, display: 'flex', alignItems: 'center' }}>\n            <DialogCombobox\n              label={selectedModel ? selectModelLabel : selectModelPlaceholder}\n              modal={false}\n              value={selectedModel ? [selectedModel] : undefined}\n            >\n              <DialogComboboxTrigger css={{ width: '100%' }} allowClear={false} />\n              <DialogComboboxContent loading={modelRoutesLoading} maxHeight={400} matchTriggerWidth>\n                {!modelRoutesLoading && (\n                  <DialogComboboxOptionList>\n                    <DialogComboboxOptionListSearch autoFocus>\n                      {supportedModelRouteList.map((modelRoute) => (\n                        <DialogComboboxOptionListSelectItem\n                          value={modelRoute.name}\n                          key={modelRoute.name}\n                          onChange={(value) => {\n                            updateSelectedModel(value);\n                          }}\n                          checked={selectedModel === modelRoute.name}\n                        >\n                          {modelRoute.name}\n                          <DialogComboboxHintRow>{modelRoute.model.name}</DialogComboboxHintRow>\n                        </DialogComboboxOptionListSelectItem>\n                      ))}\n                    </DialogComboboxOptionListSearch>\n                  </DialogComboboxOptionList>\n                )}\n              </DialogComboboxContent>\n            </DialogCombobox>\n            <Tooltip\n              title={\n                <FormattedMessage\n                  defaultMessage={\n                    'These routes come from the AI Gateway. Check out the AI Gateway preview documentation to get started'\n                  }\n                  description={'Information about gateway routes'}\n                />\n              }\n              placement='right'\n            >\n              <InfoIcon\n                css={{\n                  marginLeft: theme.spacing.sm,\n                  color: theme.colors.textSecondary,\n                }}\n              />\n            </Tooltip>\n          </div>\n          {selectedModel && (\n            <EvaluationCreatePromptParameters\n              parameters={parameters}\n              updateParameter={updateParameter}\n            />\n          )}\n          <div css={styles.formItem}>\n            <>\n              <FormUI.Label htmlFor={'new_run_name'}>\n                <FormattedMessage\n                  defaultMessage='New run name'\n                  description='Experiment page > new run modal > run name input label'\n                />\n                {!newRunName.trim() && (\n                  <FormUI.Message\n                    type='error'\n                    message={intl.formatMessage({\n                      defaultMessage: 'Please provide run name',\n                      description:\n                        'Experiment page > new run modal > invalid state - no run name provided',\n                    })}\n                  />\n                )}\n              </FormUI.Label>\n              <Input\n                id='new_run_name'\n                data-testid='run-name-input'\n                required\n                value={newRunName}\n                onChange={(e) => setNewRunName(e.target.value)}\n              />\n            </>\n          </div>\n        </div>\n        <div>\n          <div css={styles.formItem}>\n            <>\n              <FormUI.Label htmlFor={'prompt_template'}>\n                <FormattedMessage\n                  defaultMessage='Prompt Template'\n                  description='Experiment page > new run modal > prompt template input label'\n                />\n                <Button\n                  onClick={() => setViewExamplesModalOpen(true)}\n                  style={{ marginLeft: 'auto' }}\n                >\n                  <FormattedMessage\n                    defaultMessage='View Examples'\n                    description='Experiment page > new run modal > prompt examples button'\n                  />\n                </Button>\n              </FormUI.Label>\n              <FormUI.Hint>\n                <FormattedMessage\n                  defaultMessage={`Give instructions to the model. Use '{{ }}' or the \"Add new variable\" button to add variables to your prompt.`}\n                  description='Experiment page > new run modal > prompt template input hint'\n                />\n              </FormUI.Hint>\n            </>\n\n            <TextArea\n              id='prompt_template'\n              autoSize\n              data-testid='prompt-template-input'\n              value={promptTemplate}\n              onChange={(e) => updatePromptTemplate(e.target.value)}\n              ref={savePromptTemplateInputRef}\n            />\n            <EvaluationCreateRunPromptTemplateErrors violations={inputVariableNameViolations} />\n          </div>\n          {inputVariables.map((inputVariable) => (\n            <div css={styles.formItem} key={inputVariable}>\n              <>\n                <FormUI.Label htmlFor={inputVariable}>\n                  <span>{inputVariable}</span>\n                </FormUI.Label>\n                <TextArea\n                  id={inputVariable}\n                  autoSize\n                  value={\n                    inputVariableValues[inputVariable] ? inputVariableValues[inputVariable] : ''\n                  }\n                  onChange={(e) => updateInputVariableValue(inputVariable, e.target.value)}\n                />\n              </>\n            </div>\n          ))}\n          <div css={styles.formItem}>\n            <Button icon={<PlusIcon />} onClick={handleAddVariableToTemplate}>\n              <FormattedMessage\n                defaultMessage='Add new variable'\n                description='Experiment page > new run modal > \"add new variable\" button label'\n              />\n            </Button>\n          </div>\n          <div css={styles.formItem}>\n            <Tooltip title={evaluateButtonTooltip}>\n              <Button\n                data-testid='button-evaluate'\n                icon={<PlayIcon />}\n                onClick={handleEvaluate}\n                disabled={!evaluateButtonEnabled}\n                loading={isEvaluating}\n              >\n                <FormattedMessage\n                  defaultMessage='Evaluate'\n                  description='Experiment page > new run modal > \"evaluate\" button label'\n                />\n              </Button>\n            </Tooltip>\n            <Button\n              data-testid='button-cancel'\n              icon={<StopIcon />}\n              onClick={handleCancel}\n              disabled={!isEvaluating}\n              css={{ marginLeft: theme.spacing.sm }}\n            >\n              <FormattedMessage\n                defaultMessage='Cancel'\n                description='Experiment page > new run modal > \"cancel\" button label'\n              />\n            </Button>\n          </div>\n          <FormUI.Label>\n            <FormattedMessage\n              defaultMessage='Output'\n              description='Experiment page > new run modal > evaluation output field label'\n            />{' '}\n            {outputDirty && (\n              <Tooltip\n                title={\n                  <FormattedMessage\n                    defaultMessage='Model, input data or prompt have changed since last evaluation of the output'\n                    description='Experiment page > new run modal > dirty output (out of sync with new data)'\n                  />\n                }\n              >\n                <WarningIcon />\n              </Tooltip>\n            )}\n          </FormUI.Label>\n          <FormUI.Hint>\n            <FormattedMessage\n              defaultMessage='This is the output generated by the LLM using the prompt template and input values defined above.'\n              description='Experiment page > new run modal > evaluation output field hint'\n            />\n          </FormUI.Hint>\n          {evaluateOutput}\n          {metadataOutput}\n        </div>\n      </div>\n      {isCreatingRun && (\n        // Scrim overlay\n        <div\n          css={{\n            inset: 0,\n            backgroundColor: theme.colors.overlayOverlay,\n            position: 'absolute',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            zIndex: 1,\n          }}\n        >\n          <Spinner />\n        </div>\n      )}\n    </Modal>\n  );\n};\n\nconst styles = {\n  formItem: { marginBottom: 16 },\n};\n","import { useCallback, useEffect, useMemo, useState } from 'react';\nimport { debounce, fromPairs, isEqual } from 'lodash';\nimport {\n  DEFAULT_PROMPTLAB_INPUT_VALUES,\n  extractPromptInputVariables,\n  getPromptInputVariableNameViolations,\n} from '../../prompt-engineering/PromptEngineering.utils';\n\nexport const usePromptEvaluationInputValues = () => {\n  const [inputVariables, updateInputVariablesDirect] = useState<string[]>(\n    extractPromptInputVariables(''),\n  );\n\n  const [inputVariableNameViolations, setInputVariableNameViolations] = useState<\n    ReturnType<typeof getPromptInputVariableNameViolations>\n  >({ namesWithSpaces: [] });\n\n  const [inputVariableValues, updateInputVariableValues] = useState<Record<string, string>>(\n    DEFAULT_PROMPTLAB_INPUT_VALUES,\n  );\n\n  const clearInputVariableValues = useCallback(() => updateInputVariableValues({}), []);\n\n  const updateInputVariables = useMemo(\n    () =>\n      // Prevent calculating new input variable set on every keystroke of a template,\n      // let's debounce it by 250ms\n      debounce((promptTemplate: string) => {\n        updateInputVariablesDirect((currentInputVariables) => {\n          const newInputVariables = extractPromptInputVariables(promptTemplate);\n          if (!isEqual(newInputVariables, currentInputVariables)) {\n            return newInputVariables;\n          }\n          return currentInputVariables;\n        });\n        setInputVariableNameViolations(getPromptInputVariableNameViolations(promptTemplate));\n      }, 250),\n    [],\n  );\n\n  const updateInputVariableValue = useCallback((name: string, value: string) => {\n    updateInputVariableValues((values) => ({ ...values, [name]: value }));\n  }, []);\n\n  // Sanitize the variable dictionary so only actually used variables\n  // will be returned (discard leftovers from previous prompt templates)\n  const sanitizedInputVariableValues = useMemo(\n    () =>\n      fromPairs(\n        Object.entries(inputVariableValues).filter(([key]) => inputVariables.includes(key)),\n      ),\n    [inputVariableValues, inputVariables],\n  );\n\n  return {\n    updateInputVariables,\n    inputVariables,\n    inputVariableValues: sanitizedInputVariableValues,\n    updateInputVariableValue,\n    inputVariableNameViolations,\n    clearInputVariableValues,\n  };\n};\n","import React, { useCallback, useContext, useMemo, useState } from 'react';\nimport { RunRowType } from '../utils/experimentPage.row-types';\nimport { EvaluationCreatePromptRunModal } from '../../evaluation-artifacts-compare/EvaluationCreatePromptRunModal';\n\nconst CreateNewRunContext = React.createContext<{\n  createNewRun: (runToDuplicate?: RunRowType) => void;\n}>({\n  createNewRun: () => {},\n});\n\n/**\n * A thin context wrapper dedicated to invoke \"create run\" modal in various areas of the experiment runs page UI\n */\nexport const CreateNewRunContextProvider = ({\n  children,\n  visibleRuns,\n}: {\n  children: React.ReactNode;\n  visibleRuns: RunRowType[];\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [runBeingDuplicated, setRunBeingDuplicated] = useState<RunRowType | null>(null);\n\n  const contextValue = useMemo(\n    () => ({\n      createNewRun: (runToDuplicate?: RunRowType) => {\n        setIsOpen(true);\n        setRunBeingDuplicated(runToDuplicate || null);\n      },\n    }),\n    [],\n  );\n\n  return (\n    <CreateNewRunContext.Provider value={contextValue}>\n      {children}\n      <EvaluationCreatePromptRunModal\n        visibleRuns={visibleRuns}\n        isOpen={isOpen}\n        closeModal={() => setIsOpen(false)}\n        runBeingDuplicated={runBeingDuplicated}\n      />\n    </CreateNewRunContext.Provider>\n  );\n};\n\nexport const useCreateNewRun = () => useContext(CreateNewRunContext);\n","import {\n  Button,\n  Tag,\n  DialogCombobox,\n  DialogComboboxContent,\n  DialogComboboxOptionList,\n  DialogComboboxOptionListCheckboxItem,\n  DialogComboboxOptionListSelectItem,\n  DialogComboboxOptionListSearch,\n  DialogComboboxTrigger,\n  DownloadIcon,\n  Dropdown,\n  FullscreenExitIcon,\n  FullscreenIcon,\n  Menu,\n  OverflowIcon,\n  PlusIcon,\n  SidebarIcon,\n  Tooltip,\n  useDesignSystemTheme,\n  DropdownMenu,\n} from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport {\n  shouldEnableArtifactBasedEvaluation,\n  shouldEnablePromptLab,\n  shouldEnableDatasetsDropdown,\n} from 'common/utils/FeatureUtils';\nimport React, { useCallback, useMemo, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { ToggleIconButton } from '../../../../../common/components/ToggleIconButton';\nimport { ErrorWrapper } from '../../../../../common/utils/ErrorWrapper';\nimport { LIFECYCLE_FILTER } from '../../../../constants';\nimport { UpdateExperimentSearchFacetsFn, UpdateExperimentViewStateFn } from '../../../../types';\nimport { useExperimentIds } from '../../hooks/useExperimentIds';\nimport { SearchExperimentRunsFacetsState } from '../../models/SearchExperimentRunsFacetsState';\nimport { SearchExperimentRunsViewState } from '../../models/SearchExperimentRunsViewState';\nimport { getStartTimeColumnDisplayName } from '../../utils/experimentPage.common-utils';\nimport { ExperimentRunsSelectorResult } from '../../utils/experimentRuns.selector';\nimport { ExperimentViewRefreshButton } from './ExperimentViewRefreshButton';\nimport { RunsSearchAutoComplete } from './RunsSearchAutoComplete';\nimport type { ExperimentStoreEntities, DatasetSummary } from '../../../../types';\nimport { datasetSummariesEqual } from '../../../../utils/DatasetUtils';\nimport { Data } from 'vega';\nimport { CreateNotebookRunModal } from 'experiment-tracking/components/evaluation-artifacts-compare/CreateNotebookRunModal';\nimport { useCreateNewRun } from '../../hooks/useCreateNewRun';\n\nexport type ExperimentViewRunsControlsFiltersProps = {\n  searchFacetsState: SearchExperimentRunsFacetsState;\n  updateSearchFacets: UpdateExperimentSearchFacetsFn;\n  experimentId: string;\n  viewState: SearchExperimentRunsViewState;\n  updateViewState: UpdateExperimentViewStateFn;\n  runsData: ExperimentRunsSelectorResult;\n  onDownloadCsv: () => void;\n  requestError: ErrorWrapper | null;\n  additionalControls?: React.ReactNode;\n};\n\nexport const ExperimentViewRunsControlsFilters = React.memo(\n  ({\n    searchFacetsState,\n    updateSearchFacets,\n    experimentId,\n    runsData,\n    viewState,\n    updateViewState,\n    onDownloadCsv,\n    requestError,\n    additionalControls,\n  }: ExperimentViewRunsControlsFiltersProps) => {\n    const isComparingExperiments = useExperimentIds().length > 1;\n    const { compareRunsMode, startTime, lifecycleFilter, datasetsFilter } = searchFacetsState;\n    const intl = useIntl();\n    const { createNewRun } = useCreateNewRun();\n    const [isCreateRunWithNotebookModalOpen, setCreateRunWithNotebookModalOpenValue] =\n      useState(false);\n    const { theme } = useDesignSystemTheme();\n\n    // List of labels for \"start time\" filter\n    const startTimeColumnLabels: Record<string, string> = useMemo(\n      () => getStartTimeColumnDisplayName(intl),\n      [intl],\n    );\n\n    const currentLifecycleFilterValue =\n      lifecycleFilter === LIFECYCLE_FILTER.ACTIVE\n        ? intl.formatMessage({\n            defaultMessage: 'Active',\n            description: 'Linked model dropdown option to show active experiment runs',\n          })\n        : intl.formatMessage({\n            defaultMessage: 'Deleted',\n            description: 'Linked model dropdown option to show deleted experiment runs',\n          });\n\n    const currentStartTimeFilterLabel = (\n      <>\n        <FormattedMessage\n          defaultMessage='Time created'\n          description='Label for the start time select dropdown for experiment runs view'\n        />\n      </>\n    );\n\n    // Show preview sidebar only on table view and artifact view\n    const displaySidebarToggleButton =\n      compareRunsMode === undefined || compareRunsMode === 'ARTIFACT';\n\n    const datasetSummaries: DatasetSummary[] = useSelector(\n      (state: { entities: ExperimentStoreEntities }) =>\n        state.entities.datasetsByExperimentId[experimentId],\n    );\n\n    const updateDatasetsFilter = useCallback(\n      (summary: DatasetSummary) => {\n        updateSearchFacets((existingFacets) => ({\n          ...existingFacets,\n          datasetsFilter: datasetsFilter.some((item) => datasetSummariesEqual(item, summary))\n            ? datasetsFilter.filter((item) => !datasetSummariesEqual(item, summary))\n            : [...datasetsFilter, summary],\n        }));\n      },\n      [updateSearchFacets, datasetsFilter],\n    );\n\n    const hasDatasets = datasetSummaries !== undefined;\n\n    return (\n      <div css={styles.groupBar}>\n        <div css={styles.controlBar}>\n          <RunsSearchAutoComplete\n            runsData={runsData}\n            searchFacetsState={searchFacetsState}\n            updateSearchFacets={updateSearchFacets}\n            requestError={requestError}\n          />\n\n          <DialogCombobox\n            label={currentStartTimeFilterLabel}\n            value={startTime !== 'ALL' ? [startTimeColumnLabels[startTime]] : []}\n          >\n            <DialogComboboxTrigger\n              allowClear={startTime !== 'ALL'}\n              onClear={() => updateSearchFacets({ startTime: 'ALL' })}\n              data-test-id='start-time-select-dropdown'\n            />\n            <DialogComboboxContent>\n              <DialogComboboxOptionList>\n                {Object.keys(startTimeColumnLabels).map((startTimeKey) => (\n                  <DialogComboboxOptionListSelectItem\n                    key={startTimeKey}\n                    checked={startTimeKey === startTime}\n                    title={startTimeColumnLabels[startTimeKey]}\n                    data-test-id={`start-time-select-${startTimeKey}`}\n                    value={startTimeKey}\n                    onChange={() => updateSearchFacets({ startTime: startTimeKey })}\n                  >\n                    {startTimeColumnLabels[startTimeKey]}\n                  </DialogComboboxOptionListSelectItem>\n                ))}\n              </DialogComboboxOptionList>\n            </DialogComboboxContent>\n          </DialogCombobox>\n\n          <DialogCombobox\n            label={\n              <FormattedMessage\n                defaultMessage='State'\n                description='Filtering label to filter experiments based on state of active or deleted'\n              />\n            }\n            value={[currentLifecycleFilterValue]}\n          >\n            <DialogComboboxTrigger allowClear={false} data-testid='lifecycle-filter' />\n            <DialogComboboxContent>\n              <DialogComboboxOptionList>\n                <DialogComboboxOptionListSelectItem\n                  checked={lifecycleFilter === LIFECYCLE_FILTER.ACTIVE}\n                  key={LIFECYCLE_FILTER.ACTIVE}\n                  data-testid='active-runs-menu-item'\n                  value={LIFECYCLE_FILTER.ACTIVE}\n                  onChange={() => updateSearchFacets({ lifecycleFilter: LIFECYCLE_FILTER.ACTIVE })}\n                >\n                  <FormattedMessage\n                    defaultMessage='Active'\n                    description='Linked model dropdown option to show active experiment runs'\n                  />\n                </DialogComboboxOptionListSelectItem>\n                <DialogComboboxOptionListSelectItem\n                  checked={lifecycleFilter === LIFECYCLE_FILTER.DELETED}\n                  key={LIFECYCLE_FILTER.DELETED}\n                  data-testid='deleted-runs-menu-item'\n                  value={LIFECYCLE_FILTER.DELETED}\n                  onChange={() => updateSearchFacets({ lifecycleFilter: LIFECYCLE_FILTER.DELETED })}\n                >\n                  <FormattedMessage\n                    defaultMessage='Deleted'\n                    description='Linked model dropdown option to show deleted experiment runs'\n                  />\n                </DialogComboboxOptionListSelectItem>\n              </DialogComboboxOptionList>\n            </DialogComboboxContent>\n          </DialogCombobox>\n          {shouldEnableDatasetsDropdown() && (\n            <DialogCombobox\n              label={\n                <FormattedMessage\n                  defaultMessage='Datasets'\n                  description='Filtering label to filter runs based on datasets used'\n                />\n              }\n              value={datasetsFilter.map((datasetSummary) => datasetSummary.name)}\n              multiSelect\n            >\n              <Tooltip\n                title={\n                  !hasDatasets && (\n                    <FormattedMessage\n                      defaultMessage=\"No datasets registered for this experiment's runs.\"\n                      description={'No datasets registered message for datasets dropdown.'}\n                    />\n                  )\n                }\n              >\n                <DialogComboboxTrigger\n                  allowClear\n                  onClear={() => updateSearchFacets({ datasetsFilter: [] })}\n                  data-test-id='datasets-select-dropdown'\n                  showTagAfterValueCount={1}\n                  disabled={!hasDatasets}\n                />\n                {hasDatasets && (\n                  <DialogComboboxContent maxHeight={600}>\n                    <DialogComboboxOptionList>\n                      <DialogComboboxOptionListSearch>\n                        {datasetSummaries.map((summary: DatasetSummary) => (\n                          <DialogComboboxOptionListCheckboxItem\n                            key={summary.name + summary.digest + summary.context}\n                            checked={datasetsFilter.some((item) =>\n                              datasetSummariesEqual(item, summary),\n                            )}\n                            title={summary.name}\n                            data-test-id={`dataset-dropdown-${summary.name}`}\n                            value={summary.name}\n                            onChange={() => updateDatasetsFilter(summary)}\n                          >\n                            {summary.name} ({summary.digest}){' '}\n                            {summary.context && (\n                              <Tag\n                                css={{ textTransform: 'capitalize', marginRight: theme.spacing.xs }}\n                              >\n                                {summary.context}\n                              </Tag>\n                            )}\n                          </DialogComboboxOptionListCheckboxItem>\n                        ))}\n                      </DialogComboboxOptionListSearch>\n                    </DialogComboboxOptionList>\n                  </DialogComboboxContent>\n                )}\n              </Tooltip>\n            </DialogCombobox>\n          )}\n          {additionalControls}\n        </div>\n        <div css={styles.groupSeparator} />\n        <div css={styles.controlBar}>\n          <Dropdown\n            trigger={['click']}\n            placement='bottomRight'\n            overlay={\n              <Menu>\n                <Menu.Item className='csv-button' onClick={onDownloadCsv}>\n                  <DownloadIcon />{' '}\n                  <FormattedMessage\n                    defaultMessage='Download CSV'\n                    description='String for the download csv button to download experiments offline in a CSV format'\n                  />\n                </Menu.Item>\n              </Menu>\n            }\n          >\n            <Button type='tertiary' icon={<OverflowIcon />} />\n          </Dropdown>\n\n          <CreateNotebookRunModal\n            isOpen={isCreateRunWithNotebookModalOpen}\n            closeModal={() => setCreateRunWithNotebookModalOpenValue(false)}\n            experimentId={experimentId}\n          />\n\n          {!isComparingExperiments && (\n            /* \n          When comparing experiments, elements that are hidden upon \n          maximization are not displayed anyway so let's hide the button then\n         */\n            <Tooltip\n              key={viewState.viewMaximized.toString()}\n              title={\n                <FormattedMessage\n                  defaultMessage='Click to {isMaximized, select, true {restore} other {maximize}} the view'\n                  description='Experiment page > control bar > expanded view toggle button tooltip'\n                  values={{\n                    isMaximized: viewState.viewMaximized,\n                  }}\n                />\n              }\n            >\n              <ToggleIconButton\n                pressed={viewState.viewMaximized}\n                icon={viewState.viewMaximized ? <FullscreenExitIcon /> : <FullscreenIcon />}\n                onClick={() => updateViewState({ viewMaximized: !viewState.viewMaximized })}\n              />\n            </Tooltip>\n          )}\n          {shouldEnableArtifactBasedEvaluation() && displaySidebarToggleButton && (\n            <Tooltip\n              title={\n                <FormattedMessage\n                  defaultMessage='Toggle the preview sidepane'\n                  description='Experiment page > control bar > expanded view toggle button tooltip'\n                />\n              }\n            >\n              <ToggleIconButton\n                pressed={viewState.previewPaneVisible}\n                icon={<SidebarIcon />}\n                onClick={() =>\n                  updateViewState({ previewPaneVisible: !viewState.previewPaneVisible })\n                }\n              />\n            </Tooltip>\n          )}\n          <ExperimentViewRefreshButton />\n          {/* TODO: Add tooltip to guide users to this button */}\n          {shouldEnablePromptLab() && !isComparingExperiments && (\n            <DropdownMenu.Root>\n              <DropdownMenu.Trigger asChild>\n                <Button type='primary' icon={<PlusIcon />}>\n                  <FormattedMessage\n                    defaultMessage='New run'\n                    description='Button used to pop up a modal to create a new run'\n                  />\n                </Button>\n              </DropdownMenu.Trigger>\n              <DropdownMenu.Content>\n                <DropdownMenu.Item onSelect={() => createNewRun()}>\n                  {' '}\n                  <FormattedMessage\n                    defaultMessage='using Prompt Engineering'\n                    description='String for creating a new run with prompt engineering modal'\n                  />{' '}\n                  <Tag style={{ marginLeft: '4px' }} color='turquoise'>\n                    <FormattedMessage\n                      defaultMessage='Experimental'\n                      description='Experimental badge shown for features which are experimental'\n                    />\n                  </Tag>\n                </DropdownMenu.Item>\n                <DropdownMenu.Item onSelect={() => setCreateRunWithNotebookModalOpenValue(true)}>\n                  {' '}\n                  <FormattedMessage\n                    defaultMessage='using Notebook'\n                    description='String for creating a new run from a notebook'\n                  />\n                </DropdownMenu.Item>\n              </DropdownMenu.Content>\n            </DropdownMenu.Root>\n          )}\n        </div>\n      </div>\n    );\n  },\n);\n\nconst styles = {\n  groupBar: { display: 'grid', gridTemplateColumns: 'auto 1fr auto' },\n  controlBar: (theme: Theme) => ({\n    display: 'flex',\n    gap: theme.spacing.sm,\n    alignItems: 'center',\n    flexWrap: 'wrap' as const,\n  }),\n  groupSeparator: (theme: Theme) => ({ minWidth: theme.spacing.sm }),\n  columnSwitch: { margin: '5px' },\n  searchBox: (theme: Theme) => ({ display: 'flex', gap: theme.spacing.sm, width: 560 }),\n  lifecycleFilters: (theme: Theme) => ({\n    display: 'flex',\n    gap: 8,\n    alignItems: 'center',\n    marginTop: theme.spacing.sm,\n    marginBottom: theme.spacing.sm,\n    marginLeft: theme.spacing.lg * 2,\n  }),\n};\n","import {\n  DialogCombobox,\n  DialogComboboxContent,\n  DialogComboboxOptionList,\n  DialogComboboxOptionListSearch,\n  DialogComboboxOptionListSelectItem,\n  DialogComboboxTrigger,\n  ArrowDownIcon,\n  ArrowUpIcon,\n  SortAscendingIcon,\n  SortDescendingIcon,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport React, { useMemo } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { middleTruncateStr } from '../../../../../common/utils/StringUtils';\nimport {\n  COLUMN_SORT_BY_ASC,\n  COLUMN_SORT_BY_DESC,\n  SORT_DELIMITER_SYMBOL,\n} from '../../../../constants';\nimport { ExperimentRunSortOption } from '../../hooks/useRunSortOptions';\nimport { SearchExperimentRunsFacetsState } from '../../models/SearchExperimentRunsFacetsState';\n\nexport const ExperimentViewRunsSortSelector = React.memo(\n  ({\n    searchFacetsState,\n    sortOptions,\n    onSortKeyChanged,\n  }: {\n    searchFacetsState: SearchExperimentRunsFacetsState;\n    sortOptions: ExperimentRunSortOption[];\n    onSortKeyChanged: (valueContainer: any) => void;\n  }) => {\n    const { orderByKey, orderByAsc } = searchFacetsState;\n    const { theme } = useDesignSystemTheme();\n\n    // Currently used canonical \"sort by\" value in form of \"COLUMN_NAME***DIRECTION\", e.g. \"metrics.`metric`***DESCENDING\"\n    const currentSortSelectValue = useMemo(\n      () =>\n        `${orderByKey}${SORT_DELIMITER_SYMBOL}${\n          orderByAsc ? COLUMN_SORT_BY_ASC : COLUMN_SORT_BY_DESC\n        }`,\n      [orderByAsc, orderByKey],\n    );\n\n    /**\n     * Calculate and memoize a label displayed in the \"sort by\" select.\n     *\n     * If full metrics and params list is populated by runs from the API, use the\n     * value corresponding to the calculated sort option list.\n     *\n     * If the sort option list is incomplete (e.g. because fetched run set is empty) while the\n     * order key is given (e.g. because URL state says so), use it to extract the key name.\n     */\n    const currentSortSelectLabel = useMemo(() => {\n      // Search through all sort options generated basing on the fetched runs\n      const sortOption = sortOptions.find((option) => option.value === currentSortSelectValue);\n\n      let sortOptionLabel = sortOption?.label;\n\n      // If the actually chosen sort value is not found in the sort option list (e.g. because the list of fetched runs is empty),\n      // use it to generate the label\n      if (!sortOptionLabel) {\n        // The following regex extracts plain sort key name from its canonical form, i.e.\n        // metrics.`metric_key_name` => metric_key_name\n        const extractedKeyName = orderByKey.match(/^.+\\.`(.+)`$/);\n        if (extractedKeyName) {\n          // eslint-disable-next-line prefer-destructuring\n          sortOptionLabel = extractedKeyName[1];\n        }\n      }\n      return (\n        <span css={{ display: 'flex', alignItems: 'center', gap: 4 }}>\n          {orderByAsc ? <SortAscendingIcon /> : <SortDescendingIcon />}{' '}\n          <FormattedMessage\n            defaultMessage='Sort'\n            description='Sort by default option for sort by select dropdown for experiment runs'\n          />\n          : {sortOptionLabel}\n        </span>\n      );\n    }, [currentSortSelectValue, orderByAsc, orderByKey, sortOptions]);\n\n    const handleChange = (updatedValue: string) => {\n      onSortKeyChanged({ value: updatedValue });\n    };\n\n    const handleClear = () => {\n      onSortKeyChanged({ value: '' });\n    };\n\n    return (\n      <DialogCombobox label={currentSortSelectLabel}>\n        <DialogComboboxTrigger onClear={handleClear} data-test-id='sort-select-dropdown' />\n        <DialogComboboxContent minWidth={250}>\n          <DialogComboboxOptionList>\n            <DialogComboboxOptionListSearch>\n              {sortOptions.map((sortOption) => (\n                <DialogComboboxOptionListSelectItem\n                  key={sortOption.value}\n                  value={sortOption.value}\n                  onChange={handleChange}\n                  checked={sortOption.value === currentSortSelectValue}\n                  data-test-id={`sort-select-${sortOption.label}-${sortOption.order}`}\n                >\n                  <span css={{ display: 'flex', alignItems: 'center', gap: 4 }}>\n                    {sortOption.order === COLUMN_SORT_BY_ASC ? <ArrowUpIcon /> : <ArrowDownIcon />}\n                    {middleTruncateStr(sortOption.label, 50)}\n                  </span>\n                </DialogComboboxOptionListSelectItem>\n              ))}\n            </DialogComboboxOptionListSearch>\n          </DialogComboboxOptionList>\n        </DialogComboboxContent>\n      </DialogCombobox>\n    );\n  },\n);\n","import {\n  Button,\n  ChevronDownIcon,\n  Dropdown,\n  Input,\n  ColumnsIcon,\n  SearchIcon,\n  Tree,\n} from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport Utils from '../../../../../common/utils/Utils';\nimport { ATTRIBUTE_COLUMN_LABELS, COLUMN_TYPES } from '../../../../constants';\nimport { UpdateExperimentSearchFacetsFn } from '../../../../types';\nimport { useExperimentIds } from '../../hooks/useExperimentIds';\nimport { useFetchExperimentRuns } from '../../hooks/useFetchExperimentRuns';\nimport { SearchExperimentRunsFacetsState } from '../../models/SearchExperimentRunsFacetsState';\nimport {\n  extractCanonicalSortKey,\n  isCanonicalSortKeyOfType,\n  makeCanonicalSortKey,\n} from '../../utils/experimentPage.column-utils';\nimport { ExperimentRunsSelectorResult } from '../../utils/experimentRuns.selector';\nimport { shouldEnableExperimentDatasetTracking } from '../../../../../common/utils/FeatureUtils';\n\n/**\n * We need to recreate antd's tree check callback signature since it's not importable\n */\ntype AntdTreeCheckCallback = { node: { key: string | number; checked: boolean } };\n\n/**\n * Function localizing antd tree inside a DOM element. Used to focusing by keyboard.\n */\nconst locateAntdTree = (parent: HTMLElement | null): HTMLElement | null =>\n  parent?.querySelector('[role=\"tree\"] input') || null;\n\nconst GROUP_KEY = 'GROUP';\n\nconst GROUP_KEY_ATTRIBUTES = makeCanonicalSortKey(GROUP_KEY, COLUMN_TYPES.ATTRIBUTES);\nconst GROUP_KEY_PARAMS = makeCanonicalSortKey(GROUP_KEY, COLUMN_TYPES.PARAMS);\nconst GROUP_KEY_METRICS = makeCanonicalSortKey(GROUP_KEY, COLUMN_TYPES.METRICS);\nconst GROUP_KEY_TAGS = makeCanonicalSortKey(GROUP_KEY, COLUMN_TYPES.TAGS);\n\n/**\n * Returns all usable attribute columns basing on view mode and enabled flagged features\n */\nconst getAttributeColumns = (isComparing: boolean) => {\n  const result = [\n    ATTRIBUTE_COLUMN_LABELS.USER,\n    ATTRIBUTE_COLUMN_LABELS.SOURCE,\n    ATTRIBUTE_COLUMN_LABELS.VERSION,\n    ATTRIBUTE_COLUMN_LABELS.MODELS,\n  ];\n\n  if (isComparing) {\n    result.unshift(ATTRIBUTE_COLUMN_LABELS.EXPERIMENT_NAME);\n  }\n\n  if (shouldEnableExperimentDatasetTracking()) {\n    result.unshift(ATTRIBUTE_COLUMN_LABELS.DATASET);\n  }\n\n  return result;\n};\n\n/**\n * Function filters list of string by a given query string.\n */\nconst findMatching = (values: string[], filterQuery: string) =>\n  values.filter((v) => v.toLowerCase().includes(filterQuery.toLowerCase()));\n\n/**\n * Function dissects given string and wraps the\n * searched query with <strong>...</strong> if found. Used for highlighting search.\n */\nconst createHighlightedNode = (value: string, filterQuery: string) => {\n  if (!filterQuery) {\n    return value;\n  }\n  const index = value.toLowerCase().indexOf(filterQuery.toLowerCase());\n  const beforeStr = value.substring(0, index);\n  const matchStr = value.substring(index, index + filterQuery.length);\n  const afterStr = value.substring(index + filterQuery.length);\n\n  return index > -1 ? (\n    <span>\n      {beforeStr}\n      <strong>{matchStr}</strong>\n      {afterStr}\n    </span>\n  ) : (\n    value\n  );\n};\nexport interface ExperimentViewRunsColumnSelectorProps {\n  runsData: ExperimentRunsSelectorResult;\n  columnSelectorVisible: boolean;\n  onChangeColumnSelectorVisible: (value: boolean) => void;\n}\n\n/**\n * A component displaying the searchable column list - implementation.\n */\nexport const ExperimentViewRunsColumnSelectorImpl = React.memo(\n  ({\n    runsData,\n    columnSelectorVisible,\n    onChangeColumnSelectorVisible,\n    updateSearchFacets,\n    selectedColumns,\n  }: ExperimentViewRunsColumnSelectorProps & {\n    updateSearchFacets: UpdateExperimentSearchFacetsFn;\n    selectedColumns: SearchExperimentRunsFacetsState['selectedColumns'];\n  }) => {\n    const experimentIds = useExperimentIds();\n    const [filter, setFilter] = useState('');\n\n    const searchInputRef = useRef<any>(null);\n    const scrollableContainerRef = useRef<HTMLDivElement>(null);\n    const buttonRef = useRef<HTMLButtonElement>(null);\n\n    // Extract all attribute columns\n    const attributeColumnNames = useMemo(\n      () => getAttributeColumns(experimentIds.length > 1),\n      [experimentIds.length],\n    );\n\n    const setCheckedColumns = useCallback(\n      (updateFn: (existingCheckedColumns: string[]) => string[]) =>\n        updateSearchFacets((facets) => {\n          const newColumns = updateFn(facets.selectedColumns);\n          const uniqueNewColumns = Array.from(new Set(newColumns));\n          return { ...facets, selectedColumns: uniqueNewColumns };\n        }),\n      [updateSearchFacets],\n    );\n\n    // Extract unique list of tags\n    const tagsKeyList = useMemo(() => Utils.getVisibleTagKeyList(runsData.tagsList), [runsData]);\n\n    // Extract canonical key names for attributes, params, metrics and tags.\n    const canonicalKeyNames = useMemo(\n      () => ({\n        [COLUMN_TYPES.ATTRIBUTES]: attributeColumnNames.map((key) =>\n          makeCanonicalSortKey(COLUMN_TYPES.ATTRIBUTES, key),\n        ),\n        [COLUMN_TYPES.PARAMS]: runsData.paramKeyList.map((key) =>\n          makeCanonicalSortKey(COLUMN_TYPES.PARAMS, key),\n        ),\n        [COLUMN_TYPES.METRICS]: runsData.metricKeyList.map((key) =>\n          makeCanonicalSortKey(COLUMN_TYPES.METRICS, key),\n        ),\n        [COLUMN_TYPES.TAGS]: tagsKeyList.map((key) => makeCanonicalSortKey(COLUMN_TYPES.TAGS, key)),\n      }),\n      [runsData, attributeColumnNames, tagsKeyList],\n    );\n\n    // This memoized value holds the tree structure generated from\n    // attributes, params, metrics and tags. Displays only filtered values.\n    const treeData = useMemo(() => {\n      const result = [];\n\n      const filteredAttributes = findMatching(attributeColumnNames, filter);\n      const filteredParams = findMatching(runsData.paramKeyList, filter);\n      const filteredMetrics = findMatching(runsData.metricKeyList, filter);\n      const filteredTags = findMatching(tagsKeyList, filter);\n\n      if (filteredAttributes.length) {\n        result.push({\n          key: GROUP_KEY_ATTRIBUTES,\n          title: `Attributes`,\n          children: filteredAttributes.map((attributeKey) => ({\n            key: makeCanonicalSortKey(COLUMN_TYPES.ATTRIBUTES, attributeKey),\n            title: createHighlightedNode(attributeKey, filter),\n          })),\n        });\n      }\n      if (filteredMetrics.length) {\n        result.push({\n          key: GROUP_KEY_METRICS,\n          title: `Metrics (${filteredMetrics.length})`,\n          children: filteredMetrics.map((metricKey) => ({\n            key: makeCanonicalSortKey(COLUMN_TYPES.METRICS, metricKey),\n            title: createHighlightedNode(metricKey, filter),\n          })),\n        });\n      }\n      if (filteredParams.length) {\n        result.push({\n          key: GROUP_KEY_PARAMS,\n          title: `Parameters (${filteredParams.length})`,\n          children: filteredParams.map((paramKey) => ({\n            key: makeCanonicalSortKey(COLUMN_TYPES.PARAMS, paramKey),\n            title: createHighlightedNode(paramKey, filter),\n          })),\n        });\n      }\n      if (filteredTags.length) {\n        result.push({\n          key: GROUP_KEY_TAGS,\n          title: `Tags (${filteredTags.length})`,\n          children: filteredTags.map((tagKey) => ({\n            key: makeCanonicalSortKey(COLUMN_TYPES.TAGS, tagKey),\n            title: tagKey,\n          })),\n        });\n      }\n\n      return result;\n    }, [attributeColumnNames, filter, runsData, tagsKeyList]);\n\n    // This callback toggles entire group of keys\n    const toggleGroup = useCallback(\n      (isChecked: boolean, keyList: string[]) => {\n        if (!isChecked) {\n          setCheckedColumns((checked) => [...checked, ...keyList]);\n        } else {\n          setCheckedColumns((checked) => checked.filter((k) => !keyList.includes(k)));\n        }\n      },\n      [setCheckedColumns],\n    );\n\n    // This callback is intended to select/deselect a single key\n    const toggleSingleKey = useCallback(\n      (key: string, isChecked: boolean) => {\n        if (!isChecked) {\n          setCheckedColumns((checked) => [...checked, key]);\n        } else {\n          setCheckedColumns((checked) => checked.filter((k) => k !== key));\n        }\n      },\n      [setCheckedColumns],\n    );\n\n    useEffect(() => {\n      if (columnSelectorVisible) {\n        setFilter('');\n\n        // Let's wait for the next execution frame, then:\n        // - restore the dropdown menu scroll position\n        // - focus the search input\n        // - bring the dropdown into the viewport using scrollIntoView()\n        requestAnimationFrame(() => {\n          scrollableContainerRef?.current?.scrollTo(0, 0);\n          searchInputRef.current?.focus({ preventScroll: true });\n\n          if (buttonRef.current) {\n            buttonRef.current.scrollIntoView({ block: 'nearest', behavior: 'smooth' });\n          }\n        });\n      }\n    }, [columnSelectorVisible]);\n\n    const onCheck = useCallback(\n      // We need to recreate antd's tree check callback signature\n      (_: any, { node: { key, checked } }: AntdTreeCheckCallback) => {\n        if (isCanonicalSortKeyOfType(key.toString(), GROUP_KEY)) {\n          const columnType = extractCanonicalSortKey(key.toString(), GROUP_KEY);\n          const canonicalKeysForGroup = canonicalKeyNames[columnType];\n          if (canonicalKeysForGroup) {\n            toggleGroup(checked, findMatching(canonicalKeysForGroup, filter));\n          }\n        } else {\n          toggleSingleKey(key.toString(), checked);\n        }\n      },\n      [canonicalKeyNames, toggleGroup, toggleSingleKey, filter],\n    );\n\n    // This callback moves focus to tree element if down arrow has been pressed\n    // when inside search input area.\n    const searchInputKeyDown = useCallback<React.KeyboardEventHandler<HTMLInputElement>>((e) => {\n      if (e.key === 'ArrowDown') {\n        const treeElement = locateAntdTree(scrollableContainerRef.current);\n\n        if (treeElement) {\n          treeElement.focus();\n        }\n      }\n    }, []);\n\n    // A JSX block containing the dropdown\n    const dropdownContent = (\n      <div css={styles.dropdown}>\n        <div css={(theme) => ({ padding: theme.spacing.md })}>\n          <Input\n            value={filter}\n            prefix={<SearchIcon />}\n            placeholder='Search columns'\n            allowClear\n            ref={searchInputRef}\n            onChange={(e) => {\n              setFilter(e.target.value);\n            }}\n            onKeyDown={searchInputKeyDown}\n          />\n        </div>\n        <div ref={scrollableContainerRef} css={styles.scrollableContainer}>\n          <Tree\n            data-testid='column-selector-tree'\n            mode='checkable'\n            dangerouslySetAntdProps={{\n              checkedKeys: selectedColumns,\n              onCheck,\n            }}\n            defaultExpandedKeys={[\n              GROUP_KEY_ATTRIBUTES,\n              GROUP_KEY_PARAMS,\n              GROUP_KEY_METRICS,\n              GROUP_KEY_TAGS,\n            ]}\n            treeData={treeData}\n          />\n        </div>\n      </div>\n    );\n\n    return (\n      <Dropdown\n        overlay={dropdownContent}\n        placement='bottomLeft'\n        trigger={['click']}\n        visible={columnSelectorVisible}\n        onVisibleChange={onChangeColumnSelectorVisible}\n      >\n        <Button\n          ref={buttonRef}\n          style={{ display: 'flex', alignItems: 'center' }}\n          data-testid='column-selection-dropdown'\n          icon={<ColumnsIcon />}\n        >\n          <FormattedMessage\n            defaultMessage='Columns'\n            description='Dropdown text to display columns names that could to be rendered for the experiment runs table'\n          />{' '}\n          <ChevronDownIcon />\n        </Button>\n      </Dropdown>\n    );\n  },\n);\n\n/**\n * A component displaying the searchable column list.\n * This is a thin layer wrapping the implementation to optimize search state rerenders.\n */\nexport const ExperimentViewRunsColumnSelector = (props: ExperimentViewRunsColumnSelectorProps) => {\n  const { updateSearchFacets, searchFacetsState } = useFetchExperimentRuns();\n  return (\n    <ExperimentViewRunsColumnSelectorImpl\n      {...props}\n      selectedColumns={searchFacetsState.selectedColumns}\n      updateSearchFacets={updateSearchFacets}\n    />\n  );\n};\n\nconst styles = {\n  dropdown: (theme: Theme) => ({\n    backgroundColor: theme.colors.white,\n    width: 400,\n    border: `1px solid`,\n    borderColor: theme.colors.border,\n  }),\n  scrollableContainer: (theme: Theme) => ({\n    // Maximum height of 15 elements times 32 pixels as defined in\n    // design-system/src/design-system/Tree/Tree.tsx\n    maxHeight: 15 * 32,\n    overflowY: 'scroll' as const,\n    overflowX: 'hidden' as const,\n    paddingBottom: theme.spacing.md,\n    'span[title]': {\n      whiteSpace: 'nowrap' as const,\n      textOverflow: 'ellipsis',\n      overflow: 'hidden',\n    },\n  }),\n};\n","import {\n  BarChartIcon,\n  Button,\n  ListBorderIcon,\n  Popover,\n  SegmentedControlButton,\n  SegmentedControlGroup,\n  Tabs,\n  Tag,\n  Typography,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { SearchExperimentRunsViewState } from '../../models/SearchExperimentRunsViewState';\nimport { useExperimentViewLocalStore } from '../../hooks/useExperimentViewLocalStore';\nimport { shouldEnableArtifactBasedEvaluation } from '../../../../../common/utils/FeatureUtils';\nimport type { ExperimentViewRunsCompareMode } from '../../../../types';\n\nconst COMPARE_RUNS_TOOLTIP_STORAGE_KEY = 'compareRunsTooltip';\nconst COMPARE_RUNS_TOOLTIP_STORAGE_ITEM = 'seenBefore';\n\nexport interface ExperimentViewRunsModeSwitchProps {\n  compareRunsMode: ExperimentViewRunsCompareMode;\n  setCompareRunsMode: (newCompareRunsMode: ExperimentViewRunsCompareMode) => void;\n  viewState: SearchExperimentRunsViewState;\n}\n\nconst ChartViewButtonTooltip: React.FC<{\n  isComparingRuns: boolean;\n  multipleRunsSelected: boolean;\n}> = ({ multipleRunsSelected, isComparingRuns }) => {\n  const seenTooltipStore = useExperimentViewLocalStore(COMPARE_RUNS_TOOLTIP_STORAGE_KEY);\n  const [isToolTipOpen, setToolTipOpen] = useState(\n    multipleRunsSelected && !seenTooltipStore.getItem(COMPARE_RUNS_TOOLTIP_STORAGE_ITEM),\n  );\n\n  useEffect(() => {\n    const hasSeenTooltipBefore = seenTooltipStore.getItem(COMPARE_RUNS_TOOLTIP_STORAGE_ITEM);\n    if (multipleRunsSelected && !isComparingRuns && !hasSeenTooltipBefore) {\n      setToolTipOpen(true);\n    } else {\n      setToolTipOpen(false);\n    }\n  }, [multipleRunsSelected, isComparingRuns, seenTooltipStore]);\n\n  const updateIsTooltipOpen = useCallback(\n    (isOpen) => {\n      setToolTipOpen(isOpen);\n      seenTooltipStore.setItem(COMPARE_RUNS_TOOLTIP_STORAGE_ITEM, true);\n    },\n    [setToolTipOpen, seenTooltipStore],\n  );\n\n  return (\n    <>\n      <Popover.Root open={isToolTipOpen}>\n        <Popover.Trigger asChild>\n          <div css={{ position: 'absolute', inset: 0 }} />\n        </Popover.Trigger>\n        <Popover.Content align='start'>\n          <div css={{ maxWidth: '200px' }}>\n            <Typography.Paragraph>\n              <FormattedMessage\n                defaultMessage='You can now switch to the chart view to compare runs'\n                description='Tooltip to push users to use the chart view instead of compare view'\n              />\n            </Typography.Paragraph>\n            <div css={{ textAlign: 'right' }}>\n              <Button onClick={() => updateIsTooltipOpen(false)} type='primary'>\n                <FormattedMessage\n                  defaultMessage='Got it'\n                  description='Button action text for chart switcher tooltip'\n                />\n              </Button>\n            </div>\n          </div>\n          <Popover.Arrow />\n        </Popover.Content>\n      </Popover.Root>\n    </>\n  );\n};\n\n/**\n * Allows switching between \"table\", \"chart\" and \"evaluation\" modes of experiment view\n */\nexport const ExperimentViewRunsModeSwitch = ({\n  compareRunsMode,\n  setCompareRunsMode,\n  viewState,\n}: ExperimentViewRunsModeSwitchProps) => {\n  const isComparingRuns = compareRunsMode !== undefined;\n  const { classNamePrefix } = useDesignSystemTheme();\n\n  const activeTab = compareRunsMode || 'TABLE';\n\n  return (\n    <Tabs\n      dangerouslyAppendEmotionCSS={{\n        [`.${classNamePrefix}-tabs-nav`]: { marginBottom: 0, '::before': { border: 'none' } },\n      }}\n      activeKey={activeTab}\n      onChange={(tabKey) =>\n        setCompareRunsMode(\n          (tabKey === 'TABLE' ? undefined : tabKey) as ExperimentViewRunsCompareMode,\n        )\n      }\n    >\n      <Tabs.TabPane\n        tab={\n          <span data-testid='experiment-runs-mode-switch-list'>\n            <FormattedMessage\n              defaultMessage='Table'\n              description='A button enabling table mode on the experiment page'\n            />\n          </span>\n        }\n        key='TABLE'\n      />\n      <Tabs.TabPane\n        tab={\n          <>\n            <span data-testid='experiment-runs-mode-switch-compare'>\n              <FormattedMessage\n                defaultMessage='Chart'\n                description='A button enabling compare runs (chart) mode on the experiment page'\n              />\n            </span>\n            <ChartViewButtonTooltip\n              isComparingRuns={isComparingRuns}\n              multipleRunsSelected={Object.keys(viewState.runsSelected).length > 1}\n            />\n          </>\n        }\n        key='CHART'\n      />\n      {shouldEnableArtifactBasedEvaluation() && (\n        <Tabs.TabPane\n          tab={\n            <span data-testid='experiment-runs-mode-switch-evaluation'>\n              <FormattedMessage\n                defaultMessage='Evaluation'\n                description='A button enabling compare runs (evaluation) mode on the experiment page'\n              />{' '}\n              <Tag style={{ marginLeft: '4px' }} color='turquoise'>\n                <FormattedMessage\n                  defaultMessage='Experimental'\n                  description='Experimental badge shown for features which are experimental'\n                />\n              </Tag>\n            </span>\n          }\n          key='ARTIFACT'\n        />\n      )}\n    </Tabs>\n  );\n};\n","import { Theme } from '@emotion/react';\nimport React, { useCallback, useMemo } from 'react';\nimport Utils from '../../../../../common/utils/Utils';\nimport { UpdateExperimentSearchFacetsFn, UpdateExperimentViewStateFn } from '../../../../types';\nimport { useRunSortOptions } from '../../hooks/useRunSortOptions';\nimport { SearchExperimentRunsFacetsState } from '../../models/SearchExperimentRunsFacetsState';\nimport { SearchExperimentRunsViewState } from '../../models/SearchExperimentRunsViewState';\nimport { downloadRunsCsv } from '../../utils/experimentPage.common-utils';\nimport { ExperimentRunsSelectorResult } from '../../utils/experimentRuns.selector';\nimport { ExperimentViewRunsControlsActions } from './ExperimentViewRunsControlsActions';\nimport { ExperimentViewRunsControlsFilters } from './ExperimentViewRunsControlsFilters';\nimport { ErrorWrapper } from '../../../../../common/utils/ErrorWrapper';\nimport { ToggleButton, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from 'react-intl';\nimport { ExperimentViewRunsSortSelector } from './ExperimentViewRunsSortSelector';\nimport { TAGS_TO_COLUMNS_MAP } from '../../utils/experimentPage.column-utils';\nimport { COLUMN_SORT_BY_ASC, SORT_DELIMITER_SYMBOL } from '../../../../constants';\nimport { ExperimentViewRunsColumnSelector } from './ExperimentViewRunsColumnSelector';\nimport { shouldEnableExperimentDatasetTracking } from '../../../../../common/utils/FeatureUtils';\nimport { ExperimentViewRunsModeSwitch } from './ExperimentViewRunsModeSwitch';\n\ntype ExperimentViewRunsControlsProps = {\n  viewState: SearchExperimentRunsViewState;\n  updateViewState: UpdateExperimentViewStateFn;\n\n  searchFacetsState: SearchExperimentRunsFacetsState;\n  updateSearchFacets: UpdateExperimentSearchFacetsFn;\n\n  experimentId: string;\n\n  runsData: ExperimentRunsSelectorResult;\n\n  expandRows: boolean;\n  updateExpandRows: (expandRows: boolean) => void;\n\n  requestError: ErrorWrapper | null;\n};\n\n/**\n * This component houses all controls related to searching runs: sort controls,\n * filters and run related actions (delete, restore, download CSV).\n */\nexport const ExperimentViewRunsControls = React.memo(\n  ({\n    runsData,\n    viewState,\n    updateViewState,\n    updateSearchFacets,\n    searchFacetsState,\n    experimentId,\n    requestError,\n    expandRows,\n    updateExpandRows,\n  }: ExperimentViewRunsControlsProps) => {\n    const { paramKeyList, metricKeyList, tagsList } = runsData;\n    const { compareRunsMode } = searchFacetsState;\n    const isComparingRuns = compareRunsMode !== undefined;\n\n    const { theme } = useDesignSystemTheme();\n\n    const filteredParamKeys = paramKeyList;\n    const filteredMetricKeys = metricKeyList;\n    const filteredTagKeys = Utils.getVisibleTagKeyList(tagsList);\n\n    const onDownloadCsv = useCallback(\n      () => downloadRunsCsv(runsData, filteredTagKeys, filteredParamKeys, filteredMetricKeys),\n      [filteredMetricKeys, filteredParamKeys, filteredTagKeys, runsData],\n    );\n\n    const sortOptions = useRunSortOptions(filteredMetricKeys, filteredParamKeys);\n\n    const selectedRunsCount = Object.values(viewState.runsSelected).filter(Boolean).length;\n    const canRestoreRuns = selectedRunsCount > 0;\n    const canRenameRuns = selectedRunsCount === 1;\n    const canCompareRuns = selectedRunsCount > 1;\n    const showActionButtons = canCompareRuns || canRenameRuns || canRestoreRuns;\n\n    // Callback fired when the sort column value changes\n    const sortKeyChanged = useCallback(\n      ({ value: compiledOrderByKey }) => {\n        const [newOrderBy, newOrderAscending] = compiledOrderByKey.split(SORT_DELIMITER_SYMBOL);\n\n        const columnToAdd = TAGS_TO_COLUMNS_MAP[newOrderBy] || newOrderBy;\n        const isOrderAscending = newOrderAscending === COLUMN_SORT_BY_ASC;\n\n        updateSearchFacets((currentFacets) => {\n          const { selectedColumns } = currentFacets;\n          if (!selectedColumns.includes(columnToAdd)) {\n            selectedColumns.push(columnToAdd);\n          }\n          return {\n            ...currentFacets,\n            selectedColumns,\n            orderByKey: newOrderBy,\n            orderByAsc: isOrderAscending,\n          };\n        });\n      },\n      [updateSearchFacets],\n    );\n\n    // Shows or hides the column selector\n    const changeColumnSelectorVisible = useCallback(\n      (value: boolean) => updateViewState({ columnSelectorVisible: value }),\n      [updateViewState],\n    );\n\n    const toggleExpandedRows = useCallback(\n      () => updateExpandRows(!expandRows),\n      [expandRows, updateExpandRows],\n    );\n\n    const multipleDatasetsArePresent = useMemo(\n      () => runsData.datasetsList.some((datasetsInRun) => datasetsInRun?.length > 1),\n      [runsData],\n    );\n\n    return (\n      <div\n        css={{\n          display: 'flex',\n          gap: theme.spacing.sm,\n          flexDirection: 'column' as const,\n          marginTop: viewState.viewMaximized ? undefined : theme.spacing.md,\n        }}\n      >\n        {showActionButtons && (\n          <ExperimentViewRunsControlsActions\n            runsData={runsData}\n            searchFacetsState={searchFacetsState}\n            viewState={viewState}\n          />\n        )}\n\n        {!showActionButtons && (\n          <ExperimentViewRunsControlsFilters\n            onDownloadCsv={onDownloadCsv}\n            updateSearchFacets={updateSearchFacets}\n            searchFacetsState={searchFacetsState}\n            experimentId={experimentId}\n            viewState={viewState}\n            updateViewState={updateViewState}\n            runsData={runsData}\n            requestError={requestError}\n            additionalControls={\n              <>\n                <ExperimentViewRunsSortSelector\n                  onSortKeyChanged={sortKeyChanged}\n                  searchFacetsState={searchFacetsState}\n                  sortOptions={sortOptions}\n                />\n                {!isComparingRuns && (\n                  <ExperimentViewRunsColumnSelector\n                    columnSelectorVisible={viewState.columnSelectorVisible}\n                    onChangeColumnSelectorVisible={changeColumnSelectorVisible}\n                    runsData={runsData}\n                  />\n                )}\n\n                {!isComparingRuns &&\n                  shouldEnableExperimentDatasetTracking() &&\n                  multipleDatasetsArePresent && (\n                    <ToggleButton onClick={toggleExpandedRows}>\n                      <FormattedMessage\n                        defaultMessage='Expand rows'\n                        description='Label for the expand rows button above the experiment runs table'\n                      />\n                    </ToggleButton>\n                  )}\n              </>\n            }\n          />\n        )}\n\n        <div>\n          <ExperimentViewRunsModeSwitch\n            compareRunsMode={compareRunsMode}\n            setCompareRunsMode={(newCompareRunsMode) =>\n              updateSearchFacets({ compareRunsMode: newCompareRunsMode })\n            }\n            viewState={viewState}\n          />\n        </div>\n      </div>\n    );\n  },\n);\n","import { useMemo } from 'react';\nimport {\n  ATTRIBUTE_COLUMN_SORT_KEY,\n  ATTRIBUTE_COLUMN_SORT_LABEL,\n  COLUMN_SORT_BY_ASC,\n  COLUMN_SORT_BY_DESC,\n  COLUMN_TYPES,\n  SORT_DELIMITER_SYMBOL,\n} from '../../../constants';\nimport { makeCanonicalSortKey } from '../utils/experimentPage.column-utils';\n\nexport type ExperimentRunSortOption = {\n  label: string;\n  order: string;\n  value: string;\n};\n\ntype SORT_KEY_TYPE = keyof (typeof ATTRIBUTE_COLUMN_SORT_KEY & typeof ATTRIBUTE_COLUMN_SORT_LABEL);\n\n/**\n * This hook creates a set of run+sort options basing on currently selected\n * columns and the list of all metrics and keys.\n */\nexport const useRunSortOptions = (\n  filteredMetricKeys: string[],\n  filteredParamKeys: string[],\n): ExperimentRunSortOption[] =>\n  useMemo(() => {\n    let sortOptions = [];\n    const ColumnSortByOrder = [COLUMN_SORT_BY_ASC, COLUMN_SORT_BY_DESC];\n    const attributesSortBy = Object.keys(ATTRIBUTE_COLUMN_SORT_LABEL).reduce<any[]>(\n      (options, sortLabelKey) => {\n        const sortLabel = ATTRIBUTE_COLUMN_SORT_LABEL[sortLabelKey as SORT_KEY_TYPE];\n\n        ColumnSortByOrder.forEach((order) => {\n          options.push({\n            label: sortLabel,\n            value:\n              ATTRIBUTE_COLUMN_SORT_KEY[sortLabelKey as SORT_KEY_TYPE] +\n              SORT_DELIMITER_SYMBOL +\n              order,\n            order,\n          });\n        });\n\n        return options;\n      },\n      [],\n    );\n    const metricsSortBy = filteredMetricKeys.reduce<any[]>((options, sortLabelKey) => {\n      ColumnSortByOrder.forEach((order) => {\n        options.push({\n          label: sortLabelKey,\n          value: `${makeCanonicalSortKey(\n            COLUMN_TYPES.METRICS,\n            sortLabelKey,\n          )}${SORT_DELIMITER_SYMBOL}${order}`,\n          order,\n        });\n      });\n\n      return options;\n    }, []);\n    const paramsSortBy = filteredParamKeys.reduce<any[]>((options, sortLabelKey) => {\n      ColumnSortByOrder.forEach((order) => {\n        options.push({\n          label: sortLabelKey,\n          value: `${makeCanonicalSortKey(\n            COLUMN_TYPES.PARAMS,\n            sortLabelKey,\n          )}${SORT_DELIMITER_SYMBOL}${order}`,\n          order,\n        });\n      });\n\n      return options;\n    }, []);\n    sortOptions = [...attributesSortBy, ...metricsSortBy, ...paramsSortBy];\n\n    return sortOptions;\n  }, [filteredMetricKeys, filteredParamKeys]);\n","import type { AgGridReactProps, AgReactUiProps } from '@ag-grid-community/react';\nimport { Spinner } from '@databricks/design-system';\nimport React from 'react';\n\nconst MLFlowAgGridImpl = React.lazy(() => import('./AgGrid'));\n\n/**\n * A simple loader that will lazily load MLFlow's ag grid implementation.\n * Extracted to a separate module for testing purposes.\n */\nexport const MLFlowAgGridLoader = (props: AgGridReactProps | AgReactUiProps) => (\n  <React.Suspense\n    fallback={\n      <div\n        css={(cssTheme) => ({\n          display: 'flex',\n          justifyContent: 'center',\n          margin: cssTheme.spacing.md,\n        })}\n      >\n        <Spinner />\n      </div>\n    }\n  >\n    <MLFlowAgGridImpl {...props} />\n  </React.Suspense>\n);\n","import { BeakerIcon, Button, Empty, FilterIcon } from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport { FormattedMessage } from 'react-intl';\nimport { LoggingRunsDocUrl } from '../../../../../common/constants';\n\n/**\n * This component displays information about no results being displayed in runs tample,\n * either due to no runs recorded in an experiment at all or due to currently used filters.\n */\nexport const ExperimentViewRunsEmptyTable = ({\n  isFiltered,\n  onClearFilters,\n}: {\n  onClearFilters: () => void;\n  isFiltered: boolean;\n}) => {\n  const getLearnMoreLinkUrl = () => LoggingRunsDocUrl;\n\n  return (\n    <div css={styles.noResultsWrapper}>\n      <div css={styles.noResults}>\n        {isFiltered ? (\n          <Empty\n            button={\n              <Button type='primary' onClick={onClearFilters}>\n                <FormattedMessage\n                  defaultMessage='Clear filters'\n                  description='Label for a button that clears all filters, visible on a experiment runs page next to a empty state when all runs have been filtered out'\n                />\n              </Button>\n            }\n            description={\n              <FormattedMessage\n                defaultMessage='All runs in this experiment have been filtered. Change or clear filters to view runs.'\n                description='Empty state description text for experiment runs page when all runs have been filtered out'\n              />\n            }\n            title={\n              <FormattedMessage\n                defaultMessage='All runs are filtered'\n                description='Empty state title text for experiment runs page when all runs have been filtered out'\n              />\n            }\n            image={<FilterIcon />}\n          />\n        ) : (\n          <Empty\n            description={\n              <FormattedMessage\n                defaultMessage='No runs have been logged yet. <link>Learn more</link> about how to create ML model training runs in this experiment.'\n                description='Empty state description text for experiment runs page when no runs are logged in the experiment'\n                values={{\n                  link: (chunks: any) => (\n                    <a target='_blank' href={getLearnMoreLinkUrl()} rel='noreferrer'>\n                      {chunks}\n                    </a>\n                  ),\n                }}\n              />\n            }\n            title={\n              <FormattedMessage\n                defaultMessage='No runs logged'\n                description='Empty state title text for experiment runs page when no runs are logged in the experiment'\n              />\n            }\n            image={<BeakerIcon />}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n\nconst styles = {\n  noResults: {\n    maxWidth: 360,\n  },\n  noResultsWrapper: (theme: Theme) => ({\n    marginTop: theme.spacing.lg,\n    inset: 0,\n    backgroundColor: theme.colors.backgroundPrimary,\n    position: 'absolute' as const,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n  }),\n};\n","import { Button, PlusCircleIcon } from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport { useCallback, useEffect, useRef } from 'react';\nimport { FormattedMessage } from 'react-intl';\n\n/**\n * Width of the CTA column\n */\nconst COLUMN_CTA_WIDTH = 180;\n\n/**\n * CSS classes used internally\n */\nconst CLASS_OUT_OF_VIEWPORT = 'is-out-of-viewport';\nconst CLASS_IS_HIDDEN = 'is-hidden';\nconst CLASS_IS_MINIMIZED = 'is-minimized';\n\n/**\n * List all necessary agGrid sub-element classes\n */\nconst AG_GRID_CLS = {\n  ROOT: '.ag-root',\n  LEFT_COLS_CONTAINER: '.ag-pinned-left-cols-container',\n  FULL_WIDTH_ROW: '.ag-full-width-row',\n  COLS_CONTAINER: '.ag-center-cols-container',\n  HEADER: '.ag-header',\n  BODY_VIEWPORT: '.ag-body-viewport',\n};\n\ninterface ExperimentViewRunsTableAddColumnCTAProps {\n  onClick: () => void;\n  gridContainerElement: HTMLElement | null;\n  isInitialized: boolean;\n  visible?: boolean;\n  moreRunsAvailable?: boolean;\n  moreAvailableRunsTableColumnCount?: number;\n}\n\n/**\n * Component displaying dynamic table column with \"add metrics and parameters\" CTA.\n *\n * Sample usage:\n *\n * const [gridInitialized, setGridInitialized] = useState(false);\n *\n * return (\n *   <div ref={containerElement}>\n *     <AgGrid onGridReady={() => setGridInitialized(true)} {...} />\n *     <ExperimentViewRunsTableAddColumnCTA\n *       gridContainerElement={containerElement.current}\n *       isInitialized={gridInitialized}\n *       onAddColumnClicked={onAddColumnClicked}\n *       visible={!isLoading}\n *       moreAvailableRunsTableColumnCount={3}\n *     />\n *   </div>\n * );\n */\nexport const ExperimentViewRunsTableAddColumnCTA = ({\n  onClick,\n  gridContainerElement,\n  isInitialized,\n  visible,\n  moreRunsAvailable,\n  moreAvailableRunsTableColumnCount = 0,\n}: ExperimentViewRunsTableAddColumnCTAProps) => {\n  const ctaRef = useRef<HTMLDivElement>(null);\n\n  const savedContainerRef = useRef<HTMLElement>();\n  const immediateMoreRunsAvailable = useRef<boolean>(Boolean(moreRunsAvailable));\n\n  // Save immediate value of \"moreRunsAvailable\" so the fresh version\n  // will be accessible within the resize observer\n  useEffect(() => {\n    immediateMoreRunsAvailable.current = Boolean(moreRunsAvailable);\n  }, [moreRunsAvailable]);\n\n  const initialize = useCallback((containerElement: HTMLElement) => {\n    if (!ctaRef.current || !window.ResizeObserver || !containerElement) {\n      return undefined;\n    }\n\n    const targetElement = ctaRef.current;\n\n    /**\n     * On initialization, first gather all the agGrid sub-elements\n     */\n    const rootElement = containerElement.querySelector(AG_GRID_CLS.ROOT);\n    const refLeftElem = containerElement.querySelector(AG_GRID_CLS.LEFT_COLS_CONTAINER);\n    const refCenterElem = containerElement.querySelector(AG_GRID_CLS.COLS_CONTAINER);\n    const refHeaderElem = containerElement.querySelector(AG_GRID_CLS.HEADER);\n    const refBodyViewport = containerElement.querySelector(AG_GRID_CLS.BODY_VIEWPORT);\n\n    /**\n     * Initialize variables used for position calculation\n     */\n    let gridAreaWidth = 0;\n    let leftColContainerWidth = 0;\n    let leftColContainerHeight = 0;\n    let centerColContainerWidth = 0;\n    let colContainerHeight = 0;\n    let headerHeight = 0;\n\n    /**\n     * Execute only if all elements are in place\n     */\n    if (refLeftElem && refCenterElem && refHeaderElem && rootElement && refBodyViewport) {\n      /**\n       * Hook up an resize observer\n       */\n      const resizeObserver = new ResizeObserver((entries) => {\n        /**\n         * For every changed element, gather the exact dimensions\n         */\n        for (const entry of entries) {\n          if (entry.target === rootElement) {\n            gridAreaWidth = entry.contentRect.width;\n          }\n          if (entry.target === refLeftElem) {\n            leftColContainerWidth = entry.contentRect.width;\n            leftColContainerHeight = entry.contentRect.height;\n          }\n          if (entry.target === refBodyViewport) {\n            colContainerHeight = entry.contentRect.height;\n          }\n          if (entry.target === refHeaderElem) {\n            headerHeight = entry.contentRect.height;\n          }\n          if (entry.target === refCenterElem) {\n            centerColContainerWidth = entry.contentRect.width;\n          }\n        }\n\n        /**\n         * Our \"left\" position will be offset by column container widths\n         */\n        const calculatedLeft = leftColContainerWidth + centerColContainerWidth;\n\n        /**\n         * Our \"top\"  position will be offset by the header height\n         */\n        const calculatedTop = headerHeight;\n\n        /**\n         * If the column is out of viewport (expanding out of the root element),\n         * add proper CSS class to hide it\n         */\n        const isOutOfViewport = calculatedLeft + COLUMN_CTA_WIDTH >= gridAreaWidth;\n        isOutOfViewport\n          ? savedContainerRef.current?.classList.add(CLASS_OUT_OF_VIEWPORT)\n          : savedContainerRef.current?.classList.remove(CLASS_OUT_OF_VIEWPORT);\n\n        // Check if \"load more\" button is visible\n        const loadMoreRowHeight = immediateMoreRunsAvailable.current ? 32 : 0;\n\n        // If the visible row set takes only portion of the table height-wise (leftColContainerHeight < colContainerHeight),\n        // let's contract our CTA a little so \"load more\" button will fit in. If it takes whole area, do not reduce its height.\n        const calculatedHeight =\n          leftColContainerHeight < colContainerHeight\n            ? leftColContainerHeight - loadMoreRowHeight\n            : colContainerHeight;\n\n        /**\n         * If the available height is too low, add a class that indicates\n         * that we should display minimized version\n         */\n        const shouldBeMinimized = calculatedHeight < 100;\n        shouldBeMinimized\n          ? savedContainerRef.current?.classList.add(CLASS_IS_MINIMIZED)\n          : savedContainerRef.current?.classList.remove(CLASS_IS_MINIMIZED);\n\n        /**\n         * Finally, set proper values as CSS transform property. Use 3d transform\n         * to ensure hardware acceleration.\n         */\n        targetElement.style.transform = `translate3d(${calculatedLeft}px, ${calculatedTop}px, 0)`;\n\n        /**\n         * Set target height and add 1px to accomodate the border.\n         */\n        targetElement.style.height = `${calculatedHeight + 1}px`;\n      });\n\n      /**\n       * Setup observer with all the necessary elements.\n       */\n      resizeObserver.observe(refLeftElem);\n      resizeObserver.observe(refCenterElem);\n      resizeObserver.observe(refHeaderElem);\n      resizeObserver.observe(rootElement);\n      resizeObserver.observe(refBodyViewport);\n\n      /**\n       * After cleanup, disconnect the observer.\n       */\n      return () => resizeObserver.disconnect();\n    }\n    return undefined;\n  }, []);\n\n  useEffect(() => {\n    if (isInitialized && gridContainerElement) {\n      savedContainerRef.current = gridContainerElement;\n      initialize(gridContainerElement);\n    }\n  }, [initialize, isInitialized, gridContainerElement]);\n\n  /**\n   * This component works only if ResizeObserver is supported by the browser.\n   * If it's not supported, return nothing.\n   */\n  if (!window.ResizeObserver) {\n    return null;\n  }\n\n  return (\n    <div ref={ctaRef} css={styles.columnContainer} className={visible ? '' : CLASS_IS_HIDDEN}>\n      {visible && (\n        <div css={styles.buttonContainer}>\n          <Button css={styles.button} type='link' onClick={onClick}>\n            <PlusCircleIcon css={styles.buttonIcon} />\n            <div css={styles.caption}>\n              <FormattedMessage\n                defaultMessage='Show more columns {count, select, 0 {} other {({count} total)}}'\n                description='Label for a CTA button in experiment runs table which invokes column management dropdown'\n                values={{\n                  count: moreAvailableRunsTableColumnCount,\n                }}\n              />\n            </div>\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst styles = {\n  columnContainer: (theme: Theme) => ({\n    width: COLUMN_CTA_WIDTH,\n    height: 0,\n    position: 'absolute' as const,\n    border: `1px solid ${theme.colors.grey200}`,\n    borderTop: 0,\n    top: 0,\n    left: 0,\n    willChange: 'transform' as const,\n    transform: 'translate3d(0, 0, 0)',\n    [`.${CLASS_IS_MINIMIZED} &`]: {\n      display: 'flex',\n      alignItems: 'center' as const,\n    },\n    [`&.${CLASS_IS_HIDDEN}, .${CLASS_OUT_OF_VIEWPORT} &`]: {\n      display: 'none',\n    },\n    pointerEvents: 'none' as const,\n    display: 'flex',\n    alignItems: 'center',\n  }),\n  buttonContainer: (theme: Theme) => ({\n    top: 0,\n    paddingLeft: theme.spacing.lg,\n    paddingRight: theme.spacing.lg,\n    width: '100%',\n    [`.${CLASS_IS_MINIMIZED} &`]: {\n      paddingTop: theme.spacing.xs,\n    },\n    pointerEvents: 'all' as const,\n  }),\n  button: { whiteSpace: 'pre-wrap' as const, width: '100%' },\n  buttonIcon: (theme: Theme) => ({ color: theme.colors.textSecondary }),\n  caption: (theme: Theme) => ({\n    color: theme.colors.textSecondary,\n    [`.${CLASS_IS_MINIMIZED} &`]: {\n      display: 'none',\n    },\n  }),\n};\n","import { Spinner, Typography } from '@databricks/design-system';\nimport type { Theme } from '@emotion/react';\nimport { FormattedMessage } from 'react-intl';\n\ninterface ExperimentViewRunsTableStatusBarProps {\n  isLoading: boolean;\n  allRunsCount: number;\n}\n\n// Strongifies the i18n string, used in <FormattedMessage> below\nconst strong = (text: string) => <strong>{text}</strong>;\n\nexport const ExperimentViewRunsTableStatusBar = ({\n  isLoading,\n  allRunsCount,\n}: ExperimentViewRunsTableStatusBarProps) => (\n  <div css={styles.statusBar}>\n    <Typography.Text size='sm' color={isLoading ? 'secondary' : undefined}>\n      <FormattedMessage\n        // eslint-disable-next-line max-len\n        defaultMessage='<strong>{length}</strong> matching {length, plural, =0 {runs} =1 {run} other {runs}}'\n        // eslint-disable-next-line max-len\n        description='Message for displaying how many runs match search criteria on experiment page'\n        values={{\n          strong,\n          length: allRunsCount,\n        }}\n      />\n    </Typography.Text>\n    {isLoading && <Spinner size='small' />}\n  </div>\n);\n\nconst styles = {\n  statusBar: (theme: Theme) => ({\n    height: 28,\n    display: 'flex',\n    gap: 8,\n    marginTop: -1,\n    position: 'relative' as const,\n    alignItems: 'center',\n    borderTop: `1px solid ${theme.colors.border}`,\n  }),\n};\n","import React from 'react';\nimport {\n  Button,\n  CloseIcon,\n  CopyIcon,\n  Typography,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { CopyButton } from '../../shared/building_blocks/CopyButton';\n\nconst PREVIEW_SIDEBAR_WIDTH = 300;\n\n/**\n * Displays a sidebar helpful in expanding textual data in table components.\n * Will be replaced by DuBois standardized component in the future.\n */\nexport const PreviewSidebar = ({\n  content,\n  copyText,\n  headerText,\n  empty,\n  onClose,\n}: {\n  content?: React.ReactNode;\n  copyText?: string;\n  headerText?: string;\n  empty?: React.ReactNode;\n  onClose?: () => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div\n      css={{\n        width: PREVIEW_SIDEBAR_WIDTH,\n        padding: theme.spacing.sm,\n        paddingRight: 0,\n        borderLeft: `1px solid ${theme.colors.borderDecorative}`,\n        overflow: 'auto',\n        height: '100%',\n      }}\n      data-testid='preview-sidebar-content'\n    >\n      {content ? (\n        <>\n          <div\n            css={{\n              display: 'grid',\n              gridTemplateColumns: '1fr auto auto',\n              rowGap: theme.spacing.sm,\n              alignItems: 'center',\n            }}\n          >\n            {headerText && <Typography.Title level={4}>{headerText}</Typography.Title>}\n            {copyText && <CopyButton copyText={copyText} showLabel={false} icon={<CopyIcon />} />}\n            {onClose && <Button type='primary' icon={<CloseIcon />} onClick={onClose} />}\n          </div>\n          <div\n            css={{\n              // Preserve original line breaks\n              whiteSpace: 'pre-wrap',\n            }}\n          >\n            {content}\n          </div>\n        </>\n      ) : (\n        <div css={{ marginTop: theme.spacing.md }}>{empty}</div>\n      )}\n    </div>\n  );\n};\n","import type {\n  CellClickedEvent,\n  ColumnApi,\n  GridApi,\n  GridReadyEvent,\n  RowSelectedEvent,\n  SelectionChangedEvent,\n} from '@ag-grid-community/core';\nimport { Interpolation, Theme } from '@emotion/react';\nimport cx from 'classnames';\nimport React, { useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport { MLFlowAgGridLoader } from '../../../../../common/components/ag-grid/AgGridLoader';\nimport Utils from '../../../../../common/utils/Utils';\nimport {\n  ExperimentEntity,\n  UpdateExperimentSearchFacetsFn,\n  UpdateExperimentViewStateFn,\n  RunDatasetWithTags,\n} from '../../../../types';\n\nimport {\n  clearSearchExperimentsFacetsFilters,\n  isSearchFacetsFilterUsed,\n  SearchExperimentRunsFacetsState,\n} from '../../models/SearchExperimentRunsFacetsState';\nimport { SearchExperimentRunsViewState } from '../../models/SearchExperimentRunsViewState';\nimport {\n  EXPERIMENTS_DEFAULT_COLUMN_SETUP,\n  getFrameworkComponents,\n  getRowIsLoadMore,\n  getRowId,\n  useRunsColumnDefinitions,\n  getAdjustableAttributeColumns,\n} from '../../utils/experimentPage.column-utils';\nimport {\n  EXPERIMENT_RUNS_TABLE_ROW_HEIGHT,\n  RUNS_VISIBILITY_MODE,\n} from '../../utils/experimentPage.common-utils';\nimport { RunRowType } from '../../utils/experimentPage.row-types';\nimport { ExperimentRunsSelectorResult } from '../../utils/experimentRuns.selector';\nimport { createLoadMoreRow } from './cells/LoadMoreRowRenderer';\nimport { ExperimentViewRunsEmptyTable } from './ExperimentViewRunsEmptyTable';\nimport { ExperimentViewRunsTableAddColumnCTA } from './ExperimentViewRunsTableAddColumnCTA';\nimport { ExperimentViewRunsTableStatusBar } from './ExperimentViewRunsTableStatusBar';\nimport { shouldEnableExperimentDatasetTracking } from '../../../../../common/utils/FeatureUtils';\nimport { getDatasetsCellHeight } from './cells/DatasetsCellRenderer';\nimport { PreviewSidebar } from '../../../../../common/components/PreviewSidebar';\nimport { isCanonicalSortKeyOfType } from '../../utils/experimentPage.column-utils';\nimport { COLUMN_TYPES } from '../../../../constants';\nimport { Empty } from '@databricks/design-system';\nimport { FormattedMessage } from 'react-intl';\n\nconst ROW_HEIGHT = 32;\nconst ROW_BUFFER = 101; // How many rows to keep rendered, even ones not visible\n\nexport interface ExperimentViewRunsTableProps {\n  /**\n   * Actual set of prepared row data to be rendered\n   */\n  rowsData: RunRowType[];\n\n  /**\n   * Helper data set with metric, param and tag keys\n   */\n  runsData: ExperimentRunsSelectorResult;\n\n  experiments: ExperimentEntity[];\n  searchFacetsState: SearchExperimentRunsFacetsState;\n  viewState: SearchExperimentRunsViewState;\n  updateViewState: UpdateExperimentViewStateFn;\n  isLoading: boolean;\n  moreRunsAvailable: boolean;\n  updateSearchFacets: UpdateExperimentSearchFacetsFn;\n  onAddColumnClicked: () => void;\n  loadMoreRunsFunc: () => void;\n  onDatasetSelected?: (dataset: RunDatasetWithTags, run: RunRowType) => void;\n  expandRows: boolean;\n}\n\nexport const ExperimentViewRunsTable = React.memo(\n  ({\n    experiments,\n    searchFacetsState,\n    runsData,\n    isLoading,\n    moreRunsAvailable,\n    updateSearchFacets,\n    updateViewState,\n    onAddColumnClicked,\n    rowsData,\n    loadMoreRunsFunc,\n    onDatasetSelected,\n    expandRows,\n    viewState,\n  }: ExperimentViewRunsTableProps) => {\n    const { compareRunsMode } = searchFacetsState;\n    const isComparingRuns = compareRunsMode !== undefined;\n\n    const { paramKeyList, metricKeyList, tagsList } = runsData;\n\n    const [gridApi, setGridApi] = useState<GridApi>();\n    const [columnApi, setColumnApi] = useState<ColumnApi>();\n    const prevSelectRunUuids = useRef<string[]>([]);\n\n    const filteredTagKeys = useMemo(() => Utils.getVisibleTagKeyList(tagsList), [tagsList]);\n\n    const containerElement = useRef<HTMLDivElement>(null);\n    // Flag indicating if there are any rows that can be expanded\n    const expandersVisible = useMemo(\n      () => rowsData.some((row) => row.runDateAndNestInfo?.hasExpander),\n      [rowsData],\n    );\n\n    /**\n     * Updates selected rows in the view state\n     */\n    const onSelectionChange = useCallback(\n      ({ api }: SelectionChangedEvent) => {\n        const selectedUUIDs: string[] = api\n          .getSelectedRows()\n          // Filter out load more row as it's not a real run\n          .filter((row) => !row.isLoadMoreRow)\n          .map(({ runInfo }) => runInfo.run_uuid);\n        updateViewState({\n          runsSelected: selectedUUIDs.reduce(\n            (aggregate, curr) => ({ ...aggregate, [curr]: true }),\n            {},\n          ),\n        });\n        prevSelectRunUuids.current = selectedUUIDs;\n      },\n      [updateViewState],\n    );\n\n    /**\n     * A onRowSelected event handler that runs before onSelectionChange.\n     * It checks if the currently (de)selected row contains any children\n     * and if true, (de)select them as well.\n     */\n    const handleRowSelected = useCallback((event: RowSelectedEvent) => {\n      const selectedRunRows = event.api.getSelectedRows().filter((row) => !row.isLoadMoreRow);\n\n      // Let's check if the actual number of selected rows have changed\n      // to avoid empty runs\n      if (\n        prevSelectRunUuids.current &&\n        selectedRunRows.length !== prevSelectRunUuids.current.length\n      ) {\n        const isSelected = Boolean(event.node.isSelected());\n\n        // We will continue only if the selected row has properly set runDateInfo\n        const { runDateAndNestInfo } = event.data as RunRowType;\n        if (!runDateAndNestInfo) {\n          return;\n        }\n        const { isParent, expanderOpen, childrenIds } = runDateAndNestInfo;\n\n        // We will continue only if the selected row is a parent containing\n        // children and is actually expanded\n        if (isParent && expanderOpen && childrenIds) {\n          const childrenIdsToSelect = childrenIds;\n\n          event.api.forEachNode((node) => {\n            if (node.data?.isLoadMoreRow) {\n              return;\n            }\n            const { runInfo, runDateAndNestInfo: childRunDateInfo } = node.data as RunRowType;\n\n            const childrenRunUuid = runInfo.run_uuid;\n            if (childrenIdsToSelect.includes(childrenRunUuid)) {\n              // If we found children being parents, mark their children\n              // to be selected as well.\n              if (childRunDateInfo?.childrenIds) {\n                childrenIdsToSelect.push(...childRunDateInfo.childrenIds);\n              }\n\n              node.setSelected(isSelected, false, true);\n            }\n          });\n        }\n      }\n    }, []);\n\n    const onSortBy = useCallback(\n      (newOrderByKey: string, newOrderByAsc: boolean) => {\n        updateSearchFacets({ orderByKey: newOrderByKey, orderByAsc: newOrderByAsc });\n      },\n      [updateSearchFacets],\n    );\n\n    const toggleRowExpanded = useCallback(\n      (parentId: string) =>\n        updateSearchFacets(({ runsExpanded: currentRunsExpanded, ...state }) => ({\n          ...state,\n          runsExpanded: { ...currentRunsExpanded, [parentId]: !currentRunsExpanded[parentId] },\n        })),\n      [updateSearchFacets],\n    );\n\n    const togglePinnedRow = useCallback(\n      (uuid: string) => {\n        updateSearchFacets((existingFacets) => ({\n          ...existingFacets,\n          runsPinned: !existingFacets.runsPinned.includes(uuid)\n            ? [...existingFacets.runsPinned, uuid]\n            : existingFacets.runsPinned.filter((r) => r !== uuid),\n        }));\n        // In the next frame, redraw the toggled row in to update the hover state\n        // and tooltips so they won't dangle in the previous mouse position.\n        requestAnimationFrame(() => {\n          if (!gridApi) {\n            return;\n          }\n          const rowNode = gridApi.getRowNode(uuid);\n          if (rowNode) {\n            gridApi.redrawRows({ rowNodes: [rowNode] });\n          }\n        });\n      },\n      [gridApi, updateSearchFacets],\n    );\n\n    // This callback toggles visibility of runs: either all of them or a particular one\n    const toggleRowVisibility = useCallback(\n      // `runUuidOrToggle` param can be a run ID or a keyword value indicating that all/none should be hidden\n      (runUuidOrToggle: string) => {\n        updateSearchFacets((existingFacets) => {\n          if (runUuidOrToggle === RUNS_VISIBILITY_MODE.SHOWALL) {\n            // Case #1: Showing all runs by clearing `runsHidden` array\n            return {\n              ...existingFacets,\n              runsHidden: [],\n            };\n          } else if (runUuidOrToggle === RUNS_VISIBILITY_MODE.HIDEALL) {\n            // Case #2: Hiding all runs by fully populating `runsHidden` array\n            return {\n              ...existingFacets,\n              runsHidden: rowsData.map((r) => r.runUuid),\n            };\n          }\n\n          // Case #3: toggling particular run\n          const uuid = runUuidOrToggle;\n          return {\n            ...existingFacets,\n            runsHidden: !existingFacets.runsHidden.includes(uuid)\n              ? [...existingFacets.runsHidden, uuid]\n              : existingFacets.runsHidden.filter((r) => r !== uuid),\n          };\n        });\n      },\n      [updateSearchFacets, rowsData],\n    );\n\n    const gridReadyHandler = useCallback((params: GridReadyEvent) => {\n      setGridApi(params.api);\n      setColumnApi(params.columnApi);\n    }, []);\n\n    const columnDefs = useRunsColumnDefinitions({\n      searchFacetsState,\n      onSortBy,\n      onExpand: toggleRowExpanded,\n      compareExperiments: experiments.length > 1,\n      onTogglePin: togglePinnedRow,\n      onToggleVisibility: toggleRowVisibility,\n      metricKeyList,\n      paramKeyList,\n      tagKeyList: filteredTagKeys,\n      columnApi,\n      isComparingRuns,\n      onDatasetSelected,\n      expandRows,\n    });\n\n    useEffect(() => {\n      if (!gridApi) {\n        return;\n      }\n\n      if (isLoading) {\n        gridApi.showLoadingOverlay();\n      } else {\n        gridApi.hideOverlay();\n\n        // If there are more runs available in the API, append\n        // additional special row that will display \"Load more\" button\n        if (rowsData.length && moreRunsAvailable) {\n          gridApi.setRowData([...rowsData, createLoadMoreRow()]);\n          return;\n        }\n\n        gridApi.setRowData(rowsData);\n      }\n    }, [gridApi, rowsData, isLoading, moreRunsAvailable, loadMoreRunsFunc]);\n\n    // Count all columns available for selection\n    const allAvailableColumnsCount = useMemo(() => {\n      const attributeColumnCount = getAdjustableAttributeColumns(experiments.length > 1).length;\n\n      const valuesColumnCount = metricKeyList.length + paramKeyList.length + filteredTagKeys.length;\n\n      return attributeColumnCount + valuesColumnCount;\n    }, [experiments.length, filteredTagKeys.length, metricKeyList.length, paramKeyList.length]);\n\n    const hasSelectedAllColumns =\n      searchFacetsState.selectedColumns.length >= allAvailableColumnsCount;\n\n    const moreAvailableRunsTableColumnCount = Math.max(\n      0,\n      allAvailableColumnsCount - searchFacetsState.selectedColumns.length,\n    );\n\n    const displayAddColumnsCTA = !hasSelectedAllColumns && !isComparingRuns && rowsData.length > 0;\n\n    const allRunsCount = useMemo(\n      () =>\n        runsData.runInfos.filter(\n          (r) =>\n            searchFacetsState.runsPinned.includes(r.run_uuid) ||\n            runsData.runUuidsMatchingFilter.includes(r.run_uuid),\n        ).length,\n      [runsData, searchFacetsState.runsPinned],\n    );\n\n    useLayoutEffect(() => {\n      if (!gridApi) {\n        return;\n      }\n      // Each time we switch to \"compare runs\" mode, we should\n      // maximize columns so \"run name\" column will take up all remaining space\n      if (isComparingRuns) {\n        // Selection feature is not supported in compare runs mode so we should deselect all\n        gridApi.deselectAll();\n        gridApi.sizeColumnsToFit();\n      }\n      gridApi.resetRowHeights();\n    }, [gridApi, isComparingRuns]);\n\n    /**\n     * Function used by ag-grid to calculate each row's height.\n     * In this case, it's based on a datasets cell size.\n     */\n\n    const rowHeightGetterFn = useCallback(\n      // if is comparing runs, use the default row height\n      (row: { data: RunRowType }) => {\n        if (isComparingRuns || !expandRows) {\n          return EXPERIMENT_RUNS_TABLE_ROW_HEIGHT;\n        }\n        // if not comparing runs, use the datasets cell height\n        return getDatasetsCellHeight(searchFacetsState, row);\n      },\n      [searchFacetsState, isComparingRuns, expandRows],\n    );\n\n    useEffect(() => {\n      if (!shouldEnableExperimentDatasetTracking()) {\n        return;\n      }\n      // Enabling certain columns (datasets) will change our row height calculation,\n      // let's recalculate them\n      gridApi?.resetRowHeights();\n    }, [gridApi, searchFacetsState.selectedColumns, expandRows]);\n\n    const [sidebarPreviewData, setSidebarPreviewData] = useState<{\n      value: string;\n      header: string;\n    } | null>(null);\n\n    const handleCellClicked = useCallback(\n      ({ column, data, value }: CellClickedEvent) => {\n        const columnGroupId = column.getParent()?.getGroupId();\n        const shouldInvokePreviewSidebar =\n          columnGroupId === COLUMN_TYPES.METRICS || columnGroupId === COLUMN_TYPES.PARAMS;\n\n        if (shouldInvokePreviewSidebar) {\n          setSidebarPreviewData({\n            value,\n            header: `Run name: ${data.runName}, Column name: ${column.getColId()}`,\n          });\n          updateViewState({ previewPaneVisible: true });\n        }\n      },\n      [updateViewState],\n    );\n\n    const displayPreviewSidebar = !isComparingRuns && viewState.previewPaneVisible;\n\n    return (\n      <div\n        css={(theme) => ({\n          display: 'grid',\n          gridTemplateColumns: displayPreviewSidebar ? '1fr auto' : '1fr',\n          borderTop: `1px solid ${theme.colors.border}`,\n        })}\n      >\n        <div css={styles.tableAreaWrapper}>\n          <div\n            ref={containerElement}\n            className={cx('ag-theme-balham ag-grid-sticky', {\n              'ag-grid-expanders-visible': expandersVisible,\n            })}\n            css={styles.agGridOverrides}\n          >\n            <MLFlowAgGridLoader\n              defaultColDef={EXPERIMENTS_DEFAULT_COLUMN_SETUP}\n              columnDefs={columnDefs}\n              rowSelection='multiple'\n              onGridReady={gridReadyHandler}\n              onSelectionChanged={onSelectionChange}\n              getRowHeight={rowHeightGetterFn}\n              headerHeight={EXPERIMENT_RUNS_TABLE_ROW_HEIGHT}\n              onRowSelected={handleRowSelected}\n              suppressRowClickSelection\n              suppressColumnMoveAnimation\n              suppressScrollOnNewData\n              isFullWidthRow={getRowIsLoadMore}\n              fullWidthCellRenderer={'LoadMoreRowRenderer'}\n              fullWidthCellRendererParams={{ loadMoreRunsFunc }}\n              suppressFieldDotNotation\n              enableCellTextSelection\n              components={getFrameworkComponents()}\n              suppressNoRowsOverlay\n              loadingOverlayComponent='loadingOverlayComponent'\n              loadingOverlayComponentParams={{ showImmediately: true }}\n              getRowId={getRowId}\n              rowBuffer={ROW_BUFFER}\n              onCellClicked={handleCellClicked}\n            />\n            {displayAddColumnsCTA && (\n              <ExperimentViewRunsTableAddColumnCTA\n                gridContainerElement={containerElement.current}\n                isInitialized={Boolean(gridApi)}\n                onClick={onAddColumnClicked}\n                visible={!isLoading}\n                moreRunsAvailable={moreRunsAvailable}\n                moreAvailableRunsTableColumnCount={moreAvailableRunsTableColumnCount}\n              />\n            )}\n          </div>\n          {rowsData.length < 1 && !isLoading && (\n            <ExperimentViewRunsEmptyTable\n              onClearFilters={() => updateSearchFacets(clearSearchExperimentsFacetsFilters)}\n              isFiltered={isSearchFacetsFilterUsed(searchFacetsState)}\n            />\n          )}\n          <ExperimentViewRunsTableStatusBar allRunsCount={allRunsCount} isLoading={isLoading} />\n        </div>\n        {displayPreviewSidebar && (\n          <PreviewSidebar\n            content={sidebarPreviewData?.value}\n            copyText={sidebarPreviewData?.value}\n            headerText={sidebarPreviewData?.header}\n            onClose={() => updateViewState({ previewPaneVisible: false })}\n            empty={\n              <Empty\n                description={\n                  <FormattedMessage\n                    defaultMessage='Select a cell to display preview'\n                    description='Experiment page > table view > preview sidebar > nothing selected'\n                  />\n                }\n              />\n            }\n          />\n        )}\n      </div>\n    );\n  },\n);\n\n/**\n * Concrete named definitions for colors used in this agGrid\n */\nconst getGridColors = (theme: Theme) => ({\n  rowBackground: theme.colors.backgroundPrimary, // regular row background\n  rowBackgroundHover: `${theme.colors.grey600}0A`, // hovered row (4% opacity)\n  rowBackgroundSelected: `${theme.colors.grey600}14`, // selected row (8% opacity)\n  rowBackgroundHoverSelected: `${theme.colors.grey600}1F`, // selected and hovered row (12% opacity)\n  columnSortedBy: `${theme.colors.blue100}b3`, // selected and hovered row (12% opacity)\n  headerBackground: theme.colors.grey100,\n  headerTextColor: '#2E3840', // directly from Figma design\n  headerGroupTextColor: theme.colors.textSecondary, // directly from Figma design\n  borderColor: theme.colors.grey200, // border between header and content and scrollable areas\n  headerBorderColor: 'transparent', // borders inside the header\n  checkboxBorderColor: theme.colors.actionDefaultBorderDefault,\n  checkboxBorderColorChecked: theme.colors.backgroundPrimary,\n  checkboxBackgroundColorChecked: theme.colors.actionPrimaryBackgroundDefault,\n});\n\nconst styles = {\n  tableAreaWrapper: {\n    display: 'flex',\n    flexDirection: 'column' as const,\n    position: 'relative' as const,\n  },\n  agGridOverrides: (theme: Theme): Interpolation<Theme> => {\n    const gridColors = getGridColors(theme);\n    return {\n      height: '100%',\n      position: 'relative',\n      '&.ag-theme-balham': {\n        // Set up internal variable values\n        '--ag-border-color': gridColors.borderColor,\n        '--ag-row-border-color': gridColors.borderColor,\n        '--ag-odd-row-background-color': gridColors.rowBackground,\n        '--ag-row-hover-color': gridColors.rowBackgroundHover,\n        '--ag-selected-row-background-color': gridColors.rowBackgroundSelected,\n        '--ag-header-foreground-color': gridColors.headerTextColor,\n        '--ag-header-background-color': gridColors.headerBackground,\n\n        // Makes row header sticky\n        '&.ag-grid-sticky .ag-header': {\n          position: 'sticky',\n          top: 0,\n          zIndex: 1,\n        },\n        '&.ag-grid-sticky .ag-root': {\n          overflow: 'visible',\n        },\n        '&.ag-grid-sticky .ag-root-wrapper': {\n          border: '0',\n          borderRadius: '4px',\n          overflow: 'visible',\n        },\n\n        // Adds a static line between column group header row and column headers\n        '.ag-header::after': {\n          content: '\"\"',\n          position: 'absolute',\n          top: EXPERIMENT_RUNS_TABLE_ROW_HEIGHT,\n          left: 0,\n          right: 0,\n          height: 1,\n          backgroundColor: gridColors.borderColor,\n        },\n\n        // Line height for cell contents is the row height minus the border\n        '.ag-cell': {\n          // lineHeight: `min(var(--ag-line-height, ${ROW_HEIGHT - 2}px), ${ROW_HEIGHT - 2}px)`,\n          display: 'flex',\n          overflow: 'hidden',\n          '& > .ag-cell-wrapper': {\n            overflow: 'hidden',\n          },\n        },\n\n        // Padding fixes for the header (we use custom component)\n        '.ag-header-cell': {\n          padding: 0,\n        },\n        '.ag-header-cell .ag-checkbox': {\n          padding: '0 7px',\n          borderLeft: '1px solid transparent', // to match it with the cell sizing\n        },\n\n        '.ag-cell.is-ordered-by, .ag-header-cell > .is-ordered-by': {\n          backgroundColor: gridColors.columnSortedBy,\n        },\n        '.ag-header-row': {\n          '--ag-border-color': gridColors.headerBorderColor,\n        },\n        '.ag-header-row.ag-header-row-column-group': {\n          '--ag-header-foreground-color': gridColors.headerGroupTextColor,\n        },\n        '.ag-row.ag-row-selected.ag-row-hover': {\n          backgroundColor: gridColors.rowBackgroundHoverSelected,\n        },\n\n        // Hides resize guidelines when header is not hovered\n        '.ag-header:not(:hover) .ag-header-cell::after, .ag-header:not(:hover) .ag-header-group-cell::after':\n          {\n            opacity: 0,\n          },\n        '.ag-pinned-left-header': {\n          borderRight: 'none',\n        },\n\n        // Fixed for loading overlay, should be above \"load more\" button\n        '.ag-overlay-loading-wrapper': {\n          paddingTop: theme.spacing.md * 4,\n          alignItems: 'center',\n          zIndex: 2,\n        },\n        '.ag-overlay-loading-wrapper .ag-react-container': {\n          flex: 1,\n        },\n\n        // Adds border after the last column to separate contents from \"Add columns\" CTA\n        '.ag-center-cols-container': {\n          minHeight: 0,\n        },\n\n        '.ag-full-width-row': {\n          borderBottom: 0,\n          backgroundColor: 'transparent',\n          zIndex: 1,\n          '&.ag-row-hover': {\n            backgroundColor: 'transparent',\n          },\n        },\n\n        // Centers vertically and styles the checkbox cell\n        '.is-checkbox-cell': {\n          display: 'flex',\n          alignItems: 'center',\n          paddingLeft: 7, // will end up in 8px due to 1px of transparent border on the left\n          '.is-multiline-cell .ag-cell-value': {\n            height: '100%',\n          },\n        },\n\n        // Change appearance of the previewable cells\n        '.is-previewable-cell': {\n          cursor: 'pointer',\n        },\n\n        // Header checkbox cell will get the same background as header only if it's unchecked\n        '.ag-header-cell .ag-checkbox .ag-input-wrapper:not(.ag-indeterminate):not(.ag-checked)': {\n          '--ag-checkbox-background-color': gridColors.headerBackground,\n        },\n\n        // Distance from the checkbox to other icons (pin, visibility etc.)\n        '.ag-cell-wrapper .ag-selection-checkbox': {\n          marginRight: 20,\n        },\n\n        // Header and cell checkboxes will get same colors from the palette\n        '.is-checkbox-cell, .ag-header-cell .ag-checkbox': {\n          '.ag-checkbox-input-wrapper::after': {\n            color: gridColors.checkboxBorderColor,\n          },\n          '.ag-checkbox-input-wrapper.ag-checked': {\n            '--ag-checkbox-background-color': gridColors.checkboxBackgroundColorChecked,\n            '--ag-checkbox-checked-color': gridColors.checkboxBorderColorChecked,\n            '&::after': {\n              color: gridColors.checkboxBorderColorChecked,\n            },\n          },\n        },\n      },\n    };\n  },\n};\n","/**\n * Defines non-persistable, local state that\n * controls visibility of various UI elements in the\n * runs table and controls\n */\nexport class SearchExperimentRunsViewState {\n  /**\n   * Currently selected runs\n   */\n  runsSelected: Record<string, boolean> = {};\n\n  /**\n   * Currently hidden, selected child runs\n   */\n  hiddenChildRunsSelected: Record<string, boolean> = {};\n\n  /**\n   * Display \"select columns\" dropdown\n   */\n  columnSelectorVisible = false;\n\n  /**\n   * Display \"select columns\" dropdown\n   */\n  previewPaneVisible = false;\n\n  /**\n   * Determines if the experiment table is maximized\n   */\n  viewMaximized = false;\n\n  /**\n   * Persists controls state in the evaluation artifact compare mode\n   */\n  artifactViewState: {\n    selectedTables?: string[];\n    groupByCols?: string[];\n    outputColumn?: string;\n    intersectingOnly?: boolean;\n  } = {\n    selectedTables: [],\n    groupByCols: [],\n    outputColumn: '',\n    intersectingOnly: false,\n  };\n}\n","import type {\n  CompareRunsChartAxisDef,\n  CompareChartRunData,\n} from './charts/CompareRunsCharts.common';\nimport { getUUID } from '../../../common/utils/ActionUtils';\nimport { MetricEntitiesByName } from '../../types';\n\n/**\n * Enum for all recognized chart types used in compare runs\n */\nexport enum RunsCompareChartType {\n  BAR = 'BAR',\n  LINE = 'LINE',\n  SCATTER = 'SCATTER',\n  CONTOUR = 'CONTOUR',\n  PARALLEL = 'PARALLEL',\n}\n\n/**\n * Simple interface corresponding to `RunsCompareChartCard`.\n * Its role is to distinguish between stateful class instance and a simple POJO,\n * it is meant to be contained in a serializable, persisted state.\n */\nexport type SerializedRunsCompareCardConfigCard = RunsCompareCardConfig;\n\n/**\n * Main class used for represent a single configured chart card with its type, configuration options etc.\n * Meant to be extended by various chart type classes with `type` field being frozen to a single value.\n */\nexport abstract class RunsCompareCardConfig {\n  uuid?: string;\n  type: RunsCompareChartType = RunsCompareChartType.BAR;\n  runsCountToCompare?: number = 10;\n\n  constructor(uuid?: string) {\n    this.uuid = uuid;\n  }\n\n  /**\n   * Serializes chart entry, i.e. strips all unnecessary fields (and/or methods) so\n   * it can be saved in persistable memory.\n   */\n  static serialize(entity: Partial<RunsCompareCardConfig>): SerializedRunsCompareCardConfigCard {\n    // TODO: strip unnecessary fields if any\n    return (Object.keys(entity) as (keyof SerializedRunsCompareCardConfigCard)[]).reduce(\n      (result, key) => ({ ...result, [key]: entity[key] }),\n      {} as SerializedRunsCompareCardConfigCard,\n    );\n  }\n\n  /**\n   * Creates empty chart (card) config basing on a type.\n   * TODO: consume visible run set and determine best configuration of metrics, params etc.\n   */\n  static getEmptyChartCardByType(type: RunsCompareChartType, uuid?: string) {\n    if (type === RunsCompareChartType.BAR) {\n      return new RunsCompareBarCardConfig(uuid);\n    } else if (type === RunsCompareChartType.SCATTER) {\n      return new RunsCompareScatterCardConfig(uuid);\n    } else if (type === RunsCompareChartType.PARALLEL) {\n      return new RunsCompareParallelCardConfig(uuid);\n    } else if (type === RunsCompareChartType.LINE) {\n      return new RunsCompareLineCardConfig(uuid);\n    } else {\n      // Must be contour\n      return new RunsCompareContourCardConfig(uuid);\n    }\n  }\n\n  static getBaseChartConfigs(primaryMetricKey: string, primary_metric_data: MetricEntitiesByName) {\n    const resultChartSet: RunsCompareCardConfig[] = [];\n    const MAX_NUMBER_OF_METRICS_TO_RENDER = 30;\n    const MIN_NUMBER_OF_STEP_FOR_LINE_COMPARISON = 2;\n\n    const metricsToRender: Set<string> = new Set();\n    // Add primary_metric to render first\n    if (primaryMetricKey) {\n      metricsToRender.add(primaryMetricKey);\n    }\n\n    // Adding other metrics to render\n    for (const metricsKey of Object.keys(primary_metric_data)) {\n      metricsToRender.add(metricsKey);\n    }\n\n    // Render only first N metrics\n    const renderFirstNMetrics: string[] = [...metricsToRender].slice(\n      0,\n      MAX_NUMBER_OF_METRICS_TO_RENDER,\n    );\n\n    renderFirstNMetrics.forEach((metricsKey) => {\n      let chartType = RunsCompareChartType.BAR;\n      // If the metric has multiple epochs, add a line chart or else add a bar chart\n      if (\n        primary_metric_data[metricsKey]?.step !== undefined &&\n        primary_metric_data[metricsKey]?.step >= MIN_NUMBER_OF_STEP_FOR_LINE_COMPARISON\n      ) {\n        chartType = RunsCompareChartType.LINE;\n      }\n\n      // Add a bar metric chart only if at least one metric key is detected\n      resultChartSet.push({\n        ...RunsCompareCardConfig.getEmptyChartCardByType(chartType, getUUID()),\n        metricKey: metricsKey,\n      } as RunsCompareBarCardConfig);\n    });\n\n    resultChartSet.push(\n      RunsCompareCardConfig.getEmptyChartCardByType(RunsCompareChartType.PARALLEL, getUUID()),\n    );\n\n    return resultChartSet;\n  }\n}\n\n// TODO: add configuration fields relevant to scatter chart\nexport class RunsCompareScatterCardConfig extends RunsCompareCardConfig {\n  type: RunsCompareChartType.SCATTER = RunsCompareChartType.SCATTER;\n  xaxis: CompareRunsChartAxisDef = { key: '', type: 'METRIC' };\n  yaxis: CompareRunsChartAxisDef = { key: '', type: 'METRIC' };\n  runsCountToCompare = 100;\n}\n\n// TODO: add configuration fields relevant to line chart\nexport class RunsCompareLineCardConfig extends RunsCompareCardConfig {\n  type: RunsCompareChartType.LINE = RunsCompareChartType.LINE;\n\n  /**\n   * A metric key used for chart's X axis\n   */\n  metricKey = '';\n\n  /**\n   * Smoothness\n   */\n  lineSmoothness = 0;\n\n  /**\n   * Y axis mode\n   */\n  scaleType: 'linear' | 'log' = 'linear';\n\n  /**\n   * Choose X axis mode - numeric step or absolute time\n   */\n  xAxisKey: 'step' | 'time' = 'step';\n}\n\n// TODO: add configuration fields relevant to bar chart\nexport class RunsCompareBarCardConfig extends RunsCompareCardConfig {\n  type: RunsCompareChartType.BAR = RunsCompareChartType.BAR;\n\n  /**\n   * A metric key used for chart's X axis\n   */\n  metricKey = '';\n}\n\n// TODO: add configuration fields relevant to contour chart\nexport class RunsCompareContourCardConfig extends RunsCompareCardConfig {\n  type: RunsCompareChartType.CONTOUR = RunsCompareChartType.CONTOUR;\n  xaxis: CompareRunsChartAxisDef = { key: '', type: 'METRIC' };\n  yaxis: CompareRunsChartAxisDef = { key: '', type: 'METRIC' };\n  zaxis: CompareRunsChartAxisDef = { key: '', type: 'METRIC' };\n}\n\n// TODO: add configuration fields relevant to parallel coords chart\nexport class RunsCompareParallelCardConfig extends RunsCompareCardConfig {\n  type: RunsCompareChartType.PARALLEL = RunsCompareChartType.PARALLEL;\n  selectedParams: string[] = [];\n  selectedMetrics: string[] = [];\n}\n","var _path, _rect, _rect2, _rect3, _rect4;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nfunction SvgChartBar(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 18,\n    height: 16,\n    viewBox: \"0 0 18 16\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1 0.813599V15.1865H17\",\n    stroke: \"#A3AEB8\",\n    strokeLinecap: \"round\"\n  })), _rect || (_rect = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 3.16943,\n    y: 10.5763,\n    width: 2.16949,\n    height: 3.25424,\n    fill: \"#338ECC\"\n  })), _rect2 || (_rect2 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 6.42371,\n    y: 5.15259,\n    width: 2.16949,\n    height: 8.67797,\n    fill: \"#338ECC\"\n  })), _rect3 || (_rect3 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 9.67798,\n    y: 8.40686,\n    width: 2.16949,\n    height: 5.42373,\n    fill: \"#338ECC\"\n  })), _rect4 || (_rect4 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 12.9323,\n    y: 1.89832,\n    width: 2.16949,\n    height: 11.9322,\n    fill: \"#338ECC\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgChartBar);\nexport default __webpack_public_path__ + \"static/media/chart-bar.0fd4a63680fba840a7b69fbf07969f79.svg\";\nexport { ForwardRef as ReactComponent };","var _path, _path2, _path3;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nfunction SvgChartContour(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 18,\n    height: 18,\n    viewBox: \"0 0 18 18\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1 1V17H17\",\n    stroke: \"#A3AEB8\",\n    strokeLinecap: \"round\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M12.9749 4.94148C12.9188 4.71702 12.221 4.73284 12.0618 4.71515C11.1779 4.61693 10.2817 4.66052 9.39271 4.66052C8.11919 4.66052 7.15648 4.97961 6.24753 5.90922C5.86197 6.30355 5.5235 6.77684 5.23295 7.24378C4.99434 7.62726 4.65544 7.93479 4.40569 8.31299C3.93777 9.02154 3.56281 9.80723 3.56281 10.6699C3.56281 11.1806 3.37479 11.598 3.76962 12.0669C4.19449 12.5714 4.6863 12.9507 5.27978 13.2649C5.88594 13.5858 6.42202 13.8619 7.13723 13.8619C7.74338 13.8619 8.34952 13.8619 8.95567 13.8619C9.45735 13.8619 9.96042 13.8731 10.4619 13.8619C11.1412 13.8468 11.9484 13.1895 12.413 12.7381C13.581 11.6035 14.2393 9.88016 14.2393 8.24665C14.2393 7.69923 14.3797 7.17063 14.3797 6.62723C14.3797 6.40084 14.4779 5.87696 14.2744 5.71411C13.9268 5.43606 13.5785 5.13789 13.1857 4.94148\",\n    stroke: \"#338ECC\",\n    strokeLinecap: \"round\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M11.9213 6.83789C11.2761 6.83789 10.6309 6.83789 9.98577 6.83789C9.19776 6.83789 8.80182 7.44144 8.2844 7.97734C7.58163 8.70521 7.28544 9.67306 7.28544 10.666C7.28544 10.9641 7.22004 11.177 7.46104 11.3645C7.6831 11.5372 8.10719 11.6142 8.37806 11.6142C9.07316 11.6142 9.91042 11.5583 10.4462 11.0523C10.9277 10.5975 11.473 10.3701 11.8159 9.75284C12.045 9.34042 12.2022 8.86324 12.2022 8.38317C12.2022 8.14903 12.2022 7.9149 12.2022 7.68077C12.2022 7.4241 12.0208 7.38817 11.9213 7.18909\",\n    stroke: \"#338ECC\",\n    strokeLinecap: \"round\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgChartContour);\nexport default __webpack_public_path__ + \"static/media/chart-contour.0d4b306f2669f3ad25375568935e3ce3.svg\";\nexport { ForwardRef as ReactComponent };","var _path, _path2;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nfunction SvgChartLine(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 22,\n    height: 22,\n    viewBox: \"0 0 22 22\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M4.38977 15.717L8.79655 10.8113L12.5254 14.9622L19.644 7.03772\",\n    stroke: \"#338ECC\",\n    strokeWidth: 2,\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1 1V21H21\",\n    stroke: \"#A3AEB8\",\n    strokeLinecap: \"round\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgChartLine);\nexport default __webpack_public_path__ + \"static/media/chart-line.0adaa2036bb4eb5956db6d0c7e925a3d.svg\";\nexport { ForwardRef as ReactComponent };","var _path, _path2, _path3, _path4, _path5;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nfunction SvgChartParallel(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 18,\n    height: 18,\n    viewBox: \"0 0 18 18\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1 1V17H17\",\n    stroke: \"#A3AEB8\",\n    strokeLinecap: \"round\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M4.21875 3.58289C4.55663 3.58289 4.88067 3.68935 5.21469 3.73008C5.6474 3.78285 6.02137 3.96513 6.37191 4.21552C6.76902 4.49917 7.0271 4.74589 7.24101 5.18954C7.44337 5.60925 7.59378 6.06989 7.72958 6.51432C7.86002 6.94121 8.09708 7.33726 8.19153 7.77803C8.25347 8.0671 8.34514 8.32427 8.44678 8.60015C8.58028 8.96252 8.80086 9.27915 8.96667 9.62583C9.15145 10.0122 9.216 10.4461 9.34876 10.8551C9.57831 11.5623 9.91132 12.4763 10.7205 12.6731C11.4284 12.8453 12.1459 12.8845 12.8705 12.8845C13.0981 12.8845 13.3979 12.898 13.5831 12.7499C13.6402 12.7042 13.7451 12.6907 13.8164 12.6591C13.8752 12.6329 14.0919 12.5871 14.1123 12.5463\",\n    stroke: \"#CCE3F2\",\n    strokeLinecap: \"round\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M4.16162 12.9805C4.32512 12.9805 4.4895 12.9859 4.65284 12.9805C4.84076 12.9742 5.0468 12.7952 5.2099 12.707C5.62236 12.4841 5.99426 12.0648 6.24299 11.6739C6.49491 11.2781 6.8776 10.9871 7.0887 10.5649C7.27767 10.187 7.50992 9.80749 7.73691 9.45078C7.93911 9.13304 8.10211 8.77722 8.28637 8.44554C8.43088 8.18544 8.45 7.88672 8.60542 7.62768C8.94898 7.05509 9.16215 6.418 9.45873 5.82484C9.72614 5.29001 9.96898 4.82426 10.4159 4.42207C10.5753 4.27853 10.8984 4.21824 11.0995 4.14861C11.3303 4.06873 11.579 4.02714 11.8136 3.93592C12.0394 3.84807 12.2521 3.84383 12.4795 3.77386C12.6993 3.70623 12.9319 3.63713 13.1632 3.63713C13.5192 3.63713 13.9089 3.59155 14.2798 3.59155\",\n    stroke: \"#CCE3F2\",\n    strokeLinecap: \"round\"\n  })), _path4 || (_path4 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M3.79248 2.74207V13.8225\",\n    stroke: \"#338ECC\",\n    strokeLinecap: \"round\"\n  })), _path5 || (_path5 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M14.873 3.04419V13.7217\",\n    stroke: \"#338ECC\",\n    strokeLinecap: \"round\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgChartParallel);\nexport default __webpack_public_path__ + \"static/media/chart-parallel.da7dedf539b2af4b654d377c679173e4.svg\";\nexport { ForwardRef as ReactComponent };","var _path, _circle, _ellipse, _circle2, _circle3, _ellipse2, _ellipse3;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nfunction SvgChartScatter(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 18,\n    height: 16,\n    viewBox: \"0 0 18 16\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1 0.813599V15.1865H17\",\n    stroke: \"#A3AEB8\",\n    strokeLinecap: \"round\"\n  })), _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 3.98301,\n    cy: 12.4746,\n    r: 1.35593,\n    fill: \"#338ECC\"\n  })), _ellipse || (_ellipse = /*#__PURE__*/React.createElement(\"ellipse\", {\n    cx: 9.40684,\n    cy: 10.8475,\n    rx: 1.35593,\n    ry: 1.35593,\n    fill: \"#338ECC\"\n  })), _circle2 || (_circle2 = /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 5.6102,\n    cy: 8.1356,\n    r: 1.35593,\n    fill: \"#338ECC\",\n    fillOpacity: 0.25\n  })), _circle3 || (_circle3 = /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 9.40684,\n    cy: 6.50852,\n    r: 1.35593,\n    fill: \"#338ECC\"\n  })), _ellipse2 || (_ellipse2 = /*#__PURE__*/React.createElement(\"ellipse\", {\n    cx: 13.7457,\n    cy: 5.96616,\n    rx: 1.35593,\n    ry: 1.35593,\n    fill: \"#338ECC\",\n    fillOpacity: 0.25\n  })), _ellipse3 || (_ellipse3 = /*#__PURE__*/React.createElement(\"ellipse\", {\n    cx: 16.4576,\n    cy: 2.46128,\n    rx: 1.35593,\n    ry: 1.35593,\n    fill: \"#338ECC\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgChartScatter);\nexport default __webpack_public_path__ + \"static/media/chart-scatter.69118d0023a6ff3973f7fa913834ac47.svg\";\nexport { ForwardRef as ReactComponent };","import { Button, DropdownMenu, PlusIcon } from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\n\nimport { ReactComponent as ChartBarIcon } from '../../../common/static/chart-bar.svg';\nimport { ReactComponent as ChartContourIcon } from '../../../common/static/chart-contour.svg';\nimport { ReactComponent as ChartLineIcon } from '../../../common/static/chart-line.svg';\nimport { ReactComponent as ChartParallelIcon } from '../../../common/static/chart-parallel.svg';\nimport { ReactComponent as ChartScatterIcon } from '../../../common/static/chart-scatter.svg';\nimport { RunsCompareChartType } from './runs-compare.types';\n\nexport interface RunsCompareAddChartMenuProps {\n  onAddChart: (type: RunsCompareChartType) => void;\n}\n\nexport const RunsCompareAddChartMenu = ({ onAddChart }: RunsCompareAddChartMenuProps) => {\n  return (\n    <DropdownMenu.Root modal={false}>\n      <DropdownMenu.Trigger asChild>\n        <Button\n          css={styles.addChartButton}\n          icon={<PlusIcon />}\n          data-testid='experiment-view-compare-runs-add-chart'\n        >\n          Add chart\n        </Button>\n      </DropdownMenu.Trigger>\n      <DropdownMenu.Content align='end'>\n        <DropdownMenu.Item\n          onClick={() => onAddChart(RunsCompareChartType.BAR)}\n          data-testid='experiment-view-compare-runs-chart-type-bar'\n        >\n          <DropdownMenu.IconWrapper css={styles.iconWrapper}>\n            <ChartBarIcon />\n          </DropdownMenu.IconWrapper>\n          Bar chart\n        </DropdownMenu.Item>\n        <DropdownMenu.Item\n          onClick={() => onAddChart(RunsCompareChartType.LINE)}\n          data-testid='experiment-view-compare-runs-chart-type-line'\n        >\n          <DropdownMenu.IconWrapper css={styles.iconWrapper}>\n            <ChartLineIcon />\n          </DropdownMenu.IconWrapper>\n          Line chart\n        </DropdownMenu.Item>\n        <DropdownMenu.Item\n          onClick={() => onAddChart(RunsCompareChartType.PARALLEL)}\n          data-testid='experiment-view-compare-runs-chart-type-parallel'\n        >\n          <DropdownMenu.IconWrapper css={styles.iconWrapper}>\n            <ChartParallelIcon />\n          </DropdownMenu.IconWrapper>\n          Parallel coordinates\n        </DropdownMenu.Item>\n        <DropdownMenu.Item\n          onClick={() => onAddChart(RunsCompareChartType.SCATTER)}\n          data-testid='experiment-view-compare-runs-chart-type-scatter'\n        >\n          <DropdownMenu.IconWrapper css={styles.iconWrapper}>\n            <ChartScatterIcon />\n          </DropdownMenu.IconWrapper>\n          Scatter chart\n        </DropdownMenu.Item>\n        <DropdownMenu.Item\n          onClick={() => onAddChart(RunsCompareChartType.CONTOUR)}\n          data-testid='experiment-view-compare-runs-chart-type-contour'\n        >\n          <DropdownMenu.IconWrapper css={styles.iconWrapper}>\n            <ChartContourIcon />\n          </DropdownMenu.IconWrapper>\n          Contour chart\n        </DropdownMenu.Item>\n      </DropdownMenu.Content>\n    </DropdownMenu.Root>\n  );\n};\n\nconst styles = {\n  addChartButton: (theme: Theme) => ({\n    // Overriden while waiting for design decision in DuBois (FEINF-1711)\n    backgroundColor: `${theme.colors.backgroundPrimary} !important`,\n  }),\n  iconWrapper: (theme: Theme) => ({\n    width: theme.general.iconSize + theme.spacing.xs,\n  }),\n};\n","import type { PlotMouseEvent } from 'plotly.js';\nimport { useEffect, useRef } from 'react';\n\n/**\n * Unfortunately plotly.js memorizes first onHover callback given on initial render,\n * so in order to achieve updated behavior we need to wrap each onHover callback with an\n * immutable callback that will call mutable implementation.\n */\nexport const useMutableHoverCallback = <T extends (event: Readonly<PlotMouseEvent>) => void>(\n  callback: T,\n) => {\n  const mutableRef = useRef<T>(callback);\n\n  useEffect(() => {\n    mutableRef.current = callback;\n  }, [callback]);\n\n  return (event: Readonly<PlotMouseEvent>) => {\n    mutableRef.current(event);\n  };\n};\n","import { useEffect, useMemo, useState } from 'react';\nimport { CompareChartRunData } from '../charts/CompareRunsCharts.common';\n\n/**\n * Function used to highlight particular trace in the compare runs chart,\n * for both hover and select scenarios.\n * Since implementation varies across chart types, the function is curryable where\n * two first-level parameters determine the target SVG selector paths to the trace within\n * target chart type.\n *\n * @param traceSelector selector path to the trace for a particular chart type\n * @param parentSelector selector path to the traces container for a particular chart type\n */\nconst highlightChartTracesFn =\n  (traceSelector: string, parentSelector: string) =>\n  /**\n   * @param parent a HTML element containing the chart\n   * @param hoverIndex index of a trace that should be hover-higlighted, set -1 to remove highlight\n   * @param selectIndex index of a trace that should be select-higlighted, set -1 to remove highlight\n   */\n  (parent: HTMLElement, hoverIndex: number, selectIndex: number) => {\n    const deselected = hoverIndex === -1 && selectIndex === -1;\n\n    parent.querySelector('.is-hover-highlight')?.classList.remove('is-hover-highlight');\n    if (hoverIndex > -1) {\n      parent.querySelectorAll(traceSelector)[hoverIndex]?.classList.add('is-hover-highlight');\n    }\n\n    parent.querySelector('.is-selection-highlight')?.classList.remove('is-selection-highlight');\n    if (selectIndex > -1) {\n      parent.querySelectorAll(traceSelector)[selectIndex]?.classList.add('is-selection-highlight');\n    }\n\n    if (deselected) {\n      parent.querySelector(parentSelector)?.classList.remove('is-highlight');\n    } else {\n      parent.querySelector(parentSelector)?.classList.add('is-highlight');\n    }\n  };\n\n/**\n * Type-specific implementation of highlightChartTracesFn for bar charts\n */\nexport const highlightBarTraces = highlightChartTracesFn('svg .trace.bars g.point', '.trace.bars');\n\n/**\n * Type-specific implementation of highlightChartTracesFn for line charts\n */\nexport const highlightLineTraces = highlightChartTracesFn(\n  'svg .scatterlayer g.trace',\n  '.scatterlayer',\n);\n\n/**\n * Type-specific implementation of highlightChartTracesFn for scatter and contour charts\n */\nexport const highlightScatterTraces = highlightChartTracesFn(\n  'svg .scatterlayer path.point',\n  '.trace.scatter',\n);\n\n/**\n * This hook houses and exports various mechanisms necessary for highlighting traces\n * in compare runs charts.\n *\n * @param containerDiv HTML element containing the chart\n * @param selectedRunUuid currently selected run UUID (set to -1 if none)\n * @param runsData array containing run informations, should be the same order as provided to the chart\n * @param highlightFn a styling function that will be called when the trace should be (un)highlighted, please refer to `highlightCallbackFn()`\n */\nexport const useCompareRunsTraceHighlight = (\n  containerDiv: HTMLElement | null,\n  selectedRunUuid: string | null | undefined,\n  runsData: Pick<CompareChartRunData, 'runInfo'>[],\n  highlightFn: ReturnType<typeof highlightChartTracesFn>,\n) => {\n  const selectedTraceIndex = useMemo(() => {\n    if (!containerDiv) {\n      return -1;\n    }\n    return runsData.findIndex((x) => x.runInfo.run_uuid === selectedRunUuid);\n  }, [runsData, containerDiv, selectedRunUuid]);\n\n  const [hoveredPointIndex, setHoveredPointIndex] = useState(-1);\n\n  useEffect(() => {\n    if (!containerDiv) {\n      return;\n    }\n    highlightFn(containerDiv, hoveredPointIndex, selectedTraceIndex);\n  }, [highlightFn, containerDiv, selectedTraceIndex, hoveredPointIndex]);\n\n  return { selectedTraceIndex, hoveredPointIndex, setHoveredPointIndex };\n};\n","import { Config, Data, Layout } from 'plotly.js';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useIntl } from 'react-intl';\nimport { LazyPlot } from '../../LazyPlot';\nimport { useMutableHoverCallback } from '../hooks/useMutableHoverCallback';\nimport {\n  highlightBarTraces,\n  useCompareRunsTraceHighlight,\n} from '../hooks/useCompareRunsTraceHighlight';\nimport {\n  commonRunsChartStyles,\n  CompareChartRunData,\n  compareRunsChartDefaultMargin,\n  compareRunsChartHoverlabel,\n  CompareRunsCommonPlotProps,\n  normalizeChartValue,\n  useDynamicPlotSize,\n} from './CompareRunsCharts.common';\n\n// We're not using params in bar plot\nexport type CompareChartBarPlotRunData = Omit<CompareChartRunData, 'params'>;\n\nexport interface CompareRunsMetricsBarPlotProps extends CompareRunsCommonPlotProps {\n  /**\n   * Determines which metric are we comparing by\n   */\n  metricKey: string;\n\n  /**\n   * Array of runs data with corresponding values\n   */\n  runsData: CompareChartBarPlotRunData[];\n\n  /**\n   * Relative width of the plot bar\n   */\n  barWidth?: number;\n\n  /**\n   * Display run names on the Y axis\n   */\n  displayRunNames?: boolean;\n\n  /**\n   * Display metric key on the X axis\n   */\n  displayMetricKey?: boolean;\n}\n\nconst PLOT_CONFIG: Partial<Config> = {\n  displaylogo: false,\n  scrollZoom: true,\n  doubleClick: 'autosize',\n  showTips: false,\n};\n\nexport const Y_AXIS_PARAMS = {\n  ticklabelposition: 'inside',\n  tickfont: { size: 11 },\n  fixedrange: true,\n};\n\nconst getFixedPointValue = (val: string | number, places = 2) =>\n  typeof val === 'number' ? val.toFixed(places) : val;\n\n/**\n * Implementation of plotly.js chart displaying\n * bar plot comparing metrics for a given\n * set of experiments runs\n */\nexport const CompareRunsMetricsBarPlot = React.memo(\n  ({\n    runsData,\n    metricKey,\n    className,\n    margin = compareRunsChartDefaultMargin,\n    onUpdate,\n    onHover,\n    onUnhover,\n    barWidth = 1 / 2,\n    width,\n    height,\n    displayRunNames = true,\n    useDefaultHoverBox = true,\n    displayMetricKey = true,\n    selectedRunUuid,\n  }: CompareRunsMetricsBarPlotProps) => {\n    const plotData = useMemo(() => {\n      // Run uuids\n      const ids = runsData.map((d) => d.runInfo.run_uuid);\n\n      // Actual metric values\n      const values = runsData.map((d) => normalizeChartValue(d.metrics[metricKey]?.value));\n\n      // Displayed metric values\n      const textValues = runsData.map((d) => getFixedPointValue(d.metrics[metricKey]?.value));\n\n      // Colors corresponding to each run\n      const colors = runsData.map((d) => d.color);\n\n      // Check if containing negatives to adjust rendering labels relative to axis\n      const containsNegatives = values.some(\n        (v) =>\n          v &&\n          // @ts-expect-error TODO: fix this\n          // Operator '<' cannot be applied to types 'string | number' and 'number'.ts(2365)\n          v < 0,\n      );\n\n      return [\n        {\n          y: ids,\n          x: values,\n          text: textValues,\n          textposition: containsNegatives ? 'auto' : 'outside',\n          textfont: {\n            size: 11,\n          },\n          // Display run name on hover. \"<extra></extra>\" removes plotly's \"extra\" tooltip that\n          // is unnecessary here.\n          type: 'bar' as any,\n          hovertemplate: useDefaultHoverBox ? '%{label}<extra></extra>' : undefined,\n          hoverinfo: useDefaultHoverBox ? 'y' : 'none',\n          hoverlabel: useDefaultHoverBox ? compareRunsChartHoverlabel : undefined,\n          width: barWidth,\n          orientation: 'h',\n          marker: {\n            color: colors,\n          },\n        } as Data,\n      ];\n    }, [runsData, metricKey, barWidth, useDefaultHoverBox]);\n\n    const { layoutHeight, layoutWidth, setContainerDiv, containerDiv, isDynamicSizeSupported } =\n      useDynamicPlotSize();\n\n    const { formatMessage } = useIntl();\n\n    const [layout, setLayout] = useState<Partial<Layout>>({\n      width: width || layoutWidth,\n      height: height || layoutHeight,\n      margin,\n      xaxis: { title: displayMetricKey ? metricKey : undefined },\n      yaxis: {\n        showticklabels: displayRunNames,\n        title: displayRunNames\n          ? formatMessage({\n              defaultMessage: 'Run name',\n              description: 'Label for Y axis in bar chart when comparing metrics between runs',\n            })\n          : undefined,\n        tickfont: { size: 11 },\n        fixedrange: true,\n      },\n    });\n\n    useEffect(() => {\n      setLayout((current) => ({\n        ...current,\n        width: width || layoutWidth,\n        height: height || layoutHeight,\n        margin,\n        xaxis: {\n          ...current.xaxis,\n          title: displayMetricKey ? metricKey : undefined,\n        },\n      }));\n    }, [layoutWidth, layoutHeight, margin, metricKey, width, height, displayMetricKey]);\n\n    const { setHoveredPointIndex } = useCompareRunsTraceHighlight(\n      containerDiv,\n      selectedRunUuid,\n      runsData,\n      highlightBarTraces,\n    );\n\n    const hoverCallback = useCallback(\n      ({ points, event }) => {\n        setHoveredPointIndex(points[0]?.pointIndex ?? -1);\n\n        const runUuid = points[0]?.label;\n        if (runUuid) {\n          onHover?.(runUuid, event);\n        }\n      },\n      [onHover, setHoveredPointIndex],\n    );\n\n    const unhoverCallback = useCallback(() => {\n      onUnhover?.();\n      setHoveredPointIndex(-1);\n    }, [onUnhover, setHoveredPointIndex]);\n\n    /**\n     * Unfortunately plotly.js memorizes first onHover callback given on initial render,\n     * so in order to achieve updated behavior we need to wrap its most recent implementation\n     * in the immutable callback.\n     */\n    const mutableHoverCallback = useMutableHoverCallback(hoverCallback);\n\n    return (\n      <div\n        css={[commonRunsChartStyles.chartWrapper, styles.highlightStyles]}\n        className={className}\n        ref={setContainerDiv}\n      >\n        <LazyPlot\n          data={plotData}\n          useResizeHandler={!isDynamicSizeSupported}\n          css={commonRunsChartStyles.chart}\n          onUpdate={onUpdate}\n          layout={layout}\n          config={PLOT_CONFIG}\n          onHover={mutableHoverCallback}\n          onUnhover={unhoverCallback}\n        />\n      </div>\n    );\n  },\n);\n\nconst styles = {\n  highlightStyles: {\n    '.trace.bars g.point path': {\n      transition: 'var(--trace-transition)',\n    },\n    '.trace.bars.is-highlight g.point path': {\n      opacity: 'var(--trace-opacity-dimmed-high) !important',\n    },\n    '.trace.bars g.point.is-hover-highlight path': {\n      opacity: 'var(--trace-opacity-highlighted) !important',\n    },\n    '.trace.bars g.point.is-selection-highlight path': {\n      opacity: 'var(--trace-opacity-highlighted) !important',\n      stroke: 'var(--trace-stroke-color)',\n      strokeWidth: 'var(--trace-stroke-width) !important',\n    },\n  },\n};\n","import { Interpolation, Theme } from '@emotion/react';\nimport React, {\n  useCallback,\n  useContext,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nexport interface CompareRunsTooltipBodyProps<TContext = any, THover = any> {\n  runUuid: string;\n  additionalAxisData?: any;\n  hoverData: THover;\n  contextData: TContext;\n  closeContextMenu: () => void;\n  isHovering?: boolean;\n}\n\nexport type CompareRunsTooltipBodyComponent<C = any, T = any> = React.ComponentType<\n  CompareRunsTooltipBodyProps<C, T>\n>;\n\nconst CompareRunsTooltipContext = React.createContext<{\n  selectedRunUuid: string | null;\n  closeContextMenu: () => void;\n  resetTooltip: () => void;\n  updateTooltip: (\n    runUuid: string,\n    hoverData?: any,\n    event?: MouseEvent,\n    additionalData?: any,\n  ) => void;\n} | null>(null);\n\nexport enum ContextMenuVisibility {\n  HIDDEN,\n  HOVER,\n  VISIBLE,\n}\n\n/**\n * Extract first ancestor HTML element in the hierarchy, even if the target is an SVG element.\n * Necessary for proper behavior of '.contains()'\n */\nconst extractHTMLAncestorElement = (element: Element | EventTarget | null) => {\n  if (element === null || !(element instanceof Element)) {\n    return null;\n  }\n  if (element instanceof HTMLElement) {\n    return element;\n  }\n\n  let currentElement: Element | null = element;\n  while (currentElement && !(currentElement instanceof HTMLElement)) {\n    currentElement = currentElement.parentElement;\n  }\n\n  return currentElement;\n};\n\n/**\n * Context and DOM container necessary for chart context menu to work.\n * Can wrap multiple charts.\n */\nexport const CompareRunsTooltipWrapper = <\n  // Type for the context data passed to the tooltip, e.g. list of all runs\n  TContext = any,\n  // Type for local hover data passed to the tooltip, e.g. configuration of particular chart\n  THover = any,\n>({\n  className,\n  children,\n  contextData,\n  component: Component,\n  hoverOnly = false,\n}: React.PropsWithChildren<{\n  className?: string;\n  contextData: TContext;\n  component: React.ComponentType<CompareRunsTooltipBodyProps<TContext, THover>>;\n  hoverOnly?: boolean;\n}>) => {\n  // A reference to the viewport-wide element containing the context menu\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // A reference to the tooltip/context-menu element\n  const ctxMenuRef = useRef<HTMLDivElement>(null);\n\n  // Mutable value containing current mouse position\n  const currentPos = useRef<{ x: number; y: number }>({ x: 0, y: 0 });\n\n  // Current visibility of the tooltip/context-menu\n  const [contextMenuShown, setContextMenuShown] = useState<ContextMenuVisibility>(\n    ContextMenuVisibility.HIDDEN,\n  );\n\n  const [tooltipDisplayParams, setTooltipDisplayParams] = useState<any | null>(null);\n  const [hoveredRunUuid, setHoveredRunUuid] = useState<string>('');\n\n  // Apart from run uuid, It's also possible to set bonus axis data (helpful for line charts with data lineage)\n  const [additionalAxisData, setAdditionalAxisData] = useState<any>(null);\n\n  // Stores data about the run that has been clicked, but mouse has not been released.\n  const focusedRunData = useRef<{ x: number; y: number; runUuid: string } | null>(null);\n\n  // Mutable version of certain state values, used in processes outside the React event lifecycle\n  const mutableContextMenuShownRef = useRef<ContextMenuVisibility>(contextMenuShown);\n  const mutableHoveredRunUuid = useRef(hoveredRunUuid);\n  const mutableTooltipDisplayParams = useRef(tooltipDisplayParams);\n\n  // This method applies the tooltip position basing on the mouse position\n  const applyPositioning = useCallback(() => {\n    if (!ctxMenuRef.current || !containerRef.current) {\n      return;\n    }\n\n    let targetX = currentPos.current.x;\n    let targetY = currentPos.current.y;\n\n    const menuRect = ctxMenuRef.current.getBoundingClientRect();\n    const containerRect = containerRef.current.getBoundingClientRect();\n\n    if (currentPos.current.x + menuRect.width >= containerRect.width) {\n      targetX -= menuRect.width;\n    }\n\n    if (currentPos.current.y + menuRect.height >= containerRect.height) {\n      targetY -= menuRect.height;\n    }\n    ctxMenuRef.current.style.left = '0px';\n    ctxMenuRef.current.style.top = '0px';\n    ctxMenuRef.current.style.transform = `translate3d(${targetX + 1}px, ${targetY + 1}px, 0)`;\n  }, []);\n\n  // Save mutable visibility each time a stateful one changes\n  useEffect(() => {\n    mutableContextMenuShownRef.current = contextMenuShown;\n  }, [contextMenuShown]);\n\n  // This function returns X and Y of the target element relative to the container\n  const getCoordinatesForTargetElement = useCallback(\n    (targetElement: HTMLElement, event: MouseEvent) => {\n      const targetRect = targetElement.getBoundingClientRect();\n      const containerRect = containerRef.current?.getBoundingClientRect() || { left: 0, top: 0 };\n      const x = event.offsetX + (targetRect.left - containerRect.left);\n      const y = event.offsetY + (targetRect.top - containerRect.top);\n      return { x, y };\n    },\n    [],\n  );\n\n  const mouseMove: React.MouseEventHandler<HTMLDivElement> = useCallback(\n    (event) => {\n      // Apply only if the tooltip is in the hover mode\n      if (\n        mutableContextMenuShownRef.current === ContextMenuVisibility.HOVER &&\n        ctxMenuRef.current &&\n        containerRef.current\n      ) {\n        focusedRunData.current = null;\n        const targetElement = extractHTMLAncestorElement(event.target);\n        if (targetElement) {\n          currentPos.current = getCoordinatesForTargetElement(targetElement, event.nativeEvent);\n          applyPositioning();\n        }\n      }\n    },\n    [applyPositioning, getCoordinatesForTargetElement],\n  );\n\n  // This callback is being fired on every new run being hovered\n  const updateTooltip = useCallback(\n    (runUuid: string, hoverData?: any, _?: Event, additionalRunData?: any) => {\n      mutableHoveredRunUuid.current = runUuid;\n      mutableTooltipDisplayParams.current = hoverData;\n\n      // If the tooltip is visible and hardwired to the position, don't change it\n      if (mutableContextMenuShownRef.current === ContextMenuVisibility.VISIBLE) {\n        return;\n      }\n\n      // Update the event-specific data in the state\n      setTooltipDisplayParams(hoverData);\n\n      // If the mouse button has been clicked on a run but hover\n      // has been lost, do nothing\n      if (!runUuid && focusedRunData.current?.runUuid) {\n        return;\n      }\n\n      // Update the currently hovered run\n      setHoveredRunUuid((currentRunUuid) => {\n        if (additionalRunData) {\n          setAdditionalAxisData(additionalRunData);\n        }\n        // If the tooltip was hidden or it's shown but it's another run,\n        // make sure that the state is updated\n        if (\n          mutableContextMenuShownRef.current === ContextMenuVisibility.HIDDEN ||\n          (mutableContextMenuShownRef.current === ContextMenuVisibility.HOVER &&\n            runUuid !== currentRunUuid)\n        ) {\n          setContextMenuShown(ContextMenuVisibility.HOVER);\n          return runUuid;\n        }\n        return currentRunUuid;\n      });\n    },\n    [],\n  );\n\n  const mouseDownCapture: React.MouseEventHandler<HTMLDivElement> = useCallback(\n    (event) => {\n      if (hoverOnly) {\n        return;\n      }\n      // Saves the current position and hovered run ID after lowering the mouse button,\n      // we use it afterwards to confirm that user has clicked on the same run and scrubbing/zooming\n      // didn't occur in the meanwhile\n      if (event.button === 0 && mutableHoveredRunUuid.current) {\n        focusedRunData.current = {\n          x: event.nativeEvent.pageX,\n          y: event.nativeEvent.pageY,\n          runUuid: mutableHoveredRunUuid.current,\n        };\n      }\n    },\n    [hoverOnly],\n  );\n\n  // Callback for the click event for the tooltip area, checks if context menu needs to be shown.\n  // We're not using `mouseup` because plotly.js hijacks the event by appending drag cover to the document on `mousedown`.\n  const tooltipAreaClicked: React.MouseEventHandler<HTMLDivElement> = useCallback(\n    (event) => {\n      // We're interested in displaying the context menu only if\n      // mouse is in the same position as when lowering the button,\n      // this way we won't display it when zooming on the chart.\n      if (\n        focusedRunData.current?.runUuid &&\n        event.nativeEvent.pageX === focusedRunData.current.x &&\n        event.nativeEvent.pageY === focusedRunData.current.y\n      ) {\n        // If the context menu is already visible, we need to reposition it and provide\n        // the updated run UUID\n        if (mutableContextMenuShownRef.current === ContextMenuVisibility.VISIBLE) {\n          setHoveredRunUuid(focusedRunData.current.runUuid);\n          const targetElement = extractHTMLAncestorElement(event.nativeEvent.target);\n          if (targetElement) {\n            currentPos.current = getCoordinatesForTargetElement(targetElement, event.nativeEvent);\n            applyPositioning();\n          }\n        } else {\n          // If the context menu was not visible before (it was a tooltip), just enable it.\n          setContextMenuShown(ContextMenuVisibility.VISIBLE);\n        }\n        event.stopPropagation();\n      }\n      // Since the mouse button is up, reset the currently focused run\n      focusedRunData.current = null;\n    },\n    [applyPositioning, getCoordinatesForTargetElement],\n  );\n\n  // Exposed function used to hide the context menu\n  const closeContextMenu = useCallback(() => setContextMenuShown(ContextMenuVisibility.HIDDEN), []);\n\n  // Set up main listeners in the useLayoutEffect hook\n  useLayoutEffect(() => {\n    if (!containerRef.current) {\n      return undefined;\n    }\n\n    // Find the DOM root - it can be either document or a shadow root\n    const domRoot = containerRef.current.getRootNode() as Document;\n\n    // This function is being called on every click in the document,\n    // it's used to dismiss the shown context menu\n    const rootClickListener = (e: MouseEvent) => {\n      // We're interested only in dismissing context menu mode, tooltip is fine\n      if (mutableContextMenuShownRef.current !== ContextMenuVisibility.VISIBLE) {\n        return;\n      }\n\n      const targetElement = extractHTMLAncestorElement(e.target);\n\n      if (!targetElement) {\n        return;\n      }\n\n      // Check if the click event occurred within the\n      // context menu\n      const contextMenuClicked =\n        targetElement instanceof HTMLElement &&\n        ctxMenuRef?.current instanceof HTMLElement &&\n        ctxMenuRef.current.contains(targetElement);\n\n      // Dismiss the context menu only if click didn't occur on\n      // the context menu content or on another run\n      if (!contextMenuClicked && !focusedRunData.current?.runUuid) {\n        setContextMenuShown(ContextMenuVisibility.HIDDEN);\n      }\n    };\n    domRoot.addEventListener('click', rootClickListener, { capture: true });\n\n    return () => {\n      domRoot.removeEventListener('click', rootClickListener, { capture: true });\n    };\n  }, [getCoordinatesForTargetElement, applyPositioning]);\n\n  // Callback used to reset the tooltip, fired when the mouse leaves the run\n  const resetTooltip = useCallback(() => {\n    mutableHoveredRunUuid.current = '';\n    if (\n      focusedRunData.current?.runUuid ||\n      mutableContextMenuShownRef.current === ContextMenuVisibility.VISIBLE\n    ) {\n      return;\n    }\n    setHoveredRunUuid('');\n    setContextMenuShown(ContextMenuVisibility.HIDDEN);\n  }, []);\n\n  // Export the currently selected run ID. Set to \"null\" if there is nothing selected.\n  const selectedRunUuid = useMemo(() => {\n    if (contextMenuShown !== ContextMenuVisibility.VISIBLE) {\n      return null;\n    }\n    return hoveredRunUuid;\n  }, [contextMenuShown, hoveredRunUuid]);\n\n  const contextValue = useMemo(\n    () => ({ updateTooltip, resetTooltip, selectedRunUuid, closeContextMenu }),\n    [updateTooltip, resetTooltip, selectedRunUuid, closeContextMenu],\n  );\n\n  return (\n    <CompareRunsTooltipContext.Provider value={contextValue}>\n      {/* The element below wraps all the children (where charts are expected to be mounted)\n      and tracks mouse movement inside */}\n      <div\n        onMouseMove={mouseMove}\n        onMouseDownCapture={mouseDownCapture}\n        onClickCapture={tooltipAreaClicked}\n      >\n        {children}\n      </div>\n      {/* The element below houses the tooltip/context menu */}\n      <div css={styles.contextMenuContainer} className={className} ref={containerRef}>\n        {contextMenuShown !== ContextMenuVisibility.HIDDEN && hoveredRunUuid && (\n          <div\n            ref={ctxMenuRef}\n            css={styles.contextMenuWrapper}\n            data-testid='tooltip-container'\n            style={{\n              userSelect: contextMenuShown === ContextMenuVisibility.HOVER ? 'none' : 'unset',\n              pointerEvents: contextMenuShown === ContextMenuVisibility.HOVER ? 'none' : 'all',\n            }}\n          >\n            {/* A tooltip body component passed from the props */}\n            <Component\n              runUuid={hoveredRunUuid}\n              additionalAxisData={additionalAxisData}\n              hoverData={tooltipDisplayParams}\n              contextData={contextData}\n              isHovering={contextMenuShown === ContextMenuVisibility.HOVER}\n              closeContextMenu={closeContextMenu}\n            />\n          </div>\n        )}\n      </div>\n    </CompareRunsTooltipContext.Provider>\n  );\n};\n\n/**\n * This hook is used to wire up tooltip to particular compare runs chart.\n * Returns \"setTooltip\" and \"resetTooltip\" functions that should be called\n * upon chart's \"onHover\" and \"onUnhover\" events. \"setTooltip\" function consumes\n * the runUuid that was hovered on.\n */\nexport const useCompareRunsTooltip = <\n  // Type for local hover data passed to the tooltip, e.g. configuration of particular chart\n  THover = any,\n  TAxisData = any,\n>(\n  hoverData?: THover,\n) => {\n  const contextValue = useContext(CompareRunsTooltipContext);\n\n  if (!contextValue) {\n    throw new Error(\n      'You must invoke useCompareRunsTooltip() in a component being ancestor of <CompareRunsTooltipWrapper />!',\n    );\n  }\n\n  const { updateTooltip, resetTooltip, selectedRunUuid, closeContextMenu } = contextValue;\n\n  const setTooltip = useCallback(\n    (runUuid = '', event?: MouseEvent, additionalAxisData?: TAxisData) => {\n      updateTooltip(runUuid, hoverData, event, additionalAxisData);\n    },\n    [updateTooltip, hoverData],\n  );\n\n  return { setTooltip, resetTooltip, selectedRunUuid, closeContextMenu };\n};\n\nconst styles = {\n  contextMenuContainer: {\n    overflow: 'hidden',\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: '100%',\n    position: 'fixed',\n    pointerEvents: 'none',\n  } as Interpolation<Theme>,\n  contextMenuWrapper: (theme: Theme) => ({\n    zIndex: 1,\n    position: 'absolute' as const,\n    padding: theme.spacing.sm,\n    backgroundColor: 'white',\n    border: `1px solid ${theme.colors.border}`,\n    left: -999,\n    top: -999,\n  }),\n  overlayElement: (): Interpolation<Theme> => ({\n    '&::after': {\n      content: '\"\"',\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      right: 0,\n      bottom: 0,\n      backgroundColor: 'transparent',\n    },\n  }),\n};\n","import { Button, DropdownMenu, OverflowIcon, Typography } from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport { PropsWithChildren } from 'react';\nimport { InfoTooltip } from '@databricks/design-system';\n\nexport interface ChartCardWrapperProps {\n  title: React.ReactNode;\n  subtitle?: React.ReactNode;\n  onEdit: () => void;\n  onDelete: () => void;\n  fullWidth?: boolean;\n  tooltip?: string;\n}\n\n/**\n * Wrapper components for all chart cards. Provides styles and adds\n * a dropdown menu with actions for configure and delete.\n */\nexport const RunsCompareChartCardWrapper = ({\n  title,\n  subtitle,\n  onDelete,\n  onEdit,\n  children,\n  fullWidth = false,\n  tooltip = '',\n}: PropsWithChildren<ChartCardWrapperProps>) => (\n  <div css={styles.chartEntry(fullWidth)} data-testid='experiment-view-compare-runs-card'>\n    <div css={styles.chartEntryTitle}>\n      <div css={{ overflow: 'hidden' }}>\n        <Typography.Title\n          title={String(title)}\n          level={4}\n          css={{\n            marginBottom: 0,\n            overflow: 'hidden',\n            whiteSpace: 'nowrap',\n            textOverflow: 'ellipsis',\n          }}\n        >\n          {title}\n        </Typography.Title>\n        {subtitle && <span css={styles.subtitle}>{subtitle}</span>}\n        {tooltip && <InfoTooltip title={tooltip} />}\n      </div>\n      <DropdownMenu.Root modal={false}>\n        <DropdownMenu.Trigger asChild>\n          <Button\n            type='tertiary'\n            icon={<OverflowIcon />}\n            data-testid='experiment-view-compare-runs-card-menu'\n          />\n        </DropdownMenu.Trigger>\n        <DropdownMenu.Content align='end' minWidth={100}>\n          <DropdownMenu.Item onClick={onEdit} data-testid='experiment-view-compare-runs-card-edit'>\n            Configure\n          </DropdownMenu.Item>\n          <DropdownMenu.Item\n            onClick={onDelete}\n            data-testid='experiment-view-compare-runs-card-delete'\n          >\n            Delete\n          </DropdownMenu.Item>\n        </DropdownMenu.Content>\n      </DropdownMenu.Root>\n    </div>\n    {children}\n  </div>\n);\n\nconst styles = {\n  chartEntry:\n    (fullWidth = false) =>\n    (theme: Theme) => ({\n      height: 360,\n      maxWidth: fullWidth ? 'unset' : 800,\n      overflow: 'hidden',\n      display: 'grid',\n      gridTemplateRows: 'auto 1fr',\n      backgroundColor: theme.colors.backgroundPrimary,\n      padding: theme.spacing.md,\n      border: `1px solid ${theme.colors.border}`,\n      borderRadius: theme.general.borderRadiusBase,\n    }),\n  chartComponentWrapper: () => ({\n    overflow: 'hidden',\n  }),\n  chartEntryTitle: () => ({\n    display: 'grid' as const,\n    gridTemplateColumns: '1fr auto',\n    alignItems: 'flex-start',\n  }),\n  subtitle: (theme: Theme) => ({\n    color: theme.colors.textSecondary,\n    fontSize: 11,\n    marginRight: 4,\n  }),\n};\n","import { useMemo } from 'react';\nimport type { CompareChartRunData } from '../charts/CompareRunsCharts.common';\nimport { CompareRunsMetricsBarPlot } from '../charts/CompareRunsMetricsBarPlot';\nimport { useCompareRunsTooltip } from '../hooks/useCompareRunsTooltip';\nimport type { RunsCompareBarCardConfig } from '../runs-compare.types';\nimport { RunsCompareChartCardWrapper } from './ChartCard.common';\n\nexport interface RunsCompareBarChartCardProps {\n  config: RunsCompareBarCardConfig;\n  chartRunData: CompareChartRunData[];\n\n  onDelete: () => void;\n  onEdit: () => void;\n}\n\nexport const barChartCardDefaultMargin = {\n  t: 24,\n  b: 48,\n  r: 0,\n  l: 4,\n  pad: 0,\n};\n\nexport const RunsCompareBarChartCard = ({\n  config,\n  chartRunData,\n  onDelete,\n  onEdit,\n}: RunsCompareBarChartCardProps) => {\n  const slicedRuns = useMemo(\n    () => chartRunData.slice(0, config.runsCountToCompare || 10).reverse(),\n    [chartRunData, config],\n  );\n  const { setTooltip, resetTooltip, selectedRunUuid } = useCompareRunsTooltip(config);\n\n  return (\n    <RunsCompareChartCardWrapper\n      onEdit={onEdit}\n      onDelete={onDelete}\n      title={config.metricKey}\n      // TODO: add i18n after making decision on the final wording\n      subtitle={<>Comparing first {slicedRuns.length} runs</>}\n    >\n      <div css={styles.barChartCardWrapper}>\n        <CompareRunsMetricsBarPlot\n          runsData={slicedRuns}\n          metricKey={config.metricKey}\n          displayRunNames={false}\n          displayMetricKey={false}\n          useDefaultHoverBox={false}\n          margin={barChartCardDefaultMargin}\n          onHover={setTooltip}\n          onUnhover={resetTooltip}\n          selectedRunUuid={selectedRunUuid}\n        />\n      </div>\n    </RunsCompareChartCardWrapper>\n  );\n};\n\nconst styles = {\n  barChartCardWrapper: {\n    overflow: 'hidden',\n  },\n};\n","var _path, _path2, _g, _defs;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nfunction SvgParallelChartPlaceholder(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 80,\n    height: 42,\n    viewBox: \"0 0 80 42\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1.28418 2.34094L39.4998 17.0908L76.3746 7.87216\",\n    stroke: \"#CF797B\",\n    strokeLinecap: \"round\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1.95459 20.443L40.1702 25.1361L77.045 21.1134M1.95459 36.5338L40.1702 35.1929L77.045 25.1361\",\n    stroke: \"#A88E6F\",\n    strokeLinecap: \"round\"\n  })), _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n    opacity: 0.8\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1.28418 1V40.3341\",\n    stroke: \"#338ECC\",\n    strokeLinecap: \"round\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M40.6189 2.07251V39.9763\",\n    stroke: \"#338ECC\",\n    strokeLinecap: \"round\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M77.7156 2.07251V39.9763\",\n    stroke: \"url(#paint0_linear_2781_406689)\",\n    strokeWidth: 4,\n    strokeLinecap: \"square\"\n  }))), _defs || (_defs = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"linearGradient\", {\n    id: \"paint0_linear_2781_406689\",\n    x1: 78.2156,\n    y1: 2.07251,\n    x2: 78.2156,\n    y2: 39.9763,\n    gradientUnits: \"userSpaceOnUse\"\n  }, /*#__PURE__*/React.createElement(\"stop\", {\n    stopColor: \"#D04F5E\"\n  }), /*#__PURE__*/React.createElement(\"stop\", {\n    offset: 1,\n    stopColor: \"#4D9734\"\n  })))));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgParallelChartPlaceholder);\nexport default __webpack_public_path__ + \"static/media/parallel-chart-placeholder.234ef0c5b220ef2a5a6fa5bafff173f7.svg\";\nexport { ForwardRef as ReactComponent };","import { LegacySkeleton } from '@databricks/design-system';\nimport React, { Suspense } from 'react';\nimport { CompareChartRunData } from './CompareRunsCharts.common';\n\nconst ParallelCoordinatesPlot = React.lazy(() => import('./ParallelCoordinatesPlot'));\n\nexport const MAX_NUMBER_STRINGS = 30;\nexport type ParallelCoordinateDataEntry = Record<string, string | number | null>;\n\nconst LazyParallelCoordinatesPlot = (props: any) => {\n  return (\n    <Suspense fallback={<LegacySkeleton />}>\n      <ParallelCoordinatesPlot {...props}></ParallelCoordinatesPlot>\n    </Suspense>\n  );\n};\n\n// Map all metrics, params and run uuid\n// Filter data to only keep the selected params and metrics from each run\nexport function processParallelCoordinateData(\n  chartRunData: CompareChartRunData[],\n  selectedParams: string[],\n  selectedMetrics: string[],\n): ParallelCoordinateDataEntry[] {\n  const allRuns = chartRunData.map((run) => {\n    const result: ParallelCoordinateDataEntry = {\n      uuid: run.runInfo.run_uuid,\n    };\n    function computeSelectedAttrs(attrs: string[], runvalue: Record<string, any>) {\n      if (Array.isArray(attrs)) {\n        for (const attr of attrs) {\n          if (attr in runvalue) {\n            result[attr] = runvalue[attr].value;\n          } else {\n            result[attr] = null;\n          }\n        }\n      }\n    }\n    computeSelectedAttrs(selectedParams, run.params);\n    computeSelectedAttrs(selectedMetrics, run.metrics);\n    return result;\n  });\n\n  return filterParallelCoordinateData(allRuns);\n}\n\nexport function filterParallelCoordinateData(\n  allRuns: ParallelCoordinateDataEntry[],\n): ParallelCoordinateDataEntry[] {\n  const keys = Object.keys(allRuns[0]);\n  keys.shift(); // remove uuid as a key\n  let stringRuns: ParallelCoordinateDataEntry[] = allRuns;\n\n  // add runs with any string values until 30 unique values in any column\n  keys.forEach((key) => {\n    const numberRuns = stringRuns.filter((x) => {\n      return !isNaN(Number(x[key])) && x[key] !== null;\n    }); // this logic should remain the same as in getAxesTypes() for casting\n\n    if (numberRuns.length >= stringRuns.length / 2) {\n      stringRuns = numberRuns;\n      return;\n    }\n\n    const seenVals: Set<string> = new Set();\n    const tempRuns = [];\n    for (const run of stringRuns) {\n      const value = run[key];\n      if (seenVals.size === MAX_NUMBER_STRINGS && seenVals.has(String(value))) {\n        tempRuns.push(run);\n      } else if (seenVals.size < MAX_NUMBER_STRINGS && isNaN(Number(value))) {\n        seenVals.add(String(value));\n        tempRuns.push(run);\n      }\n    }\n    stringRuns = tempRuns;\n  });\n\n  return stringRuns;\n}\n\nexport default LazyParallelCoordinatesPlot;\n","import { Button, Typography } from '@databricks/design-system';\nimport { useMemo } from 'react';\nimport { ReactComponent as ParallelChartSvg } from '../../../../common/static/parallel-chart-placeholder.svg';\nimport type { CompareChartRunData } from '../charts/CompareRunsCharts.common';\nimport LazyParallelCoordinatesPlot, {\n  processParallelCoordinateData,\n} from '../charts/LazyParallelCoordinatesPlot';\nimport { useCompareRunsTooltip } from '../hooks/useCompareRunsTooltip';\nimport type { RunsCompareParallelCardConfig } from '../runs-compare.types';\nimport { RunsCompareChartCardWrapper } from './ChartCard.common';\n\nexport interface RunsCompareParallelChartCardProps {\n  config: RunsCompareParallelCardConfig;\n  chartRunData: CompareChartRunData[];\n\n  onDelete: () => void;\n  onEdit: () => void;\n}\n\n/**\n * A placeholder component displayed before parallel coords chart is being configured by user\n */\nconst EmptyParallelCoordsPlaceholder = ({ onEdit }: { onEdit: () => void }) => {\n  return (\n    <div css={{ display: 'flex', flex: 1, justifyContent: 'center', alignItems: 'center' }}>\n      <div css={{ display: 'flex', flexDirection: 'column', alignItems: 'center', maxWidth: 360 }}>\n        <ParallelChartSvg />\n        <Typography.Title css={{ marginTop: 16 }} color='secondary' level={3}>\n          Compare parameter importance\n        </Typography.Title>\n        <Typography.Text css={{ marginBottom: 16 }} color='secondary'>\n          Use the parallel coordinates chart to compare how various parameters in model affect your\n          model metrics.\n        </Typography.Text>\n        <Button type='primary' onClick={onEdit}>\n          Configure chart\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport const RunsCompareParallelChartCard = ({\n  config,\n  chartRunData,\n  onDelete,\n  onEdit,\n}: RunsCompareParallelChartCardProps) => {\n  const [isConfigured, parallelCoordsData] = useMemo(() => {\n    const selectedParamsCount = config.selectedParams?.length || 0;\n    const selectedMetricsCount = config.selectedMetrics?.length || 0;\n\n    const configured = selectedParamsCount + selectedMetricsCount >= 2;\n\n    // Prepare the data in the parcoord-es format\n    const data = configured\n      ? processParallelCoordinateData(chartRunData, config.selectedParams, config.selectedMetrics)\n      : [];\n\n    return [configured, data];\n  }, [config, chartRunData]);\n\n  const { setTooltip, resetTooltip, selectedRunUuid, closeContextMenu } =\n    useCompareRunsTooltip(config);\n\n  return (\n    <RunsCompareChartCardWrapper\n      onEdit={onEdit}\n      onDelete={onDelete}\n      title={'Parallel Coordinates'}\n      subtitle={isConfigured ? <>Comparing {parallelCoordsData.length} runs</> : null}\n      fullWidth\n      tooltip='The Parallel Coordinates Chart now only shows runs with columns that are either numbers or strings. If a column has string entries, the runs corresponding to the 30 most recent unique values will be shown.'\n    >\n      {!isConfigured ? (\n        <EmptyParallelCoordsPlaceholder onEdit={onEdit} />\n      ) : parallelCoordsData.length ? (\n        // Avoid displaying empty set, otherwise parcoord-es goes crazy\n        <div css={styles.parallelChartCardWrapper}>\n          <LazyParallelCoordinatesPlot\n            data={parallelCoordsData}\n            selectedParams={config.selectedParams}\n            selectedMetrics={config.selectedMetrics}\n            onHover={setTooltip}\n            onUnhover={resetTooltip}\n            axesRotateThreshold={8}\n            selectedRunUuid={selectedRunUuid}\n            closeContextMenu={closeContextMenu}\n          />\n        </div>\n      ) : null}\n    </RunsCompareChartCardWrapper>\n  );\n};\n\nconst styles = {\n  parallelChartCardWrapper: {\n    // Set \"display: flex\" here (and \"flex: 1\" in the child element)\n    // so the chart will grow in width and height\n    display: 'flex',\n    overflow: 'hidden',\n    cursor: 'pointer',\n  },\n};\n","import { useTheme } from '@emotion/react';\nimport { Data, Datum, Layout, PlotMouseEvent } from 'plotly.js';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { LazyPlot } from '../../LazyPlot';\nimport { useMutableHoverCallback } from '../hooks/useMutableHoverCallback';\nimport {\n  highlightScatterTraces,\n  useCompareRunsTraceHighlight,\n} from '../hooks/useCompareRunsTraceHighlight';\nimport {\n  commonRunsChartStyles,\n  CompareChartRunData,\n  CompareRunsChartAxisDef,\n  compareRunsChartDefaultMargin,\n  compareRunsChartHoverlabel,\n  CompareRunsCommonPlotProps,\n  useDynamicPlotSize,\n} from './CompareRunsCharts.common';\n\nexport interface CompareRunsScatterPlotProps extends CompareRunsCommonPlotProps {\n  /**\n   * Horizontal axis with a metric or a param\n   */\n  xAxis: CompareRunsChartAxisDef;\n\n  /**\n   * Vertical axis with a metric or a param\n   */\n  yAxis: CompareRunsChartAxisDef;\n\n  /**\n   * Array of runs data with corresponding values\n   */\n  runsData: CompareChartRunData[];\n}\n\nconst PLOT_CONFIG = {\n  displaylogo: false,\n  scrollZoom: true,\n};\n\nexport const createTooltipTemplate = () =>\n  '<b>%{customdata[1]}:</b><br>' +\n  '<b>%{xaxis.title.text}:</b> %{x:.2f}<br>' +\n  '<b>%{yaxis.title.text}:</b> %{y:.2f}<br>' +\n  '<extra></extra>';\n\n/**\n * Implementation of plotly.js chart displaying\n * scatter plot comparing values for a given\n * set of experiments runs\n */\nexport const CompareRunsScatterPlot = React.memo(\n  ({\n    runsData,\n    xAxis,\n    yAxis,\n    markerSize = 10,\n    className,\n    margin = compareRunsChartDefaultMargin,\n    onUpdate,\n    onHover,\n    onUnhover,\n    width,\n    height,\n    useDefaultHoverBox = true,\n    selectedRunUuid,\n  }: CompareRunsScatterPlotProps) => {\n    const theme = useTheme();\n\n    const { layoutHeight, layoutWidth, setContainerDiv, containerDiv, isDynamicSizeSupported } =\n      useDynamicPlotSize();\n\n    const plotData = useMemo(() => {\n      // Prepare empty values\n      const xValues: (number | string)[] = [];\n      const yValues: (number | string)[] = [];\n      const colors: (number | string)[] = [];\n      const tooltipData: Datum[] = [];\n\n      // Iterate through all the runs and aggregate selected metrics/params\n      for (const runData of runsData) {\n        const {\n          runInfo: { run_uuid, run_name },\n          metrics,\n          params,\n          color,\n        } = runData;\n        const xAxisData = xAxis.type === 'METRIC' ? metrics : params;\n        const yAxisData = yAxis.type === 'METRIC' ? metrics : params;\n\n        const x = xAxisData?.[xAxis.key]?.value || undefined;\n        const y = yAxisData?.[yAxis.key]?.value || undefined;\n\n        if (x && y) {\n          xValues.push(x);\n          yValues.push(y);\n          colors.push(color || theme.colors.primary);\n          tooltipData.push([run_uuid, run_name || run_uuid] as any);\n        }\n      }\n\n      return [\n        {\n          x: xValues,\n          y: yValues,\n          customdata: tooltipData,\n          hovertemplate: useDefaultHoverBox ? createTooltipTemplate() : undefined,\n          hoverinfo: useDefaultHoverBox ? undefined : 'none',\n          hoverlabel: useDefaultHoverBox ? compareRunsChartHoverlabel : undefined,\n          type: 'scatter',\n          mode: 'markers',\n          marker: {\n            size: markerSize,\n            color: colors,\n          },\n        } as Data,\n      ];\n    }, [runsData, xAxis, yAxis, theme, markerSize, useDefaultHoverBox]);\n\n    const [layout, setLayout] = useState<Partial<Layout>>({\n      width: width || layoutWidth,\n      height: height || layoutHeight,\n      margin,\n      xaxis: { title: xAxis.key },\n      yaxis: { title: yAxis.key },\n    });\n\n    useEffect(() => {\n      setLayout((current) => {\n        const newLayout = {\n          ...current,\n          width: width || layoutWidth,\n          height: height || layoutHeight,\n          margin,\n        };\n\n        if (newLayout.xaxis) {\n          newLayout.xaxis.title = xAxis.key;\n        }\n\n        if (newLayout.yaxis) {\n          newLayout.yaxis.title = yAxis.key;\n        }\n\n        return newLayout;\n      });\n    }, [layoutWidth, layoutHeight, margin, xAxis.key, yAxis.key, width, height]);\n\n    const { setHoveredPointIndex } = useCompareRunsTraceHighlight(\n      containerDiv,\n      selectedRunUuid,\n      runsData,\n      highlightScatterTraces,\n    );\n\n    const hoverCallback = useCallback(\n      ({ points }: PlotMouseEvent) => {\n        // Find the corresponding run UUID by basing on \"customdata\" field set in the trace data.\n        // Plotly TS typings don't support custom fields so we need to cast to \"any\" first\n        const pointCustomDataRunUuid = (points[0] as any)?.customdata?.[0];\n        setHoveredPointIndex(points[0]?.pointIndex ?? -1);\n\n        if (pointCustomDataRunUuid) {\n          onHover?.(pointCustomDataRunUuid);\n        }\n      },\n      [onHover, setHoveredPointIndex],\n    );\n\n    const unhoverCallback = useCallback(() => {\n      onUnhover?.();\n      setHoveredPointIndex(-1);\n    }, [onUnhover, setHoveredPointIndex]);\n\n    /**\n     * Unfortunately plotly.js memorizes first onHover callback given on initial render,\n     * so in order to achieve updated behavior we need to wrap its most recent implementation\n     * in the immutable callback.\n     */\n    const mutableHoverCallback = useMutableHoverCallback(hoverCallback);\n\n    return (\n      <div\n        css={[\n          commonRunsChartStyles.chartWrapper,\n          commonRunsChartStyles.scatterChartHighlightStyles,\n        ]}\n        className={className}\n        ref={setContainerDiv}\n      >\n        <LazyPlot\n          data={plotData}\n          useResizeHandler={!isDynamicSizeSupported}\n          css={commonRunsChartStyles.chart}\n          layout={layout}\n          config={PLOT_CONFIG}\n          onUpdate={onUpdate}\n          onHover={mutableHoverCallback}\n          onUnhover={unhoverCallback}\n        />\n      </div>\n    );\n  },\n);\n","import { useMemo } from 'react';\nimport type { CompareChartRunData } from '../charts/CompareRunsCharts.common';\nimport type { RunsCompareScatterCardConfig } from '../runs-compare.types';\nimport { RunsCompareChartCardWrapper } from './ChartCard.common';\nimport { CompareRunsScatterPlot } from '../charts/CompareRunsScatterPlot';\nimport { useCompareRunsTooltip } from '../hooks/useCompareRunsTooltip';\n\nexport interface RunsCompareScatterChartCardProps {\n  config: RunsCompareScatterCardConfig;\n  chartRunData: CompareChartRunData[];\n\n  onDelete: () => void;\n  onEdit: () => void;\n}\n\nexport const RunsCompareScatterChartCard = ({\n  config,\n  chartRunData,\n  onDelete,\n  onEdit,\n}: RunsCompareScatterChartCardProps) => {\n  const slicedRuns = useMemo(\n    () => chartRunData.slice(0, config.runsCountToCompare || 10).reverse(),\n    [chartRunData, config],\n  );\n\n  const { setTooltip, resetTooltip, selectedRunUuid } = useCompareRunsTooltip(config);\n\n  return (\n    <RunsCompareChartCardWrapper\n      onEdit={onEdit}\n      onDelete={onDelete}\n      title={`${config.xaxis.key} vs. ${config.yaxis.key}`}\n      // TODO: add i18n after making decision on the final wording\n      subtitle={<>Comparing first {slicedRuns.length} runs</>}\n    >\n      <div css={styles.scatterChartCardWrapper}>\n        <CompareRunsScatterPlot\n          runsData={slicedRuns}\n          xAxis={config.xaxis}\n          yAxis={config.yaxis}\n          onHover={setTooltip}\n          onUnhover={resetTooltip}\n          useDefaultHoverBox={false}\n          selectedRunUuid={selectedRunUuid}\n        />\n      </div>\n    </RunsCompareChartCardWrapper>\n  );\n};\n\nconst styles = {\n  scatterChartCardWrapper: {\n    overflow: 'hidden',\n  },\n};\n","import { useTheme } from '@emotion/react';\nimport { Data, Datum, Layout, PlotMouseEvent } from 'plotly.js';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { LazyPlot } from '../../LazyPlot';\nimport { useMutableHoverCallback } from '../hooks/useMutableHoverCallback';\nimport {\n  highlightScatterTraces,\n  useCompareRunsTraceHighlight,\n} from '../hooks/useCompareRunsTraceHighlight';\nimport {\n  commonRunsChartStyles,\n  CompareChartRunData,\n  CompareRunsChartAxisDef,\n  compareRunsChartDefaultContourMargin,\n  compareRunsChartHoverlabel,\n  CompareRunsCommonPlotProps,\n  useDynamicPlotSize,\n} from './CompareRunsCharts.common';\n\nexport interface CompareRunsContourPlotProps extends CompareRunsCommonPlotProps {\n  /**\n   * Horizontal axis with a metric or a param\n   */\n  xAxis: CompareRunsChartAxisDef;\n\n  /**\n   * Vertical axis with a metric or a param\n   */\n  yAxis: CompareRunsChartAxisDef;\n\n  /**\n   * Depth dimension with a metric or a param\n   */\n  zAxis: CompareRunsChartAxisDef;\n\n  /**\n   * Array of runs data with corresponding values\n   */\n  runsData: CompareChartRunData[];\n\n  /**\n   * Sets the color scale in [[0.35, 'rgb(40,60,190)'],[0.5, 'rgb(70,100,245)'],...] format.\n   * Leave unset to use the defualt scale.\n   */\n  colorScale?: [number, string][];\n\n  /**\n   * Set to `true` in order to reverse the color scale.\n   */\n  reverseScale?: boolean;\n}\n\nconst PLOT_CONFIG = {\n  displaylogo: false,\n  scrollZoom: true,\n};\n\nconst DEFAULT_COLOR_SCALE: [number, string][] = [\n  [0, 'rgb(5,10,172)'],\n  [0.35, 'rgb(40,60,190)'],\n  [0.5, 'rgb(70,100,245)'],\n  [0.6, 'rgb(90,120,245)'],\n  [0.7, 'rgb(106,137,247)'],\n  [1, 'rgb(220,220,220)'],\n];\n\nexport const createTooltipTemplate = (zAxisTitle: string) =>\n  '<b>%{customdata[1]}:</b><br>' +\n  '<b>%{xaxis.title.text}:</b> %{x:.2f}<br>' +\n  '<b>%{yaxis.title.text}:</b> %{y:.2f}<br>' +\n  `<b>${zAxisTitle}:</b> %{customdata[2]:.2f}` +\n  '<extra></extra>';\n\n/**\n * Implementation of plotly.js chart displaying\n * contour plot comparing values for a given\n * set of experiments runs\n */\nexport const CompareRunsContourPlot = React.memo(\n  ({\n    runsData,\n    xAxis,\n    yAxis,\n    zAxis,\n    markerSize = 10,\n    className,\n    reverseScale,\n    margin = compareRunsChartDefaultContourMargin,\n    colorScale = DEFAULT_COLOR_SCALE,\n    onUpdate,\n    onHover,\n    onUnhover,\n    width,\n    height,\n    useDefaultHoverBox = true,\n    selectedRunUuid,\n  }: CompareRunsContourPlotProps) => {\n    const theme = useTheme();\n\n    const { layoutHeight, layoutWidth, setContainerDiv, containerDiv, isDynamicSizeSupported } =\n      useDynamicPlotSize();\n\n    const plotData = useMemo(() => {\n      // Prepare empty values\n      const xValues: (number | string)[] = [];\n      const yValues: (number | string)[] = [];\n      const zValues: (number | string)[] = [];\n      const colors: (number | string)[] = [];\n      const tooltipData: Datum[] = [];\n\n      // Iterate through all the runs and aggregate selected metrics/params\n      for (const runData of runsData) {\n        const {\n          runInfo: { run_uuid, run_name },\n          metrics,\n          params,\n          color,\n        } = runData;\n        const xAxisData = xAxis.type === 'METRIC' ? metrics : params;\n        const yAxisData = yAxis.type === 'METRIC' ? metrics : params;\n        const zAxisData = zAxis.type === 'METRIC' ? metrics : params;\n\n        const x = xAxisData?.[xAxis.key]?.value || undefined;\n        const y = yAxisData?.[yAxis.key]?.value || undefined;\n        const z = zAxisData?.[zAxis.key]?.value || undefined;\n\n        if (x && y && z) {\n          xValues.push(x);\n          yValues.push(y);\n          zValues.push(z);\n          colors.push(color || theme.colors.primary);\n          tooltipData.push([run_uuid, run_name || run_uuid, z] as any);\n        }\n      }\n\n      // Let's compile chart layers\n      const layers = [\n        // The top layer with the scatter plot (dots)\n        {\n          x: xValues,\n          y: yValues,\n          customdata: tooltipData,\n          hovertemplate: useDefaultHoverBox ? createTooltipTemplate(zAxis.key) : undefined,\n          hoverinfo: useDefaultHoverBox ? undefined : 'none',\n          hoverlabel: useDefaultHoverBox ? compareRunsChartHoverlabel : undefined,\n          type: 'scatter',\n          mode: 'markers',\n          marker: {\n            size: markerSize,\n            color: colors,\n            line: {\n              color: 'black',\n              width: 1,\n            },\n          },\n        },\n      ] as Data[];\n\n      // If there are at least two runs, add a contour chart layer\n      if (runsData.length > 1) {\n        layers.unshift({\n          x: xValues,\n          y: yValues,\n          z: zValues,\n          type: 'contour',\n          connectgaps: true,\n          hoverinfo: 'none',\n          contours: {\n            coloring: 'heatmap',\n          },\n          colorscale: colorScale,\n          reversescale: reverseScale,\n        } as Data);\n      }\n      return layers;\n    }, [\n      colorScale,\n      reverseScale,\n      markerSize,\n      runsData,\n      xAxis.type,\n      xAxis.key,\n      yAxis.type,\n      yAxis.key,\n      zAxis.type,\n      zAxis.key,\n      theme.colors.primary,\n      useDefaultHoverBox,\n    ]);\n\n    const [layout, setLayout] = useState<Partial<Layout>>({\n      width: width || layoutWidth,\n      height: height || layoutHeight,\n      margin,\n      xaxis: { title: xAxis.key },\n      yaxis: { ticks: 'inside', title: { standoff: 32, text: yAxis.key } },\n    });\n\n    useEffect(() => {\n      setLayout((current) => {\n        const newLayout = {\n          ...current,\n          width: width || layoutWidth,\n          height: height || layoutHeight,\n          margin,\n        };\n\n        if (newLayout.xaxis) {\n          newLayout.xaxis.title = xAxis.key;\n        }\n\n        if (newLayout.yaxis) {\n          newLayout.yaxis.title = { standoff: 32, text: yAxis.key };\n        }\n\n        return newLayout;\n      });\n    }, [layoutWidth, layoutHeight, margin, xAxis.key, yAxis.key, width, height]);\n\n    const { setHoveredPointIndex } = useCompareRunsTraceHighlight(\n      containerDiv,\n      selectedRunUuid,\n      runsData,\n      highlightScatterTraces,\n    );\n\n    const hoverCallback = useCallback(\n      ({ points }: PlotMouseEvent) => {\n        // Find hover event corresponding to the second curve (scatter plot) only\n        const scatterPoints = points.find(({ curveNumber }) => curveNumber === 1);\n\n        setHoveredPointIndex(scatterPoints?.pointIndex ?? -1);\n\n        if (!scatterPoints) {\n          return;\n        }\n\n        // Find the corresponding run UUID by basing on \"customdata\" field set in the trace data.\n        // Plotly TS typings don't support custom fields so we need to cast to \"any\" first\n        const pointCustomDataRunUuid = (scatterPoints as any)?.customdata?.[0];\n        if (pointCustomDataRunUuid) {\n          onHover?.(pointCustomDataRunUuid);\n        }\n      },\n      [onHover, setHoveredPointIndex],\n    );\n\n    const unhoverCallback = useCallback(() => {\n      onUnhover?.();\n      setHoveredPointIndex(-1);\n    }, [onUnhover, setHoveredPointIndex]);\n\n    /**\n     * Unfortunately plotly.js memorizes first onHover callback given on initial render,\n     * so in order to achieve updated behavior we need to wrap its most recent implementation\n     * in the immutable callback.\n     */\n    const mutableHoverCallback = useMutableHoverCallback(hoverCallback);\n\n    return (\n      <div\n        css={[\n          commonRunsChartStyles.chartWrapper,\n          commonRunsChartStyles.scatterChartHighlightStyles,\n        ]}\n        className={className}\n        ref={setContainerDiv}\n      >\n        <LazyPlot\n          data={plotData}\n          useResizeHandler={!isDynamicSizeSupported}\n          css={commonRunsChartStyles.chart}\n          onUpdate={onUpdate}\n          layout={layout}\n          config={PLOT_CONFIG}\n          onHover={mutableHoverCallback}\n          onUnhover={unhoverCallback}\n        />\n      </div>\n    );\n  },\n);\n","import { useMemo } from 'react';\nimport type { CompareChartRunData } from '../charts/CompareRunsCharts.common';\nimport type { RunsCompareContourCardConfig } from '../runs-compare.types';\nimport { RunsCompareChartCardWrapper } from './ChartCard.common';\nimport { CompareRunsContourPlot } from '../charts/CompareRunsContourPlot';\nimport { useCompareRunsTooltip } from '../hooks/useCompareRunsTooltip';\n\nexport interface RunsCompareContourChartCardProps {\n  config: RunsCompareContourCardConfig;\n  chartRunData: CompareChartRunData[];\n\n  onDelete: () => void;\n  onEdit: () => void;\n}\n\nexport const RunsCompareContourChartCard = ({\n  config,\n  chartRunData,\n  onDelete,\n  onEdit,\n}: RunsCompareContourChartCardProps) => {\n  const slicedRuns = useMemo(\n    () => chartRunData.slice(0, config.runsCountToCompare || 10).reverse(),\n    [chartRunData, config],\n  );\n\n  const { setTooltip, resetTooltip, selectedRunUuid } = useCompareRunsTooltip(config);\n\n  return (\n    <RunsCompareChartCardWrapper\n      onEdit={onEdit}\n      onDelete={onDelete}\n      title={`${config.xaxis.key} vs. ${config.yaxis.key} vs. ${config.zaxis.key}`}\n      // TODO: add i18n after making decision on the final wording\n      subtitle={<>Comparing first {slicedRuns.length} runs</>}\n    >\n      <div css={styles.contourChartCardWrapper}>\n        <CompareRunsContourPlot\n          runsData={slicedRuns}\n          xAxis={config.xaxis}\n          yAxis={config.yaxis}\n          zAxis={config.zaxis}\n          useDefaultHoverBox={false}\n          onHover={setTooltip}\n          onUnhover={resetTooltip}\n          selectedRunUuid={selectedRunUuid}\n        />\n      </div>\n    </RunsCompareChartCardWrapper>\n  );\n};\n\nconst styles = {\n  contourChartCardWrapper: {\n    overflow: 'hidden',\n  },\n};\n","import { minBy } from 'lodash';\nimport { Config, Data, Layout, LayoutAxis } from 'plotly.js';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useIntl } from 'react-intl';\nimport { MetricEntity } from '../../../types';\nimport { LazyPlot } from '../../LazyPlot';\nimport { useMutableHoverCallback } from '../hooks/useMutableHoverCallback';\nimport {\n  highlightLineTraces,\n  useCompareRunsTraceHighlight,\n} from '../hooks/useCompareRunsTraceHighlight';\nimport {\n  commonRunsChartStyles,\n  CompareChartRunData,\n  compareRunsChartDefaultMargin,\n  compareRunsChartHoverlabel,\n  CompareRunsCommonPlotProps,\n  normalizeChartValue,\n  useDynamicPlotSize,\n} from './CompareRunsCharts.common';\nimport { EMA } from '../../MetricsPlotView';\n\nexport interface CompareRunsMetricsLinePlotProps extends CompareRunsCommonPlotProps {\n  /**\n   * Determines which metric are we comparing by\n   */\n  metricKey: string;\n\n  /**\n   * Smoothing factor for EMA\n   */\n  lineSmoothness?: number;\n\n  /**\n   * Y axis mode\n   */\n  scaleType?: 'linear' | 'log';\n\n  /**\n   * Use spline or polyline. Spline is default mode.\n   */\n  lineShape?: 'linear' | 'spline';\n\n  /**\n   * Choose X axis mode - numeric step or absolute time\n   */\n  xAxisKey?: 'step' | 'time' | 'time-relative';\n\n  /**\n   * Array of runs data with corresponding values\n   */\n  runsData: CompareChartRunData[];\n}\n\nconst PLOT_CONFIG: Partial<Config> = {\n  displaylogo: false,\n  doubleClick: 'autosize',\n  scrollZoom: true,\n};\n\nexport const createTooltipTemplate = (runName: string) =>\n  `<b>${runName}</b>:<br>` +\n  '<b>%{xaxis.title.text}:</b> %{x}<br>' +\n  '<b>%{yaxis.title.text}:</b> %{y:.2f}<br>' +\n  '<extra></extra>';\n\n/**\n * Prepares dataset's X axis according to selected visualization type: step, time-wall and time-relative\n */\nconst prepareMetricHistoryByAxisType = (\n  metricHistory?: MetricEntity[],\n  axisType?: CompareRunsMetricsLinePlotProps['xAxisKey'],\n) => {\n  if (!metricHistory) {\n    return [];\n  }\n  if (axisType === 'time-relative') {\n    const { timestamp: minTimestamp } = minBy(metricHistory, 'timestamp') || {};\n    if (minTimestamp) {\n      return metricHistory.map((e) => (e.timestamp - minTimestamp) / 1000); // Milliseconds -> seconds\n    }\n  } else if (axisType === 'time') {\n    return metricHistory.map((e) => e.timestamp);\n  }\n\n  return metricHistory.map((e) => e.step);\n};\n\n/**\n * Implementation of plotly.js chart displaying\n * line plot comparing metrics' history for a given\n * set of experiments runs\n */\nexport const CompareRunsMetricsLinePlot = React.memo(\n  ({\n    runsData,\n    metricKey,\n    scaleType = 'linear',\n    xAxisKey = 'step',\n    lineSmoothness = 70,\n    className,\n    margin = compareRunsChartDefaultMargin,\n    lineShape = 'spline',\n    onUpdate,\n    onHover,\n    onUnhover,\n    width,\n    height,\n    useDefaultHoverBox = true,\n    selectedRunUuid,\n  }: CompareRunsMetricsLinePlotProps) => {\n    const plotData = useMemo(\n      () =>\n        // Generate separate data trace for each run\n        runsData.map((runEntry) => {\n          if (runEntry.metricsHistory) {\n            return {\n              // Let's add UUID to each run so it can be distinguished later (e.g. on hover)\n              uuid: runEntry.runInfo.run_uuid,\n              name: runEntry.runInfo.run_name,\n              x: prepareMetricHistoryByAxisType(runEntry.metricsHistory[metricKey], xAxisKey),\n              // The actual value is on Y axis\n              y: EMA(\n                runEntry.metricsHistory[metricKey]?.map((e) => normalizeChartValue(e.value)),\n                lineSmoothness,\n              ),\n              hovertext: runEntry.runInfo.run_name,\n              text: 'x',\n              textposition: 'outside',\n              textfont: {\n                size: 11,\n              },\n              hovertemplate: useDefaultHoverBox\n                ? createTooltipTemplate(runEntry.runInfo.run_name)\n                : undefined,\n              hoverinfo: useDefaultHoverBox ? undefined : 'none',\n              hoverlabel: useDefaultHoverBox ? compareRunsChartHoverlabel : undefined,\n              type: 'scatter',\n              line: { shape: lineShape },\n              marker: {\n                color: runEntry.color,\n              },\n            } as Data;\n          }\n\n          return {};\n        }),\n      [runsData, lineShape, xAxisKey, lineSmoothness, metricKey, useDefaultHoverBox],\n    );\n\n    const { layoutHeight, layoutWidth, setContainerDiv, containerDiv, isDynamicSizeSupported } =\n      useDynamicPlotSize();\n\n    const { formatMessage } = useIntl();\n\n    const { setHoveredPointIndex } = useCompareRunsTraceHighlight(\n      containerDiv,\n      selectedRunUuid,\n      runsData,\n      highlightLineTraces,\n    );\n\n    const xAxisKeyLabel = useMemo(() => {\n      if (xAxisKey === 'time') {\n        return formatMessage({\n          defaultMessage: 'Time',\n          description:\n            'Label for X axis in compare runs metrics when values are displayed by absolute time',\n        });\n      }\n      if (xAxisKey === 'time-relative') {\n        return formatMessage({\n          defaultMessage: 'Time (s)',\n          description:\n            'Label for X axis in compare runs metrics when values are displayed by relative time in seconds',\n        });\n      }\n      return formatMessage({\n        defaultMessage: 'Step',\n        description:\n          'Label for X axis in compare runs metrics when values are displayed by metric history step',\n      });\n    }, [formatMessage, xAxisKey]);\n\n    const yAxisParams: Partial<LayoutAxis> = useMemo(\n      () => ({\n        tickfont: { size: 11 },\n        type: scaleType === 'log' ? 'log' : 'linear',\n      }),\n      [scaleType],\n    );\n\n    const [layout, setLayout] = useState<Partial<Layout>>({\n      width: width || layoutWidth,\n      height: height || layoutHeight,\n      margin,\n      xaxis: { title: xAxisKeyLabel },\n      yaxis: yAxisParams,\n    });\n\n    useEffect(() => {\n      setLayout((current) => ({\n        ...current,\n        width: width || layoutWidth,\n        height: height || layoutHeight,\n        margin,\n        yaxis: yAxisParams,\n        showlegend: false,\n      }));\n    }, [layoutWidth, layoutHeight, margin, yAxisParams, width, height, xAxisKeyLabel]);\n\n    const hoverCallback = useCallback(\n      ({ points, event }) => {\n        setHoveredPointIndex(points[0]?.curveNumber ?? -1);\n        const runUuid = (points[0]?.data as any).uuid;\n\n        // Apart from \"y\" value, we also want to send the \"x\" data so it can\n        // be reflected in the tooltip\n        const xAxisData = {\n          // Value of the \"x\" axis\n          value: points[0]?.x,\n          // The index of the X datum\n          index: points[0]?.pointIndex,\n          // Current label (\"Step\", \"Time\" etc.)\n          label: xAxisKeyLabel,\n        };\n        if (runUuid) {\n          onHover?.(runUuid, event, xAxisData);\n        }\n      },\n      [onHover, setHoveredPointIndex, xAxisKeyLabel],\n    );\n\n    const unhoverCallback = useCallback(() => {\n      onUnhover?.();\n      setHoveredPointIndex(-1);\n    }, [onUnhover, setHoveredPointIndex]);\n\n    // When switching axis title, Plotly.js mutates its layout object\n    // internally which leads to desync problems and automatic axis range\n    // ends up with an invalid value. In order to fix it, we are mutating\n    // axis object and injecting metric key as title in\n    // the render phase.\n    // It could be fixed by wrapping plotly.js directly instead of using\n    // react-plotly.js - but the effort does not correspond to the plan of\n    // moving away from plotly soon.\n    const immediateLayout = layout;\n    if (immediateLayout.xaxis) {\n      immediateLayout.xaxis.title = xAxisKeyLabel;\n      immediateLayout.xaxis.type = xAxisKey === 'time' ? 'date' : undefined;\n    }\n    if (immediateLayout.yaxis) {\n      immediateLayout.yaxis.title = metricKey;\n    }\n\n    /**\n     * Unfortunately plotly.js memorizes first onHover callback given on initial render,\n     * so in order to achieve updated behavior we need to wrap its most recent implementation\n     * in the immutable callback.\n     */\n    const mutableHoverCallback = useMutableHoverCallback(hoverCallback);\n\n    return (\n      <div\n        css={[commonRunsChartStyles.chartWrapper, styles.highlightStyles]}\n        className={className}\n        ref={setContainerDiv}\n      >\n        <LazyPlot\n          data={plotData}\n          useResizeHandler={!isDynamicSizeSupported}\n          css={commonRunsChartStyles.chart}\n          onUpdate={onUpdate}\n          layout={immediateLayout}\n          config={PLOT_CONFIG}\n          onHover={mutableHoverCallback}\n          onUnhover={unhoverCallback}\n        />\n      </div>\n    );\n  },\n);\n\nconst styles = {\n  highlightStyles: {\n    '.scatterlayer g.trace': {\n      transition: 'var(--trace-transition)',\n    },\n    '.scatterlayer.is-highlight g.trace': {\n      opacity: 'var(--trace-opacity-dimmed-low) !important',\n    },\n    '.scatterlayer g.trace.is-hover-highlight': {\n      opacity: 'var(--trace-opacity-highlighted) !important',\n    },\n    '.scatterlayer g.trace.is-selection-highlight': {\n      opacity: 'var(--trace-opacity-highlighted) !important',\n    },\n    '.scatterlayer g.trace.is-selection-highlight path.point': {\n      stroke: 'var(--trace-stroke-color)',\n      strokeWidth: 'var(--trace-stroke-width) !important',\n    },\n  },\n};\n","import { LegacySkeleton } from '@databricks/design-system';\nimport { useMemo } from 'react';\nimport { CompareChartRunData } from '../charts/CompareRunsCharts.common';\nimport { CompareRunsMetricsLinePlot } from '../charts/CompareRunsMetricsLinePlot';\nimport { useCompareRunsTooltip } from '../hooks/useCompareRunsTooltip';\nimport type { RunsCompareLineCardConfig } from '../runs-compare.types';\nimport { RunsCompareChartCardWrapper } from './ChartCard.common';\n\nexport interface RunsCompareLineChartCardProps {\n  config: RunsCompareLineCardConfig;\n  chartRunData: CompareChartRunData[];\n\n  isMetricHistoryLoading?: boolean;\n\n  onDelete: () => void;\n  onEdit: () => void;\n}\n\nexport const RunsCompareLineChartCard = ({\n  config,\n  chartRunData,\n  isMetricHistoryLoading,\n  onDelete,\n  onEdit,\n}: RunsCompareLineChartCardProps) => {\n  const slicedRuns = useMemo(\n    () => chartRunData.slice(0, config.runsCountToCompare || 10).reverse(),\n    [chartRunData, config],\n  );\n\n  const { setTooltip, resetTooltip, selectedRunUuid } = useCompareRunsTooltip(config);\n\n  return (\n    <RunsCompareChartCardWrapper\n      onEdit={onEdit}\n      onDelete={onDelete}\n      title={config.metricKey}\n      // TODO: add i18n after making decision on the final wording\n      subtitle={<>Comparing first {slicedRuns.length} runs</>}\n    >\n      <div css={styles.lineChartCardWrapper}>\n        {isMetricHistoryLoading ? (\n          <LegacySkeleton />\n        ) : (\n          <CompareRunsMetricsLinePlot\n            runsData={slicedRuns}\n            metricKey={config.metricKey}\n            scaleType={config.scaleType}\n            xAxisKey={config.xAxisKey}\n            lineSmoothness={config.lineSmoothness}\n            useDefaultHoverBox={false}\n            onHover={setTooltip}\n            onUnhover={resetTooltip}\n            selectedRunUuid={selectedRunUuid}\n          />\n        )}\n      </div>\n    </RunsCompareChartCardWrapper>\n  );\n};\n\nconst styles = {\n  lineChartCardWrapper: {\n    overflow: 'hidden',\n  },\n};\n","import { useMemo } from 'react';\nimport { Theme } from '@emotion/react';\nimport { RunsCompareBarChartCard } from './cards/RunsCompareBarChartCard';\nimport { RunsCompareParallelChartCard } from './cards/RunsCompareParallelChartCard';\nimport type { CompareChartRunData } from './charts/CompareRunsCharts.common';\nimport type {\n  RunsCompareBarCardConfig,\n  RunsCompareCardConfig,\n  RunsCompareContourCardConfig,\n  RunsCompareLineCardConfig,\n  RunsCompareParallelCardConfig,\n  RunsCompareScatterCardConfig,\n} from './runs-compare.types';\n\nimport { RunsCompareChartType } from './runs-compare.types';\nimport { RunsCompareScatterChartCard } from './cards/RunsCompareScatterChartCard';\nimport { RunsCompareContourChartCard } from './cards/RunsCompareContourChartCard';\nimport { RunsCompareLineChartCard } from './cards/RunsCompareLineChartCard';\n\nexport interface RunsCompareChartsProps {\n  chartRunData: CompareChartRunData[];\n  cardsConfig: RunsCompareCardConfig[];\n  isMetricHistoryLoading?: boolean;\n  onRemoveChart: (chart: RunsCompareCardConfig) => void;\n  onStartEditChart: (chart: RunsCompareCardConfig) => void;\n}\n\nexport const RunsCompareCharts = ({\n  chartRunData,\n  cardsConfig,\n  isMetricHistoryLoading,\n  onRemoveChart,\n  onStartEditChart,\n}: RunsCompareChartsProps) => {\n  const [parallelChartCards, remainingChartCards] = useMemo(() => {\n    // Play it safe in case that cards config somehow failed to load\n    if (!Array.isArray(cardsConfig)) {\n      return [[], []];\n    }\n    return [\n      cardsConfig.filter((c) => c.type === RunsCompareChartType.PARALLEL),\n      cardsConfig.filter((c) => c.type !== RunsCompareChartType.PARALLEL),\n    ];\n  }, [cardsConfig]);\n  return (\n    <>\n      {parallelChartCards.length ? (\n        <div css={styles.parallelChartsWrapper}>\n          {parallelChartCards.map((cardConfig) => (\n            <RunsCompareParallelChartCard\n              config={cardConfig as RunsCompareParallelCardConfig}\n              chartRunData={chartRunData}\n              onEdit={() => onStartEditChart(cardConfig)}\n              onDelete={() => onRemoveChart(cardConfig)}\n            />\n          ))}\n        </div>\n      ) : null}\n      <div css={styles.chartsWrapper}>\n        {remainingChartCards.map((cardConfig) => {\n          if (cardConfig.type === RunsCompareChartType.BAR) {\n            return (\n              <RunsCompareBarChartCard\n                config={cardConfig as RunsCompareBarCardConfig}\n                chartRunData={chartRunData}\n                onEdit={() => onStartEditChart(cardConfig)}\n                onDelete={() => onRemoveChart(cardConfig)}\n              />\n            );\n          } else if (cardConfig.type === RunsCompareChartType.LINE) {\n            return (\n              <RunsCompareLineChartCard\n                config={cardConfig as RunsCompareLineCardConfig}\n                chartRunData={chartRunData}\n                onEdit={() => onStartEditChart(cardConfig)}\n                onDelete={() => onRemoveChart(cardConfig)}\n                isMetricHistoryLoading={isMetricHistoryLoading}\n              />\n            );\n          } else if (cardConfig.type === RunsCompareChartType.SCATTER) {\n            return (\n              <RunsCompareScatterChartCard\n                config={cardConfig as RunsCompareScatterCardConfig}\n                chartRunData={chartRunData}\n                onEdit={() => onStartEditChart(cardConfig)}\n                onDelete={() => onRemoveChart(cardConfig)}\n              />\n            );\n          } else if (cardConfig.type === RunsCompareChartType.CONTOUR) {\n            return (\n              <RunsCompareContourChartCard\n                config={cardConfig as RunsCompareContourCardConfig}\n                chartRunData={chartRunData}\n                onEdit={() => onStartEditChart(cardConfig)}\n                onDelete={() => onRemoveChart(cardConfig)}\n              />\n            );\n          }\n\n          return null;\n        })}\n      </div>\n    </>\n  );\n};\n\nconst styles = {\n  chartGroupWrapper: (theme: Theme) => ({\n    display: 'flex',\n    flexDirection: 'column' as const,\n    gap: theme.spacing.md,\n  }),\n  parallelChartsWrapper: (theme: Theme) => ({\n    display: 'flex',\n    flexDirection: 'column' as const,\n    gap: theme.spacing.md,\n    marginBottom: theme.spacing.md,\n  }),\n  chartsWrapper: (theme: Theme) => ({\n    display: 'grid',\n    gridTemplateColumns: 'repeat(auto-fill, minmax(520px, 1fr))',\n    gap: theme.spacing.md,\n  }),\n};\n","import { Select, Typography } from '@databricks/design-system';\nimport React, { ComponentProps, PropsWithChildren } from 'react';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { makeCanonicalSortKey } from '../../experiment-page/utils/experimentPage.column-utils';\n\n/**\n * Represents a field in the compare run charts configuration modal.\n * Displays a title and content with proper margins.\n */\nexport const RunsCompareConfigureField = ({\n  title,\n  children,\n}: PropsWithChildren<{\n  title: string;\n}>) => {\n  return (\n    <div\n      css={(theme) => ({ marginBottom: theme.spacing.md * 2 })}\n      data-testid='experiment-view-compare-runs-config-field'\n    >\n      <Typography.Title level={4}>{title}:</Typography.Title>\n      {children}\n    </div>\n  );\n};\n\n/**\n * A searchable select for selecting metric or param from a categorized list.\n */\nexport const RunsCompareMetricParamSelect = ({\n  value,\n  onChange,\n  metricKeyList,\n  paramKeyList,\n}: {\n  value: string;\n  onChange: ComponentProps<typeof Select>['onChange'];\n  metricKeyList?: string[];\n  paramKeyList?: string[];\n}) => {\n  const { formatMessage } = useIntl();\n\n  const isEmpty = !paramKeyList?.length && !metricKeyList?.length;\n\n  return (\n    <Select\n      css={styles.selectFull}\n      value={\n        isEmpty\n          ? formatMessage({\n              description:\n                'Message displayed when no metrics or params are available in the compare runs chart configure modal',\n              defaultMessage: 'No metrics or parameters available',\n            })\n          : value\n      }\n      disabled={isEmpty}\n      onChange={onChange}\n      dangerouslySetAntdProps={{ showSearch: true }}\n    >\n      {metricKeyList?.length ? (\n        <Select.OptGroup\n          label={formatMessage({\n            defaultMessage: 'Metrics',\n            description:\n              \"Label for 'metrics' option group in the compare runs chart configure modal\",\n          })}\n        >\n          {metricKeyList.map((metric) => (\n            <Select.Option\n              key={makeCanonicalSortKey('METRIC', metric)}\n              value={makeCanonicalSortKey('METRIC', metric)}\n            >\n              {metric}\n            </Select.Option>\n          ))}\n        </Select.OptGroup>\n      ) : null}\n      {paramKeyList?.length ? (\n        <Select.OptGroup\n          label={formatMessage({\n            defaultMessage: 'Params',\n            description:\n              \"Label for 'params' option group in the compare runs chart configure modal\",\n          })}\n        >\n          {paramKeyList.map((param) => (\n            <Select.Option\n              key={makeCanonicalSortKey('PARAM', param)}\n              value={makeCanonicalSortKey('PARAM', param)}\n            >\n              {param}\n            </Select.Option>\n          ))}\n        </Select.OptGroup>\n      ) : null}\n    </Select>\n  );\n};\n\nexport const RunsCompareRunNumberSelect = ({\n  onChange,\n  value,\n  options,\n}: {\n  value?: number;\n  onChange: ComponentProps<typeof Select<number>>['onChange'];\n  options: (number | { value: number; label: React.ReactNode })[];\n}) => {\n  const { formatMessage } = useIntl();\n  return (\n    <RunsCompareConfigureField\n      title={formatMessage({\n        defaultMessage: 'Max. no of runs shown',\n        description:\n          'Label for the control allowing selection of number of runs displayed in a compare runs chart',\n      })}\n    >\n      <Select<number> css={styles.selectFull} value={value} onChange={onChange}>\n        {options.map((countOption) => {\n          const optionValue = typeof countOption === 'number' ? countOption : countOption.value;\n          const label = typeof countOption === 'number' ? countOption : countOption.label;\n          return (\n            <Select.Option key={optionValue} value={optionValue}>\n              {label}\n            </Select.Option>\n          );\n        })}\n      </Select>\n    </RunsCompareConfigureField>\n  );\n};\n\nexport const runsCompareRunCountDefaultOptions: { value: number; label: React.ReactNode }[] = [\n  // We're not using any procedural generation so react-intl extractor can parse it\n  {\n    value: 5,\n    label: (\n      <FormattedMessage\n        defaultMessage='5'\n        description='Label for 5 first runs visible in run count selector within runs compare configuration modal'\n      />\n    ),\n  },\n  {\n    value: 10,\n    label: (\n      <FormattedMessage\n        defaultMessage='10'\n        description='Label for 10 first runs visible in run count selector within runs compare configuration modal'\n      />\n    ),\n  },\n  {\n    value: 20,\n    label: (\n      <FormattedMessage\n        defaultMessage='20'\n        description='Label for 20 first runs visible in run count selector within runs compare configuration modal'\n      />\n    ),\n  },\n];\n\nconst styles = { selectFull: { width: '100%' } };\n","import { Select } from '@databricks/design-system';\nimport { useCallback, useEffect } from 'react';\nimport type { RunsCompareCardConfig, RunsCompareBarCardConfig } from '../runs-compare.types';\nimport {\n  RunsCompareConfigureField,\n  runsCompareRunCountDefaultOptions,\n  RunsCompareRunNumberSelect,\n} from './RunsCompareConfigure.common';\n\n/**\n * Form containing configuration controls for runs compare charts.\n */\nexport const RunsCompareConfigureBarChart = ({\n  state,\n  onStateChange,\n  metricKeyList,\n}: {\n  metricKeyList: string[];\n  state: Partial<RunsCompareBarCardConfig>;\n  onStateChange: (setter: (current: RunsCompareCardConfig) => RunsCompareBarCardConfig) => void;\n}) => {\n  /**\n   * Callback for updating metric key\n   */\n  const updateMetric = useCallback(\n    (metricKey: string) => {\n      onStateChange((current) => ({ ...(current as RunsCompareBarCardConfig), metricKey }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * Callback for updating run count\n   */\n  const updateVisibleRunCount = useCallback(\n    (runsCountToCompare: number) => {\n      onStateChange((current) => ({\n        ...(current as RunsCompareBarCardConfig),\n        runsCountToCompare,\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * If somehow metric key is not predetermined, automatically\n   * select the first one so it's not empty\n   */\n  useEffect(() => {\n    if (!state.metricKey && metricKeyList?.[0]) {\n      updateMetric(metricKeyList[0]);\n    }\n  }, [state.metricKey, updateMetric, metricKeyList]);\n\n  const emptyMetricsList = metricKeyList.length === 0;\n\n  return (\n    <>\n      <RunsCompareConfigureField title='Metric'>\n        <Select\n          css={styles.selectFull}\n          value={emptyMetricsList ? 'No metrics available' : state.metricKey}\n          onChange={updateMetric}\n          disabled={emptyMetricsList}\n          dangerouslySetAntdProps={{ showSearch: true }}\n        >\n          {metricKeyList.map((metric) => (\n            <Select.Option key={metric} value={metric} data-testid={`metric-${metric}`}>\n              {metric}\n            </Select.Option>\n          ))}\n        </Select>\n      </RunsCompareConfigureField>\n      <RunsCompareRunNumberSelect\n        value={state.runsCountToCompare}\n        onChange={updateVisibleRunCount}\n        options={runsCompareRunCountDefaultOptions}\n      />\n    </>\n  );\n};\n\nconst styles = { selectFull: { width: '100%' } };\n","import { Select } from '@databricks/design-system';\nimport { useCallback } from 'react';\nimport type { RunsCompareCardConfig, RunsCompareParallelCardConfig } from '../runs-compare.types';\nimport { RunsCompareConfigureField } from './RunsCompareConfigure.common';\n\n/**\n * Form containing configuration controls for runs compare charts.\n */\nexport const RunsCompareConfigureParallelChart = ({\n  state,\n  onStateChange,\n  metricKeyList,\n  paramKeyList,\n}: {\n  metricKeyList: string[];\n  paramKeyList: string[];\n  state: Partial<RunsCompareParallelCardConfig>;\n  onStateChange: (\n    setter: (current: RunsCompareCardConfig) => RunsCompareParallelCardConfig,\n  ) => void;\n}) => {\n  /**\n   * Callback for updating selected metrics and params\n   */\n\n  const updateSelectedParams = useCallback(\n    (selectedParams: string[]) => {\n      onStateChange((current) => ({\n        ...(current as RunsCompareParallelCardConfig),\n        selectedParams,\n      }));\n    },\n    [onStateChange],\n  );\n\n  const updateSelectedMetrics = useCallback(\n    (selectedMetrics: string[]) => {\n      onStateChange((current) => ({\n        ...(current as RunsCompareParallelCardConfig),\n        selectedMetrics,\n      }));\n    },\n    [onStateChange],\n  );\n\n  const emptyMetricsList = metricKeyList.length === 0;\n  const emptyParamsList = paramKeyList.length === 0;\n\n  return (\n    <>\n      <RunsCompareConfigureField title='Params'>\n        <Select\n          mode={emptyParamsList ? undefined : 'multiple'}\n          onChange={updateSelectedParams}\n          style={{\n            width: 300,\n          }}\n          value={emptyParamsList ? ('No parameters available' as any) : state.selectedParams}\n          disabled={emptyParamsList}\n        >\n          {paramKeyList.map((param) => (\n            <Select.Option value={param}>{param}</Select.Option>\n          ))}\n        </Select>\n      </RunsCompareConfigureField>\n      <RunsCompareConfigureField title='Metrics'>\n        <Select\n          mode={emptyMetricsList ? undefined : 'multiple'}\n          onChange={updateSelectedMetrics}\n          style={{\n            width: 300,\n          }}\n          value={emptyMetricsList ? ('No metrics available' as any) : state.selectedMetrics}\n          disabled={emptyMetricsList}\n        >\n          {metricKeyList.map((metric) => (\n            <Select.Option value={metric}>{metric}</Select.Option>\n          ))}\n        </Select>\n      </RunsCompareConfigureField>\n    </>\n  );\n};\n","import { Radio, Select, Switch, Tooltip, QuestionMarkIcon } from '@databricks/design-system';\nimport { FormattedMessage } from 'react-intl';\nimport { useCallback, useEffect } from 'react';\nimport type { RunsCompareCardConfig, RunsCompareLineCardConfig } from '../runs-compare.types';\nimport {\n  RunsCompareConfigureField,\n  RunsCompareRunNumberSelect,\n} from './RunsCompareConfigure.common';\nimport { LineSmoothSlider } from '../../LineSmoothSlider';\n\n/**\n * Form containing configuration controls for runs compare charts.\n */\nexport const RunsCompareConfigureLineChart = ({\n  state,\n  onStateChange,\n  metricKeyList,\n}: {\n  metricKeyList: string[];\n  state: Partial<RunsCompareLineCardConfig>;\n  onStateChange: (setter: (current: RunsCompareCardConfig) => RunsCompareLineCardConfig) => void;\n}) => {\n  /**\n   * Callback for updating metric key\n   */\n  const updateMetric = useCallback(\n    (metricKey: string) => {\n      onStateChange((current) => ({ ...(current as RunsCompareLineCardConfig), metricKey }));\n    },\n    [onStateChange],\n  );\n\n  const updateXAxisKey = useCallback(\n    (xAxisKey: RunsCompareLineCardConfig['xAxisKey']) => {\n      onStateChange((current) => ({\n        ...(current as RunsCompareLineCardConfig),\n        xAxisKey,\n      }));\n    },\n    [onStateChange],\n  );\n\n  const updateYAxisType = useCallback(\n    (isLogType: boolean) =>\n      onStateChange((current) => ({\n        ...(current as RunsCompareLineCardConfig),\n        scaleType: isLogType ? 'log' : 'linear',\n      })),\n    [onStateChange],\n  );\n\n  const updateSmoothing = useCallback(\n    (lineSmoothness: number) => {\n      onStateChange((current) => ({\n        ...(current as RunsCompareLineCardConfig),\n        lineSmoothness: lineSmoothness,\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * Callback for updating run count\n   */\n  const updateVisibleRunCount = useCallback(\n    (runsCountToCompare: number) => {\n      onStateChange((current) => ({\n        ...(current as RunsCompareLineCardConfig),\n        runsCountToCompare,\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * If somehow metric key is not predetermined, automatically\n   * select the first one so it's not empty\n   */\n  useEffect(() => {\n    if (!state.metricKey && metricKeyList?.[0]) {\n      updateMetric(metricKeyList[0]);\n    }\n  }, [state.metricKey, updateMetric, metricKeyList]);\n\n  const emptyMetricsList = metricKeyList.length === 0;\n\n  return (\n    <>\n      <RunsCompareConfigureField title='Metric (Y-axis)'>\n        <Select\n          css={styles.selectFull}\n          value={emptyMetricsList ? 'No metrics available' : state.metricKey}\n          onChange={updateMetric}\n          disabled={emptyMetricsList}\n          dangerouslySetAntdProps={{ showSearch: true }}\n        >\n          {metricKeyList.map((metric) => (\n            <Select.Option key={metric} value={metric} data-testid={`metric-${metric}`}>\n              {metric}\n            </Select.Option>\n          ))}\n        </Select>\n      </RunsCompareConfigureField>\n      <RunsCompareConfigureField title='X-axis'>\n        <Radio.Group\n          value={state.xAxisKey}\n          onChange={({ target: { value } }) => updateXAxisKey(value)}\n        >\n          <Radio value='step'>Step</Radio>\n          <Radio value='time'>\n            Time (wall)\n            <Tooltip\n              title={\n                <FormattedMessage\n                  defaultMessage='Absolute date and time'\n                  description='A tooltip line chart configuration for the step function of wall time'\n                />\n              }\n              placement='right'\n            >\n              {' '}\n              <QuestionMarkIcon css={styles.timeStepQuestionMarkIcon} />\n            </Tooltip>\n          </Radio>\n          <Radio value='time-relative'>\n            Time (relative)\n            <Tooltip\n              title={\n                <FormattedMessage\n                  defaultMessage='Amount of time that has passed since the first metric value was logged'\n                  description='A tooltip line chart configuration for the step function of relative time'\n                />\n              }\n              placement='right'\n            >\n              {' '}\n              <QuestionMarkIcon css={styles.timeStepQuestionMarkIcon} />\n            </Tooltip>\n          </Radio>\n        </Radio.Group>\n      </RunsCompareConfigureField>\n      <RunsCompareConfigureField title='Y-axis log scale'>\n        <Switch checked={state.scaleType === 'log'} onChange={updateYAxisType} label='Enabled' />\n      </RunsCompareConfigureField>\n      <RunsCompareConfigureField title='Line smoothness'>\n        <LineSmoothSlider\n          data-testid='smoothness-toggle'\n          min={0}\n          max={100}\n          handleLineSmoothChange={updateSmoothing}\n          defaultValue={state.lineSmoothness ? state.lineSmoothness : 0}\n        />\n      </RunsCompareConfigureField>\n      <RunsCompareRunNumberSelect\n        value={state.runsCountToCompare}\n        onChange={updateVisibleRunCount}\n        options={[5, 10, 20]}\n      />\n    </>\n  );\n};\n\nconst styles = {\n  selectFull: { width: '100%' },\n  timeStepQuestionMarkIcon: () => ({\n    svg: { width: 12, height: 12 },\n  }),\n};\n","import { useCallback, useEffect, useMemo, useState } from 'react';\nimport { getMetricHistoryApiBulk } from '../../../actions';\nimport type { MetricHistoryByName } from '../../../types';\nimport { useAsyncDispatch } from '../../experiment-page/hooks/useAsyncDispatch';\nimport type { CompareChartRunData } from '../charts/CompareRunsCharts.common';\n\n/**\n * Automatically fetches metric history for runs, used in compare runs charts.\n * After updating list of metrics or runs, optimizes the request and fetches\n * only the missing entries.\n */\nexport const useFetchCompareRunsMetricHistory = (\n  // We can fetch multiple metrics at once\n  metricKeys: string[],\n  runsData: CompareChartRunData[],\n  currentStoreMetrics: Record<string, MetricHistoryByName>,\n) => {\n  const dispatch = useAsyncDispatch();\n\n  const [error, setError] = useState<any>(null);\n  const [requests, setRequests] = useState<Record<string, boolean>>({});\n\n  /**\n   * We store pending requests in \"<run-id>-<metric-key>\" format,\n   * the function below changes the state of pending requests\n   */\n  const setRequestsPending = useCallback(\n    (runUuids: string[], metric: string, value: boolean) => {\n      setRequests((currentRequests) => {\n        const result = { ...currentRequests };\n        for (const uuid of runUuids) {\n          const key = `${uuid}-${metric}`;\n          result[key] = value;\n        }\n        return result;\n      });\n    },\n    [setRequests],\n  );\n\n  const addRequests = useCallback(\n    (runUuids: string[], metric: string) => setRequestsPending(runUuids, metric, true),\n    [setRequestsPending],\n  );\n\n  const settleRequests = useCallback(\n    (runUuids: string[], metric: string) => setRequestsPending(runUuids, metric, false),\n    [setRequestsPending],\n  );\n\n  const isLoading = useMemo(() => {\n    const runUuids = runsData.map((r) => r.runInfo.run_uuid);\n    for (const uuid of runUuids) {\n      for (const metric of metricKeys) {\n        const isPendingRequest = requests[`${uuid}-${metric}`];\n        if (isPendingRequest) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }, [metricKeys, requests, runsData]);\n\n  useEffect(() => {\n    if (!metricKeys.length) {\n      return;\n    }\n\n    for (const metricKey of metricKeys) {\n      if (!metricKey) {\n        continue;\n      }\n\n      // Determine which runs does not have corresponding\n      // metric history entries already fetched and stored\n      const runUuids = runsData.map((r) => r.runInfo.run_uuid);\n      const runUuidsToFetch = runUuids.filter((runUuid) => {\n        const isInStore = Boolean(currentStoreMetrics[runUuid]?.[metricKey]);\n        const isPendingRequest = requests[`${runUuid}-${metricKey}`];\n        return !isInStore && !isPendingRequest;\n      });\n\n      if (!runUuidsToFetch.length) {\n        continue;\n      }\n\n      // Register request for history in the internal state\n      addRequests(runUuidsToFetch, metricKey);\n\n      // Dispatch the action\n      // @ts-expect-error TS(2554): Expected 4-5 arguments, but got 2.\n      dispatch(getMetricHistoryApiBulk(runUuidsToFetch, metricKey))\n        .then(() => {\n          // Settle request in the internal state if it's resolved\n          settleRequests(runUuidsToFetch, metricKey);\n        })\n        .catch((e) => {\n          // Set the internal state error if occurred\n          setError(e);\n        });\n    }\n  }, [addRequests, currentStoreMetrics, dispatch, settleRequests, metricKeys, requests, runsData]);\n\n  return { isLoading, error };\n};\n","import { LegacySkeleton } from '@databricks/design-system';\nimport { useMemo } from 'react';\nimport { connect } from 'react-redux';\nimport { ReduxState } from '../../../../redux-types';\nimport { MetricHistoryByName } from '../../../types';\nimport type { CompareChartRunData } from '../charts/CompareRunsCharts.common';\nimport { CompareRunsMetricsLinePlot } from '../charts/CompareRunsMetricsLinePlot';\nimport { useCompareRunsTooltip } from '../hooks/useCompareRunsTooltip';\nimport { useFetchCompareRunsMetricHistory } from '../hooks/useFetchCompareRunsMetricHistory';\nimport { RunsCompareLineCardConfig } from '../runs-compare.types';\n\nexport const RunsCompareConfigureLineChartPreviewImpl = ({\n  previewData,\n  cardConfig,\n  metricsByRunUuid,\n}: {\n  previewData: CompareChartRunData[];\n  cardConfig: RunsCompareLineCardConfig;\n\n  metricsByRunUuid: Record<string, MetricHistoryByName>;\n}) => {\n  const metricKeysToFetch = useMemo(() => [cardConfig.metricKey], [cardConfig.metricKey]);\n  const { isLoading, error } = useFetchCompareRunsMetricHistory(\n    metricKeysToFetch,\n    previewData,\n    metricsByRunUuid,\n  );\n\n  const previewDataWithHistory = useMemo<CompareChartRunData[]>(\n    () =>\n      previewData.map((previewRun) => ({\n        ...previewRun,\n        metricsHistory: metricsByRunUuid[previewRun.runInfo.run_uuid],\n      })),\n    [previewData, metricsByRunUuid],\n  );\n\n  const { resetTooltip, setTooltip } = useCompareRunsTooltip(cardConfig);\n\n  if (isLoading) {\n    return <LegacySkeleton />;\n  }\n\n  if (error) {\n    return <>Error occured!</>;\n  }\n\n  return (\n    <CompareRunsMetricsLinePlot\n      runsData={previewDataWithHistory}\n      metricKey={cardConfig.metricKey}\n      scaleType={cardConfig.scaleType}\n      lineSmoothness={cardConfig.lineSmoothness}\n      xAxisKey={cardConfig.xAxisKey}\n      useDefaultHoverBox={false}\n      onHover={setTooltip}\n      onUnhover={resetTooltip}\n    />\n  );\n};\n\nconst mapStateToProps = ({ entities: { metricsByRunUuid } }: ReduxState) => ({\n  metricsByRunUuid,\n});\n\n/**\n * Preview of line chart used in compare runs configuration modal\n */\nexport const RunsCompareConfigureLineChartPreview = connect(mapStateToProps, undefined, undefined, {\n  areStatesEqual: (nextState, prevState) =>\n    nextState.entities.metricsByRunUuid === prevState.entities.metricsByRunUuid,\n})(RunsCompareConfigureLineChartPreviewImpl);\n","import { CompareChartRunData } from '../charts/CompareRunsCharts.common';\nimport LazyParallelCoordinatesPlot, {\n  processParallelCoordinateData,\n} from '../charts/LazyParallelCoordinatesPlot';\nimport { useCompareRunsTooltip } from '../hooks/useCompareRunsTooltip';\nimport { RunsCompareParallelCardConfig } from '../runs-compare.types';\n\nexport const RunsCompareConfigureParallelChartPreview = ({\n  previewData,\n  cardConfig,\n}: {\n  previewData: CompareChartRunData[];\n  cardConfig: RunsCompareParallelCardConfig;\n}) => {\n  const selectedParamsCount = cardConfig.selectedParams?.length || 0;\n  const selectedMetricsCount = cardConfig.selectedMetrics?.length || 0;\n\n  const isConfigured = selectedParamsCount + selectedMetricsCount >= 2;\n\n  const { setTooltip, resetTooltip } = useCompareRunsTooltip(cardConfig);\n\n  const filteredData = isConfigured\n    ? processParallelCoordinateData(\n        previewData,\n        cardConfig.selectedParams,\n        cardConfig.selectedMetrics,\n      )\n    : [];\n\n  if (!isConfigured) {\n    return (\n      <div css={{ display: 'flex', justifyContent: 'center', alignItems: 'center' }}>\n        Select at least two metrics and params first\n      </div>\n    );\n  }\n\n  return filteredData.length ? (\n    /* Avoid displaying empty set, otherwise parcoord-es crashes */\n    <LazyParallelCoordinatesPlot\n      selectedMetrics={cardConfig.selectedMetrics}\n      selectedParams={cardConfig.selectedParams}\n      data={filteredData}\n      axesRotateThreshold={6}\n      onHover={setTooltip}\n      onUnhover={resetTooltip}\n    />\n  ) : null;\n};\n","import { useCallback, useEffect } from 'react';\nimport { useIntl } from 'react-intl';\nimport {\n  extractCanonicalSortKey,\n  isCanonicalSortKeyOfType,\n  makeCanonicalSortKey,\n} from '../../experiment-page/utils/experimentPage.column-utils';\nimport type { RunsCompareCardConfig, RunsCompareContourCardConfig } from '../runs-compare.types';\nimport {\n  RunsCompareMetricParamSelect,\n  RunsCompareConfigureField,\n  RunsCompareRunNumberSelect,\n} from './RunsCompareConfigure.common';\n\ntype ValidAxis = keyof Pick<RunsCompareContourCardConfig, 'xaxis' | 'yaxis' | 'zaxis'>;\n\n/**\n * Form containing configuration controls for Contour runs compare chart.\n */\nexport const RunsCompareConfigureContourChart = ({\n  state,\n  onStateChange,\n  metricKeyList,\n  paramKeyList,\n}: {\n  metricKeyList: string[];\n  paramKeyList: string[];\n  state: RunsCompareContourCardConfig;\n  onStateChange: (setter: (current: RunsCompareCardConfig) => RunsCompareContourCardConfig) => void;\n}) => {\n  const { formatMessage } = useIntl();\n\n  /**\n   * Callback for updating X or Y axis\n   */\n  const updateAxis = useCallback(\n    (canonicalKey: string, axis: ValidAxis) => {\n      const type = isCanonicalSortKeyOfType(canonicalKey, 'METRIC') ? 'METRIC' : 'PARAM';\n      const key = extractCanonicalSortKey(canonicalKey, type);\n      onStateChange((current) => ({\n        ...(current as RunsCompareContourCardConfig),\n        [axis]: { key, type },\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * Callback for updating run count\n   */\n  const updateVisibleRunCount = useCallback(\n    (runsCountToCompare: number) => {\n      onStateChange((current) => ({\n        ...(current as RunsCompareContourCardConfig),\n        runsCountToCompare,\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * If somehow axes are not predetermined, automatically\n   * select the first metric/param so it's not empty\n   */\n  useEffect(() => {\n    const firstMetric = metricKeyList?.[0];\n    const firstParam = paramKeyList?.[0];\n    if (!state.xaxis?.key) {\n      if (firstMetric) {\n        updateAxis(makeCanonicalSortKey('METRIC', firstMetric), 'xaxis');\n      } else if (firstParam) {\n        updateAxis(makeCanonicalSortKey('PARAM', firstParam), 'xaxis');\n      }\n    }\n    if (!state.yaxis?.key) {\n      if (firstMetric) {\n        updateAxis(makeCanonicalSortKey('METRIC', firstMetric), 'yaxis');\n      } else if (firstParam) {\n        updateAxis(makeCanonicalSortKey('PARAM', firstParam), 'yaxis');\n      }\n    }\n    if (!state.zaxis?.key) {\n      if (firstMetric) {\n        updateAxis(makeCanonicalSortKey('METRIC', firstMetric), 'zaxis');\n      } else if (firstParam) {\n        updateAxis(makeCanonicalSortKey('PARAM', firstParam), 'zaxis');\n      }\n    }\n  }, [state.xaxis, state.yaxis, state.zaxis, updateAxis, metricKeyList, paramKeyList]);\n\n  return (\n    <>\n      <RunsCompareConfigureField\n        title={formatMessage({\n          defaultMessage: 'X axis',\n          description:\n            'Label for X axis in Contour chart configurator in compare runs chart config modal',\n        })}\n      >\n        <RunsCompareMetricParamSelect\n          value={state.xaxis.key ? makeCanonicalSortKey(state.xaxis.type, state.xaxis.key) : ''}\n          onChange={(value) => {\n            updateAxis(value, 'xaxis');\n          }}\n          paramKeyList={paramKeyList}\n          metricKeyList={metricKeyList}\n        />\n      </RunsCompareConfigureField>\n      <RunsCompareConfigureField\n        title={formatMessage({\n          defaultMessage: 'Y axis',\n          description:\n            'Label for Y axis in Contour chart configurator in compare runs chart config modal',\n        })}\n      >\n        <RunsCompareMetricParamSelect\n          value={state.yaxis.key ? makeCanonicalSortKey(state.yaxis.type, state.yaxis.key) : ''}\n          onChange={(value) => {\n            updateAxis(value, 'yaxis');\n          }}\n          paramKeyList={paramKeyList}\n          metricKeyList={metricKeyList}\n        />\n      </RunsCompareConfigureField>\n      <RunsCompareConfigureField\n        title={formatMessage({\n          defaultMessage: 'Z axis',\n          description:\n            'Label for Z axis in Contour chart configurator in compare runs chart config modal',\n        })}\n      >\n        <RunsCompareMetricParamSelect\n          value={state.zaxis.key ? makeCanonicalSortKey(state.zaxis.type, state.zaxis.key) : ''}\n          onChange={(value) => {\n            updateAxis(value, 'zaxis');\n          }}\n          paramKeyList={paramKeyList}\n          metricKeyList={metricKeyList}\n        />\n      </RunsCompareConfigureField>\n      <RunsCompareRunNumberSelect\n        value={state.runsCountToCompare}\n        onChange={updateVisibleRunCount}\n        options={[5, 10, 20]}\n      />\n    </>\n  );\n};\n","import { useCallback, useEffect } from 'react';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport {\n  extractCanonicalSortKey,\n  isCanonicalSortKeyOfType,\n  makeCanonicalSortKey,\n} from '../../experiment-page/utils/experimentPage.column-utils';\nimport type { RunsCompareCardConfig, RunsCompareScatterCardConfig } from '../runs-compare.types';\nimport {\n  RunsCompareMetricParamSelect,\n  RunsCompareConfigureField,\n  RunsCompareRunNumberSelect,\n  runsCompareRunCountDefaultOptions,\n} from './RunsCompareConfigure.common';\n\ntype ValidAxis = keyof Pick<RunsCompareScatterCardConfig, 'xaxis' | 'yaxis'>;\n\nconst scatterPlotDefaultOptions = runsCompareRunCountDefaultOptions;\nscatterPlotDefaultOptions.push(\n  {\n    value: 100,\n    label: (\n      <FormattedMessage\n        defaultMessage='100'\n        description='Label for 100 first runs visible in run count selector within runs compare configuration modal'\n      />\n    ),\n  },\n  {\n    value: 250,\n    label: (\n      <FormattedMessage\n        defaultMessage='250'\n        description='Label for 250 first runs visible in run count selector within runs compare configuration modal'\n      />\n    ),\n  },\n  {\n    value: 500,\n    label: (\n      <FormattedMessage\n        defaultMessage='500'\n        description='Label for 500 first runs visible in run count selector within runs compare configuration modal'\n      />\n    ),\n  },\n);\n\n/**\n * Form containing configuration controls for scatter runs compare chart.\n */\nexport const RunsCompareConfigureScatterChart = ({\n  state,\n  onStateChange,\n  metricKeyList,\n  paramKeyList,\n}: {\n  metricKeyList: string[];\n  paramKeyList: string[];\n  state: RunsCompareScatterCardConfig;\n  onStateChange: (setter: (current: RunsCompareCardConfig) => RunsCompareScatterCardConfig) => void;\n}) => {\n  const { formatMessage } = useIntl();\n\n  /**\n   * Callback for updating X or Y axis\n   */\n  const updateAxis = useCallback(\n    (canonicalKey: string, axis: ValidAxis) => {\n      const type = isCanonicalSortKeyOfType(canonicalKey, 'METRIC') ? 'METRIC' : 'PARAM';\n      const key = extractCanonicalSortKey(canonicalKey, type);\n      onStateChange((current) => ({\n        ...(current as RunsCompareScatterCardConfig),\n        [axis]: { key, type },\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * Callback for updating run count\n   */\n  const updateVisibleRunCount = useCallback(\n    (runsCountToCompare: number) => {\n      onStateChange((current) => ({\n        ...(current as RunsCompareScatterCardConfig),\n        runsCountToCompare,\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * If somehow axes are not predetermined, automatically\n   * select the first metric/param so it's not empty\n   */\n  useEffect(() => {\n    const firstMetric = metricKeyList?.[0];\n    const firstParam = paramKeyList?.[0];\n    if (!state.xaxis?.key) {\n      if (firstMetric) {\n        updateAxis(makeCanonicalSortKey('METRIC', firstMetric), 'xaxis');\n      } else if (firstParam) {\n        updateAxis(makeCanonicalSortKey('PARAM', firstParam), 'xaxis');\n      }\n    }\n    if (!state.yaxis?.key) {\n      if (firstMetric) {\n        updateAxis(makeCanonicalSortKey('METRIC', firstMetric), 'yaxis');\n      } else if (firstParam) {\n        updateAxis(makeCanonicalSortKey('PARAM', firstParam), 'yaxis');\n      }\n    }\n  }, [state.xaxis, state.yaxis, updateAxis, metricKeyList, paramKeyList]);\n\n  return (\n    <>\n      <RunsCompareConfigureField\n        title={formatMessage({\n          defaultMessage: 'X axis',\n          description:\n            'Label for X axis in scatter chart configurator in compare runs chart config modal',\n        })}\n      >\n        <RunsCompareMetricParamSelect\n          value={state.xaxis.key ? makeCanonicalSortKey(state.xaxis.type, state.xaxis.key) : ''}\n          onChange={(value) => {\n            updateAxis(value, 'xaxis');\n          }}\n          paramKeyList={paramKeyList}\n          metricKeyList={metricKeyList}\n        />\n      </RunsCompareConfigureField>\n      <RunsCompareConfigureField\n        title={formatMessage({\n          defaultMessage: 'Y axis',\n          description:\n            'Label for Y axis in scatter chart configurator in compare runs chart config modal',\n        })}\n      >\n        <RunsCompareMetricParamSelect\n          value={state.yaxis.key ? makeCanonicalSortKey(state.yaxis.type, state.yaxis.key) : ''}\n          onChange={(value) => {\n            updateAxis(value, 'yaxis');\n          }}\n          paramKeyList={paramKeyList}\n          metricKeyList={metricKeyList}\n        />\n      </RunsCompareConfigureField>\n      <RunsCompareRunNumberSelect\n        value={state.runsCountToCompare}\n        onChange={updateVisibleRunCount}\n        options={scatterPlotDefaultOptions}\n      />\n    </>\n  );\n};\n","import {\n  Button,\n  CloseIcon,\n  PinIcon,\n  PinFillIcon,\n  Tooltip,\n  VisibleIcon,\n} from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport { FormattedMessage } from 'react-intl';\nimport { Link } from '../../../common/utils/RoutingUtils';\nimport Routes from '../../routes';\nimport { useExperimentIds } from '../experiment-page/hooks/useExperimentIds';\nimport { CompareChartRunData, truncateString } from './charts/CompareRunsCharts.common';\nimport { CompareRunsTooltipBodyProps } from './hooks/useCompareRunsTooltip';\nimport {\n  RunsCompareBarCardConfig,\n  RunsCompareCardConfig,\n  RunsCompareChartType,\n  RunsCompareScatterCardConfig,\n  RunsCompareContourCardConfig,\n  RunsCompareLineCardConfig,\n  RunsCompareParallelCardConfig,\n} from './runs-compare.types';\n\ninterface LineXAxisValues {\n  value: number;\n  index: number;\n  label: string;\n}\n\ninterface CompareChartContextMenuContentDataType {\n  runs: CompareChartRunData[];\n  onTogglePin?: (runUuid: string) => void;\n  onHideRun?: (runUuid: string) => void;\n}\n\ntype CompareChartContextMenuHoverDataType = RunsCompareCardConfig;\n\nconst normalizeValue = (value: string | number, decimalPlaces = 6) => {\n  if (typeof value === 'number') {\n    return value.toFixed(decimalPlaces);\n  }\n  // cast to numbers that have for values that have been previously stringified\n  const castToNumber = Number(value);\n  if (!isNaN(castToNumber)) {\n    return castToNumber.toFixed(decimalPlaces);\n  }\n  // truncate strings that are too long\n  return truncateString(value, 8);\n};\n\nconst createBarChartValuesBox = (\n  cardConfig: RunsCompareBarCardConfig,\n  activeRun: CompareChartRunData,\n) => {\n  const { metricKey } = cardConfig;\n  const metric = activeRun?.metrics[metricKey];\n\n  if (!metric) {\n    return null;\n  }\n\n  return (\n    <div css={styles.value}>\n      <strong>{metric.key}:</strong> {normalizeValue(metric.value)}\n    </div>\n  );\n};\n\nconst createScatterChartValuesBox = (\n  cardConfig: RunsCompareScatterCardConfig,\n  activeRun: CompareChartRunData,\n) => {\n  const { xaxis, yaxis } = cardConfig;\n  const xKey = xaxis.key;\n  const yKey = yaxis.key;\n\n  const xValue =\n    xaxis.type === 'METRIC' ? activeRun.metrics[xKey]?.value : activeRun.params[xKey]?.value;\n\n  const yValue =\n    yaxis.type === 'METRIC' ? activeRun.metrics[yKey]?.value : activeRun.params[yKey]?.value;\n\n  return (\n    <>\n      {xValue && (\n        <div css={styles.value}>\n          <strong>X ({xKey}):</strong> {normalizeValue(xValue)}\n        </div>\n      )}\n      {yValue && (\n        <div css={styles.value}>\n          <strong>Y ({yKey}):</strong> {normalizeValue(yValue)}\n        </div>\n      )}\n    </>\n  );\n};\n\nconst createContourChartValuesBox = (\n  cardConfig: RunsCompareContourCardConfig,\n  activeRun: CompareChartRunData,\n) => {\n  const { xaxis, yaxis, zaxis } = cardConfig;\n  const xKey = xaxis.key;\n  const yKey = yaxis.key;\n  const zKey = zaxis.key;\n\n  const xValue =\n    xaxis.type === 'METRIC' ? activeRun.metrics[xKey]?.value : activeRun.params[xKey]?.value;\n\n  const yValue =\n    yaxis.type === 'METRIC' ? activeRun.metrics[yKey]?.value : activeRun.params[yKey]?.value;\n\n  const zValue =\n    zaxis.type === 'METRIC' ? activeRun.metrics[zKey]?.value : activeRun.params[zKey]?.value;\n\n  return (\n    <>\n      {xValue && (\n        <div css={styles.value}>\n          <strong>X ({xKey}):</strong> {normalizeValue(xValue)}\n        </div>\n      )}\n      {yValue && (\n        <div css={styles.value}>\n          <strong>Y ({yKey}):</strong> {normalizeValue(yValue)}\n        </div>\n      )}\n      {zValue && (\n        <div css={styles.value}>\n          <strong>Z ({zKey}):</strong> {normalizeValue(zValue)}\n        </div>\n      )}\n    </>\n  );\n};\n\nconst createLineChartValuesBox = (\n  cardConfig: RunsCompareLineCardConfig,\n  activeRun: CompareChartRunData,\n  xAxisValues?: LineXAxisValues,\n) => {\n  const { metricKey } = cardConfig;\n  const metric =\n    // If there's available value from x axis (step or time), extract entry from\n    // metric history instead of latest metric.\n    (xAxisValues && activeRun?.metricsHistory?.[metricKey]?.[xAxisValues?.index]) ??\n    activeRun?.metrics[metricKey];\n\n  if (!metric) {\n    return null;\n  }\n\n  return (\n    <>\n      {xAxisValues && (\n        <div css={styles.value}>\n          <strong>{xAxisValues.label}:</strong> {xAxisValues.value}\n        </div>\n      )}\n      <div css={styles.value}>\n        <strong>{metric.key}:</strong> {normalizeValue(metric.value)}\n      </div>\n    </>\n  );\n};\n\nconst createParallelChartValuesBox = (\n  cardConfig: RunsCompareParallelCardConfig,\n  activeRun: CompareChartRunData,\n  isHovering?: boolean,\n) => {\n  const { selectedParams, selectedMetrics } = cardConfig as RunsCompareParallelCardConfig;\n  const paramsList = selectedParams.map((paramKey) => {\n    const param = activeRun?.params[paramKey];\n    if (param) {\n      return (\n        <div>\n          <strong>{param.key}:</strong> {normalizeValue(param.value)}\n        </div>\n      );\n    }\n    return true;\n  });\n  const metricsList = selectedMetrics.map((metricKey) => {\n    const metric = activeRun?.metrics[metricKey];\n    if (metric) {\n      return (\n        <div>\n          <strong>{metric.key}:</strong> {normalizeValue(metric.value)}\n        </div>\n      );\n    }\n    return true;\n  });\n\n  // show only first 3 params and primary metric if hovering, else show all\n  if (isHovering) {\n    return (\n      <>\n        {paramsList.slice(0, 3)}\n        {metricsList[metricsList.length - 1]}\n        {(paramsList.length > 3 || metricsList.length > 1) && <div>...</div>}\n      </>\n    );\n  } else {\n    return (\n      <>\n        {paramsList}\n        {metricsList}\n      </>\n    );\n  }\n};\n\n/**\n * Internal component that displays metrics/params - its final design\n * is a subject to change\n */\nconst ValuesBox = ({\n  activeRun,\n  cardConfig,\n  isHovering,\n  xAxisValues,\n}: {\n  activeRun: CompareChartRunData;\n  cardConfig: RunsCompareCardConfig;\n  isHovering?: boolean;\n  xAxisValues?: LineXAxisValues;\n}) => {\n  if (cardConfig.type === RunsCompareChartType.BAR) {\n    return createBarChartValuesBox(cardConfig as RunsCompareBarCardConfig, activeRun);\n  }\n\n  if (cardConfig.type === RunsCompareChartType.SCATTER) {\n    return createScatterChartValuesBox(cardConfig as RunsCompareScatterCardConfig, activeRun);\n  }\n\n  if (cardConfig.type === RunsCompareChartType.CONTOUR) {\n    return createContourChartValuesBox(cardConfig as RunsCompareContourCardConfig, activeRun);\n  }\n\n  if (cardConfig.type === RunsCompareChartType.LINE) {\n    return createLineChartValuesBox(\n      cardConfig as RunsCompareLineCardConfig,\n      activeRun,\n      xAxisValues,\n    );\n  }\n\n  if (cardConfig.type === RunsCompareChartType.PARALLEL) {\n    return createParallelChartValuesBox(\n      cardConfig as RunsCompareParallelCardConfig,\n      activeRun,\n      isHovering,\n    );\n  }\n\n  return null;\n};\n\nexport const RunsCompareTooltipBody = ({\n  closeContextMenu,\n  contextData,\n  additionalAxisData,\n  hoverData: cardConfig,\n  runUuid,\n  isHovering,\n}: CompareRunsTooltipBodyProps<\n  CompareChartContextMenuContentDataType,\n  CompareChartContextMenuHoverDataType\n>) => {\n  const { runs, onTogglePin, onHideRun } = contextData;\n  const [experimentId] = useExperimentIds();\n  const activeRun = runs?.find((run) => run.runInfo.run_uuid === runUuid);\n\n  if (!activeRun) {\n    return null;\n  }\n\n  return (\n    <div>\n      <div css={styles.contentWrapper}>\n        <div css={styles.header}>\n          <div css={styles.colorPill} style={{ backgroundColor: activeRun.color }} />\n          <Link\n            to={Routes.getRunPageRoute(experimentId, runUuid)}\n            target='_blank'\n            css={styles.runLink}\n            onClick={closeContextMenu}\n          >\n            {activeRun.runInfo.run_name || activeRun.runInfo.run_uuid}\n          </Link>\n        </div>\n        {!isHovering && <Button size='small' onClick={closeContextMenu} icon={<CloseIcon />} />}\n      </div>\n\n      <ValuesBox\n        isHovering={isHovering}\n        activeRun={activeRun}\n        cardConfig={cardConfig}\n        xAxisValues={additionalAxisData}\n      />\n\n      <div css={styles.actionsWrapper}>\n        {activeRun.pinnable && onTogglePin && (\n          <Tooltip\n            title={\n              activeRun.pinned ? (\n                <FormattedMessage\n                  defaultMessage='Unpin run'\n                  description='A tooltip for the pin icon button in the runs table next to the pinned run'\n                />\n              ) : (\n                <FormattedMessage\n                  defaultMessage='Click to pin the run'\n                  description='A tooltip for the pin icon button in the runs chart tooltip next to the not pinned run'\n                />\n              )\n            }\n            placement='bottom'\n          >\n            <Button\n              size='small'\n              onClick={() => {\n                onTogglePin(runUuid);\n                closeContextMenu();\n              }}\n              icon={activeRun.pinned ? <PinFillIcon /> : <PinIcon />}\n            />\n          </Tooltip>\n        )}\n        {onHideRun && (\n          <Tooltip\n            title={\n              <FormattedMessage\n                defaultMessage='Click to hide the run'\n                description='A tooltip for the \"hide\" icon button in the runs chart tooltip'\n              />\n            }\n            placement='bottom'\n          >\n            <Button\n              data-testid='experiment-view-compare-runs-tooltip-visibility-button'\n              size='small'\n              onClick={() => {\n                onHideRun(runUuid);\n                closeContextMenu();\n              }}\n              icon={<VisibleIcon />}\n            />\n          </Tooltip>\n        )}\n      </div>\n    </div>\n  );\n};\n\nconst styles = {\n  runLink: (theme: Theme) => ({\n    color: theme.colors.primary,\n    '&:hover': {},\n  }),\n  actionsWrapper: {\n    marginTop: 8,\n    display: 'flex',\n    gap: 8,\n    alignItems: 'center',\n  },\n  header: {\n    display: 'flex',\n    gap: 8,\n    alignItems: 'center',\n  },\n  value: {\n    maxWidth: 300,\n    whiteSpace: 'nowrap' as const,\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n  },\n  contentWrapper: {\n    display: 'flex',\n    gap: 8,\n    alignItems: 'center',\n    marginBottom: 12,\n    justifyContent: 'space-between',\n    height: 24,\n  },\n  colorPill: { width: 12, height: 12, borderRadius: '100%' },\n};\n","/**\n * TODO: implement actual UI for this modal, it's a crude placeholder with minimal logic for now\n */\nimport { Modal, Select } from '@databricks/design-system';\nimport { Interpolation, Theme } from '@emotion/react';\nimport React, { useCallback, useMemo, useState } from 'react';\nimport { useIntl } from 'react-intl';\nimport {\n  RunsCompareBarCardConfig,\n  RunsCompareCardConfig,\n  RunsCompareChartType,\n  RunsCompareLineCardConfig,\n  RunsCompareContourCardConfig,\n  RunsCompareScatterCardConfig,\n  RunsCompareParallelCardConfig,\n} from './runs-compare.types';\n\nimport { ReactComponent as ChartBarIcon } from '../../../common/static/chart-bar.svg';\nimport { ReactComponent as ChartContourIcon } from '../../../common/static/chart-contour.svg';\nimport { ReactComponent as ChartLineIcon } from '../../../common/static/chart-line.svg';\nimport { ReactComponent as ChartParallelIcon } from '../../../common/static/chart-parallel.svg';\nimport { ReactComponent as ChartScatterIcon } from '../../../common/static/chart-scatter.svg';\nimport { RunsCompareConfigureBarChart } from './config/RunsCompareConfigureBarChart';\nimport { RunsCompareConfigureParallelChart } from './config/RunsCompareConfigureParallelChart';\nimport type { CompareChartRunData } from './charts/CompareRunsCharts.common';\nimport { RunsCompareConfigureField } from './config/RunsCompareConfigure.common';\nimport { RunsCompareConfigureLineChart } from './config/RunsCompareConfigureLineChart';\nimport { RunsCompareConfigureLineChartPreview } from './config/RunsCompareConfigureLineChart.preview';\nimport { RunsCompareConfigureBarChartPreview } from './config/RunsCompareConfigureBarChart.preview';\nimport { RunsCompareConfigureContourChartPreview } from './config/RunsCompareConfigureContourChart.preview';\nimport { RunsCompareConfigureScatterChartPreview } from './config/RunsCompareConfigureScatterChart.preview';\nimport { RunsCompareConfigureParallelChartPreview } from './config/RunsCompareConfigureParallelChart.preview';\nimport { RunsCompareConfigureContourChart } from './config/RunsCompareConfigureContourChart';\nimport { RunsCompareConfigureScatterChart } from './config/RunsCompareConfigureScatterChart';\nimport { RunsCompareTooltipBody } from './RunsCompareTooltipBody';\nimport { CompareRunsTooltipWrapper } from './hooks/useCompareRunsTooltip';\n\nconst previewComponentsMap: Record<\n  RunsCompareChartType,\n  React.FC<{\n    previewData: CompareChartRunData[];\n    cardConfig: any;\n  }>\n> = {\n  [RunsCompareChartType.BAR]: RunsCompareConfigureBarChartPreview,\n  [RunsCompareChartType.CONTOUR]: RunsCompareConfigureContourChartPreview,\n  [RunsCompareChartType.LINE]: RunsCompareConfigureLineChartPreview,\n  [RunsCompareChartType.PARALLEL]: RunsCompareConfigureParallelChartPreview,\n  [RunsCompareChartType.SCATTER]: RunsCompareConfigureScatterChartPreview,\n};\n\nexport const RunsCompareConfigureModal = ({\n  onCancel,\n  onSubmit,\n  config,\n  chartRunData,\n  metricKeyList,\n  paramKeyList,\n}: {\n  metricKeyList: string[];\n  paramKeyList: string[];\n  config: RunsCompareCardConfig;\n  chartRunData: CompareChartRunData[];\n  onCancel: () => void;\n  onSubmit: (formData: Partial<RunsCompareCardConfig>) => void;\n}) => {\n  const [currentFormState, setCurrentFormState] = useState<RunsCompareCardConfig>(config);\n\n  const isEditing = Boolean(currentFormState.uuid);\n\n  const updateChartType = useCallback((type?: RunsCompareChartType) => {\n    if (!type) {\n      return;\n    }\n    const emptyChartCard = RunsCompareCardConfig.getEmptyChartCardByType(type);\n    if (emptyChartCard) {\n      setCurrentFormState(emptyChartCard);\n    }\n  }, []);\n\n  const renderConfigOptionsforChartType = (type?: RunsCompareChartType) => {\n    if (type === RunsCompareChartType.BAR) {\n      return (\n        <RunsCompareConfigureBarChart\n          metricKeyList={metricKeyList}\n          state={currentFormState as RunsCompareBarCardConfig}\n          onStateChange={setCurrentFormState}\n        />\n      );\n    }\n    if (type === RunsCompareChartType.CONTOUR) {\n      return (\n        <RunsCompareConfigureContourChart\n          metricKeyList={metricKeyList}\n          paramKeyList={paramKeyList}\n          state={currentFormState as RunsCompareContourCardConfig}\n          onStateChange={setCurrentFormState}\n        />\n      );\n    }\n    if (type === RunsCompareChartType.LINE) {\n      return (\n        <RunsCompareConfigureLineChart\n          metricKeyList={metricKeyList}\n          state={currentFormState as RunsCompareLineCardConfig}\n          onStateChange={setCurrentFormState}\n        />\n      );\n    }\n    if (type === RunsCompareChartType.PARALLEL) {\n      return (\n        <RunsCompareConfigureParallelChart\n          metricKeyList={metricKeyList}\n          paramKeyList={paramKeyList}\n          state={currentFormState as RunsCompareParallelCardConfig}\n          onStateChange={setCurrentFormState}\n        />\n      );\n    }\n    if (type === RunsCompareChartType.SCATTER) {\n      return (\n        <RunsCompareConfigureScatterChart\n          metricKeyList={metricKeyList}\n          paramKeyList={paramKeyList}\n          state={currentFormState as RunsCompareScatterCardConfig}\n          onStateChange={setCurrentFormState}\n        />\n      );\n    }\n    return null;\n  };\n\n  const previewData = useMemo(\n    () => chartRunData.slice(0, currentFormState.runsCountToCompare).reverse(),\n    [chartRunData, currentFormState.runsCountToCompare],\n  );\n\n  const renderPreviewChartType = (type?: RunsCompareChartType) => {\n    if (!type) {\n      return null;\n    }\n    const PreviewComponent = previewComponentsMap[type];\n    if (!PreviewComponent) {\n      return null;\n    }\n    return <PreviewComponent previewData={previewData} cardConfig={currentFormState} />;\n  };\n\n  const { formatMessage } = useIntl();\n\n  return (\n    <Modal\n      visible\n      onCancel={onCancel}\n      onOk={() => onSubmit(currentFormState)}\n      title={\n        isEditing\n          ? formatMessage({\n              defaultMessage: 'Edit chart',\n              description: 'Title of the modal when editing a runs comparison chart',\n            })\n          : formatMessage({\n              defaultMessage: 'Add new chart',\n              description: 'Title of the modal when adding a new runs comparison chart',\n            })\n      }\n      okButtonProps={{ 'data-testid': 'experiment-view-compare-runs-chart-modal-confirm' }}\n      cancelText={formatMessage({\n        defaultMessage: 'Cancel',\n        description:\n          'Cancel button label within a modal for adding/editing a new runs comparison chart',\n      })}\n      okText={\n        isEditing\n          ? formatMessage({\n              defaultMessage: 'Save changes',\n              description:\n                'Confirm button label within a modal when editing a runs comparison chart',\n            })\n          : formatMessage({\n              defaultMessage: 'Add chart',\n              description:\n                'Confirm button label within a modal when adding a new runs comparison chart',\n            })\n      }\n      size='wide'\n      css={{ width: 1280 }}\n    >\n      <div css={styles.wrapper}>\n        <div>\n          {!isEditing && (\n            <RunsCompareConfigureField title='Type'>\n              <Select<RunsCompareChartType>\n                css={{ width: '100%' }}\n                value={currentFormState.type}\n                onChange={updateChartType}\n              >\n                <Select.Option value={RunsCompareChartType.BAR}>\n                  <div css={styles.chartTypeOption}>\n                    <ChartBarIcon />\n                    Bar chart\n                  </div>\n                </Select.Option>\n                <Select.Option value={RunsCompareChartType.SCATTER}>\n                  <div css={styles.chartTypeOption}>\n                    <ChartScatterIcon />\n                    Scatter chart\n                  </div>\n                </Select.Option>\n                <Select.Option value={RunsCompareChartType.LINE}>\n                  <div css={styles.chartTypeOption}>\n                    <ChartLineIcon />\n                    Line chart\n                  </div>\n                </Select.Option>\n                <Select.Option value={RunsCompareChartType.PARALLEL}>\n                  <div css={styles.chartTypeOption}>\n                    <ChartParallelIcon />\n                    Parallel coordinates\n                  </div>\n                </Select.Option>\n                <Select.Option value={RunsCompareChartType.CONTOUR}>\n                  <div css={styles.chartTypeOption}>\n                    <ChartContourIcon />\n                    Contour chart\n                  </div>\n                </Select.Option>\n              </Select>\n            </RunsCompareConfigureField>\n          )}\n          {renderConfigOptionsforChartType(currentFormState.type)}\n        </div>\n        <CompareRunsTooltipWrapper\n          contextData={{ runs: chartRunData }}\n          component={RunsCompareTooltipBody}\n          hoverOnly\n        >\n          <div css={styles.chartWrapper}>{renderPreviewChartType(currentFormState.type)}</div>\n        </CompareRunsTooltipWrapper>\n      </div>\n    </Modal>\n  );\n};\n\nconst styles = {\n  chartTypeOption: (theme: Theme) =>\n    ({\n      display: 'grid',\n      gridTemplateColumns: `${theme.general.iconSize + theme.spacing.xs}px 1fr`,\n      gap: theme.spacing.xs,\n      alignItems: 'center',\n    } as Interpolation<Theme>),\n  wrapper: {\n    // TODO: wait for modal dimensions decision\n    display: 'grid',\n    gridTemplateColumns: '300px 1fr',\n    gap: 32,\n  } as Interpolation<Theme>,\n  field: {\n    // TODO: wait for modal dimensions decision\n    display: 'grid',\n    gridTemplateColumns: '80px 1fr',\n    marginBottom: 16,\n  } as Interpolation<Theme>,\n  chartWrapper: {\n    height: 400,\n  },\n};\n","import { barChartCardDefaultMargin } from '../cards/RunsCompareBarChartCard';\nimport { CompareChartRunData } from '../charts/CompareRunsCharts.common';\nimport { CompareRunsMetricsBarPlot } from '../charts/CompareRunsMetricsBarPlot';\nimport { useCompareRunsTooltip } from '../hooks/useCompareRunsTooltip';\nimport { RunsCompareBarCardConfig } from '../runs-compare.types';\n\nexport const RunsCompareConfigureBarChartPreview = ({\n  previewData,\n  cardConfig,\n}: {\n  previewData: CompareChartRunData[];\n  cardConfig: RunsCompareBarCardConfig;\n}) => {\n  const { resetTooltip, setTooltip } = useCompareRunsTooltip(cardConfig);\n\n  return (\n    <CompareRunsMetricsBarPlot\n      useDefaultHoverBox={false}\n      displayRunNames={false}\n      displayMetricKey={false}\n      metricKey={cardConfig.metricKey}\n      runsData={previewData}\n      margin={barChartCardDefaultMargin}\n      onHover={setTooltip}\n      onUnhover={resetTooltip}\n    />\n  );\n};\n","import { CompareChartRunData } from '../charts/CompareRunsCharts.common';\nimport { CompareRunsContourPlot } from '../charts/CompareRunsContourPlot';\nimport { useCompareRunsTooltip } from '../hooks/useCompareRunsTooltip';\nimport { RunsCompareContourCardConfig } from '../runs-compare.types';\n\nexport const RunsCompareConfigureContourChartPreview = ({\n  previewData,\n  cardConfig,\n}: {\n  previewData: CompareChartRunData[];\n  cardConfig: RunsCompareContourCardConfig;\n}) => {\n  const { resetTooltip, setTooltip } = useCompareRunsTooltip(cardConfig);\n\n  return (\n    <CompareRunsContourPlot\n      xAxis={cardConfig.xaxis}\n      yAxis={cardConfig.yaxis}\n      zAxis={cardConfig.zaxis}\n      runsData={previewData}\n      onHover={setTooltip}\n      onUnhover={resetTooltip}\n      useDefaultHoverBox={false}\n    />\n  );\n};\n","import { CompareChartRunData } from '../charts/CompareRunsCharts.common';\nimport { CompareRunsScatterPlot } from '../charts/CompareRunsScatterPlot';\nimport { useCompareRunsTooltip } from '../hooks/useCompareRunsTooltip';\nimport { RunsCompareScatterCardConfig } from '../runs-compare.types';\n\nexport const RunsCompareConfigureScatterChartPreview = ({\n  previewData,\n  cardConfig,\n}: {\n  previewData: CompareChartRunData[];\n  cardConfig: RunsCompareScatterCardConfig;\n}) => {\n  const { resetTooltip, setTooltip } = useCompareRunsTooltip(cardConfig);\n\n  return (\n    <CompareRunsScatterPlot\n      xAxis={cardConfig.xaxis}\n      yAxis={cardConfig.yaxis}\n      runsData={previewData}\n      onHover={setTooltip}\n      onUnhover={resetTooltip}\n      useDefaultHoverBox={false}\n    />\n  );\n};\n","import { LegacySkeleton } from '@databricks/design-system';\nimport { Theme } from '@emotion/react';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { connect } from 'react-redux';\nimport type {\n  ExperimentStoreEntities,\n  KeyValueEntity,\n  MetricEntitiesByName,\n  MetricHistoryByName,\n  UpdateExperimentSearchFacetsFn,\n} from '../../types';\nimport { RunRowType } from '../experiment-page/utils/experimentPage.row-types';\nimport { RunsCompareCardConfig } from './runs-compare.types';\nimport type { RunsCompareChartType } from './runs-compare.types';\nimport { RunsCompareAddChartMenu } from './RunsCompareAddChartMenu';\nimport { RunsCompareCharts } from './RunsCompareCharts';\nimport { SearchExperimentRunsFacetsState } from '../experiment-page/models/SearchExperimentRunsFacetsState';\nimport { RunsCompareConfigureModal } from './RunsCompareConfigureModal';\nimport { getUUID } from '../../../common/utils/ActionUtils';\nimport type { CompareChartRunData } from './charts/CompareRunsCharts.common';\nimport {\n  AUTOML_EVALUATION_METRIC_TAG,\n  MLFLOW_EXPERIMENT_PRIMARY_METRIC_NAME,\n} from '../../constants';\nimport { RunsCompareTooltipBody } from './RunsCompareTooltipBody';\nimport { CompareRunsTooltipWrapper } from './hooks/useCompareRunsTooltip';\nimport { useMultipleChartsMetricHistory } from './hooks/useMultipleChartsMetricHistory';\n\nexport interface RunsCompareProps {\n  comparedRuns: RunRowType[];\n  isLoading: boolean;\n  metricKeyList: string[];\n  paramKeyList: string[];\n  experimentTags: Record<string, KeyValueEntity>;\n  searchFacetsState: SearchExperimentRunsFacetsState;\n  updateSearchFacets: UpdateExperimentSearchFacetsFn;\n\n  // Provided by redux connect().\n  paramsByRunUuid: Record<string, Record<string, KeyValueEntity>>;\n  latestMetricsByRunUuid: Record<string, MetricEntitiesByName>;\n  metricsByRunUuid: Record<string, MetricHistoryByName>;\n}\n\n/**\n * Component displaying comparison charts and differences (and in future artifacts) between experiment runs.\n * Intended to be mounted next to runs table.\n *\n * This component extracts params/metrics from redux store by itself for quicker access, however\n * it needs a provided list of compared run entries using same model as runs table.\n */\nexport const RunsCompareImpl = ({\n  comparedRuns,\n  isLoading,\n  searchFacetsState,\n  updateSearchFacets,\n  latestMetricsByRunUuid,\n  metricsByRunUuid,\n  paramsByRunUuid,\n  metricKeyList,\n  paramKeyList,\n  experimentTags,\n}: RunsCompareProps) => {\n  const [initiallyLoaded, setInitiallyLoaded] = useState(false);\n  const [configuredCardConfig, setConfiguredCardConfig] = useState<RunsCompareCardConfig | null>(\n    null,\n  );\n\n  const addNewChartCard = useCallback((type: RunsCompareChartType) => {\n    // TODO: pass existing runs data and get pre-configured initial setup for every chart type\n    setConfiguredCardConfig(RunsCompareCardConfig.getEmptyChartCardByType(type));\n  }, []);\n\n  const startEditChart = useCallback((chartCard: RunsCompareCardConfig) => {\n    setConfiguredCardConfig(chartCard);\n  }, []);\n\n  useEffect(() => {\n    if (!initiallyLoaded && !isLoading) {\n      setInitiallyLoaded(true);\n    }\n  }, [initiallyLoaded, isLoading]);\n\n  const primaryMetricKey = useMemo(() => {\n    const automlEntry = experimentTags[AUTOML_EVALUATION_METRIC_TAG];\n    const mlflowPrimaryEntry = experimentTags[MLFLOW_EXPERIMENT_PRIMARY_METRIC_NAME];\n    return automlEntry?.value || mlflowPrimaryEntry?.value || metricKeyList[0] || '';\n  }, [experimentTags, metricKeyList]);\n\n  /**\n   * Dataset generated for all charts in a single place\n   */\n  const chartRunData: CompareChartRunData[] = useMemo(\n    () =>\n      comparedRuns\n        .filter((run) => !run.hidden)\n        .map((run) => ({\n          runInfo: run.runInfo,\n          metrics: latestMetricsByRunUuid[run.runUuid] || {},\n          params: paramsByRunUuid[run.runUuid] || {},\n          color: run.color,\n          pinned: run.pinned,\n          pinnable: run.pinnable,\n          metricsHistory: {},\n        })),\n    [comparedRuns, latestMetricsByRunUuid, paramsByRunUuid],\n  );\n\n  const { isLoading: isMetricHistoryLoading, chartRunDataWithHistory } =\n    useMultipleChartsMetricHistory(\n      searchFacetsState.compareRunCharts || [],\n      chartRunData,\n      metricsByRunUuid,\n    );\n\n  // Set chart cards to the user-facing base config if there is no other information.\n  useEffect(() => {\n    if (!searchFacetsState.compareRunCharts && chartRunDataWithHistory.length > 0) {\n      updateSearchFacets(\n        (current) => ({\n          ...current,\n          compareRunCharts: RunsCompareCardConfig.getBaseChartConfigs(\n            primaryMetricKey,\n            chartRunDataWithHistory[0].metrics,\n          ),\n        }),\n        { replaceHistory: true },\n      );\n    }\n  }, [\n    searchFacetsState.compareRunCharts,\n    primaryMetricKey,\n    updateSearchFacets,\n    chartRunDataWithHistory,\n  ]);\n\n  const onTogglePin = useCallback(\n    (runUuid: string) => {\n      updateSearchFacets((existingFacets) => ({\n        ...existingFacets,\n        runsPinned: !existingFacets.runsPinned.includes(runUuid)\n          ? [...existingFacets.runsPinned, runUuid]\n          : existingFacets.runsPinned.filter((r) => r !== runUuid),\n      }));\n    },\n    [updateSearchFacets],\n  );\n\n  const onHideRun = useCallback(\n    (runUuid: string) => {\n      updateSearchFacets((existingFacets) => ({\n        ...existingFacets,\n        runsHidden: [...existingFacets.runsHidden, runUuid],\n      }));\n    },\n    [updateSearchFacets],\n  );\n\n  const submitForm = (configuredCard: Partial<RunsCompareCardConfig>) => {\n    // TODO: implement validation\n    const serializedCard = RunsCompareCardConfig.serialize({\n      ...configuredCard,\n      uuid: getUUID(),\n    });\n\n    // Creating new chart\n    if (!configuredCard.uuid) {\n      updateSearchFacets((current) => ({\n        ...current,\n        // This condition ensures that chart collection will remain undefined if not set previously\n        compareRunCharts: current.compareRunCharts && [...current.compareRunCharts, serializedCard],\n      }));\n    } /* Editing existing chart */ else {\n      updateSearchFacets((current) => ({\n        ...current,\n        compareRunCharts: current.compareRunCharts?.map((existingChartCard) => {\n          if (existingChartCard.uuid === configuredCard.uuid) {\n            return serializedCard;\n          }\n          return existingChartCard;\n        }),\n      }));\n    }\n\n    // Hide the modal\n    setConfiguredCardConfig(null);\n  };\n\n  const removeChart = (configToDelete: RunsCompareCardConfig) => {\n    updateSearchFacets((current) => ({\n      ...current,\n      compareRunCharts: current.compareRunCharts?.filter(\n        (setup) => setup.uuid !== configToDelete.uuid,\n      ),\n    }));\n  };\n\n  /**\n   * Data utilized by the tooltip system:\n   * runs data and toggle pin callback\n   */\n  const tooltipContextValue = useMemo(\n    () => ({ runs: chartRunDataWithHistory, onTogglePin, onHideRun }),\n    [chartRunDataWithHistory, onHideRun, onTogglePin],\n  );\n\n  if (!initiallyLoaded) {\n    return (\n      <div css={styles.wrapper}>\n        <LegacySkeleton />\n      </div>\n    );\n  }\n\n  return (\n    <div css={styles.wrapper} data-testid='experiment-view-compare-runs-chart-area'>\n      <div css={styles.controlsWrapper}>\n        <RunsCompareAddChartMenu onAddChart={addNewChartCard} />\n      </div>\n      <CompareRunsTooltipWrapper\n        contextData={tooltipContextValue}\n        component={RunsCompareTooltipBody}\n      >\n        <RunsCompareCharts\n          chartRunData={chartRunDataWithHistory}\n          cardsConfig={searchFacetsState.compareRunCharts || []}\n          onStartEditChart={startEditChart}\n          onRemoveChart={removeChart}\n          isMetricHistoryLoading={isMetricHistoryLoading}\n        />\n      </CompareRunsTooltipWrapper>\n      {configuredCardConfig && (\n        <RunsCompareConfigureModal\n          chartRunData={chartRunDataWithHistory}\n          metricKeyList={metricKeyList}\n          paramKeyList={paramKeyList}\n          config={configuredCardConfig}\n          onSubmit={submitForm}\n          onCancel={() => setConfiguredCardConfig(null)}\n        />\n      )}\n    </div>\n  );\n};\n\nconst styles = {\n  controlsWrapper: (theme: Theme) => ({\n    position: 'sticky' as const,\n    top: 0,\n    marginBottom: theme.spacing.md,\n    display: 'flex' as const,\n    justifyContent: 'flex-end',\n    zIndex: 2,\n    backgroundColor: theme.colors.backgroundSecondary,\n    paddingTop: theme.spacing.md,\n    paddingBottom: theme.spacing.md,\n  }),\n  wrapper: (theme: Theme) => ({\n    borderTop: `1px solid ${theme.colors.border}`,\n    borderLeft: `1px solid ${theme.colors.border}`,\n\n    // Let's cover 1 pixel of the grid's border for the sleek look\n    marginLeft: -1,\n\n    position: 'relative' as const,\n    backgroundColor: theme.colors.backgroundSecondary,\n    paddingLeft: theme.spacing.md,\n    paddingRight: theme.spacing.md,\n    paddingBottom: theme.spacing.md,\n    zIndex: 1,\n    overflowY: 'auto' as const,\n  }),\n};\n\nconst mapStateToProps = ({ entities }: { entities: ExperimentStoreEntities }) => {\n  const { paramsByRunUuid, latestMetricsByRunUuid, metricsByRunUuid } = entities;\n  return { paramsByRunUuid, latestMetricsByRunUuid, metricsByRunUuid };\n};\n\nexport const RunsCompare = connect(\n  mapStateToProps,\n  // mapDispatchToProps function (not provided):\n  undefined,\n  // mergeProps function (not provided):\n  undefined,\n  {\n    // We're interested only in \"entities\" sub-tree so we won't\n    // re-render on other state changes (e.g. API request IDs)\n    areStatesEqual: (nextState, prevState) => nextState.entities === prevState.entities,\n  },\n)(RunsCompareImpl);\n","import { max } from 'lodash';\nimport { useMemo } from 'react';\nimport { MetricHistoryByName } from '../../../types';\nimport { CompareChartRunData } from '../charts/CompareRunsCharts.common';\nimport {\n  RunsCompareCardConfig,\n  RunsCompareChartType,\n  RunsCompareLineCardConfig,\n} from '../runs-compare.types';\nimport { useFetchCompareRunsMetricHistory } from './useFetchCompareRunsMetricHistory';\n\n/**\n * This hook aggregates demands from multiple charts requiring metric\n * history and invokes necessary fetch actions using another designated hook.\n * When metric history is available, it enriches runs and returns them.\n */\nexport const useMultipleChartsMetricHistory = (\n  cardsConfig: RunsCompareCardConfig[],\n  chartRunData: CompareChartRunData[],\n  metricsByRunUuid: Record<string, MetricHistoryByName>,\n) => {\n  // First, determine which cards require metric history\n  const cardsRequiringMetricHistory = useMemo(\n    () =>\n      cardsConfig.filter(\n        // For the time being, only line charts require metric history\n        (c) => c.type === RunsCompareChartType.LINE,\n      ) as RunsCompareLineCardConfig[],\n    [cardsConfig],\n  );\n\n  // Next, determine runs requiring history\n  const runsRequiringMetricHistory = useMemo(() => {\n    if (!cardsRequiringMetricHistory.length) {\n      return [];\n    }\n    const maxRunCount = max(cardsRequiringMetricHistory.map((c) => c.runsCountToCompare || 10));\n    return chartRunData.slice(0, maxRunCount);\n  }, [cardsRequiringMetricHistory, chartRunData]);\n\n  // Determine which metrics need history to be fetched\n  const metricsRequiringHistory = useMemo(\n    () => Array.from(new Set(cardsRequiringMetricHistory.map((card) => card.metricKey))),\n    [cardsRequiringMetricHistory],\n  );\n\n  // Invoke the hook that actually fetches the history\n  const { isLoading } = useFetchCompareRunsMetricHistory(\n    metricsRequiringHistory,\n    runsRequiringMetricHistory,\n    metricsByRunUuid,\n  );\n\n  // Enrich the input data with the metric history and return it\n  const chartRunDataWithHistory = useMemo<CompareChartRunData[]>(() => {\n    // If there are no runs requiring metric history, just pass runs through\n    if (!runsRequiringMetricHistory.length) {\n      return chartRunData;\n    }\n    return chartRunData.map((baseRun) => ({\n      ...baseRun,\n      metricsHistory: metricsByRunUuid[baseRun.runInfo.run_uuid] || undefined,\n    }));\n  }, [runsRequiringMetricHistory, metricsByRunUuid, chartRunData]);\n\n  return { isLoading, chartRunDataWithHistory };\n};\n","import type { NotificationInstance } from '@databricks/design-system';\nimport { useCallback } from 'react';\nimport { useIntl } from 'react-intl';\nimport type { RunEntity, RunInfoEntity } from '../../../types';\nimport { EXPERIMENT_PARENT_ID_TAG } from '../utils/experimentPage.common-utils';\n\nconst FETCHED_RUN_NOTIFICATION_DURATION = 3; // Seconds\nconst FETCHED_RUN_NOTIFICATION_KEY = 'FETCHED_RUN_NOTIFICATION_KEY';\n\nconst countFetchedRuns = (fetchedRuns: RunEntity[], existingRunInfos: RunInfoEntity[] = []) => {\n  // Extract only runs that are not loaded yet\n  const newRuns = fetchedRuns.filter(\n    (r) => !existingRunInfos.some((x) => x.run_uuid === r.info.run_uuid),\n  );\n\n  // Next, extract runs containing non-empty \"parentRunId\" tag\n  const runsWithParent = newRuns.filter((run: any) => {\n    const runTagsList = run?.data?.tags;\n    return (\n      Array.isArray(runTagsList) &&\n      runTagsList.some((tag) => tag.key === EXPERIMENT_PARENT_ID_TAG && Boolean(tag.value))\n    );\n  });\n\n  // Return counts of both all runs and those with parent\n  return {\n    allRuns: newRuns.length,\n    childRuns: runsWithParent.length,\n  };\n};\n\nexport const useFetchedRunsNotification = (notification: NotificationInstance) => {\n  const { formatMessage } = useIntl();\n\n  // Creates the localized message based on the returned run count\n  const getMessage = useCallback(\n    (allRuns: number, childRuns: number) => {\n      // Returned when only child runs are loaded\n      if (allRuns === childRuns) {\n        return formatMessage(\n          {\n            defaultMessage: 'Loaded {childRuns} child {childRuns, plural, =1 {run} other {runs}}',\n            description: 'Experiment page > loaded more runs notification > loaded only child runs',\n          },\n          { childRuns: childRuns },\n        );\n      }\n\n      // Returned when we fetch both regular (parent) and child runs\n      return formatMessage(\n        {\n          defaultMessage:\n            'Loaded {allRuns} {allRuns, plural, =1 {run} other {runs}}, including {childRuns} child {childRuns, plural, =1 {run} other {runs}}',\n          description:\n            'Experiment page > loaded more runs notification > loaded both parent and child runs',\n        },\n        { allRuns, childRuns: childRuns },\n      );\n    },\n    [formatMessage],\n  );\n\n  return useCallback(\n    (fetchedRuns: RunEntity[], existingRunInfos: RunInfoEntity[]) => {\n      if (Array.isArray(fetchedRuns)) {\n        // Get counted runs\n        const { allRuns, childRuns } = countFetchedRuns(fetchedRuns, existingRunInfos);\n\n        // Display notification only if there are any new child runs\n        if (childRuns < 1) {\n          return;\n        }\n\n        // If there is a similar notification visible already, close it first\n        // to avoid confusion due to multiple displayed notification elements\n        notification.close(FETCHED_RUN_NOTIFICATION_KEY);\n\n        // Display the notification\n        notification.info({\n          message: getMessage(allRuns, childRuns),\n          duration: FETCHED_RUN_NOTIFICATION_DURATION,\n          placement: 'bottomRight',\n          key: FETCHED_RUN_NOTIFICATION_KEY,\n        });\n      }\n    },\n    [notification, getMessage],\n  );\n};\n","import { useEffect, useRef } from 'react';\nimport type { UpdateExperimentSearchFacetsFn } from '../../../types';\nimport type { SearchExperimentRunsFacetsState } from '../models/SearchExperimentRunsFacetsState';\nimport type { RunRowType } from '../utils/experimentPage.row-types';\nimport { MLFLOW_RUN_TYPE_TAG, MLFLOW_RUN_TYPE_VALUE_EVALUATION } from '../../../constants';\nimport { SingleRunData } from '../utils/experimentPage.row-utils';\nimport { EXPERIMENT_PARENT_ID_TAG } from '../utils/experimentPage.common-utils';\n\ntype RunsExpandedType = SearchExperimentRunsFacetsState['runsExpanded'];\n\nconst isEvaluationRun = (runData: SingleRunData) =>\n  runData.tags?.[MLFLOW_RUN_TYPE_TAG]?.value === MLFLOW_RUN_TYPE_VALUE_EVALUATION;\n\n/**\n * Automatically expands parent run rows when certain conditions are met.\n * Currently the only supported case are rows with runs of the evaluation type.\n *\n * Note: it requires providing both set of visible run rows (to expand those)\n * and list of all runs (to check which are of the evaluation type)\n */\nexport const useAutoExpandRunRows = (\n  allRunsData: SingleRunData[],\n  visibleRows: RunRowType[],\n  isPristine: () => boolean,\n  updateSearchFacets: UpdateExperimentSearchFacetsFn,\n  runsExpanded: RunsExpandedType,\n) => {\n  useEffect(() => {\n    if (!isPristine()) {\n      return;\n    }\n    const evaluationRunIds = allRunsData\n      .filter(isEvaluationRun)\n      .map(({ runInfo }) => runInfo.run_uuid);\n\n    const runsIdsToExpand: string[] = visibleRows\n      .filter(\n        ({ runDateAndNestInfo, runUuid }) =>\n          runDateAndNestInfo.hasExpander &&\n          typeof runsExpanded[runUuid] === 'undefined' &&\n          runDateAndNestInfo.childrenIds?.some((id) => evaluationRunIds.includes(id)),\n      )\n      .map(({ runUuid }) => runUuid);\n\n    if (runsIdsToExpand.length) {\n      updateSearchFacets(\n        (currentFacets) => ({\n          ...currentFacets,\n          runsExpanded: runsIdsToExpand.reduce(\n            (aggregate, runUuid) => ({ ...aggregate, [runUuid]: true }),\n            currentFacets.runsExpanded,\n          ),\n        }),\n        { preservePristine: true, replaceHistory: true },\n      );\n    }\n  }, [allRunsData, visibleRows, runsExpanded, updateSearchFacets, isPristine]);\n};\n","import { useCallback, useEffect, useRef, useState } from 'react';\nimport { UseEvaluationArtifactTableDataResult } from './useEvaluationArtifactTableData';\nimport { useDispatch } from 'react-redux';\nimport { ThunkDispatch } from '../../../../redux-types';\nimport {\n  compilePromptInputText,\n  extractEvaluationPrerequisitesForRun,\n  extractPromptInputVariables,\n} from '../../prompt-engineering/PromptEngineering.utils';\nimport { RunRowType } from '../../experiment-page/utils/experimentPage.row-types';\nimport { evaluatePromptTableValue } from '../../../actions/PromptEngineeringActions';\nimport Utils from '../../../../common/utils/Utils';\n\n/**\n * Local utilility function, confirms if all param values\n * are provided for a particular evaluation table data row.\n */\nconst containsAllParamValuesForRow = (\n  row: UseEvaluationArtifactTableDataResult[0],\n  requiredInputs: string[],\n) => {\n  const missingInputParams = requiredInputs.filter(\n    (requiredInput) => !row.groupByCellValues[requiredInput],\n  );\n\n  return missingInputParams.length === 0;\n};\n\n/**\n * A hook containing complete toolset supporting \"Evaluate all\" button\n */\nexport const useEvaluateAllRows = (\n  evaluationTableData: UseEvaluationArtifactTableDataResult,\n  outputColumn: string,\n) => {\n  const currentTableData = useRef<UseEvaluationArtifactTableDataResult>(evaluationTableData);\n  const currentRunsBeingEvaluated = useRef<string[]>([]);\n\n  useEffect(() => {\n    currentTableData.current = evaluationTableData;\n  }, [evaluationTableData]);\n\n  const [runColumnsBeingEvaluated, setEvaluatedRuns] = useState<string[]>([]);\n\n  useEffect(() => {\n    currentRunsBeingEvaluated.current = runColumnsBeingEvaluated;\n  }, [runColumnsBeingEvaluated]);\n\n  const dispatch = useDispatch<ThunkDispatch>();\n\n  // Processes single run's evaluation queue.\n  const processQueueForRun = useCallback(\n    (run: RunRowType) => {\n      const tableData = currentTableData.current;\n      const { parameters, promptTemplate, routeName } = extractEvaluationPrerequisitesForRun(run);\n\n      if (!promptTemplate) {\n        return;\n      }\n\n      const requiredInputs = extractPromptInputVariables(promptTemplate);\n\n      // Try to find the next row in the table that can be evaluated for a particular table\n      const nextEvaluableRow = tableData.find(\n        (tableRow) =>\n          !tableRow.cellValues[run.runUuid] &&\n          containsAllParamValuesForRow(tableRow, requiredInputs),\n      );\n\n      // If there's no row, close the queue and return\n      if (!nextEvaluableRow) {\n        setEvaluatedRuns((runs) =>\n          runs.filter((existingRunUuid) => existingRunUuid !== run.runUuid),\n        );\n        return;\n      }\n      const rowKey = nextEvaluableRow.key;\n      const inputValues = nextEvaluableRow.groupByCellValues;\n\n      if (!promptTemplate) {\n        return;\n      }\n\n      const compiledPrompt = compilePromptInputText(promptTemplate, inputValues);\n\n      if (routeName) {\n        dispatch(\n          evaluatePromptTableValue({\n            routeName,\n            compiledPrompt,\n            inputValues,\n            outputColumn,\n            rowKey,\n            parameters,\n            run,\n          }),\n        )\n          .then(() => {\n            // If the current queue for the run is still active, continue with processing\n            if (currentRunsBeingEvaluated.current.includes(run.runUuid)) {\n              processQueueForRun(run);\n            }\n          })\n          .catch((e) => {\n            // In case of error, notify the user and close the queue\n            Utils.logErrorAndNotifyUser(e);\n            setEvaluatedRuns((runs) =>\n              runs.filter((existingRunUuid) => existingRunUuid !== run.runUuid),\n            );\n          });\n      }\n    },\n    [dispatch, outputColumn],\n  );\n\n  // Enables run's evaluation queue and starts its processing\n  const startEvaluatingRunColumn = useCallback(\n    (run: RunRowType) => {\n      setEvaluatedRuns((runs) => [...runs, run.runUuid]);\n      processQueueForRun(run);\n    },\n    [processQueueForRun],\n  );\n\n  // Removes the run from evaluation queue so it will gracefully stop after currently pending evaluation\n  const stopEvaluatingRunColumn = useCallback((run: RunRowType) => {\n    setEvaluatedRuns((runs) => runs.filter((existingRunUuid) => existingRunUuid !== run.runUuid));\n  }, []);\n\n  return { runColumnsBeingEvaluated, startEvaluatingRunColumn, stopEvaluatingRunColumn };\n};\n","import React, { useCallback, useContext, useMemo, useState } from 'react';\nimport { RunRowType } from '../../experiment-page/utils/experimentPage.row-types';\nimport { UseEvaluationArtifactTableDataResult } from '../hooks/useEvaluationArtifactTableData';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { ReduxState, ThunkDispatch } from '../../../../redux-types';\nimport { EvaluationDataReduxState } from '../../../reducers/EvaluationDataReducer';\nimport { evaluatePromptTableValue } from '../../../actions/PromptEngineeringActions';\nimport {\n  DEFAULT_PROMPTLAB_OUTPUT_COLUMN,\n  canEvaluateOnRun,\n  compilePromptInputText,\n  extractEvaluationPrerequisitesForRun,\n  extractPromptInputVariables,\n} from '../../prompt-engineering/PromptEngineering.utils';\nimport Utils from '../../../../common/utils/Utils';\nimport { useEvaluateAllRows } from '../hooks/useEvaluateAllRows';\nimport { GatewayErrorWrapper } from '../../../sdk/ModelGatewayService';\nimport { useIntl } from 'react-intl';\n\nexport interface PromptEngineeringContextType {\n  getMissingParams: (run: RunRowType, rowKey: string) => string[] | null;\n  getEvaluableRowCount: (run: RunRowType) => number;\n  pendingDataLoading: EvaluationDataReduxState['evaluationPendingDataLoadingByRunUuid'];\n  evaluateCell: (run: RunRowType, rowKey: string) => void;\n  evaluateAllClick: (run: RunRowType) => void;\n  runColumnsBeingEvaluated: string[];\n  canEvaluateInRunColumn: (run: RunRowType) => boolean;\n  toggleExpandedHeader: () => void;\n  isHeaderExpanded: boolean;\n}\n\nconst PromptEngineeringContext = React.createContext<PromptEngineeringContextType>({\n  getMissingParams: () => [],\n  pendingDataLoading: {},\n  getEvaluableRowCount: () => 0,\n  evaluateCell: () => {},\n  evaluateAllClick: () => {},\n  runColumnsBeingEvaluated: [],\n  canEvaluateInRunColumn: () => false,\n  toggleExpandedHeader: () => {},\n  isHeaderExpanded: false,\n});\n\nexport const PromptEngineeringContextProvider = ({\n  tableData,\n  outputColumn,\n  children,\n}: React.PropsWithChildren<{\n  tableData: UseEvaluationArtifactTableDataResult;\n  outputColumn: string;\n}>) => {\n  const intl = useIntl();\n\n  const [isHeaderExpanded, setIsHeaderExpanded] = useState(false);\n  const toggleExpandedHeader = useCallback(() => setIsHeaderExpanded((expanded) => !expanded), []);\n\n  const getMissingParams = useCallback(\n    (run: RunRowType, rowKey: string) => {\n      if (!canEvaluateOnRun(run)) {\n        return null;\n      }\n      const row = tableData.find((x) => x.key === rowKey);\n      if (!row) {\n        return null;\n      }\n\n      const { promptTemplate } = extractEvaluationPrerequisitesForRun(run);\n\n      if (!promptTemplate) {\n        return null;\n      }\n\n      const requiredInputs = extractPromptInputVariables(promptTemplate);\n\n      const missingInputParams = requiredInputs.filter(\n        (requiredInput) => !row.groupByCellValues[requiredInput],\n      );\n\n      return missingInputParams;\n    },\n    [tableData],\n  );\n\n  const dispatch = useDispatch<ThunkDispatch>();\n  const { startEvaluatingRunColumn, stopEvaluatingRunColumn, runColumnsBeingEvaluated } =\n    useEvaluateAllRows(tableData, outputColumn);\n\n  const pendingDataLoading = useSelector(\n    ({ evaluationData }: ReduxState) => evaluationData.evaluationPendingDataLoadingByRunUuid,\n  );\n\n  const canEvaluateInRunColumn = useCallback(\n    (run?: RunRowType) => outputColumn === DEFAULT_PROMPTLAB_OUTPUT_COLUMN && canEvaluateOnRun(run),\n    [outputColumn],\n  );\n\n  const getEvaluableRowCount = useCallback(\n    (run: RunRowType) => {\n      const evaluatableRows = tableData.filter((tableRow) => {\n        if (tableRow.cellValues[run.runUuid]) {\n          return false;\n        }\n        const missingParams = getMissingParams(run, tableRow.key);\n        return missingParams?.length === 0;\n      });\n\n      return evaluatableRows.length;\n    },\n    [tableData, getMissingParams],\n  );\n\n  const evaluateAllClick = useCallback(\n    (run: RunRowType) => {\n      if (runColumnsBeingEvaluated.includes(run.runUuid)) {\n        stopEvaluatingRunColumn(run);\n      } else {\n        startEvaluatingRunColumn(run);\n      }\n    },\n    [runColumnsBeingEvaluated, startEvaluatingRunColumn, stopEvaluatingRunColumn],\n  );\n\n  const evaluateCell = useCallback(\n    (run: RunRowType, rowKey: string) => {\n      const row = tableData.find(({ key }) => key === rowKey);\n      if (!row) {\n        return;\n      }\n      const inputValues = row.groupByCellValues;\n\n      const { parameters, promptTemplate, routeName } = extractEvaluationPrerequisitesForRun(run);\n\n      if (!promptTemplate) {\n        return;\n      }\n\n      const compiledPrompt = compilePromptInputText(promptTemplate, inputValues);\n\n      if (routeName) {\n        dispatch(\n          evaluatePromptTableValue({\n            routeName,\n            compiledPrompt,\n            inputValues,\n            outputColumn,\n            rowKey,\n            parameters,\n            run,\n          }),\n        ).catch((e: GatewayErrorWrapper) => {\n          const errorMessage = e.getGatewayErrorMessage() || e.getUserVisibleError();\n          const wrappedMessage = intl.formatMessage(\n            {\n              defaultMessage: 'AI gateway returned the following error: \"{errorMessage}\"',\n              description: 'Experiment page > new run modal > AI gateway error message',\n            },\n            {\n              errorMessage,\n            },\n          );\n          Utils.logErrorAndNotifyUser(wrappedMessage);\n        });\n      }\n    },\n    [tableData, dispatch, outputColumn, intl],\n  );\n  const contextValue = useMemo(\n    () => ({\n      getMissingParams,\n      getEvaluableRowCount,\n      evaluateCell,\n      evaluateAllClick,\n      pendingDataLoading,\n      canEvaluateInRunColumn,\n      runColumnsBeingEvaluated,\n      isHeaderExpanded,\n      toggleExpandedHeader,\n    }),\n    [\n      getMissingParams,\n      getEvaluableRowCount,\n      evaluateAllClick,\n      evaluateCell,\n      pendingDataLoading,\n      canEvaluateInRunColumn,\n      runColumnsBeingEvaluated,\n      isHeaderExpanded,\n      toggleExpandedHeader,\n    ],\n  );\n  return (\n    <PromptEngineeringContext.Provider value={contextValue}>\n      {children}\n    </PromptEngineeringContext.Provider>\n  );\n};\n\nexport const usePromptEngineeringContext = () => useContext(PromptEngineeringContext);\n","import { Button, Popover, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from 'react-intl';\nimport { useSelector } from 'react-redux';\nimport { ReduxState } from '../../../../redux-types';\nimport type { RunRowType } from '../../experiment-page/utils/experimentPage.row-types';\nimport {\n  canEvaluateOnRun,\n  extractEvaluationPrerequisitesForRun,\n} from '../../prompt-engineering/PromptEngineering.utils';\nimport { usePromptEngineeringContext } from '../contexts/PromptEngineeringContext';\n\ninterface EvaluationRunHeaderModelIndicatorProps {\n  run: RunRowType;\n}\nexport const EvaluationRunHeaderModelIndicator = ({\n  run,\n}: EvaluationRunHeaderModelIndicatorProps) => {\n  const { theme } = useDesignSystemTheme();\n\n  const { isHeaderExpanded } = usePromptEngineeringContext();\n\n  const promptEvaluationDataForRun = extractEvaluationPrerequisitesForRun(run);\n\n  const gatewayRoute = useSelector(({ modelGateway }: ReduxState) =>\n    promptEvaluationDataForRun.routeName\n      ? modelGateway.modelGatewayRoutes[promptEvaluationDataForRun.routeName]\n      : null,\n  );\n\n  if (!canEvaluateOnRun(run) || !promptEvaluationDataForRun) {\n    return null;\n  }\n\n  const { parameters, promptTemplate, routeName } = promptEvaluationDataForRun;\n  const { stop: stopSequences = [] } = parameters;\n\n  return (\n    <div\n      css={{\n        marginTop: theme.spacing.xs,\n        flex: 1,\n        display: 'flex',\n        flexDirection: 'column',\n        gap: theme.spacing.sm,\n        overflowX: 'hidden',\n        width: '100%',\n      }}\n    >\n      <Typography.Hint>{gatewayRoute ? gatewayRoute.model.name : routeName}</Typography.Hint>\n      {isHeaderExpanded && (\n        <>\n          <Typography.Hint>\n            <FormattedMessage\n              defaultMessage='Temperature: {temperature}'\n              description='Experiment page > artifact compare view > run column header prompt metadata > temperature parameter'\n              values={parameters}\n            />\n          </Typography.Hint>\n          <Typography.Hint>\n            <FormattedMessage\n              defaultMessage='Max. tokens: {max_tokens}'\n              description='Experiment page > artifact compare view > run column header prompt metadata > max tokens parameter'\n              values={parameters}\n            />\n          </Typography.Hint>\n          {stopSequences.length ? (\n            <Typography.Hint\n              css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}\n            >\n              <FormattedMessage\n                defaultMessage='Stop sequences: {stopSequences}'\n                description='Experiment page > artifact compare view > run column header prompt metadata > stop sequences parameter'\n                values={{ stopSequences: stopSequences?.join(', ') }}\n              />\n            </Typography.Hint>\n          ) : null}\n          <div css={{ fontSize: 0 }}>\n            <Popover.Root>\n              <Popover.Trigger asChild>\n                <Button\n                  type='link'\n                  size='small'\n                  css={{\n                    fontSize: theme.typography.fontSizeSm,\n                  }}\n                >\n                  <FormattedMessage\n                    defaultMessage='View prompt template'\n                    description='Experiment page > artifact compare view > run column header prompt metadata > \"view prompt template\" button label'\n                  />\n                </Button>\n              </Popover.Trigger>\n              <Popover.Content css={{ maxWidth: 300 }}>\n                <Popover.Arrow />\n                {promptTemplate}\n              </Popover.Content>\n            </Popover.Root>\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n","import { Button, Popover, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { ExperimentViewDatasetWithContext } from '../../experiment-page/components/runs/ExperimentViewDatasetWithContext';\nimport type { RunRowType } from '../../experiment-page/utils/experimentPage.row-types';\nimport type { RunDatasetWithTags } from '../../../types';\nimport { useCallback } from 'react';\n\ninterface EvaluationRunHeaderDatasetIndicatorProps {\n  run: RunRowType;\n  onDatasetSelected: (dataset: RunDatasetWithTags, run: RunRowType) => void;\n}\n\nexport const EvaluationRunHeaderDatasetIndicator = ({\n  run,\n  onDatasetSelected,\n}: EvaluationRunHeaderDatasetIndicatorProps) => {\n  const { theme } = useDesignSystemTheme();\n\n  const handleDatasetSelected = useCallback(\n    (datasetWithTags: RunDatasetWithTags) => onDatasetSelected(datasetWithTags, run),\n    [onDatasetSelected, run],\n  );\n\n  if (run.datasets?.length < 1) {\n    return null;\n  }\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        alignItems: 'center',\n        gap: theme.spacing.xs,\n        overflow: 'hidden',\n      }}\n    >\n      <div css={{ flexShrink: 1, flexGrow: 1, overflow: 'hidden' }}>\n        <Button type='link' onClick={() => handleDatasetSelected(run.datasets[0])}>\n          <ExperimentViewDatasetWithContext\n            datasetWithTags={run.datasets[0]}\n            displayTextAsLink\n            css={{ marginTop: theme.spacing.xs / 2, marginBottom: theme.spacing.xs / 2 }}\n          />\n        </Button>\n      </div>\n      {run.datasets.length > 1 && (\n        <div css={{ flexShrink: 0, flexGrow: 1, display: 'flex', alignItems: 'flex-end' }}>\n          <Popover.Root modal={false}>\n            <Popover.Trigger asChild>\n              <Button size='small' style={{ borderRadius: '8px', width: '40px' }}>\n                <Typography.Text color='secondary'>+{run.datasets.length - 1}</Typography.Text>\n              </Button>\n            </Popover.Trigger>\n            <Popover.Content align='start'>\n              {run.datasets\n                .slice(1)\n                .filter(Boolean)\n                .map((datasetWithTags) => (\n                  <div\n                    css={{\n                      height: theme.general.heightSm,\n                      display: 'flex',\n                      alignItems: 'center',\n                    }}\n                    key={`${datasetWithTags.dataset.name}-${datasetWithTags.dataset.digest}`}\n                  >\n                    <Button type='link' onClick={() => handleDatasetSelected(datasetWithTags)}>\n                      <ExperimentViewDatasetWithContext\n                        datasetWithTags={datasetWithTags}\n                        displayTextAsLink\n                      />\n                    </Button>\n                  </div>\n                ))}\n            </Popover.Content>\n          </Popover.Root>\n        </div>\n      )}\n    </div>\n  );\n};\n","import { useDesignSystemTheme } from '@databricks/design-system';\nimport { PropsWithChildren, ReactNode } from 'react';\n\ninterface Props {\n  className?: string;\n  groupHeaderContent?: ReactNode;\n  isGroupByHeader?: false;\n}\n\nexport const EvaluationTableHeader = ({\n  children,\n  className,\n  groupHeaderContent = null,\n}: PropsWithChildren<Props>) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    // Header cell wrapper element\n    <div\n      css={{\n        width: '100%',\n        height: '100%',\n        display: 'flex',\n        flexDirection: 'column',\n      }}\n    >\n      {/* Spacer element serving as a group header */}\n      <div\n        css={{\n          width: '100%',\n          flexBasis: 40,\n          display: 'flex',\n          alignItems: 'center',\n          padding: theme.spacing.sm,\n          borderBottom: `1px solid ${theme.colors.borderDecorative}`,\n        }}\n        className='header-group-cell'\n      >\n        {groupHeaderContent}\n      </div>\n      {/* Main header cell content */}\n      <div\n        css={{\n          width: '100%',\n          flex: 1,\n          display: 'flex',\n          justifyContent: 'flex-start',\n          alignItems: 'flex-start',\n          padding: theme.spacing.xs,\n          borderRight: `1px solid ${theme.colors.borderDecorative}`,\n        }}\n        className={className}\n      >\n        {children}\n      </div>\n    </div>\n  );\n};\n","import {\n  Button,\n  DropdownMenu,\n  OverflowIcon,\n  PlayIcon,\n  StopIcon,\n  Tooltip,\n  VisibleIcon,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { Link } from '../../../../common/utils/RoutingUtils';\nimport ExperimentRoutes from '../../../routes';\nimport { RunRowType } from '../../experiment-page/utils/experimentPage.row-types';\nimport { EvaluationRunHeaderModelIndicator } from './EvaluationRunHeaderModelIndicator';\nimport {\n  shouldEnableExperimentDatasetTracking,\n  shouldEnablePromptLab,\n} from '../../../../common/utils/FeatureUtils';\nimport { EvaluationRunHeaderDatasetIndicator } from './EvaluationRunHeaderDatasetIndicator';\nimport type { RunDatasetWithTags } from '../../../types';\nimport { usePromptEngineeringContext } from '../contexts/PromptEngineeringContext';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport React, { useMemo } from 'react';\nimport { EvaluationTableHeader } from './EvaluationTableHeader';\nimport { useCreateNewRun } from '../../experiment-page/hooks/useCreateNewRun';\nimport { canEvaluateOnRun } from '../../prompt-engineering/PromptEngineering.utils';\n\ninterface EvaluationRunHeaderCellRendererProps {\n  run: RunRowType;\n  onHideRun: (runUuid: string) => void;\n  onDuplicateRun: (run: RunRowType) => void;\n  onDatasetSelected: (dataset: RunDatasetWithTags, run: RunRowType) => void;\n  groupHeaderContent?: React.ReactNode;\n}\n\n/**\n * Component used as a column header for output (\"run\") columns\n */\nexport const EvaluationRunHeaderCellRenderer = ({\n  run,\n  onHideRun,\n  onDuplicateRun,\n  onDatasetSelected,\n  groupHeaderContent = null,\n}: EvaluationRunHeaderCellRendererProps) => {\n  const { theme } = useDesignSystemTheme();\n  const {\n    getEvaluableRowCount,\n    evaluateAllClick,\n    runColumnsBeingEvaluated,\n    canEvaluateInRunColumn,\n  } = usePromptEngineeringContext();\n  const intl = useIntl();\n  const evaluableRowCount = getEvaluableRowCount(run);\n  const evaluateAllButtonEnabled = evaluableRowCount > 0;\n\n  const evaluatingAllInProgress = runColumnsBeingEvaluated.includes(run.runUuid);\n\n  const evaluateAllTooltipContent = useMemo(() => {\n    if (!evaluateAllButtonEnabled) {\n      return intl.formatMessage({\n        defaultMessage: 'There are no evaluable rows within this column',\n        description:\n          'Experiment page > artifact compare view > run column header > Disabled \"Evaluate all\" button tooltip when no rows are evaluable',\n      });\n    }\n    if (evaluateAllButtonEnabled && !evaluatingAllInProgress) {\n      return intl.formatMessage(\n        {\n          defaultMessage: 'Process {evaluableRowCount} rows without evaluation output',\n          description:\n            'Experiment page > artifact compare view > run column header > \"Evaluate all\" button tooltip',\n        },\n        {\n          evaluableRowCount,\n        },\n      );\n    }\n\n    return null;\n  }, [evaluableRowCount, evaluateAllButtonEnabled, evaluatingAllInProgress, intl]);\n\n  return (\n    <EvaluationTableHeader\n      css={{\n        justifyContent: 'flex-start',\n        padding: theme.spacing.sm,\n        paddingBottom: 0,\n        paddingTop: theme.spacing.sm,\n        flexDirection: 'column',\n        gap: theme.spacing.xs / 2,\n        overflow: 'hidden',\n      }}\n      groupHeaderContent={groupHeaderContent}\n    >\n      <div\n        css={{\n          width: '100%',\n          display: 'flex',\n        }}\n      >\n        <Link\n          css={{ display: 'flex', gap: theme.spacing.sm, alignItems: 'center' }}\n          to={ExperimentRoutes.getRunPageRoute(run.experimentId, run.runUuid)}\n          target='_blank'\n        >\n          <div\n            css={{\n              backgroundColor: run.color,\n              width: 12,\n              height: 12,\n              borderRadius: 6,\n            }}\n          />\n\n          {run.runName}\n        </Link>\n        <div css={{ flexBasis: theme.spacing.sm }} />\n\n        <Button onClick={() => onHideRun(run.runUuid)} size='small' icon={<VisibleIcon />} />\n        <div css={{ flex: 1 }} />\n        {shouldEnablePromptLab() && canEvaluateInRunColumn(run) && (\n          <>\n            <div css={{ flexBasis: theme.spacing.sm }} />\n            <Tooltip title={evaluateAllTooltipContent}>\n              <Button\n                disabled={!evaluateAllButtonEnabled}\n                size='small'\n                onClick={() => evaluateAllClick(run)}\n                icon={evaluatingAllInProgress ? <StopIcon /> : <PlayIcon />}\n              >\n                {evaluatingAllInProgress ? (\n                  <FormattedMessage\n                    defaultMessage='Stop evaluating'\n                    description='Experiment page > artifact compare view > run column header > \"Evaluate all\" button label when the column is being evaluated'\n                  />\n                ) : (\n                  <FormattedMessage\n                    defaultMessage='Evaluate all'\n                    description='Experiment page > artifact compare view > run column header > \"Evaluate all\" button label'\n                  />\n                )}\n              </Button>\n            </Tooltip>\n          </>\n        )}\n        <div css={{ flexBasis: theme.spacing.sm }} />\n        {shouldEnablePromptLab() && canEvaluateOnRun(run) && (\n          <DropdownMenu.Root modal={false}>\n            <DropdownMenu.Trigger asChild>\n              <Button size='small' icon={<OverflowIcon />} />\n            </DropdownMenu.Trigger>\n            <DropdownMenu.Content>\n              <DropdownMenu.Item onClick={() => onDuplicateRun(run)}>\n                <FormattedMessage\n                  defaultMessage='Duplicate run'\n                  description='Experiment page > artifact compare view > run column header > \"duplicate run\" button label'\n                />\n              </DropdownMenu.Item>\n            </DropdownMenu.Content>\n          </DropdownMenu.Root>\n        )}\n      </div>\n\n      {shouldEnablePromptLab() && canEvaluateOnRun(run) ? (\n        <EvaluationRunHeaderModelIndicator run={run} />\n      ) : (\n        shouldEnableExperimentDatasetTracking() && (\n          <EvaluationRunHeaderDatasetIndicator run={run} onDatasetSelected={onDatasetSelected} />\n        )\n      )}\n    </EvaluationTableHeader>\n  );\n};\n","import { Button, InfoIcon, PlayIcon, RefreshIcon, Tooltip } from '@databricks/design-system';\nimport { FormattedMessage } from 'react-intl';\nimport { usePromptEngineeringContext } from '../contexts/PromptEngineeringContext';\nimport { RunRowType } from '../../experiment-page/utils/experimentPage.row-types';\nimport { canEvaluateOnRun } from '../../prompt-engineering/PromptEngineering.utils';\n\n/**\n * Displays multiple variants of \"(re)evaluate\" button within the artifact comparison table\n */\nexport const EvaluationCellEvaluateButton = ({\n  disabled,\n  isLoading,\n  run,\n  rowKey,\n}: {\n  disabled?: boolean;\n  isLoading: boolean;\n  rowKey: string;\n  run: RunRowType;\n}) => {\n  const isRunEvaluable = canEvaluateOnRun(run);\n  const { evaluateCell, getMissingParams } = usePromptEngineeringContext();\n\n  const missingParamsToEvaluate = (run && getMissingParams(run, rowKey)) || null;\n\n  if (missingParamsToEvaluate && missingParamsToEvaluate.length > 0) {\n    return (\n      <Tooltip\n        title={\n          <FormattedMessage\n            description='Experiment page > artifact compare view > text cell > missing evaluation parameter values tooltip'\n            defaultMessage='Evaluation is not possible because values for the following inputs cannot be determined: {missingParamList}. Add input columns to the \"group by\" settings or use \"Add row\" button to define new parameter set.'\n            values={{\n              missingParamList: <code>{missingParamsToEvaluate.join(', ')}</code>,\n            }}\n          />\n        }\n      >\n        <InfoIcon />\n      </Tooltip>\n    );\n  }\n\n  if (!isRunEvaluable) {\n    return (\n      <Tooltip\n        title={\n          <FormattedMessage\n            description='Experiment page > artifact compare view > text cell > run not evaluable tooltip'\n            defaultMessage='You cannot evaluate this cell, this run was not created using AI gateway route'\n          />\n        }\n      >\n        <InfoIcon />\n      </Tooltip>\n    );\n  }\n  return (\n    <Button\n      loading={isLoading}\n      disabled={disabled}\n      size='small'\n      onMouseDownCapture={(e) => e.stopPropagation()}\n      onClickCapture={(e) => {\n        e.stopPropagation();\n        evaluateCell(run, rowKey);\n      }}\n      icon={<PlayIcon />}\n    >\n      {<>Evaluate</>}\n    </Button>\n  );\n};\n","import { TableSkeleton, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport type { ICellRendererParams } from '@ag-grid-community/core';\nimport { FormattedMessage } from 'react-intl';\nimport React from 'react';\nimport { RunRowType } from '../../experiment-page/utils/experimentPage.row-types';\nimport { usePromptEngineeringContext } from '../contexts/PromptEngineeringContext';\nimport { useSelector } from 'react-redux';\nimport { ReduxState } from '../../../../redux-types';\nimport { PendingEvaluationArtifactTableEntry } from '../../../types';\nimport { canEvaluateOnRun } from '../../prompt-engineering/PromptEngineering.utils';\nimport { EvaluationCellEvaluateButton } from './EvaluationCellEvaluateButton';\nimport { shouldEnablePromptLab } from '../../../../common/utils/FeatureUtils';\nimport { UseEvaluationArtifactTableDataResult } from '../hooks/useEvaluationArtifactTableData';\n\n// Truncate the text in the cell, it doesn't make sense to populate\n// more data into the DOM since cells have hidden overflow anyway\nconst MAX_TEXT_LENGTH = 512;\n\ninterface EvaluationTextCellRendererProps extends ICellRendererParams {\n  value: string;\n  isGroupByColumn?: boolean;\n  context: { highlightedText: string };\n\n  data: UseEvaluationArtifactTableDataResult extends (infer U)[]\n    ? U\n    : UseEvaluationArtifactTableDataResult;\n\n  // Valid only for run columns\n  run?: RunRowType;\n}\n\n/**\n * Internal use component - breaks down the rendered text into chunks and highlights\n * particular part found by the provided substring.\n */\nconst HighlightedText = React.memo(({ text, highlight }: { text: string; highlight: string }) => {\n  const { theme } = useDesignSystemTheme();\n  if (!highlight) {\n    return <>{text}</>;\n  }\n\n  const parts = text.split(new RegExp(`(${highlight})`, 'gi'));\n\n  return (\n    <>\n      {parts.map((part, i) => (\n        <React.Fragment key={i}>\n          {part.toLowerCase() === highlight.toLowerCase() ? (\n            <span css={{ backgroundColor: theme.colors.yellow200 }}>{part}</span>\n          ) : (\n            part\n          )}\n        </React.Fragment>\n      ))}\n    </>\n  );\n});\n\n/**\n * Component used to render a single text cell in the evaluation artifacts comparison table.\n */\n/* eslint-disable complexity */\nexport const EvaluationTextCellRenderer = ({\n  value,\n  context,\n  isGroupByColumn,\n  run,\n  data,\n}: EvaluationTextCellRendererProps) => {\n  const { theme } = useDesignSystemTheme();\n  const { pendingDataLoading, canEvaluateInRunColumn } = usePromptEngineeringContext();\n  const isGatewayRoutesLoading = useSelector(\n    ({ modelGateway }: ReduxState) => modelGateway.modelGatewayRoutesLoading,\n  );\n\n  const isCellEvaluating = run && pendingDataLoading[run.runUuid]?.[data?.key];\n  const outputMetadata = (run && data.outputMetadataByRunUuid?.[run.runUuid]) || null;\n\n  const backgroundColor =\n    outputMetadata?.isPending || data.isPendingInputRow\n      ? theme.colors.backgroundSecondary\n      : theme.colors.backgroundPrimary;\n\n  return (\n    <div\n      css={{\n        height: '100%',\n        whiteSpace: 'normal',\n        padding: theme.spacing.sm,\n        overflow: 'hidden',\n        position: 'relative',\n        cursor: 'pointer',\n        backgroundColor,\n        '&:hover': {\n          backgroundColor: theme.colors.actionDefaultBackgroundHover,\n        },\n      }}\n    >\n      {isCellEvaluating ? (\n        <TableSkeleton lines={3} />\n      ) : (\n        <>\n          {!value ? (\n            <Typography.Text color='info' css={{ overflow: 'hidden', textOverflow: 'ellipsis' }}>\n              <FormattedMessage\n                defaultMessage='(empty)'\n                description='Experiment page > artifact compare view > results table > no result (empty cell)'\n              />\n            </Typography.Text>\n          ) : (\n            <span\n              css={{\n                display: '-webkit-box',\n                overflow: 'hidden',\n                textOverflow: 'ellipsis',\n                '-webkit-box-orient': 'vertical',\n                '-webkit-line-clamp': '7',\n              }}\n            >\n              {isGroupByColumn && context.highlightedText ? (\n                <HighlightedText text={value} highlight={context.highlightedText} />\n              ) : (\n                value.substring(0, MAX_TEXT_LENGTH)\n              )}\n            </span>\n          )}\n        </>\n      )}\n      {shouldEnablePromptLab() && run && canEvaluateInRunColumn(run) && (\n        <div\n          css={{\n            position: 'absolute',\n            left: 8,\n            bottom: 8,\n            right: 8,\n            display: 'flex',\n            gap: theme.spacing.sm,\n            alignItems: 'center',\n            justifyContent: 'space-between',\n          }}\n        >\n          <div css={{ display: 'flex', alignItems: 'center', gap: theme.spacing.xs }}>\n            {!value && (\n              <EvaluationCellEvaluateButton\n                disabled={isCellEvaluating}\n                isLoading={isGatewayRoutesLoading}\n                run={run}\n                rowKey={data.key}\n              />\n            )}\n            {(outputMetadata?.isPending || data.isPendingInputRow) && (\n              <Typography.Hint size='sm' css={{ fontStyle: 'italic' }}>\n                <FormattedMessage\n                  defaultMessage='Unsaved'\n                  description='Experiment page > artifact compare view > results table > unsaved indicator'\n                />\n              </Typography.Hint>\n            )}\n          </div>\n          {outputMetadata && !isCellEvaluating && (\n            <div css={{ display: 'flex', gap: theme.spacing.xs, alignItems: 'center' }}>\n              {outputMetadata.evaluationTime && (\n                <Typography.Hint size='sm'>\n                  {Math.round(outputMetadata.evaluationTime)} ms\n                  {outputMetadata.totalTokens ? ',' : ''}\n                </Typography.Hint>\n              )}\n              {outputMetadata.totalTokens && (\n                <Typography.Hint size='sm'>\n                  <FormattedMessage\n                    defaultMessage='{totalTokens} total tokens'\n                    description='Experiment page > artifact compare view > results table > total number of evaluated tokens'\n                    values={{ totalTokens: outputMetadata.totalTokens }}\n                  />\n                </Typography.Hint>\n              )}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n","import { shouldEnableExperimentDatasetTracking } from '../../../common/utils/FeatureUtils';\n\nexport const EVALUATION_ARTIFACTS_TEXT_COLUMN_WIDTH = {\n  // Default width of \"group by\" columns\n  initialWidthGroupBy: 200,\n  // Default width of \"compare\" (output) columns\n  initialWidthOutput: 360,\n  maxWidth: 500,\n  minWidth: 140,\n};\nexport const EVALUATION_ARTIFACTS_RUN_NAME_HEIGHT = 40;\nexport const EVALUATION_ARTIFACTS_TABLE_ROW_HEIGHT = 190;\n\nexport const getEvaluationArtifactsTableHeaderHeight = (\n  isExpanded = false,\n  includePlaceForMetadata = false,\n) => {\n  // If there is no metadata displayed at all, prepare\n  // 40 px for group header plus 40 px for the run name\n  if (!includePlaceForMetadata) {\n    return 80;\n  }\n\n  // If there's a metadata to be displayed, base the resulting height\n  // on the header expansion. Pixel values according to designs.\n  return 40 + (isExpanded ? 175 : 62);\n};\n","import { IHeaderParams } from '@ag-grid-community/core';\nimport { Tooltip, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { truncate } from 'lodash';\nimport { EvaluationTableHeader } from './EvaluationTableHeader';\n\ninterface EvaluationGroupByHeaderCellRendererProps extends IHeaderParams {\n  displayName: string;\n  onAddNewInputs: () => void;\n  displayAddNewInputsButton?: boolean;\n}\n\n/**\n * Component used as a column header for \"group by\" columns\n */\nexport const EvaluationGroupByHeaderCellRenderer = ({\n  displayName,\n}: EvaluationGroupByHeaderCellRendererProps) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <EvaluationTableHeader css={{ justifyContent: 'flex-start', padding: theme.spacing.sm }}>\n      <Tooltip title={truncate(displayName, { length: 250 })}>\n        <Typography.Text bold css={{ overflow: 'hidden', textOverflow: 'ellipsis' }}>\n          {displayName}\n        </Typography.Text>\n      </Tooltip>\n    </EvaluationTableHeader>\n  );\n};\n","import { Input, Modal, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { useCallback, useMemo, useState } from 'react';\nimport { RunRowType } from '../../experiment-page/utils/experimentPage.row-types';\nimport { uniq } from 'lodash';\nimport {\n  canEvaluateOnRun,\n  extractRequiredInputParamsForRun,\n} from '../../prompt-engineering/PromptEngineering.utils';\nimport { FormattedMessage } from 'react-intl';\n\nconst MAX_RUN_NAMES = 5;\n\nexport const useEvaluationAddNewInputsModal = () => {\n  const [modalVisible, setModalVisible] = useState(false);\n  const [requiredInputKeys, setRequiredInputKeys] = useState<\n    {\n      inputName: string;\n      runNames: string[];\n    }[]\n  >([]);\n  const [inputValues, setInputValues] = useState<Record<string, string>>({});\n\n  const allValuesProvided = useMemo(\n    () => requiredInputKeys.every(({ inputName }) => inputValues[inputName]),\n    [inputValues, requiredInputKeys],\n  );\n\n  const [successCallback, setSuccessCallback] = useState<\n    (providedParamValues: Record<string, string>) => void\n  >(async () => {});\n\n  const setInputValue = useCallback((key: string, value: string) => {\n    setInputValues((values) => ({ ...values, [key]: value }));\n  }, []);\n\n  const showAddNewInputsModal = useCallback(\n    (runs: RunRowType[], onSuccess: (providedParamValues: Record<string, string>) => void) => {\n      const requiredInputsForRuns = runs.filter(canEvaluateOnRun).map((run) => ({\n        runName: run.runName,\n        params: extractRequiredInputParamsForRun(run),\n      }));\n      const inputValuesWithRunNames = uniq(\n        requiredInputsForRuns.map(({ params }) => params).flat(),\n      ).map((inputName) => ({\n        inputName,\n        runNames: requiredInputsForRuns\n          .filter((r) => r.params.includes(inputName))\n          .map(({ runName }) => runName),\n      }));\n      setModalVisible(true);\n      setRequiredInputKeys(inputValuesWithRunNames);\n      setInputValues({});\n      setSuccessCallback(() => onSuccess);\n    },\n    [],\n  );\n  const { theme } = useDesignSystemTheme();\n\n  const AddNewInputsModal = (\n    <Modal\n      title={\n        <FormattedMessage\n          defaultMessage='Add row'\n          description='Experiment page > artifact compare view > \"add new row\" modal title'\n        />\n      }\n      okButtonProps={{ disabled: !allValuesProvided }}\n      okText={\n        <FormattedMessage\n          // TODO(ML-32664): Implement \"Submit and evaluate\" that evaluates entire row\n          defaultMessage='Submit'\n          description='Experiment page > artifact compare view > \"add new row\" modal submit button label'\n        />\n      }\n      cancelText={\n        <FormattedMessage\n          defaultMessage='Cancel'\n          description='Experiment page > artifact compare view > \"add new row\" modal cancel button label'\n        />\n      }\n      onOk={() => {\n        successCallback(inputValues);\n        setModalVisible(false);\n      }}\n      visible={modalVisible}\n      onCancel={() => setModalVisible(false)}\n    >\n      {requiredInputKeys.map(({ inputName, runNames }) => (\n        <div key={inputName} css={{ marginBottom: theme.spacing.md }}>\n          <Typography.Text bold>{inputName}</Typography.Text>\n          <Typography.Hint\n            css={{ whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}\n          >\n            <FormattedMessage\n              defaultMessage='Used by {runNames} {hasMore, select, true {and other runs} other {}}'\n              description='Experiment page > artifact compare view > label indicating which runs are using particular input field'\n              values={{\n                runNames: runNames.slice(0, MAX_RUN_NAMES).join(', '),\n                hasMore: runNames.length > MAX_RUN_NAMES,\n              }}\n            />\n          </Typography.Hint>\n          <div css={{ marginTop: theme.spacing.sm }}>\n            <Input.TextArea\n              value={inputValues[inputName]}\n              onChange={(e) => setInputValue(inputName, e.target.value)}\n            />\n          </div>\n        </div>\n      ))}\n    </Modal>\n  );\n  return { showAddNewInputsModal, AddNewInputsModal };\n};\n","import { Button, ChevronDownIcon, ChevronRightIcon, Tooltip } from '@databricks/design-system';\nimport { EvaluationTableHeader } from './EvaluationTableHeader';\nimport { usePromptEngineeringContext } from '../contexts/PromptEngineeringContext';\nimport { FormattedMessage } from 'react-intl';\n\nconst enlargedIconStyle = { svg: { width: 20, height: 20 } };\n\nexport const EvaluationTableActionsColumnRenderer = () => {\n  const { toggleExpandedHeader, isHeaderExpanded } = usePromptEngineeringContext();\n\n  return (\n    <EvaluationTableHeader>\n      <Tooltip\n        placement='right'\n        title={\n          <FormattedMessage\n            defaultMessage='Toggle detailed view'\n            description='Experiment page > artifact compare view > table header > label for \"toggle detailed view\" button'\n          />\n        }\n      >\n        <Button\n          icon={\n            isHeaderExpanded ? (\n              <ChevronDownIcon css={enlargedIconStyle} />\n            ) : (\n              <ChevronRightIcon css={enlargedIconStyle} />\n            )\n          }\n          onClick={toggleExpandedHeader}\n        />\n      </Tooltip>\n    </EvaluationTableHeader>\n  );\n};\n","import { Button, PlusIcon, Tooltip, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from 'react-intl';\n\ninterface EvaluationTableActionsCellRendererProps {\n  onAddNewInputs: () => void;\n  displayAddNewInputsButton: boolean;\n}\n\nexport const EvaluationTableActionsCellRenderer = ({\n  onAddNewInputs,\n  displayAddNewInputsButton,\n}: EvaluationTableActionsCellRendererProps) => {\n  const { theme } = useDesignSystemTheme();\n  if (!displayAddNewInputsButton) {\n    return null;\n  }\n\n  return (\n    <div\n      css={{\n        width: '100%',\n        height: '100%',\n        display: 'flex',\n        flexDirection: 'column',\n        padding: theme.spacing.xs,\n      }}\n    >\n      <Tooltip\n        placement='right'\n        title={\n          <FormattedMessage\n            defaultMessage='Add row'\n            description='Experiment page > artifact compare view > add new row button'\n          />\n        }\n      >\n        <Button icon={<PlusIcon />} onClick={onAddNewInputs} />\n      </Tooltip>\n    </div>\n  );\n};\n","import { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { RunRowType } from '../../experiment-page/utils/experimentPage.row-types';\nimport { UseEvaluationArtifactTableDataResult } from '../hooks/useEvaluationArtifactTableData';\nimport { CellClickedEvent, ColDef, GridApi } from '@ag-grid-community/core';\nimport { Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { MLFlowAgGridLoader } from '../../../../common/components/ag-grid/AgGridLoader';\nimport { EvaluationRunHeaderCellRenderer } from './EvaluationRunHeaderCellRenderer';\nimport { EvaluationTextCellRenderer } from './EvaluationTextCellRenderer';\nimport {\n  EVALUATION_ARTIFACTS_TABLE_ROW_HEIGHT,\n  EVALUATION_ARTIFACTS_TEXT_COLUMN_WIDTH,\n  getEvaluationArtifactsTableHeaderHeight,\n} from '../EvaluationArtifactCompare.utils';\nimport { EvaluationGroupByHeaderCellRenderer } from './EvaluationGroupByHeaderCellRenderer';\nimport type { Theme } from '@emotion/react';\nimport type { RunDatasetWithTags } from '../../../types';\nimport { useEvaluationAddNewInputsModal } from '../hooks/useEvaluationAddNewInputsModal';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { ReduxState, ThunkDispatch } from '../../../../redux-types';\nimport { evaluateAddInputValues } from '../../../actions/PromptEngineeringActions';\nimport {\n  canEvaluateOnRun,\n  extractRequiredInputParamsForRun,\n} from '../../prompt-engineering/PromptEngineering.utils';\nimport { useIntl } from 'react-intl';\nimport { usePromptEngineeringContext } from '../contexts/PromptEngineeringContext';\nimport { EvaluationTableHeader } from './EvaluationTableHeader';\nimport { EvaluationTableActionsColumnRenderer } from './EvaluationTableActionsColumnRenderer';\nimport { EvaluationTableActionsCellRenderer } from './EvaluationTableActionsCellRenderer';\nimport { shouldEnablePromptLab } from '../../../../common/utils/FeatureUtils';\nimport { useCreateNewRun } from '../../experiment-page/hooks/useCreateNewRun';\n\nexport interface EvaluationArtifactCompareTableProps {\n  resultList: UseEvaluationArtifactTableDataResult;\n  visibleRuns: RunRowType[];\n  groupByColumns: string[];\n  onCellClick?: (value: string, columnHeader: string) => void;\n  onHideRun: (runUuid: string) => void;\n  onDatasetSelected: (dataset: RunDatasetWithTags, run: RunRowType) => void;\n  highlightedText: string;\n  isPreviewPaneVisible?: boolean;\n  outputColumnName: string;\n}\n\nexport const EvaluationArtifactCompareTable = ({\n  resultList,\n  visibleRuns,\n  groupByColumns,\n  onCellClick,\n  onHideRun,\n  onDatasetSelected,\n  highlightedText = '',\n  isPreviewPaneVisible,\n  outputColumnName,\n}: EvaluationArtifactCompareTableProps) => {\n  const [columns, setColumns] = useState<ColDef[]>([]);\n\n  const [gridApi, setGridApi] = useState<GridApi | null>(null);\n  const pendingData = useSelector(\n    ({ evaluationData }: ReduxState) => evaluationData.evaluationPendingDataByRunUuid,\n  );\n  const gridWrapperRef = useRef<HTMLDivElement>(null);\n\n  const { isHeaderExpanded } = usePromptEngineeringContext();\n  const { createNewRun } = useCreateNewRun();\n\n  // Before hiding or duplicating the run, let's refresh the header to mitigate ag-grid's\n  // bug where it fails to defocus cell after the whole table has been hidden.\n  const handleHideRun = useCallback(\n    (runUuid: string) => {\n      gridApi?.refreshHeader();\n      onHideRun(runUuid);\n    },\n    [gridApi, onHideRun],\n  );\n\n  const handleDuplicateRun = useCallback(\n    (runToDuplicate?: RunRowType) => {\n      gridApi?.refreshHeader();\n      createNewRun(runToDuplicate);\n    },\n    [createNewRun, gridApi],\n  );\n\n  useEffect(() => {\n    if (gridApi && !isPreviewPaneVisible) {\n      gridApi.clearFocusedCell();\n    }\n  }, [gridApi, isPreviewPaneVisible]);\n\n  // Force-refresh visible cells' values when some pending data have changes\n  // either by loading new data or discarding values. This makes sure\n  // that even if the prompt evaluates to the same value, the grid still refreshes.\n  useEffect(() => {\n    if (!gridApi) {\n      return;\n    }\n    const visibleRows = gridApi.getRenderedNodes();\n    gridApi.refreshCells({ force: true, rowNodes: visibleRows });\n  }, [gridApi, pendingData, highlightedText]);\n\n  const { showAddNewInputsModal, AddNewInputsModal } = useEvaluationAddNewInputsModal();\n  const dispatch = useDispatch<ThunkDispatch>();\n\n  const scrollGridToTop = useCallback(() => {\n    // Find the scrollable viewport element\n    const gridViewport = gridWrapperRef.current?.querySelector('.ag-body-viewport');\n    if (gridViewport) {\n      gridViewport.scrollTo({ top: 0, behavior: 'smooth' });\n    } else {\n      // If for some reason there's no element, use native jumpy method\n      gridApi?.ensureIndexVisible(0, 'top');\n    }\n  }, [gridApi]);\n\n  const displayAddNewInputsButton = useMemo(\n    // TODO(ML-32969): count prompt-engineered runs based on tags\n    () => visibleRuns.map(extractRequiredInputParamsForRun).flat().length > 0,\n    [visibleRuns],\n  );\n\n  const onAddNewInputs = useCallback(() => {\n    showAddNewInputsModal(visibleRuns, (values) => {\n      dispatch(evaluateAddInputValues(values));\n      // Scroll the grid to the top after adding new row\n      scrollGridToTop();\n    });\n  }, [scrollGridToTop, showAddNewInputsModal, dispatch, visibleRuns]);\n\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n\n  const handleCellClicked = useCallback(\n    ({ value, colDef, column }: CellClickedEvent) => {\n      const emptyMessage = intl.formatMessage({\n        defaultMessage: '(empty)',\n        description:\n          'Experiment page > artifact compare view > results table > no result (empty cell)',\n      });\n      return onCellClick?.(value || emptyMessage, colDef.headerName || column.getId());\n    },\n    [intl, onCellClick],\n  );\n\n  const outputColumnIndicator = useMemo(\n    () => <Typography.Text bold>{outputColumnName}</Typography.Text>,\n    [outputColumnName],\n  );\n\n  useEffect(() => {\n    const cols: ColDef[] = [];\n\n    const { initialWidthGroupBy, initialWidthOutput, maxWidth, minWidth } =\n      EVALUATION_ARTIFACTS_TEXT_COLUMN_WIDTH;\n\n    if (shouldEnablePromptLab() && visibleRuns.some((run) => canEvaluateOnRun(run))) {\n      cols.push({\n        resizable: false,\n        pinned: true,\n        width: 40,\n        headerComponent: 'ActionsColumnRenderer',\n        cellRendererSelector: ({ rowIndex }) =>\n          rowIndex === 0\n            ? {\n                component: 'ActionsCellRenderer',\n                params: {\n                  displayAddNewInputsButton,\n                  onAddNewInputs,\n                },\n              }\n            : undefined,\n        cellClass: 'leading-column-cell',\n      });\n    }\n\n    groupByColumns.forEach((col, index) => {\n      const isLastGroupByColumns = index === groupByColumns.length - 1;\n      cols.push({\n        resizable: true,\n        initialWidth: initialWidthGroupBy,\n        minWidth,\n        maxWidth,\n        headerName: col,\n        valueGetter: ({ data }) => data.groupByCellValues[col],\n        suppressMovable: true,\n        cellRenderer: 'TextRendererCellRenderer',\n        headerClass: isLastGroupByColumns ? 'last-group-by-header-cell' : undefined,\n        cellRendererParams: {\n          isGroupByColumn: true,\n        },\n        headerComponent: 'GroupHeaderCellRenderer',\n        headerComponentParams: {\n          displayAddNewInputsButton,\n          onAddNewInputs,\n        },\n        colId: col,\n        onCellClicked: handleCellClicked,\n      });\n    });\n\n    visibleRuns.forEach((run, index) => {\n      const isFirstColumn = index === 0;\n      cols.push({\n        resizable: true,\n        initialWidth: initialWidthOutput,\n        minWidth,\n        maxWidth,\n        headerName: run.runName,\n        colId: run.runUuid,\n        valueGetter: ({ data }) => data.cellValues[run.runUuid],\n        suppressMovable: true,\n        cellRenderer: 'TextRendererCellRenderer',\n        cellRendererParams: {\n          run,\n        },\n        headerComponent: 'RunHeaderCellRenderer',\n        headerComponentParams: {\n          run,\n          onDuplicateRun: handleDuplicateRun,\n          onHideRun: handleHideRun,\n          onDatasetSelected,\n          groupHeaderContent: isFirstColumn ? outputColumnIndicator : null,\n        },\n        onCellClicked: handleCellClicked,\n      });\n    });\n\n    setColumns(cols);\n  }, [\n    visibleRuns,\n    groupByColumns,\n    handleHideRun,\n    handleDuplicateRun,\n    onDatasetSelected,\n    onAddNewInputs,\n    displayAddNewInputsButton,\n    handleCellClicked,\n    outputColumnIndicator,\n  ]);\n\n  useEffect(() => {\n    if (!gridApi) {\n      return;\n    }\n\n    // Check if we need to have a tall header, i.e. if we have any runs\n    // with datasets or with evaluation metadata\n    const runsContainHeaderMetadata = visibleRuns.some(\n      (run) => canEvaluateOnRun(run) || run.datasets?.length > 0,\n    );\n\n    // Set header height dynamically\n    gridApi.setHeaderHeight(\n      getEvaluationArtifactsTableHeaderHeight(isHeaderExpanded, runsContainHeaderMetadata),\n    );\n  }, [gridApi, isHeaderExpanded, visibleRuns]);\n\n  return (\n    <div css={{ height: '100%', overflow: 'hidden' }} ref={gridWrapperRef}>\n      <MLFlowAgGridLoader\n        css={createTableStyles(theme)}\n        context={{ highlightedText }}\n        rowHeight={EVALUATION_ARTIFACTS_TABLE_ROW_HEIGHT}\n        onGridReady={({ api }) => setGridApi(api)}\n        getRowId={({ data }) => data.key}\n        suppressHorizontalScroll={false}\n        columnDefs={columns}\n        rowData={resultList}\n        components={{\n          TextRendererCellRenderer: EvaluationTextCellRenderer,\n          GroupHeaderCellRenderer: EvaluationGroupByHeaderCellRenderer,\n          RunHeaderCellRenderer: EvaluationRunHeaderCellRenderer,\n          ActionsColumnRenderer: EvaluationTableActionsColumnRenderer,\n          ActionsCellRenderer: EvaluationTableActionsCellRenderer,\n        }}\n      />\n      {AddNewInputsModal}\n    </div>\n  );\n};\n\nconst createTableStyles = (theme: Theme) => ({\n  '.ag-row:not(.ag-row-first), .ag-body-viewport': {\n    borderTop: `1px solid ${theme.colors.borderDecorative}`,\n  },\n  '.ag-row-last': {\n    borderBottom: `1px solid ${theme.colors.borderDecorative}`,\n  },\n  '.ag-cell, .last-group-by-header-cell .header-group-cell': {\n    borderRight: `1px solid ${theme.colors.borderDecorative}`,\n  },\n  '.ag-cell-focus:not(.leading-column-cell)::after': {\n    content: '\"\"',\n    position: 'absolute' as const,\n    inset: 0,\n    boxShadow: `inset 0 0 0px 2px ${theme.colors.blue300}`,\n    pointerEvents: 'none' as const,\n  },\n});\n","import { fromPairs, isObject, sortBy } from 'lodash';\nimport { useMemo } from 'react';\n\nimport { EvaluationArtifactTableEntry, PendingEvaluationArtifactTableEntry } from '../../../types';\nimport type { EvaluationDataReduxState } from '../../../reducers/EvaluationDataReducer';\nimport { shouldEnablePromptLab } from '../../../../common/utils/FeatureUtils';\nimport {\n  PROMPTLAB_METADATA_COLUMN_LATENCY,\n  PROMPTLAB_METADATA_COLUMN_TOTAL_TOKENS,\n} from '../../prompt-engineering/PromptEngineering.utils';\n\ntype ArtifactsByRun = EvaluationDataReduxState['evaluationArtifactsByRunUuid'];\ntype PendingDataByRun = EvaluationDataReduxState['evaluationPendingDataByRunUuid'];\ntype DraftInputValues = EvaluationDataReduxState['evaluationDraftInputValues'];\n\nexport type UseEvaluationArtifactTableDataResult = {\n  // Unique key for every result row\n  key: string;\n\n  // Values of \"group by\" columns. The column name is the key.\n  groupByCellValues: Record<string, string>;\n\n  // Values of output columns. The run uuid is the key.\n  cellValues: Record<string, string>;\n\n  // Contains data describing additional metadata for output: evaluation time, total tokens and a flag\n  // indicating if the run was evaluated in this session and is unsynced\n  outputMetadataByRunUuid?: Record<\n    string,\n    { isPending: boolean; evaluationTime: number; totalTokens?: number }\n  >;\n\n  isPendingInputRow?: boolean;\n}[];\n\nconst extractGroupByValuesFromEntry = (\n  entry: EvaluationArtifactTableEntry,\n  groupByCols: string[],\n) => {\n  const groupByMappings = groupByCols.map<[string, string]>((groupBy) => [\n    groupBy,\n    entry[groupBy]?.toString(),\n  ]);\n\n  // Next, let's calculate a unique hash for values of those columns - it will serve as\n  // an identifier of each result row.\n  const groupByHashKey = groupByMappings.map(([, keyValue]) => String(keyValue)).join('.');\n\n  return { key: groupByHashKey, groupByValues: fromPairs(groupByMappings) };\n};\n\n/**\n * Consumes table artifact data and based on provided dimensions,\n * generates the data ready to be displayed in the comparison data grid.\n *\n * @param artifactsByRun artifacts-by-run data (extracted from the redux store)\n * @param comparedRunsUuids UUIDs of runs we want to compare\n * @param tableNames table names we want to include in the comparison\n * @param groupByCols list of columns that will be used to group the results by\n * @param outputColumn selects the column to be displayed in the run\n */\nexport const useEvaluationArtifactTableData = (\n  artifactsByRun: ArtifactsByRun,\n  pendingDataByRun: PendingDataByRun,\n  draftInputValues: DraftInputValues,\n  comparedRunsUuids: string[],\n  tableNames: string[],\n  groupByCols: string[],\n  outputColumn: string,\n): UseEvaluationArtifactTableDataResult =>\n  // eslint-disable-next-line complexity\n  useMemo(() => {\n    /**\n     * End results, i.e. table rows\n     */\n    const results: UseEvaluationArtifactTableDataResult = [];\n\n    /**\n     * An aggregate object containing all output column values.\n     * The first level key is the combined hash of all group by values,\n     * the second level key is the run UUID. A leaf of this tree corresponds to the output cell value.\n     */\n    const outputCellsValueMap: Record<string, Record<string, string>> = {};\n\n    /**\n     * An aggregate object containing values of the \"group by\" columns.\n     * The first level key is the combined hash of all group by values,\n     * the second level key is the \"group by\" column name. A leaf of this tree corresponds to the cell value.\n     */\n    const groupByCellsValueMap: Record<string, Record<string, string>> = {};\n\n    /**\n     * This array contains all \"group by\" keys that were freshly added or evaluated, i.e. they are not found\n     * in the original evaluation data. This helps to identify them, place them on the top and indicate\n     * they're yet to be synchronized.\n     */\n    const pendingRowKeys: string[] = [];\n\n    /**\n     * Start with populating the table with the draft rows created from the draft input sets\n     */\n    for (const draftInputValueSet of draftInputValues) {\n      const visibleGroupByValues = groupByCols.map((colName) => [\n        colName,\n        draftInputValueSet[colName],\n      ]);\n\n      const draftInputRowKey = visibleGroupByValues.map(([, value]) => value).join('.');\n\n      // Register new \"group by\" values combination and mark it as an artificial row\n      groupByCellsValueMap[draftInputRowKey] = fromPairs(visibleGroupByValues);\n      pendingRowKeys.push(draftInputRowKey);\n    }\n\n    const outputMetadataByCellsValueMap: Record<\n      string,\n      Record<string, { isPending: boolean; evaluationTime: number; totalTokens?: number }>\n    > = {};\n\n    // Search through artifact tables and get all entries corresponding to a particular run\n    const runsWithEntries = comparedRunsUuids.map<[string, EvaluationArtifactTableEntry[]]>(\n      (runUuid) => {\n        const baseEntries = Object.values(artifactsByRun[runUuid] || {})\n          .filter(({ path }) => tableNames.includes(path))\n          .map(({ entries }) => entries)\n          .flat();\n        return [runUuid, baseEntries];\n      },\n    );\n\n    // Iterate through all entries and assign them to the corresponding groups.\n    for (const [runUuid, entries] of runsWithEntries) {\n      for (const entry of entries) {\n        const { key, groupByValues } = extractGroupByValuesFromEntry(entry, groupByCols);\n\n        // Do not process the entry that have empty values for all active \"group by\" columns\n        if (Object.values(groupByValues).every((value) => !value)) {\n          continue;\n        }\n\n        // Assign \"group by\" column cell values\n        if (!groupByCellsValueMap[key]) {\n          groupByCellsValueMap[key] = groupByValues;\n        }\n\n        // Check if there are values in promptlab metadata columns\n        if (\n          entry[PROMPTLAB_METADATA_COLUMN_LATENCY] ||\n          entry[PROMPTLAB_METADATA_COLUMN_TOTAL_TOKENS]\n        ) {\n          if (!outputMetadataByCellsValueMap[key]) {\n            outputMetadataByCellsValueMap[key] = {};\n          }\n\n          // If true, save it to the record containing output metadata at the index\n          // corresponding to a current \"group by\" key (row) and the run uuid (column)\n          // Show the metadata of the most recent value\n          if (!outputMetadataByCellsValueMap[key][runUuid]) {\n            outputMetadataByCellsValueMap[key][runUuid] = {\n              isPending: false,\n              evaluationTime: parseFloat(entry[PROMPTLAB_METADATA_COLUMN_LATENCY]),\n              totalTokens: entry[PROMPTLAB_METADATA_COLUMN_TOTAL_TOKENS]\n                ? parseInt(entry[PROMPTLAB_METADATA_COLUMN_TOTAL_TOKENS], 10)\n                : undefined,\n            };\n          }\n        }\n\n        // Assign output column cell values\n        if (!outputCellsValueMap[key]) {\n          outputCellsValueMap[key] = {};\n        }\n\n        const cellsEntry = outputCellsValueMap[key];\n\n        // Use the data from the other set if present, but only if there\n        // is no value assigned already. This way we will proritize prepended values.\n        cellsEntry[runUuid] = cellsEntry[runUuid] || entry[outputColumn]?.toString();\n      }\n    }\n\n    for (const [runUuid, pendingEntries] of Object.entries(pendingDataByRun)) {\n      for (const pendingEntry of pendingEntries) {\n        const { entryData, ...metadata } = pendingEntry;\n        const { key, groupByValues } = extractGroupByValuesFromEntry(entryData, groupByCols);\n\n        // Do not process the entry that have empty values for all active \"group by\" columns\n        if (Object.values(groupByValues).every((value) => !value)) {\n          continue;\n        }\n\n        // Assign \"group by\" column cell values\n        if (!groupByCellsValueMap[key]) {\n          groupByCellsValueMap[key] = groupByValues;\n\n          // If the key was not found in the original set, mark entire row as pending\n          pendingRowKeys.push(key);\n        }\n\n        if (!outputMetadataByCellsValueMap[key]) {\n          outputMetadataByCellsValueMap[key] = {};\n        }\n\n        // code pointer for where the metadat is stored\n        outputMetadataByCellsValueMap[key][runUuid] = metadata;\n\n        // Assign output column cell values\n        if (!outputCellsValueMap[key]) {\n          outputCellsValueMap[key] = {};\n        }\n\n        const cellsEntry = outputCellsValueMap[key];\n        // Use pending data to overwrite already existing result\n        cellsEntry[runUuid] = entryData[outputColumn]?.toString() || cellsEntry[runUuid];\n      }\n    }\n\n    /**\n     * Extract all \"group by\" keys, i.e. effectively row keys.\n     * Hoist all rows that were created during the pending evaluation to the top.\n     */\n    const allRowKeys = sortBy(\n      Object.entries(groupByCellsValueMap),\n      ([key]) => !pendingRowKeys.includes(key),\n    );\n\n    // In the final step, iterate through all found combinations of \"group by\" values and\n    // assign the cells\n    for (const [key, groupByCellValues] of allRowKeys) {\n      const existingTableRow = results.find(({ key: existingKey }) => key === existingKey);\n      if (existingTableRow && outputCellsValueMap[key]) {\n        existingTableRow.cellValues = outputCellsValueMap[key];\n        existingTableRow.outputMetadataByRunUuid = outputMetadataByCellsValueMap[key];\n      } else {\n        results.push({\n          key,\n          groupByCellValues,\n          cellValues: outputCellsValueMap[key] || {},\n          outputMetadataByRunUuid: outputMetadataByCellsValueMap[key],\n          isPendingInputRow: pendingRowKeys.includes(key),\n        });\n      }\n    }\n\n    return results;\n  }, [\n    comparedRunsUuids,\n    artifactsByRun,\n    groupByCols,\n    draftInputValues,\n    tableNames,\n    outputColumn,\n    pendingDataByRun,\n  ]);\n","import userEvent from '@testing-library/user-event';\nimport { useEffect } from 'react';\n\ndeclare interface NavigatorWithUserData extends Navigator {\n  userAgentData: any;\n}\n\nconst isMacKeyboard = () =>\n  // userAgentData should be supported in modern Chromium based browsers\n  /mac/i.test((window.navigator as NavigatorWithUserData).userAgentData?.platform) ||\n  // if not, falls back to navigator.platform\n  /mac/i.test(window.navigator.platform);\n\nconst systemModifierKey: keyof KeyboardEvent = isMacKeyboard() ? 'metaKey' : 'ctrlKey';\n\n/**\n * Triggers certain action when a keyboard combination is pressed\n *\n * @example\n *\n * // Listens to CMD+S action\n * useBrowserKeyShortcutListener('s', { ctrlOrCmdKey: true }, () => { ... })\n */\nexport const useBrowserKeyShortcutListener = (\n  /**\n   * A single key (e.g. \"s\") that will be listened for pressing\n   */\n  key: string,\n  /**\n   * Determines which modifier keys are necessary to trigger the action\n   */\n  modifierKeys: { shiftKey?: boolean; ctrlOrCmdKey?: boolean; altOrOptKey?: boolean } = {},\n  /**\n   * A callback function. If returns true, the default action for the key combination will be prevented.\n   */\n  fn: () => boolean | void,\n) => {\n  const { altOrOptKey = false, ctrlOrCmdKey = false, shiftKey = false } = modifierKeys;\n  useEffect(() => {\n    const handler = (e: KeyboardEvent) => {\n      if (\n        (!ctrlOrCmdKey || e[systemModifierKey]) &&\n        (!altOrOptKey || e.altKey) &&\n        (!shiftKey || e.shiftKey) &&\n        e.key === key\n      ) {\n        const shouldPreventDefault = fn();\n        if (shouldPreventDefault) {\n          e.preventDefault();\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handler);\n    return () => window.removeEventListener('keydown', handler);\n  }, [key, fn, ctrlOrCmdKey, altOrOptKey, shiftKey]);\n\n  return { isMacKeyboard };\n};\n","import {\n  CopyIcon,\n  DialogCombobox,\n  DialogComboboxContent,\n  DialogComboboxOptionList,\n  DialogComboboxOptionListCheckboxItem,\n  DialogComboboxOptionListSelectItem,\n  DialogComboboxTrigger,\n  Empty,\n  InfoIcon,\n  Input,\n  SearchIcon,\n  LegacySkeleton,\n  Spinner,\n  ToggleButton,\n  Tooltip,\n  Typography,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport type { EvaluationDataReduxState } from '../../reducers/EvaluationDataReducer';\nimport { SearchExperimentRunsViewState } from '../experiment-page/models/SearchExperimentRunsViewState';\nimport { RunRowType } from '../experiment-page/utils/experimentPage.row-types';\nimport { EvaluationArtifactCompareTable } from './components/EvaluationArtifactCompareTable';\nimport { useEvaluationArtifactColumns } from './hooks/useEvaluationArtifactColumns';\nimport { useEvaluationArtifactTableData } from './hooks/useEvaluationArtifactTableData';\nimport { useEvaluationArtifactTables } from './hooks/useEvaluationArtifactTables';\nimport type {\n  RunDatasetWithTags,\n  UpdateExperimentSearchFacetsFn,\n  UpdateExperimentViewStateFn,\n} from '../../types';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { PreviewSidebar } from '../../../common/components/PreviewSidebar';\nimport { useEvaluationArtifactViewState } from './hooks/useEvaluationArtifactViewState';\nimport { useEvaluationArtifactWriteBack } from './hooks/useEvaluationArtifactWriteBack';\nimport { PromptEngineeringContextProvider } from './contexts/PromptEngineeringContext';\nimport { ReduxState, ThunkDispatch } from '../../../redux-types';\nimport { getEvaluationTableArtifact } from '../../actions';\nimport Utils from '../../../common/utils/Utils';\nimport {\n  DEFAULT_PROMPTLAB_OUTPUT_COLUMN,\n  canEvaluateOnRun,\n  extractRequiredInputParamsForRun,\n} from '../prompt-engineering/PromptEngineering.utils';\nimport { searchModelGatewayRoutesApi } from '../../actions/ModelGatewayActions';\nimport { shouldEnablePromptLab } from 'common/utils/FeatureUtils';\n\nconst MAX_RUNS_TO_COMPARE = 10;\n\ninterface EvaluationArtifactCompareViewProps {\n  comparedRuns: RunRowType[];\n  viewState: SearchExperimentRunsViewState;\n  updateViewState: UpdateExperimentViewStateFn;\n  updateSearchFacets: UpdateExperimentSearchFacetsFn;\n  onDatasetSelected: (dataset: RunDatasetWithTags, run: RunRowType) => void;\n}\n\n/**\n * Compares the table data contained in experiment run artifacts.\n */\nexport const EvaluationArtifactCompareView = ({\n  comparedRuns,\n  updateSearchFacets,\n  onDatasetSelected,\n  viewState,\n  updateViewState,\n}: EvaluationArtifactCompareViewProps) => {\n  const intl = useIntl();\n  const { theme } = useDesignSystemTheme();\n\n  const visibleRuns = useMemo(\n    () => comparedRuns.filter(({ hidden }) => !hidden).slice(0, MAX_RUNS_TO_COMPARE),\n    [comparedRuns],\n  );\n\n  const {\n    selectedTables,\n    groupByCols,\n    outputColumn,\n    setSelectedTables,\n    setGroupByCols,\n    setOutputColumn,\n  } = useEvaluationArtifactViewState(viewState, updateViewState);\n\n  const [showSearchSpinner, setShowSearchSpinner] = useState(false);\n  const [filter, setFilter] = useState('');\n  const [debouncedFilter, setDebouncedFilter] = useState('');\n  const [userDeselectedAllColumns, setUserDeselectedAllColumns] = useState(false);\n\n  const { isSyncingArtifacts, EvaluationSyncStatusElement } = useEvaluationArtifactWriteBack();\n\n  const dispatch = useDispatch<ThunkDispatch>();\n\n  useEffect(() => {\n    if (shouldEnablePromptLab()) {\n      dispatch(searchModelGatewayRoutesApi()).catch((e) => {\n        Utils.logErrorAndNotifyUser(e?.message || e);\n      });\n    }\n  }, [dispatch]);\n\n  const handleTableToggle = useCallback(\n    (value: string) =>\n      setSelectedTables((currentValue) => {\n        if (currentValue.includes(value)) {\n          return currentValue.filter((item) => item !== value);\n        } else {\n          return [...currentValue, value];\n        }\n      }),\n    [setSelectedTables],\n  );\n\n  const handleGroupByToggle = useCallback(\n    (value: string) =>\n      setGroupByCols((currentValue) => {\n        const newValues = currentValue.includes(value)\n          ? currentValue.filter((item) => item !== value)\n          : [...currentValue, value].sort();\n        setUserDeselectedAllColumns(newValues.length === 0);\n        return newValues;\n      }),\n    [setGroupByCols],\n  );\n\n  const visibleRunsUuids = useMemo(() => visibleRuns.map(({ runUuid }) => runUuid), [visibleRuns]);\n\n  const {\n    evaluationArtifactsByRunUuid,\n    evaluationPendingDataByRunUuid,\n    evaluationDraftInputValues,\n  } = useSelector(({ evaluationData }: ReduxState) => evaluationData);\n\n  const { tables, tablesByRun } = useEvaluationArtifactTables(visibleRuns);\n\n  // Select the first table by default\n  useEffect(() => {\n    if (tables.length > 0 && selectedTables.length === 0) {\n      setSelectedTables([tables[0]]);\n    }\n  }, [tables, setSelectedTables, selectedTables.length]);\n\n  const isLoading = useSelector(({ evaluationData, modelGateway }: ReduxState) => {\n    return (\n      modelGateway.modelGatewayRoutesLoading ||\n      visibleRunsUuids.some((uuid) =>\n        selectedTables.some(\n          (table) => evaluationData.evaluationArtifactsLoadingByRunUuid[uuid]?.[table],\n        ),\n      )\n    );\n  });\n\n  const { columns } = useEvaluationArtifactColumns(\n    evaluationArtifactsByRunUuid,\n    visibleRunsUuids,\n    selectedTables,\n  );\n\n  const tableRows = useEvaluationArtifactTableData(\n    evaluationArtifactsByRunUuid,\n    evaluationPendingDataByRunUuid,\n    evaluationDraftInputValues,\n    visibleRunsUuids,\n    selectedTables,\n    groupByCols,\n    outputColumn,\n  );\n\n  // Try to extract all existing prompt input fields from prompt engineering runs, if there are any.\n  // Return \"null\" otherwise.\n  const promptLabInputVariableNames = useMemo(() => {\n    const promptEngineeringRuns = visibleRuns.filter(canEvaluateOnRun);\n    const allInputNames = promptEngineeringRuns.map(extractRequiredInputParamsForRun).flat();\n    if (!allInputNames.length) {\n      return null;\n    }\n\n    // Remove duplicates\n    const distinctInputNames = Array.from(new Set(allInputNames));\n\n    // Ensure that detected input names are included in the available columns\n    return distinctInputNames.filter((inputName) => columns.includes(inputName));\n  }, [visibleRuns, columns]);\n\n  // If we've changed the visible run set and all of them originate from prompt engineering,\n  // reset the columns so they will be recalculated again\n  useEffect(() => {\n    if (visibleRuns.every(canEvaluateOnRun)) {\n      setGroupByCols([]);\n    }\n  }, [setGroupByCols, visibleRuns]);\n\n  // For every run, load its selected tables\n  useEffect(() => {\n    if (!selectedTables.length) {\n      return;\n    }\n    for (const run of visibleRuns) {\n      if (!run) {\n        continue;\n      }\n      const tablesToFetch = (tablesByRun[run.runUuid] || []).filter((table) =>\n        selectedTables.includes(table),\n      );\n      for (const table of tablesToFetch) {\n        dispatch(getEvaluationTableArtifact(run.runUuid, table, false)).catch((e) => {\n          Utils.logErrorAndNotifyUser(e.message || e);\n        });\n      }\n    }\n  }, [visibleRuns, dispatch, selectedTables, tablesByRun]);\n\n  // Table is ready to use if it's loaded, at least one table and at least one run is selected\n  const areTablesSelected = selectedTables.length > 0;\n  const areRunsSelected = visibleRuns.length > 0;\n  const isViewConfigured = !isLoading && areTablesSelected && areRunsSelected;\n\n  const filteredRows = useMemo(() => {\n    if (!debouncedFilter.trim()) {\n      return tableRows;\n    }\n    const regexp = new RegExp(debouncedFilter, 'i');\n    return tableRows.filter(({ groupByCellValues }) =>\n      Object.values(groupByCellValues).some((groupByValue) => groupByValue?.match(regexp)),\n    );\n  }, [tableRows, debouncedFilter]);\n\n  const handleHideRun = useCallback(\n    (runUuid: string) =>\n      updateSearchFacets((existingFacets) => ({\n        ...existingFacets,\n        runsHidden: [...existingFacets.runsHidden, runUuid],\n      })),\n    [updateSearchFacets],\n  );\n\n  // Make sure that there's at least one \"group by\" column selected\n  useEffect(() => {\n    if (isLoading || userDeselectedAllColumns) {\n      return;\n    }\n    const noColumnsSelected = groupByCols.length < 1;\n    const columnNotAvailableAnymore = groupByCols.some((column) => !columns.includes(column));\n    const firstColumn = columns[0];\n\n    // If prompt engineering prompt inputs are detected, take them as a candidate for initial \"group by\" columns.\n    // If not, use the first valid column found.\n    const groupByColumnCandidates =\n      promptLabInputVariableNames || (firstColumn ? [firstColumn] : null);\n\n    if ((noColumnsSelected || columnNotAvailableAnymore) && groupByColumnCandidates) {\n      setGroupByCols(groupByColumnCandidates.sort());\n    }\n  }, [\n    isLoading,\n    userDeselectedAllColumns,\n    groupByCols,\n    outputColumn,\n    columns,\n    setGroupByCols,\n    promptLabInputVariableNames,\n  ]);\n\n  // Remove MLFLOW_ columns from the list of groupby columns since they are for metadata only\n  const availableGroupByColumns = useMemo(\n    () => columns.filter((col) => !col.startsWith('MLFLOW_')),\n    [columns],\n  );\n\n  // All columns that are not used for grouping can be used as output (compare) column\n  // Remove MLFLOW_ columns from the list of output columns\n  const availableOutputColumns = useMemo(\n    () => columns.filter((col) => !groupByCols.includes(col) && !col.startsWith('MLFLOW_')),\n    [columns, groupByCols],\n  );\n\n  // If the current output column have been selected as \"group by\", change it to the other available one\n  useEffect(() => {\n    if (groupByCols.includes(outputColumn) || !outputColumn) {\n      const nextColumnCandidate = availableOutputColumns.includes(DEFAULT_PROMPTLAB_OUTPUT_COLUMN)\n        ? DEFAULT_PROMPTLAB_OUTPUT_COLUMN\n        : availableOutputColumns[0];\n      setOutputColumn(nextColumnCandidate || '');\n    }\n  }, [groupByCols, outputColumn, availableOutputColumns, setOutputColumn]);\n\n  // On every change of \"filter\" input, debounce the value and show the spinner\n  useEffect(() => {\n    setShowSearchSpinner(true);\n    const handler = setTimeout(() => setDebouncedFilter(filter), 250);\n    return () => clearTimeout(handler);\n  }, [filter]);\n\n  // After debounced filter value settles in, remove the search spinner\n  useEffect(() => {\n    setShowSearchSpinner(false);\n  }, [debouncedFilter]);\n\n  // If the current output column is not available anymore, change it to the other available one\n  useEffect(() => {\n    if (!availableOutputColumns.includes(outputColumn)) {\n      const nextColumnCandidate = availableOutputColumns.includes(DEFAULT_PROMPTLAB_OUTPUT_COLUMN)\n        ? DEFAULT_PROMPTLAB_OUTPUT_COLUMN\n        : availableOutputColumns[0];\n      setOutputColumn(nextColumnCandidate || '');\n    }\n  }, [outputColumn, availableOutputColumns, setOutputColumn]);\n\n  // If any currently selected table is not available anymore, deselect it\n  useEffect(() => {\n    if (selectedTables.some((table) => !tables.includes(table))) {\n      setSelectedTables([]);\n    }\n  }, [selectedTables, tables, setSelectedTables]);\n\n  const [sidebarPreviewData, setSidebarPreviewData] = useState<{\n    value: string;\n    header: string;\n  } | null>(null);\n\n  const handleCellClicked = useCallback(\n    (value: string, header: string) => {\n      setSidebarPreviewData({ value, header });\n      updateViewState({ previewPaneVisible: true });\n    },\n    [updateViewState],\n  );\n\n  return (\n    <div\n      css={{\n        borderTop: `1px solid ${theme.colors.border}`,\n        borderLeft: `1px solid ${theme.colors.border}`,\n        // Let's cover 1 pixel of the grid's border for the sleek look\n        marginLeft: -1,\n        zIndex: 1,\n        height: '100%',\n        display: 'grid',\n        gridTemplateColumns: viewState.previewPaneVisible ? '1fr auto' : '1fr',\n        overflow: 'hidden',\n      }}\n    >\n      <div\n        css={{\n          paddingLeft: theme.spacing.sm,\n          paddingTop: theme.spacing.sm,\n          height: '100%',\n          display: 'grid',\n          gridTemplateRows: 'auto auto 1fr',\n          overflow: 'hidden',\n          rowGap: theme.spacing.sm,\n          backgroundColor: theme.colors.backgroundSecondary,\n        }}\n      >\n        <div\n          css={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: theme.spacing.sm,\n            overflow: 'hidden',\n            height: theme.general.heightSm,\n          }}\n        >\n          <DialogCombobox\n            label={\n              <FormattedMessage\n                defaultMessage='Table'\n                description='Experiment page > artifact compare view > table select dropdown label'\n              />\n            }\n            multiSelect\n            value={selectedTables}\n          >\n            <DialogComboboxTrigger\n              css={{ maxWidth: 300, backgroundColor: theme.colors.backgroundPrimary }}\n              data-testid='dropdown-tables'\n              onClear={() => setSelectedTables([])}\n              disabled={isSyncingArtifacts}\n            />\n            <DialogComboboxContent css={{ maxWidth: 300 }}>\n              <DialogComboboxOptionList>\n                {tables.map((artifactPath) => (\n                  <DialogComboboxOptionListCheckboxItem\n                    value={artifactPath}\n                    key={artifactPath}\n                    onChange={handleTableToggle}\n                    checked={selectedTables.includes(artifactPath)}\n                    data-testid='dropdown-tables-option'\n                  >\n                    {artifactPath}\n                  </DialogComboboxOptionListCheckboxItem>\n                ))}\n              </DialogComboboxOptionList>\n            </DialogComboboxContent>\n          </DialogCombobox>\n          <Tooltip\n            title={\n              <FormattedMessage\n                defaultMessage='Using the list of logged table artifacts, select at least one to start comparing results.'\n                description='Experiment page > artifact compare view > table select dropdown tooltip'\n              />\n            }\n          >\n            <InfoIcon />\n          </Tooltip>\n        </div>\n        {isLoading ? (\n          <LegacySkeleton />\n        ) : (\n          <>\n            <div\n              css={{\n                display: 'flex',\n                columnGap: theme.spacing.sm,\n                alignItems: 'center',\n                overflow: 'hidden',\n                height: theme.general.heightSm,\n              }}\n            >\n              <Input\n                prefix={<SearchIcon />}\n                suffix={showSearchSpinner && <Spinner size='small' />}\n                css={{ width: 300, minWidth: 300 }}\n                onChange={(e) => setFilter(e.target.value)}\n                value={filter}\n                placeholder={intl.formatMessage(\n                  {\n                    defaultMessage: 'Filter by {columnNames}',\n                    description:\n                      'Experiment page > artifact compare view > search input placeholder',\n                  },\n                  {\n                    columnNames: groupByCols.join(', '),\n                  },\n                )}\n                allowClear\n                disabled={!isViewConfigured || isSyncingArtifacts}\n              />\n              <DialogCombobox\n                value={groupByCols}\n                multiSelect\n                label={\n                  <FormattedMessage\n                    defaultMessage='Group by'\n                    description='Experiment page > artifact compare view > \"group by column\" select dropdown label'\n                  />\n                }\n              >\n                <DialogComboboxTrigger\n                  disabled={!isViewConfigured || isSyncingArtifacts}\n                  allowClear={false}\n                  showTagAfterValueCount={1}\n                  css={{ maxWidth: 300, backgroundColor: theme.colors.backgroundPrimary }}\n                  aria-label='Select \"group by\" columns'\n                />\n                <DialogComboboxContent css={{ maxWidth: 300 }}>\n                  <DialogComboboxOptionList>\n                    {availableGroupByColumns.map((columnName) => (\n                      <DialogComboboxOptionListCheckboxItem\n                        value={columnName}\n                        key={columnName}\n                        onChange={handleGroupByToggle}\n                        checked={groupByCols.includes(columnName)}\n                      >\n                        {columnName}\n                      </DialogComboboxOptionListCheckboxItem>\n                    ))}\n                  </DialogComboboxOptionList>\n                </DialogComboboxContent>\n              </DialogCombobox>\n              <DialogCombobox\n                value={[outputColumn]}\n                label={\n                  <FormattedMessage\n                    defaultMessage='Compare'\n                    description='Experiment page > artifact compare view > \"compare\" select dropdown label'\n                  />\n                }\n              >\n                <DialogComboboxTrigger\n                  disabled={!isViewConfigured || isSyncingArtifacts}\n                  allowClear={false}\n                  css={{ maxWidth: 300, backgroundColor: theme.colors.backgroundPrimary }}\n                />\n                <DialogComboboxContent css={{ maxWidth: 300 }}>\n                  <DialogComboboxOptionList>\n                    {availableOutputColumns.map((columnName) => (\n                      <DialogComboboxOptionListSelectItem\n                        value={columnName}\n                        key={columnName}\n                        onChange={() => setOutputColumn(columnName)}\n                        checked={outputColumn === columnName}\n                      >\n                        {columnName}\n                      </DialogComboboxOptionListSelectItem>\n                    ))}\n                  </DialogComboboxOptionList>\n                </DialogComboboxContent>\n              </DialogCombobox>\n            </div>\n\n            {isViewConfigured && !userDeselectedAllColumns ? (\n              <div\n                css={{\n                  position: 'relative' as const,\n                  zIndex: 1,\n                  overflowY: 'hidden' as const,\n                  height: '100%',\n                  backgroundColor: theme.colors.backgroundPrimary,\n                }}\n              >\n                <PromptEngineeringContextProvider tableData={tableRows} outputColumn={outputColumn}>\n                  <EvaluationArtifactCompareTable\n                    visibleRuns={visibleRuns}\n                    groupByColumns={groupByCols}\n                    resultList={filteredRows}\n                    onCellClick={handleCellClicked}\n                    onHideRun={handleHideRun}\n                    onDatasetSelected={onDatasetSelected}\n                    highlightedText={debouncedFilter.trim()}\n                    isPreviewPaneVisible={viewState.previewPaneVisible}\n                    outputColumnName={outputColumn}\n                  />\n                </PromptEngineeringContextProvider>\n              </div>\n            ) : (\n              <div css={{ marginTop: theme.spacing.lg }}>\n                <Empty\n                  title={\n                    userDeselectedAllColumns ? (\n                      <FormattedMessage\n                        defaultMessage='No group by columns selected'\n                        description='Experiment page > artifact compare view > empty state for no group by columns selected > title'\n                      />\n                    ) : areRunsSelected ? (\n                      <FormattedMessage\n                        defaultMessage='No tables selected'\n                        description='Experiment page > artifact compare view > empty state for no tables selected > title'\n                      />\n                    ) : (\n                      <FormattedMessage\n                        defaultMessage='No runs selected'\n                        description='Experiment page > artifact compare view > empty state for no runs selected > title'\n                      />\n                    )\n                  }\n                  description={\n                    userDeselectedAllColumns ? (\n                      <FormattedMessage\n                        defaultMessage='Using controls above, select at least one \"group by\" column.'\n                        description='Experiment page > artifact compare view > empty state for no group by columns selected > title'\n                      />\n                    ) : areRunsSelected ? (\n                      <FormattedMessage\n                        defaultMessage='Using controls above, select at least one artifact containing table.'\n                        description='Experiment page > artifact compare view > empty state for no tables selected > subtitle with the hint'\n                      />\n                    ) : (\n                      <FormattedMessage\n                        defaultMessage='Make sure that at least one experiment run is visible and available to compare'\n                        description='Experiment page > artifact compare view > empty state for no runs selected > subtitle with the hint'\n                      />\n                    )\n                  }\n                />\n              </div>\n            )}\n            {EvaluationSyncStatusElement}\n          </>\n        )}\n      </div>\n      {viewState.previewPaneVisible && (\n        <PreviewSidebar\n          content={sidebarPreviewData?.value}\n          copyText={sidebarPreviewData?.value}\n          headerText={sidebarPreviewData?.header}\n          onClose={() => updateViewState({ previewPaneVisible: false })}\n          empty={\n            <Empty\n              description={\n                <FormattedMessage\n                  defaultMessage='Select a cell to display preview'\n                  description='Experiment page > artifact compare view > preview sidebar > nothing selected'\n                />\n              }\n            />\n          }\n        />\n      )}\n    </div>\n  );\n};\n","import { useEffect, useState } from 'react';\nimport { SearchExperimentRunsViewState } from '../../experiment-page/models/SearchExperimentRunsViewState';\nimport { UpdateExperimentViewStateFn } from '../../../types';\n\nexport const useEvaluationArtifactViewState = (\n  viewState: SearchExperimentRunsViewState,\n  updateViewState: UpdateExperimentViewStateFn,\n) => {\n  const { artifactViewState = {} } = viewState;\n\n  const [selectedTables, setSelectedTables] = useState<string[]>(\n    artifactViewState.selectedTables || [],\n  );\n  const [groupByCols, setGroupByCols] = useState<string[]>(artifactViewState.groupByCols || []);\n  const [outputColumn, setOutputColumn] = useState(artifactViewState.outputColumn || '');\n\n  useEffect(\n    () =>\n      updateViewState({\n        artifactViewState: {\n          selectedTables,\n          groupByCols,\n          outputColumn,\n        },\n      }),\n    [updateViewState, selectedTables, groupByCols, outputColumn],\n  );\n\n  return {\n    selectedTables,\n    groupByCols,\n    outputColumn,\n    setSelectedTables,\n    setGroupByCols,\n    setOutputColumn,\n  };\n};\n","import React from 'react';\nimport { useCallback, useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { ReduxState, ThunkDispatch } from '../../../../redux-types';\nimport { Button, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport {\n  discardPendingEvaluationData,\n  writeBackEvaluationArtifactsAction,\n} from '../../../actions/PromptEngineeringActions';\nimport { FormattedMessage } from 'react-intl';\nimport Utils from '../../../../common/utils/Utils';\nimport { useBrowserKeyShortcutListener } from '../../../../common/hooks/useBrowserKeyShortcutListener';\n\nexport const useEvaluationArtifactWriteBack = () => {\n  const {\n    evaluationPendingDataByRunUuid,\n    evaluationArtifactsBeingUploaded,\n    evaluationDraftInputValues,\n  } = useSelector(({ evaluationData }: ReduxState) => evaluationData);\n\n  const [isSyncingArtifacts, setSyncingArtifacts] = useState(false);\n\n  const dispatch = useDispatch<ThunkDispatch>();\n\n  const discard = useCallback(() => {\n    dispatch(discardPendingEvaluationData());\n  }, [dispatch]);\n\n  const unsyncedDataEntriesCount = Object.values(evaluationPendingDataByRunUuid).flat().length;\n  const draftInputValuesCount = evaluationDraftInputValues.length;\n  const runsBeingSynchronizedCount = Object.values(evaluationArtifactsBeingUploaded).filter(\n    (runArtifacts) => Object.values(runArtifacts).some((isSynced) => isSynced),\n  ).length;\n\n  useEffect(() => {\n    if (unsyncedDataEntriesCount === 0) {\n      setSyncingArtifacts(false);\n    }\n  }, [unsyncedDataEntriesCount]);\n\n  const synchronizeArtifactData = useCallback(() => {\n    if (unsyncedDataEntriesCount === 0 || isSyncingArtifacts) {\n      return true;\n    }\n    setSyncingArtifacts(true);\n    dispatch(writeBackEvaluationArtifactsAction()).catch((e) => {\n      Utils.logErrorAndNotifyUser(e);\n    });\n    return true;\n  }, [dispatch, unsyncedDataEntriesCount, isSyncingArtifacts]);\n\n  const { isMacKeyboard } = useBrowserKeyShortcutListener(\n    's',\n    { ctrlOrCmdKey: true },\n    synchronizeArtifactData,\n  );\n\n  const { theme } = useDesignSystemTheme();\n\n  // Following flag is true when there are draft input values (draft rows), but\n  // no evaluated values yet\n  const pendingUnevaluatedDraftInputValues =\n    draftInputValuesCount > 0 && unsyncedDataEntriesCount === 0;\n\n  // Display write-back UI only if there are draft rows or unsynced evaluation values\n  const shouldStatusElementBeDisplayed =\n    unsyncedDataEntriesCount > 0 || pendingUnevaluatedDraftInputValues;\n\n  const EvaluationSyncStatusElement = shouldStatusElementBeDisplayed ? (\n    <div\n      css={{\n        backgroundColor: theme.colors.backgroundPrimary,\n        border: `1px solid ${theme.colors.border}`,\n        padding: theme.spacing.md,\n        marginBottom: theme.spacing.sm,\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n      }}\n    >\n      {pendingUnevaluatedDraftInputValues ? (\n        <FormattedMessage\n          defaultMessage={\n            'You have added rows with new input values, but you still need to evaluate the new data in order to save it.'\n          }\n          description='Experiment page > artifact compare view > prompt lab artifact synchronization > unevaluated rows indicator'\n        />\n      ) : isSyncingArtifacts ? (\n        <Typography.Text>\n          <FormattedMessage\n            defaultMessage='Synchronizing artifacts for {runsBeingSynchronizedCount} runs...'\n            description='Experiment page > artifact compare view > prompt lab artifact synchronization > loading state'\n            values={{\n              runsBeingSynchronizedCount: <strong>{runsBeingSynchronizedCount}</strong>,\n            }}\n          />\n        </Typography.Text>\n      ) : (\n        <Typography.Text>\n          <FormattedMessage\n            defaultMessage={`You have <strong>{unsyncedDataEntriesCount}</strong> unsaved evaluated {unsyncedDataEntriesCount, plural, =1 {value} other {values}}. Click \"Save\" button or press {keyCombination} keys to synchronize the artifact data.`}\n            description='Experiment page > artifact compare view > prompt lab artifact synchronization > pending changes indicator'\n            values={{\n              strong: (value) => <strong>{value}</strong>,\n              unsyncedDataEntriesCount,\n              keyCombination: isMacKeyboard() ? '⌘CMD+S' : 'CTRL+S',\n            }}\n          />\n        </Typography.Text>\n      )}\n      <div css={{ display: 'flex', gap: theme.spacing.sm }}>\n        <Button disabled={isSyncingArtifacts} onClick={discard}>\n          <FormattedMessage\n            defaultMessage='Discard'\n            description='Experiment page > artifact compare view > prompt lab artifact synchronization > submit button label'\n          />\n        </Button>{' '}\n        {/* Display \"Save\" button only if there are actual evaluated data to sync (don't allow to sync empty draft rows) */}\n        {unsyncedDataEntriesCount > 0 && (\n          <Button loading={isSyncingArtifacts} type='primary' onClick={synchronizeArtifactData}>\n            <FormattedMessage\n              defaultMessage='Save'\n              description='Experiment page > artifact compare view > prompt lab artifact synchronization > cancel button label'\n            />\n          </Button>\n        )}\n      </div>\n    </div>\n  ) : null;\n\n  return { isSyncingArtifacts, EvaluationSyncStatusElement };\n};\n","import { fromPairs } from 'lodash';\nimport { useMemo } from 'react';\nimport { RunLoggedArtifactType, RunLoggedArtifactsDeclaration } from '../../../types';\nimport { MLFLOW_LOGGED_ARTIFACTS_TAG } from '../../../constants';\nimport { RunRowType } from '../../experiment-page/utils/experimentPage.row-types';\n\n/**\n * Consumes an array of experiment run entities and extracts names of\n * all table artifacts defined by their tags.\n */\nexport const useEvaluationArtifactTables = (comparedRunRows: RunRowType[]) =>\n  useMemo(() => {\n    const tablesByRun = fromPairs(\n      comparedRunRows\n        .map<[string, string[]]>((run) => {\n          const rawLoggedArtifactsDeclaration = run.tags?.[MLFLOW_LOGGED_ARTIFACTS_TAG]?.value;\n          const tablesInRun: Set<string> = new Set();\n          if (rawLoggedArtifactsDeclaration) {\n            try {\n              const loggedArtifacts: RunLoggedArtifactsDeclaration = JSON.parse(\n                rawLoggedArtifactsDeclaration,\n              );\n\n              loggedArtifacts\n                .filter(({ type }) => type === RunLoggedArtifactType.TABLE)\n                .forEach(({ path }) => {\n                  tablesInRun.add(path);\n                });\n            } catch (error) {\n              if (error instanceof SyntaxError) {\n                throw new SyntaxError(\n                  `The \"${MLFLOW_LOGGED_ARTIFACTS_TAG}\" tag in \"${run.runName}\" run is malformed!`,\n                );\n              }\n              throw error;\n            }\n          }\n          return [run.runUuid, Array.from(tablesInRun)];\n        })\n        // Filter entries with no tables reported\n        .filter(([, tables]) => tables.length > 0),\n    );\n\n    const allUniqueTables = Array.from(new Set(Object.values(tablesByRun).flat()));\n\n    const tablesIntersection = allUniqueTables.filter((tableName) =>\n      comparedRunRows.every(({ runUuid }) => tablesByRun[runUuid]?.includes(tableName)),\n    );\n\n    return {\n      tables: allUniqueTables,\n      tablesByRun,\n      tablesIntersection,\n    };\n  }, [comparedRunRows]);\n","import { useMemo } from 'react';\nimport type { EvaluationDataReduxState } from '../../../reducers/EvaluationDataReducer';\n\ntype ArtifactsByRun = EvaluationDataReduxState['evaluationArtifactsByRunUuid'];\n\n/**\n * Consumes artifacts data (extracted from the redux store) and based on the\n * provided list of tables and run UUIDs, returns:\n * - list of all columns found in the tables data\n * - list of columns that are present in every matching table\n */\nexport const useEvaluationArtifactColumns = (\n  artifactsByRun: ArtifactsByRun,\n  comparedRunUuids: string[],\n  tableNames: string[],\n) =>\n  useMemo(() => {\n    // Do not proceed if there are no tables or runs selected\n    if (tableNames.length === 0 || comparedRunUuids.length === 0) {\n      return { columns: [], columnsIntersection: [] };\n    }\n\n    // Extract all matching table objects from the store data\n    const allTableEntries = comparedRunUuids\n      .map((runUuid) =>\n        Object.values(artifactsByRun[runUuid] || {}).filter(({ path }) =>\n          tableNames.includes(path),\n        ),\n      )\n      .flat();\n\n    // Extract all valid column names\n    const allColumnsForAllTables = allTableEntries\n      .filter(({ path }) => tableNames.includes(path))\n      .map(({ columns }) => columns)\n      .flat();\n\n    // Remove duplicates\n    const columns = Array.from(new Set(allColumnsForAllTables));\n\n    // Find the intersection\n    const columnsIntersection = columns.filter((column) =>\n      allTableEntries.every(({ columns: tableColumns }) => tableColumns.includes(column)),\n    );\n\n    return {\n      columns,\n      columnsIntersection,\n    };\n  }, [comparedRunUuids, artifactsByRun, tableNames]);\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { LegacySkeleton, useLegacyNotification } from '@databricks/design-system';\nimport {\n  DatasetSummary,\n  ExperimentEntity,\n  ExperimentStoreEntities,\n  LIFECYCLE_FILTER,\n  MODEL_VERSION_FILTER,\n  RunDatasetWithTags,\n  UpdateExperimentViewStateFn,\n} from '../../../../types';\nimport {\n  experimentRunsSelector,\n  ExperimentRunsSelectorParams,\n  ExperimentRunsSelectorResult,\n} from '../../utils/experimentRuns.selector';\nimport { ExperimentViewRunsControls } from './ExperimentViewRunsControls';\nimport { ExperimentViewRunsTable } from './ExperimentViewRunsTable';\n\nimport { searchModelVersionsApi } from '../../../../../model-registry/actions';\nimport { loadMoreRunsApi, searchRunsApi, searchRunsPayload } from '../../../../actions';\nimport { GetExperimentRunsContextProvider } from '../../contexts/GetExperimentRunsContext';\nimport { useFetchExperimentRuns } from '../../hooks/useFetchExperimentRuns';\nimport { SearchExperimentRunsViewState } from '../../models/SearchExperimentRunsViewState';\nimport Utils from '../../../../../common/utils/Utils';\nimport {\n  ATTRIBUTE_COLUMN_SORT_KEY,\n  MLFLOW_RUN_TYPE_TAG,\n  MLFLOW_RUN_TYPE_VALUE_EVALUATION,\n} from '../../../../constants';\nimport { RunRowType } from '../../utils/experimentPage.row-types';\nimport { prepareRunsGridData } from '../../utils/experimentPage.row-utils';\nimport { RunsCompare } from '../../../runs-compare/RunsCompare';\nimport { useFetchedRunsNotification } from '../../hooks/useFetchedRunsNotification';\nimport { DatasetWithRunType, ExperimentViewDatasetDrawer } from './ExperimentViewDatasetDrawer';\nimport { useExperimentViewLocalStore } from '../../hooks/useExperimentViewLocalStore';\nimport { useAutoExpandRunRows } from '../../hooks/useAutoExpandRunRows';\nimport { EvaluationArtifactCompareView } from '../../../evaluation-artifacts-compare/EvaluationArtifactCompareView';\nimport { shouldEnableArtifactBasedEvaluation } from '../../../../../common/utils/FeatureUtils';\nimport { CreateNewRunContextProvider } from '../../hooks/useCreateNewRun';\nimport { useChartViewByDefault } from '../../hooks/useChartViewByDefault';\n\nexport interface ExperimentViewRunsOwnProps {\n  isLoading: boolean;\n  experiments: ExperimentEntity[];\n  modelVersionFilter?: MODEL_VERSION_FILTER;\n  lifecycleFilter?: LIFECYCLE_FILTER;\n  datasetsFilter?: DatasetSummary[];\n  onMaximizedChange?: (newIsMaximized: boolean) => void;\n}\n\nexport interface ExperimentViewRunsProps extends ExperimentViewRunsOwnProps {\n  runsData: ExperimentRunsSelectorResult;\n}\n\n/**\n * Creates time with milliseconds set to zero, usable in calculating\n * relative time\n */\nconst createCurrentTime = () => {\n  const mountTime = new Date();\n  mountTime.setMilliseconds(0);\n  return mountTime;\n};\n\nexport const ExperimentViewRunsImpl = React.memo((props: ExperimentViewRunsProps) => {\n  const { experiments, runsData, onMaximizedChange } = props;\n\n  // Persistable sort/filter model state is taken from the context\n  const {\n    searchFacetsState,\n    updateSearchFacets,\n    isLoadingRuns,\n    loadMoreRuns,\n    moreRunsAvailable,\n    isPristine,\n    requestError,\n  } = useFetchExperimentRuns();\n\n  const [visibleRuns, setVisibleRuns] = useState<RunRowType[]>([]);\n\n  // Non-persistable view model state is being created locally\n  const [viewState, setViewState] = useState(new SearchExperimentRunsViewState());\n\n  const { experiment_id } = experiments[0];\n  const expandRowsStore = useExperimentViewLocalStore(experiment_id);\n  const [expandRows, updateExpandRows] = useState<boolean>(\n    expandRowsStore.getItem('expandRows') === 'true' ?? false,\n  );\n\n  useEffect(() => {\n    expandRowsStore.setItem('expandRows', expandRows);\n  }, [expandRows, expandRowsStore]);\n\n  const {\n    paramKeyList,\n    metricKeyList,\n    tagsList,\n    modelVersionsByRunUuid,\n    paramsList,\n    metricsList,\n    runInfos,\n    runUuidsMatchingFilter,\n    datasetsList,\n  } = runsData;\n\n  /**\n   * Create a list of run infos with assigned metrics, params and tags\n   */\n  const runData = useMemo(\n    () =>\n      runInfos.map((runInfo, index) => ({\n        runInfo,\n        params: paramsList[index],\n        metrics: metricsList[index],\n        tags: tagsList[index],\n        datasets: datasetsList[index],\n      })),\n    [datasetsList, metricsList, paramsList, runInfos, tagsList],\n  );\n\n  const {\n    orderByKey,\n    searchFilter,\n    runsExpanded,\n    runsPinned,\n    runsHidden,\n    compareRunsMode,\n    datasetsFilter,\n  } = searchFacetsState;\n\n  const isComparingRuns = compareRunsMode !== undefined;\n\n  // Default to chart view if metrics are available\n  useChartViewByDefault(isLoadingRuns, metricKeyList, updateSearchFacets);\n  // Automatically expand parent runs if necessary\n  useAutoExpandRunRows(runData, visibleRuns, isPristine, updateSearchFacets, runsExpanded);\n\n  const updateViewState = useCallback<UpdateExperimentViewStateFn>(\n    (newPartialViewState) =>\n      setViewState((currentViewState) => ({ ...currentViewState, ...newPartialViewState })),\n    [],\n  );\n\n  const addColumnClicked = useCallback(() => {\n    updateViewState({ columnSelectorVisible: true });\n  }, [updateViewState]);\n\n  const shouldNestChildrenAndFetchParents = useMemo(\n    () => (!orderByKey && !searchFilter) || orderByKey === ATTRIBUTE_COLUMN_SORT_KEY.DATE,\n    [orderByKey, searchFilter],\n  );\n\n  // Value used a reference for the \"date\" column\n  const [referenceTime, setReferenceTime] = useState(createCurrentTime);\n\n  // We're setting new reference date only when new runs data package has arrived\n  useEffect(() => {\n    setReferenceTime(createCurrentTime);\n  }, [runInfos]);\n\n  const filteredTagKeys = useMemo(() => Utils.getVisibleTagKeyList(tagsList), [tagsList]);\n\n  const [isDrawerOpen, setIsDrawerOpen] = useState<boolean>(false);\n  const [selectedDatasetWithRun, setSelectedDatasetWithRun] = useState<DatasetWithRunType>();\n\n  useEffect(() => {\n    if (isLoadingRuns) {\n      return;\n    }\n    const runs = prepareRunsGridData({\n      experiments,\n      paramKeyList,\n      metricKeyList,\n      modelVersionsByRunUuid,\n      runsExpanded,\n      tagKeyList: filteredTagKeys,\n      nestChildren: shouldNestChildrenAndFetchParents,\n      referenceTime,\n      runData,\n      runUuidsMatchingFilter,\n      runsPinned,\n      runsHidden,\n    });\n\n    setVisibleRuns(runs);\n  }, [\n    runData,\n    isLoadingRuns,\n    experiments,\n    metricKeyList,\n    modelVersionsByRunUuid,\n    paramKeyList,\n    runsExpanded,\n    filteredTagKeys,\n    shouldNestChildrenAndFetchParents,\n    referenceTime,\n    runsPinned,\n    runsHidden,\n    runUuidsMatchingFilter,\n    requestError,\n  ]);\n\n  const [notificationsFn, notificationContainer] = useLegacyNotification();\n  const showFetchedRunsNotifications = useFetchedRunsNotification(notificationsFn);\n\n  const loadMoreRunsCallback = useCallback(() => {\n    if (moreRunsAvailable && !isLoadingRuns) {\n      // Don't do this if we're loading runs\n      // to prevent too many requests from being\n      // sent out\n      loadMoreRuns().then((runs) => {\n        // Display notification about freshly loaded runs\n        showFetchedRunsNotifications(runs, runInfos);\n      });\n    }\n  }, [moreRunsAvailable, isLoadingRuns, loadMoreRuns, runInfos, showFetchedRunsNotifications]);\n\n  useEffect(() => {\n    onMaximizedChange?.(viewState.viewMaximized);\n  }, [viewState.viewMaximized, onMaximizedChange]);\n\n  const datasetSelected = useCallback((dataset: RunDatasetWithTags, run: RunRowType) => {\n    setSelectedDatasetWithRun({ datasetWithTags: dataset, runData: run });\n    setIsDrawerOpen(true);\n  }, []);\n\n  return (\n    <CreateNewRunContextProvider visibleRuns={visibleRuns}>\n      <ExperimentViewRunsControls\n        viewState={viewState}\n        updateViewState={updateViewState}\n        runsData={runsData}\n        searchFacetsState={searchFacetsState}\n        updateSearchFacets={updateSearchFacets}\n        experimentId={experiment_id}\n        requestError={requestError}\n        expandRows={expandRows}\n        updateExpandRows={updateExpandRows}\n      />\n      <div css={styles.createRunsTableWrapper(isComparingRuns)}>\n        <ExperimentViewRunsTable\n          experiments={experiments}\n          runsData={runsData}\n          searchFacetsState={searchFacetsState}\n          viewState={viewState}\n          isLoading={isLoadingRuns}\n          updateSearchFacets={updateSearchFacets}\n          updateViewState={updateViewState}\n          onAddColumnClicked={addColumnClicked}\n          rowsData={visibleRuns}\n          loadMoreRunsFunc={loadMoreRunsCallback}\n          moreRunsAvailable={moreRunsAvailable}\n          onDatasetSelected={datasetSelected}\n          expandRows={expandRows}\n        />\n        {compareRunsMode === 'CHART' && (\n          <RunsCompare\n            isLoading={isLoadingRuns}\n            comparedRuns={visibleRuns}\n            metricKeyList={runsData.metricKeyList}\n            paramKeyList={runsData.paramKeyList}\n            experimentTags={runsData.experimentTags}\n            searchFacetsState={searchFacetsState}\n            updateSearchFacets={updateSearchFacets}\n          />\n        )}\n        {compareRunsMode === 'ARTIFACT' && shouldEnableArtifactBasedEvaluation() && (\n          <EvaluationArtifactCompareView\n            comparedRuns={visibleRuns}\n            viewState={viewState}\n            updateViewState={updateViewState}\n            updateSearchFacets={updateSearchFacets}\n            onDatasetSelected={datasetSelected}\n          />\n        )}\n        {notificationContainer}\n        {selectedDatasetWithRun && (\n          <ExperimentViewDatasetDrawer\n            isOpen={isDrawerOpen}\n            setIsOpen={setIsDrawerOpen}\n            selectedDatasetWithRun={selectedDatasetWithRun}\n            setSelectedDatasetWithRun={setSelectedDatasetWithRun}\n          />\n        )}\n      </div>\n    </CreateNewRunContextProvider>\n  );\n});\n\nconst styles = {\n  createRunsTableWrapper: (isComparingRuns: boolean) => ({\n    minHeight: 225, // This is the exact height for displaying a minimum five rows and table header\n    height: '100%',\n    display: 'grid',\n    position: 'relative' as const,\n    // When comparing runs, we fix the table width to 310px.\n    // We can consider making it resizable by a user.\n    gridTemplateColumns: isComparingRuns ? '310px 1fr' : '1fr',\n  }),\n  loadingFooter: () => ({\n    justifyContent: 'center',\n    alignItems: 'center',\n    display: 'flex',\n    height: '72px',\n  }),\n};\n\n/**\n * Concrete actions for GetExperimentRuns context provider\n */\nconst getExperimentRunsActions = {\n  searchRunsApi,\n  loadMoreRunsApi,\n  searchRunsPayload,\n  searchModelVersionsApi,\n};\n\n/**\n * Function mapping redux state used in connect()\n */\nconst mapStateToProps = (\n  state: { entities: ExperimentStoreEntities },\n  params: ExperimentRunsSelectorParams,\n) => {\n  return { runsData: experimentRunsSelector(state, params) };\n};\n\n/**\n * Component responsible for displaying runs table with its set of\n * respective sort and filter controls on the experiment page.\n */\nexport const ExperimentViewRunsConnect: React.ComponentType<ExperimentViewRunsOwnProps> = connect(\n  // mapStateToProps function:\n  mapStateToProps,\n  // mapDispatchToProps function (not provided):\n  undefined,\n  // mergeProps function (not provided):\n  undefined,\n  {\n    // We're interested only in certain entities sub-tree so we won't\n    // re-render on other state changes (e.g. API request IDs or metric history)\n    areStatesEqual: (nextState, prevState) =>\n      nextState.entities.experimentTagsByExperimentId ===\n        prevState.entities.experimentTagsByExperimentId &&\n      nextState.entities.latestMetricsByRunUuid === prevState.entities.latestMetricsByRunUuid &&\n      nextState.entities.modelVersionsByRunUuid === prevState.entities.modelVersionsByRunUuid &&\n      nextState.entities.paramsByRunUuid === prevState.entities.paramsByRunUuid &&\n      nextState.entities.runInfosByUuid === prevState.entities.runInfosByUuid &&\n      nextState.entities.runUuidsMatchingFilter === prevState.entities.runUuidsMatchingFilter &&\n      nextState.entities.tagsByRunUuid === prevState.entities.tagsByRunUuid,\n  },\n)(ExperimentViewRunsImpl);\n\n/**\n * This component serves as a layer for injecting props necessary for connect() to work\n */\nexport const ExperimentViewRunsInjectFilters = (props: ExperimentViewRunsOwnProps) => {\n  const { searchFacetsState } = useFetchExperimentRuns();\n  if (props.isLoading) {\n    return <LegacySkeleton active />;\n  }\n  return (\n    <ExperimentViewRunsConnect\n      {...props}\n      modelVersionFilter={searchFacetsState.modelVersionFilter as MODEL_VERSION_FILTER}\n      lifecycleFilter={searchFacetsState.lifecycleFilter as LIFECYCLE_FILTER}\n      datasetsFilter={searchFacetsState.datasetsFilter as DatasetSummary[]}\n    />\n  );\n};\n\n/**\n * This component serves as a layer for creating context for searching runs\n * and provides implementations of necessary redux actions.\n */\nexport const ExperimentViewRunsInjectContext = (props: ExperimentViewRunsOwnProps) => (\n  <GetExperimentRunsContextProvider actions={getExperimentRunsActions}>\n    <ExperimentViewRunsInjectFilters {...props} />\n  </GetExperimentRunsContextProvider>\n);\n\n/**\n * Export context injection layer as a main entry point\n */\nexport const ExperimentViewRuns = React.memo(ExperimentViewRunsInjectContext);\n","import { useEffect, useRef } from 'react';\nimport { UpdateExperimentSearchFacetsFn } from '../../../types';\n\nexport const useChartViewByDefault = (\n  isLoadingRuns: boolean,\n  metricKeyList: string[],\n  updateSearchFacets: UpdateExperimentSearchFacetsFn,\n) => {\n  const hasAutomaticallyChangedModeAlready = useRef(false);\n  // Default to chart view if there are any metrics in the runsData.\n  useEffect(() => {\n    // - Let's wait until the runs are finished loading.\n    // - If the mode was automatically changed already, do nothing.\n    if (isLoadingRuns || hasAutomaticallyChangedModeAlready.current) {\n      return;\n    }\n    if (metricKeyList.length > 0) {\n      updateSearchFacets({ compareRunsMode: 'CHART' });\n      hasAutomaticallyChangedModeAlready.current = true;\n    }\n  }, [isLoadingRuns, metricKeyList.length, updateSearchFacets]);\n};\n","import { LegacySkeleton } from '@databricks/design-system';\n\nimport { useEffect, useState } from 'react';\nimport { ErrorCodes } from '../../../common/constants';\nimport NotFoundPage from '../NotFoundPage';\nimport { PermissionDeniedView } from '../PermissionDeniedView';\nimport { ExperimentViewDescriptions } from './components/ExperimentViewDescriptions';\nimport { ExperimentViewNotes } from './components/ExperimentViewNotes';\nimport { ExperimentViewHeader } from './components/header/ExperimentViewHeader';\nimport { ExperimentViewHeaderCompare } from './components/header/ExperimentViewHeaderCompare';\nimport { ExperimentViewRuns } from './components/runs/ExperimentViewRuns';\nimport { useExperimentIds } from './hooks/useExperimentIds';\nimport { useExperiments } from './hooks/useExperiments';\nimport { useFetchExperiments } from './hooks/useFetchExperiments';\nimport { useElementHeight } from '../../../common/utils/useElementHeight';\nimport { useAsyncDispatch } from './hooks/useAsyncDispatch';\nimport { searchDatasetsApi } from '../../actions';\nimport Utils from '../../../common/utils/Utils';\n\nexport const ExperimentView = () => {\n  const dispatch = useAsyncDispatch();\n\n  const experimentIds = useExperimentIds();\n  const experiments = useExperiments(experimentIds);\n\n  const [firstExperiment] = experiments;\n\n  const { fetchExperiments, isLoadingExperiment, requestError } = useFetchExperiments();\n\n  const { elementHeight: hideableElementHeight, observeHeight } = useElementHeight();\n\n  const [isMaximized, setIsMaximized] = useState(false);\n\n  useEffect(() => {\n    fetchExperiments(experimentIds);\n  }, [fetchExperiments, experimentIds]);\n\n  useEffect(() => {\n    const requestAction = searchDatasetsApi(experimentIds);\n    dispatch(requestAction).catch((e) => {\n      Utils.logErrorAndNotifyUser(e);\n    });\n  }, [dispatch, experimentIds]);\n\n  const isComparingExperiments = experimentIds.length > 1;\n\n  if (requestError && requestError.getErrorCode() === ErrorCodes.PERMISSION_DENIED) {\n    return <PermissionDeniedView errorMessage={requestError.getMessageField()} />;\n  }\n\n  if (requestError && requestError.getErrorCode() === ErrorCodes.RESOURCE_DOES_NOT_EXIST) {\n    return <NotFoundPage />;\n  }\n\n  const isLoading = isLoadingExperiment || !experiments[0];\n\n  return (\n    <div css={styles.experimentViewWrapper}>\n      {isLoading ? (\n        <LegacySkeleton title paragraph={false} active />\n      ) : (\n        <>\n          {isComparingExperiments ? (\n            <ExperimentViewHeaderCompare experiments={experiments} />\n          ) : (\n            <>\n              <ExperimentViewHeader experiment={firstExperiment} />\n              <div\n                style={{\n                  maxHeight: isMaximized ? 0 : hideableElementHeight,\n                }}\n                css={{ overflowY: 'hidden', flexShrink: 0, transition: 'max-height .12s' }}\n              >\n                <div ref={observeHeight}>\n                  <ExperimentViewDescriptions experiment={firstExperiment} />\n                  <ExperimentViewNotes experiment={firstExperiment} />\n                </div>\n              </div>\n            </>\n          )}\n        </>\n      )}\n\n      <ExperimentViewRuns\n        experiments={experiments}\n        isLoading={isLoading}\n        // We don't keep the view state on this level to maximize <ExperimentViewRuns>'s performance\n        onMaximizedChange={setIsMaximized}\n      />\n    </div>\n  );\n};\n\nconst styles = {\n  experimentViewWrapper: { height: '100%', display: 'flex', flexDirection: 'column' as const },\n};\n\nexport default ExperimentView;\n","import { isEqual } from 'lodash';\nimport { useSelector } from 'react-redux';\nimport type { ExperimentEntity, ExperimentStoreEntities } from '../../../types';\n\nexport type UseExperimentsResult = ExperimentEntity[];\n\n/**\n * Hook that returns data and functions necessary for rendering\n * experiment(s) details - name, title, tags etc.\n */\nexport const useExperiments = (ids: (number | string)[]): UseExperimentsResult =>\n  useSelector(\n    (state: { entities: ExperimentStoreEntities }) =>\n      ids.map((id) => state.entities.experimentsById[id]).filter(Boolean),\n    (oldExperiments, newExperiments) => isEqual(oldExperiments, newExperiments),\n  );\n","import { useEffect, useState } from 'react';\n\n/**\n * Hook that returns dynamically updated changing element height. Usage example:\n * ```ts\n * const { elementHeight, observeHeight } = useElementHeight();\n * // ...\n * return <div ref={observeHeight}>Element height: {elementHeight}px</div>\n * ```\n */\nexport const useElementHeight = () => {\n  const [hideableElementsContainer, setHideableElementsContainer] = useState<HTMLElement | null>(\n    null,\n  );\n\n  const [elementHeight, setElementHeight] = useState<number | undefined>(undefined);\n\n  useEffect(() => {\n    if (!hideableElementsContainer || !window.ResizeObserver) {\n      return undefined;\n    }\n    const resizeObserver = new ResizeObserver(([entry]) => {\n      if (entry.target.scrollHeight) {\n        setElementHeight(entry.target.scrollHeight);\n      }\n    });\n    resizeObserver.observe(hideableElementsContainer);\n    return () => resizeObserver.disconnect();\n  }, [hideableElementsContainer]);\n\n  return { elementHeight, observeHeight: setHideableElementsContainer };\n};\n","import { useEffect } from 'react';\nimport { useIntl } from 'react-intl';\n// prettier-ignore\nimport {\n  getExperimentApi,\n  setCompareExperiments,\n  setExperimentTagApi,\n} from '../../actions';\nimport Utils from '../../../common/utils/Utils';\nimport { GetExperimentsContextProvider } from './contexts/GetExperimentsContext';\nimport { ExperimentView } from './ExperimentView';\n\n/**\n * Concrete actions for GetExperiments context\n */\nconst getExperimentActions = {\n  setExperimentTagApi,\n  getExperimentApi,\n  setCompareExperiments,\n};\n\n/**\n * Main entry point for the experiment page. This component\n * provides underlying structure with context containing\n * concrete versions of store actions.\n */\nexport const ExperimentPage = () => {\n  const { formatMessage } = useIntl();\n\n  useEffect(() => {\n    const pageTitle = formatMessage({\n      defaultMessage: 'Experiment Runs - Databricks',\n      description: 'Title on a page used to manage MLflow experiments runs',\n    });\n    Utils.updatePageTitle(pageTitle);\n  });\n\n  return (\n    <GetExperimentsContextProvider actions={getExperimentActions}>\n      <ExperimentView />\n    </GetExperimentsContextProvider>\n  );\n};\n\nexport default ExperimentPage;\n","import { throttle } from 'lodash';\nimport { Layout, Margin } from 'plotly.js';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { PlotParams } from 'react-plotly.js';\nimport {\n  KeyValueEntity,\n  MetricEntitiesByName,\n  MetricHistoryByName,\n  RunInfoEntity,\n} from '../../../types';\n\n/**\n * Common props for all charts used in compare runs\n */\nexport interface CompareRunsCommonPlotProps {\n  /**\n   * A scatter layer marker size\n   */\n  markerSize?: number;\n\n  /**\n   * Additional class name passed to the chart wrapper\n   */\n  className?: string;\n\n  /**\n   * Plotly.js-compatible margin object\n   */\n  margin?: Partial<Margin>;\n\n  /**\n   * Callback fired when a run is hovered\n   */\n  onHover?: (runUuid: string, event?: MouseEvent, additionalAxisData?: any) => void;\n\n  /**\n   * Callback fired when no run is hovered anymore\n   */\n  onUnhover?: () => void;\n\n  /**\n   * Callback fired when the either plot's data or its layout has changed\n   */\n  onUpdate?: PlotParams['onUpdate'];\n\n  /**\n   * Width in pixels. If not provided, chart uses auto-sizing.\n   */\n  width?: number;\n\n  /**\n   * Height in pixels. If not provided, chart uses auto-sizing.\n   */\n  height?: number;\n\n  /**\n   * If true, renders default plotly.js powered hover box with run data\n   */\n  useDefaultHoverBox?: boolean;\n\n  /**\n   * Indicates which run is currently selected in the global context and should be highlighted\n   */\n  selectedRunUuid?: string | null;\n}\n\n/**\n * Defines single axis used in compare run charts\n */\nexport interface CompareRunsChartAxisDef {\n  key: string;\n  type: 'METRIC' | 'PARAM';\n}\n\nexport interface CompareChartRunData {\n  /**\n   * Run's RunInfo object containing the metadata\n   */\n  runInfo: RunInfoEntity;\n  /**\n   * Object containing latest run's metrics by key\n   */\n  metrics: MetricEntitiesByName;\n  /**\n   * Dictionary with the metrics by name. This field is optional\n   * as it's used only by certain chart types.\n   */\n  metricsHistory?: MetricHistoryByName;\n  /**\n   * Object containing run's params by key\n   */\n  params: Record<string, KeyValueEntity>;\n  /**\n   * Color corresponding to the run\n   */\n  color?: string;\n  /**\n   * Set to \"true\" if the run is pinned\n   */\n  pinned?: boolean;\n  /**\n   * Set to \"true\" if the run is pinnable (e.g. not a child run)\n   */\n  pinnable?: boolean;\n}\n\n/**\n * By default, Plotly.js is capable of autosizing only on resizing window with\n * no option to observe other constraints (e.g. container resize). This hooks\n * attaches a resize observer to the chart wrapper and dynamically returns its dimensions\n * so it can be passed to the chart's layout in order to correctly maintain responsive size.\n */\nexport const useDynamicPlotSize = (throttleMs = 100) => {\n  const [layoutWidth, setLayoutWidth] = useState<undefined | number>(undefined);\n  const [layoutHeight, setLayoutHeight] = useState<undefined | number>(undefined);\n\n  const isDynamicSizeSupported = Boolean(window.ResizeObserver);\n\n  const setDimensions = useCallback((width: number, height: number) => {\n    setLayoutWidth(width);\n    setLayoutHeight(height);\n  }, []);\n\n  const setDimensionsThrottled = useMemo(\n    () =>\n      throttle(setDimensions, throttleMs, {\n        leading: true,\n      }),\n    [setDimensions, throttleMs],\n  );\n\n  const [containerDiv, setContainerDiv] = useState<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    let unmounted = false;\n    if (!containerDiv || !window.ResizeObserver) {\n      return undefined;\n    }\n    const observer = new ResizeObserver(([observerEntry]) => {\n      if (unmounted) {\n        return;\n      }\n\n      setDimensionsThrottled(\n        Math.round(observerEntry.contentRect.width),\n        Math.round(observerEntry.contentRect.height),\n      );\n    });\n\n    observer.observe(containerDiv);\n    return () => {\n      unmounted = true;\n      observer.disconnect();\n    };\n  }, [containerDiv, setDimensionsThrottled]);\n\n  return { containerDiv, setContainerDiv, layoutWidth, layoutHeight, isDynamicSizeSupported };\n};\n\nexport type UseMemoizedChartLayoutParams<T = any> = Pick<CompareRunsCommonPlotProps, 'margin'> & {\n  resetViewOn: T[];\n  xAxisKey: string;\n  yAxisKey: string;\n  layoutWidth?: number;\n  layoutHeight?: number;\n  additionalXAxisParams?: Partial<Layout['xaxis']>;\n  additionalYAxisParams?: Partial<Layout['yaxis']>;\n};\n\n/**\n * Styles used in all compare run charts\n */\nexport const commonRunsChartStyles = {\n  // Styles used for highlighting traces in both scatter and contour chart types\n  scatterChartHighlightStyles: {\n    '.trace.scatter path.point': {\n      transition: 'var(--trace-transition)',\n    },\n    '.trace.scatter.is-highlight path.point': {\n      opacity: 'var(--trace-opacity-dimmed-low) !important',\n    },\n    '.trace.scatter path.point.is-hover-highlight': {\n      opacity: 'var(--trace-opacity-highlighted) !important',\n    },\n    '.trace.scatter path.point.is-selection-highlight': {\n      opacity: 'var(--trace-opacity-highlighted) !important',\n      stroke: 'var(--trace-stroke-color)',\n      strokeWidth: 'var(--trace-stroke-width) !important',\n    },\n  },\n  chartWrapper: () => ({\n    width: '100%',\n    height: '100%',\n    overflow: 'hidden',\n    position: 'relative' as const,\n    fontSize: 0,\n    lineHeight: 0,\n    '.js-plotly-plot .plotly .cursor-ew-resize, .js-plotly-plot .plotly .cursor-crosshair': {\n      cursor: 'pointer',\n    },\n    // Add a little stroke to the Y axis text so if despite the margin\n    // tick texts would overlay the axis label, it would still look decent\n    '.js-plotly-plot g.infolayer > g.g-ytitle > text': {\n      stroke: 'white',\n      strokeWidth: 16,\n      paintOrder: 'stroke',\n    },\n    // Variable used by chart trace highlighting\n    '--trace-transition': 'opacity .16s',\n    '--trace-opacity-highlighted': '1',\n    '--trace-opacity-dimmed-low': '0.45',\n    '--trace-opacity-dimmed-high': '0.55',\n    '--trace-stroke-color': 'black',\n    '--trace-stroke-width': '1',\n  }),\n  chart: { width: '100%', height: '100%' },\n};\n\n/**\n * Default margin for all compare run charts but contour\n */\nexport const compareRunsChartDefaultMargin: Partial<Margin> = {\n  t: 0,\n  b: 48,\n  r: 0,\n  l: 48,\n  pad: 0,\n};\n\n/**\n * Default margin for contour compare run charts\n */\nexport const compareRunsChartDefaultContourMargin: Partial<Margin> = {\n  t: 0,\n  b: 48,\n  r: 0,\n  l: 80,\n  pad: 0,\n};\n\n/**\n * Default hover label style for all compare run charts\n */\nexport const compareRunsChartHoverlabel = {\n  bgcolor: 'white',\n  bordercolor: '#ccc',\n  font: {\n    color: 'black',\n  },\n};\n\n/**\n * Function that makes sure that extreme values e.g. infinities masked as 1.79E+308\n * are normalized to be displayed properly in charts.\n */\nexport const normalizeChartValue = (value?: number | string) => {\n  const parsedValue = typeof value === 'string' ? parseFloat(value) : value;\n\n  // Return all falsy values as-is\n  if (!parsedValue) {\n    return parsedValue;\n  }\n  if (!Number.isFinite(parsedValue) || Number.isNaN(parsedValue)) {\n    return undefined;\n  }\n  if (Math.abs(parsedValue) === Number.MAX_VALUE) {\n    return Number.POSITIVE_INFINITY * Math.sign(parsedValue);\n  }\n\n  return value;\n};\n\nexport const truncateString = (fullStr: string, strLen: number) => {\n  if (fullStr.length <= strLen) return fullStr;\n\n  const separator = '...';\n\n  const sepLen = separator.length,\n    charsToShow = strLen - sepLen,\n    frontChars = Math.ceil(charsToShow / 2),\n    backChars = Math.floor(charsToShow / 2);\n\n  return fullStr.substr(0, frontChars) + separator + fullStr.substr(fullStr.length - backChars);\n};\n","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _python = _interopRequireDefault(require(\"refractor/lang/python.js\"));\n\n;\nvar _default = _python.default;\nexports.default = _default;"],"names":["useAsyncDispatch","useDispatch","GetExperimentsContext","createContext","GetExperimentsContextProvider","_ref","children","actions","fetchExperimentsRequestIds","setFetchExperimentsRequestIds","useState","isLoadingExperiment","setIsLoadingExperiment","requestError","setRequestError","dispatch","fetchExperiments","useCallback","experimentIds","fetchFn","newRequestIds","map","experimentId","requestAction","getExperimentApi","catch","e","Utils","logErrorAndNotifyUser","meta","id","requestIds","isEqual","contextValue","useMemo","_jsx","Provider","value","RequestStateWrapper","shouldOptimisticallyRender","renderFn","_isLoading","_renderError","requests","some","r","includes","active","forEach","request","error","PermissionDeniedView","errorMessage","theme","useDesignSystemTheme","_jsxs","className","style","height","marginTop","src","permissionDeniedLock","alt","paddingTop","css","_css","color","colors","textSecondary","ExperimentViewArtifactLocation","artifactLocation","_Fragment","ExperimentViewDescriptions","React","experiment","styles","container","Typography","Text","FormattedMessage","defaultMessage","experiment_id","artifact_location","display","gap","spacing","lg","useFetchExperiments","getExperimentsContext","useContext","Error","ExperimentViewNotes","storedNote","useSelector","state","tags","getExperimentTags","_Object$values$find","Object","values","find","t","getKey","NOTE_CONTENT_TAG","undefined","extractNoteFromTags","showNotesEditor","setShowNotesEditor","setExperimentTagApi","handleSubmitEditNote","updatedNote","action","then","CollapsibleSection","title","collapsibleSectionHeader","Button","type","onClick","forceOpen","defaultCollapsed","EditableNote","defaultMarkdown","onSubmit","onCancel","showEditor","lineHeight","ExperimentViewCopyTitle","intl","useIntl","size","dangerouslySetAntdProps","copyable","text","name","icon","CopyIcon","tooltips","formatMessage","_ref2","CopyButton","copyText","showLabel","showTooltip","setShowTooltip","Tooltip","visible","handleClick","navigator","clipboard","writeText","setTimeout","onMouseLeave","handleMouseLeave","CopyBox","Input","readOnly","GetLinkModal","link","Modal","ExperimentViewHeaderShareButton","showGetLinkModal","setShowGetLinkModal","window","location","href","_ref3","ExperimentViewHeader","normalizedExperimentName","split","pop","feedbackFormUrl","useExperimentPageFeedbackUrl","PageHeader","headerWrapper","target","rel","NewWindowIcon","breadcrumbs","sendFeedbackPopoverContent","maxWidth","flexDirection","alignItems","sm","ExperimentViewHeaderCompare","experiments","pageTitle","numExperiments","length","experimentRunsSelector","params","comparingExperiments","runUuids","entities","runInfosByUuid","filter","_ref7","_ref8","run_uuid","modelVersionsByRunUuid","runUuidsMatchingFilter","runInfos","extractRunInfos","lifecycleFilter","LIFECYCLE_FILTER","ACTIVE","modelVersionFilter","MODEL_VERSION_FILTER","ALL_RUNS","datasetsFilter","run_id","getRunInfo","getRunDatasets","rInfo","_","lifecycle_stage","WITH_MODEL_VERSIONS","WTIHOUT_MODEL_VERSIONS","console","warn","_ref4","datasets","datasetWithTags","datasetName","dataset","datasetDigest","digest","datasetTag","tag","key","_ref5","context","_ref6","metricKeysSet","Set","paramKeysSet","datasetsList","runInfo","runDatasetsByUuid","metricsList","metricsByRunUuid","getLatestMetrics","metrics","metric","add","paramsList","paramValues","getParams","param","tagsList","getRunTags","firstExperimentId","experimentTags","metricKeyList","Array","from","sort","paramKeyList","ColumnHeaderCell","handleSortBy","canonicalSortKey","orderByAsc","orderByKey","this","props","newOrderByAsc","onSortBy","render","enableSorting","displayName","getClassName","role","headerLabelWrapper","SortAscendingIcon","SortDescendingIcon","sortable","width","justifyContent","padding","svg","actionTertiaryTextHover","headerSortIcon","marginRight","ErrorIcon","XCircleIcon","textValidationDanger","FinishedIcon","CheckCircleIcon","textValidationSuccess","getRunStatusIcon","status","ClockIcon","DateCellRenderer","startTime","referenceTime","runStatus","cellWrapper","formatTimestamp","timeSinceStr","ExperimentNameCellRenderer","data","Link","to","Routes","getExperimentPageRoute","basename","TrimmedText","maxSize","allowShowMore","trimmedText","substr","showMore","setShowMore","expandButton","ModelsCellRenderer","registeredModels","loggedModels","runUuid","models","mergeLoggedAndRegisteredModels","modelToRender","modelDiv","registeredModelName","registeredModelVersion","mvPageRoute","getIframeCorrectedRoute","getModelVersionPageRoute","displayFullName","registeredModelSvg","flavors","loggedModelFlavorText","loggedModelLink","getRunPageRoute","artifactPath","loggedModelSvg","imageWrapper","img","position","SourceCellRenderer","sourceType","renderSource","renderSourceTypeIcon","VersionCellRenderer","version","renderSourceVersion","MOUSE_DELAYS","mouseEnterDelay","mouseLeaveDelay","RowActionsCellRenderer","pinned","hidden","actionsContainer","placement","actionCheckbox","checked","onChange","onToggleVisibility","VisibleOffIcon","VisibleIcon","pinnable","onTogglePin","PinFillIcon","PinIcon","prevProps","nextProps","input","appearance","cursor","grey600","grey400","RowActionsHeaderCellRenderer","DropdownMenu","Root","modal","Trigger","asChild","actionButton","Content","Item","RUNS_VISIBILITY_MODE","HIDEALL","IconWrapper","SHOWALL","background","border","RunNameCellRenderer","onExpand","runName","runDateAndNestInfo","hasExpander","expanderOpen","childrenIds","level","renderingAsParent","isNaN","expanderWrapper","nestLevel","expanderButton","MinusBoxIcon","PlusSquareIcon","runLink","colorPill","backgroundColor","minWidth","typography","fontSizeBase","minHeight","overflow","textOverflow","borderRadius","flexShrink","marginBottom","LoadMoreRowRenderer","loadMoreRunsFunc","SingleDataset","onDatasetSelected","appendComma","inPopover","contextTag","MLFLOW_RUN_DATASET_CONTEXT_TAG","xs","TableIcon","Popover","Close","Tag","textTransform","_ref9","DatasetsCellRenderer","expandRows","containerElement","useRef","datasetsVisible","setDatasetsVisible","clampedDatasets","slice","useEffect","current","callback","throttle","entry","availableHeight","contentRect","elementsFit","stackedHeight","i","item","clientHeight","availableWidth","stackedWidth","clientWidth","resizeObserver","ResizeObserver","observe","disconnect","moreItemsToShow","datasetsToShow","ref","index","paddingLeft","paddingRight","align","general","heightSm","getActionsColumnWidth","compactMode","makeCanonicalSortKey","keyType","keyName","isCanonicalSortKeyOfType","canonicalKey","startsWith","extractCanonicalSortKey","substring","createParamFieldName","EXPERIMENT_FIELD_PREFIX_PARAM","createMetricFieldName","EXPERIMENT_FIELD_PREFIX_METRIC","createTagFieldName","EXPERIMENT_FIELD_PREFIX_TAG","TAGS_TO_COLUMNS_MAP","ATTRIBUTE_COLUMN_SORT_KEY","USER","COLUMN_TYPES","ATTRIBUTES","RUN_NAME","SOURCE","VERSION","getRowId","getRowIsLoadMore","rowNode","isLoadMoreRow","getAdjustableAttributeColumns","isComparingExperiments","arguments","result","ATTRIBUTE_COLUMN_LABELS","MODELS","shouldEnableExperimentDatasetTracking","push","DATASET","EXPERIMENT_NAME","useRunsColumnDefinitions","searchFacetsState","compareExperiments","tagKeyList","columnApi","isComparingRuns","selectedColumns","cumulativeColumns","cachedMetricKeys","cachedParamKeys","cachedTagKeys","paramKeys","metricKeys","tagKeys","useCumulativeColumnKeys","columnSet","commonSortOrderProps","getOrderedByClassName","getHeaderClassName","getCellClassName","colDef","headerComponentParams","columns","valueGetter","checkboxSelection","headerComponent","headerCheckboxSelection","headerName","cellClass","cellRenderer","cellRendererParams","resizable","colId","headerTooltip","field","equals","dateInfo1","dateInfo2","initialWidth","DATE","DURATION","experimentName1","experimentName2","initialHide","tags1","tags2","getSourceName","version1","version2","models1","models2","groupId","METRICS","metricKey","getQualifiedEntityName","tooltipField","def","PARAMS","paramKey","TAGS","tagKey","canonicalSortKeys","setColumnVisible","EXPERIMENTS_DEFAULT_COLUMN_SETUP","autoSizePadding","menuIcon","suppressMenu","suppressMovable","DeleteRunModalImpl","Component","constructor","super","handleSubmit","bind","deletePromises","selectedRunIds","runId","deleteRunApi","Promise","all","openErrorModal","number","ConfirmModal","isOpen","onClose","pluralize","helpText","confirmButtonText","mapDispatchToProps","connect","RestoreRunModalImpl","restorePromises","restoreRunApi","textJson","error_code","message","useExperimentIds","useParams","useLocation","normalizedLocationSearch","decodeURIComponent","search","compareExperimentIdsQueryParam","queryParams","qs","experimentIdsRaw","toString","JSON","parse","clearSearchExperimentsFacetsFilters","currentSearchFacetsState","searchFilter","SearchExperimentRunsFacetsState","isSearchFacetsFilterUsed","Boolean","DEFAULT_LIFECYCLE_FILTER","DEFAULT_MODEL_VERSION_FILTER","DEFAULT_START_TIME","DEFAULT_ORDER_BY_KEY","DEFAULT_ORDER_BY_ASC","getDefaultSelectedColumns","runsExpanded","runsPinned","runsHidden","compareRunsMode","compareRunCharts","START_TIME_COLUMN_OFFSET","ALL","LAST_HOUR","LAST_24_HOURS","LAST_7_DAYS","LAST_30_DAYS","LAST_YEAR","createSearchRunsParams","pageToken","runViewType","ViewType","ACTIVE_ONLY","DELETED_ONLY","orderBy","createOrderByExpression","startTimeExpression","createStartTimeExpression","offset","datasetsFilterExpression","join","createDatasetsFilterExpression","createFilterExpression","activeFilters","shouldFetchParents","shouldNestChildrenAndFetchParents","flattenString","isArray","persistSearchStateFieldSerializers","deserializeLocalStorage","deserializeQueryString","serializeQueryString","inputs","inputsWithoutExperimentId","btoaUtf8","stringify","parsedResult","atobUtf8","serializeLocalStorage","serializeFieldsToQueryString","resultObject","keys","_persistSearchStateFi","serializeFn","serializeFieldsToLocalStorage","_persistSearchStateFi3","KNOWN_STATE_KEYS","urlParserDecoder","str","defaultDecoder","mergeFacetsStates","base","object","assign","persistLocalStorage","idKey","localStorageInstance","LocalStorageUtils","getStoreForComponent","sortFilterModelToSave","saveComponentState","createPersistedQueryString","serializedSortFilterModelToSave","QueryString","addQueryPrefix","arrayFormat","encodeValuesOnly","restoreExperimentSearchFacetsState","locationSearch","baseState","rawLocalStorageValue","loadComponentState","model","isObject","localStorageValue","_persistSearchStateFi4","deserializeFn","deserializeFieldsFromLocalStorage","rawUrlData","ignoreQueryPrefix","comma","arrayLimit","decoder","restData","stateData","rawURLSearchData","hasOwnProperty","isKnownField","extractExperimentSearchFacetsState","transformedStateData","_persistSearchStateFi2","deserializeFieldsFromQueryString","urlState","queryString","GetExperimentRunsContext","GetExperimentRunsContextProvider","navigate","useNavigate","searchRunsRequestId","setSearchRunsRequestId","isLoadingRuns","setIsLoadingRuns","initialSearchPath","setInitialSearchPath","moreRunsAvailable","setMoreRunsAvailable","experimentIdsHash","lastSearchFacetsQueryString","setSearchFacetsState","activeRequests","nextPageToken","isPristineFlag","isPristine","internalFetchExperimentRuns","requestSearchFacetsState","requestExperimentIds","requestReferenceTime","Date","now","requestNextPageToken","loadMore","loadMoreRunsApi","searchRunsApi","fetchPromise","next_page_token","fetchModelVersionsForRuns","runsPayload","actionCreator","runsWithLogModelHistory","run","EXPERIMENT_LOG_MODEL_HISTORY_TAG","chunk","MAX_RUNS_IN_SEARCH_MODEL_VERSIONS_FILTER","runsChunk","info","runs","searchModelVersionsApi","activeRequest","loadMoreRuns","fetchExperimentRuns","persistState","replaceHistory","newQueryString","currentLocationSearch","currentParameters","persistExperimentSearchFacetsState","pathname","replace","updateSearchFacets","newFilterModel","updateOptions","forceRefresh","preservePristine","oldModel","newModel","isFunction","shouldRefetchRuns","newSearchFacetsState","refreshRuns","useFetchExperimentRuns","getExperimentRunsContextValue","ExperimentViewRunModals","showDeleteRunModal","showRestoreRunModal","showRenameRunModal","runsSelected","onCloseDeleteRunModal","onCloseRestoreRunModal","onCloseRenameRunModal","renamedRunName","entries","selected","DeleteRunModal","RestoreRunModal","RenameRunModal","onSuccess","CompareRunsButtonWrapper","ExperimentViewRunsControlsActions","viewState","runsData","setShowDeleteRunModal","setShowRestoreRunModal","setShowRenameRunModal","setRenamedRunName","renameButtonClicked","runsSelectedList","selectedRun","run_name","compareButtonClicked","getCompareRunPageRoute","onDeleteRun","onRestoreRun","selectedRunsCount","canRestoreRuns","canRenameRuns","canCompareRuns","controlBar","disabled","danger","DELETED","buttonSeparator","borderLeft","marginLeft","ToggleIconButton","pressed","onBlur","onFocus","onMouseEnter","borders","borderRadiusMd","lineHeightBase","actionDefaultBackgroundPress","actionDefaultTextPress","actionDefaultBackgroundHover","actionDefaultTextHover","UnitNumber","prefixCls","_ref$offset","top","concat","left","classNames","getOffset","start","end","unit","SingleNumber","unitNodes","offsetStyle","originCount","count","originValue","Number","Math","abs","_React$useState","_React$useState2","_slicedToArray","prevValue","setPrevValue","_React$useState3","_React$useState4","prevCount","setPrevCount","onTransitionEnd","timeout","clearTimeout","_extends","transition","unitNumberList","prevIndex","findIndex","n","singleUnit","transform","__rest","s","p","prototype","call","indexOf","getOwnPropertySymbols","propertyIsEnumerable","_a","customizePrefixCls","motionClassName","show","_a$component","component","restProps","getPrefixCls","ConfigContext","newProps","numberNodes","numberList","String","num","borderColor","boxShadow","cloneElement","oriProps","isPresetColor","PresetColorTypes","_classNames","_ref$placement","_React$useContext","direction","colorInPreset","ribbonCls","_defineProperty","colorStyle","cornerColorStyle","Badge","_classNames2","customizeScrollNumberPrefixCls","scrollNumberPrefixCls","_a$count","_a$overflowCount","overflowCount","_a$dot","dot","_a$size","_a$showZero","showZero","numberedDisplayCount","hasStatus","isZero","showAsDot","mergedCount","isHidden","countRef","livingCount","displayCountRef","displayCount","isDotRef","mergedStyle","parseInt","right","titleNode","statusTextNode","displayNode","_typeof","statusCls","statusStyle","badgeClassName","statusTextColor","CSSMotion","motionName","motionAppear","_classNames3","isDot","scrollNumberCls","scrollNumberStyle","ScrollNumber","Ribbon","ExperimentViewRefreshButtonImpl","searchRunsPayload","lastFetchTime","setLastFetchTime","newRunsCount","setNewRunsCount","interval","setInterval","searchPayloadData","maxResults","MAX_DETECT_NEW_RUNS_RESULTS","_result$runs","newRuns","POLL_INTERVAL","clearInterval","pill","SyncIcon","sup","lime","zIndex","ExperimentViewRefreshButton","areStatesEqual","nextState","prevState","useExperimentViewLocalStore","storeIdentifier","RunsSearchTooltipContent","whereBold","chunks","ExperimentSearchSyntaxDocUrl","ATTRIBUTE_OPTIONS","boldedText","wholeText","shouldBeBold","textArray","RegExp","match","TOOLTIP_COOKIE_KEY","RunsSearchAutoComplete","setText","autocompleteEnabled","setAutocompleteEnabled","focused","setFocused","lastSetBySelection","setLastSetBySelection","existingEntityNamesRef","metricNames","paramNames","tagNames","suggestionLimits","setSuggestionLimits","Metrics","Parameters","Tags","currentEntitiesRef","entityBeingEdited","setEntityBeingEdited","baseOptions","existingEntityNames","mergedEntityNames","getEntityNamesFromRunsData","newRunsData","existingNames","mergeDedup","list1","list2","getTagNames","flatMap","tagRecord","label","options","entityNames","m","previousEntities","newEntities","re","clauses","results","lastIndex","exec","clause","startIndex","getClausesAndStartIndex","clauseObj","entity","endIndex","getEntitiesAndIndices","currentEntitiesNames","previousEntitiesNames","trim","filteredOptions","getFilteredOptionsFromEntityName","group","newOptions","option","toLowerCase","limitForGroup","ellipsized","onSelect","groupName","prevSuggestionLimits","prefix","suffix","clearSearchFiltersState","showTooltipOnError","setShowTooltipOnError","currentTimeSecs","floor","storedItem","getItem","tooltipIcon","_tooltipIcon$current","setItem","click","noMatches","o","open","triggerSearch","preventDefault","searchBox","AutoComplete","dropdownMatchSelectWidth","defaultOpen","defaultActiveFirstOption","dropdownRender","menu","dropdownOverride","SearchIcon","searchBarIcon","onKeyDown","placeholder","searchInputSuffix","CloseIcon","overlayInnerStyle","trigger","InfoIcon","datasetSummariesEqual","summary1","summary2","SyntaxHighlighter","highlight","refractor","registerLanguage","language","fontFamily","fontSize","textAlign","whiteSpace","wordSpacing","wordBreak","MozTabSize","OTabSize","tabSize","WebkitHyphens","MozHyphens","msHyphens","hyphens","margin","textShadow","comment","prolog","doctype","cdata","punctuation","namespace","Opacity","operator","property","function","selector","boolean","string","url","keyword","control","directive","statement","regex","atrule","variable","deleted","textDecoration","inserted","borderBottom","italic","fontStyle","important","fontWeight","bold","Outline","OutlineOffset","borderRightColor","wordWrap","attribute","builtin","char","class","constant","hexcode","symbol","python","themesStyles","light","lightStyle","duotoneDark","duotoneDarkStyle","CodeSnippet","showLineNumbers","lineNumberStyle","customStyle","codeTagProps","pick","CreateNotebookRunModal","closeModal","classical_ml_text","llm_text","verticalSizing","onOk","footer","Title","Hint","Tabs","TabPane","tab","dictionaryAdjectives","dictionaryNouns","generateString","separator","integerScale","randomAdjIndex","random","randomNounIndex","parameterDefinitions","defineMessage","helpString","max","min","step","DEFAULT_PARAMETER_VALUES","temperature","max_tokens","usePromptEvaluationParameters","parameters","updateParameters","updateParameter","EvaluationCreatePromptParameters","parameterDef","md","FormUI","Label","htmlFor","verticalAlign","LineSmoothSlider","defaultValue","handleLineSmoothChange","Select","allowClear","mode","suffixIcon","newVariableEndSegment","newVariableNameSegment","whitespaceViolationMessage","EvaluationCreateRunPromptTemplateErrors","violations","namesWithSpaces","invalidNames","nameWithSpace","PROMPT_TEMPLATE_EXAMPLES","prompt","variables","TextArea","EvaluationCreatePromptRunModalExamples","closeExamples","updatePromptTemplate","updateInputVariableValue","ArrowLeftIcon","promptTemplate","boxSizing","actionDefaultBorderDefault","backgroundPrimary","float","tryPromptTemplate","line","Paragraph","Divider","Spacer","_ref10","EvaluationCreatePromptRunModal","runBeingDuplicated","visibleRuns","selectedModel","updateSelectedModel","newRunName","setNewRunName","isCreatingRun","setIsCreatingRun","isEvaluating","setIsEvaluating","lastEvaluationError","setLastEvaluationError","evaluationOutput","setEvaluationOutput","evaluationMetadata","setEvaluationMetadata","outputDirty","setOutputDirty","isViewExamplesModalOpen","setViewExamplesModalOpen","cancelTokenRef","searchModelGatewayRoutesApi","updateInputVariables","inputVariables","inputVariableValues","inputVariableNameViolations","clearInputVariableValues","usePromptEvaluationInputValues","updateInputVariablesDirect","extractPromptInputVariables","setInputVariableNameViolations","updateInputVariableValues","DEFAULT_PROMPTLAB_INPUT_VALUES","debounce","currentInputVariables","newInputVariables","getPromptInputVariableNameViolations","sanitizedInputVariableValues","fromPairs","handleAddVariableToTemplate","savePromptTemplateInputRef","usePromptEvaluationPromptTemplateValue","DEFAULT_PROMPTLAB_NEW_TEMPLATE_VALUE","promptTemplateRef","template","newValue","requestAnimationFrame","textAreaElement","focus","setSelectionRange","_ref$resizableTextAre","resizableTextArea","textArea","maxLength","generateRandomRunName","duplicatedPromptTemplate","routeName","duplicatedRouteName","duplicatedParameters","extractEvaluationPrerequisitesForRun","extractRequiredInputParamsForRun","duplicatedRunName","originalRunName","alreadyExistingRunNames","nameSegmentWithoutIndex","newIndex","getDuplicatedRunName","modelRoutes","modelGateway","modelGatewayRoutes","supportedModelRouteList","sortBy","modelRoute","ModelGatewayRouteType","LLM_V1_COMPLETIONS","LLM_V1_CHAT","route_type","modelRoutesLoading","modelGatewayRoutesLoading","handleEvaluate","cancelToken","inputText","compilePromptInputText","queryModelGatewayRouteApi","metadata","ModelGatewayService","parseEvaluationResponse","latency","performance","metadataWithEvaluationTime","prefixedMetadata","reduce","acc","metadata_key","metadata_value","getGatewayErrorMessage","getUserVisibleError","wrappedMessage","handleCancel","selectModelLabel","selectModelPlaceholder","promptTemplateProvided","allInputValuesProvided","every","_inputVariableValues$","runNameProvided","evaluateButtonEnabled","createRunButtonEnabled","createRunButtonTooltip","evaluateButtonTooltip","evaluateOutput","Alert","closable","TableSkeleton","lines","rows","metadataOutput","PROMPTLAB_METADATA_COLUMN_LATENCY","round","PROMPTLAB_METADATA_COLUMN_TOTAL_TOKENS","totalTokens","onHandleSubmit","modelInput","createPromptLabRunApi","modelParameters","modelRouteName","promptParameters","modelOutput","modelOutputParameters","currentState","formItem","DialogCombobox","DialogComboboxTrigger","DialogComboboxContent","loading","maxHeight","matchTriggerWidth","DialogComboboxOptionList","DialogComboboxOptionListSearch","autoFocus","DialogComboboxOptionListSelectItem","DialogComboboxHintRow","Message","required","autoSize","inputVariable","PlusIcon","PlayIcon","StopIcon","WarningIcon","inset","overlayOverlay","Spinner","CreateNewRunContext","createNewRun","CreateNewRunContextProvider","setIsOpen","setRunBeingDuplicated","runToDuplicate","useCreateNewRun","ExperimentViewRunsControlsFilters","updateViewState","onDownloadCsv","additionalControls","isCreateRunWithNotebookModalOpen","setCreateRunWithNotebookModalOpenValue","startTimeColumnLabels","getStartTimeColumnDisplayName","currentLifecycleFilterValue","currentStartTimeFilterLabel","displaySidebarToggleButton","datasetSummaries","datasetsByExperimentId","updateDatasetsFilter","summary","existingFacets","hasDatasets","groupBar","onClear","startTimeKey","shouldEnableDatasetsDropdown","datasetSummary","multiSelect","showTagAfterValueCount","DialogComboboxOptionListCheckboxItem","groupSeparator","Dropdown","overlay","Menu","DownloadIcon","OverflowIcon","isMaximized","viewMaximized","FullscreenExitIcon","FullscreenIcon","shouldEnableArtifactBasedEvaluation","previewPaneVisible","SidebarIcon","shouldEnablePromptLab","gridTemplateColumns","flexWrap","columnSwitch","lifecycleFilters","ExperimentViewRunsSortSelector","sortOptions","onSortKeyChanged","currentSortSelectValue","SORT_DELIMITER_SYMBOL","COLUMN_SORT_BY_ASC","COLUMN_SORT_BY_DESC","currentSortSelectLabel","sortOption","sortOptionLabel","extractedKeyName","handleChange","updatedValue","handleClear","order","ArrowUpIcon","ArrowDownIcon","middleTruncateStr","GROUP_KEY","GROUP_KEY_ATTRIBUTES","GROUP_KEY_PARAMS","GROUP_KEY_METRICS","GROUP_KEY_TAGS","findMatching","filterQuery","v","createHighlightedNode","beforeStr","matchStr","afterStr","ExperimentViewRunsColumnSelectorImpl","columnSelectorVisible","onChangeColumnSelectorVisible","setFilter","searchInputRef","scrollableContainerRef","buttonRef","attributeColumnNames","isComparing","unshift","getAttributeColumns","setCheckedColumns","updateFn","facets","newColumns","uniqueNewColumns","tagsKeyList","getVisibleTagKeyList","canonicalKeyNames","treeData","filteredAttributes","filteredParams","filteredMetrics","filteredTags","attributeKey","toggleGroup","isChecked","keyList","k","toggleSingleKey","_scrollableContainerR","_searchInputRef$curre","scrollTo","preventScroll","scrollIntoView","block","behavior","onCheck","node","columnType","canonicalKeysForGroup","searchInputKeyDown","treeElement","parent","querySelector","dropdownContent","dropdown","scrollableContainer","Tree","checkedKeys","defaultExpandedKeys","onVisibleChange","ColumnsIcon","ChevronDownIcon","ExperimentViewRunsColumnSelector","white","overflowY","overflowX","paddingBottom","COMPARE_RUNS_TOOLTIP_STORAGE_ITEM","ChartViewButtonTooltip","multipleRunsSelected","seenTooltipStore","isToolTipOpen","setToolTipOpen","hasSeenTooltipBefore","updateIsTooltipOpen","Arrow","ExperimentViewRunsModeSwitch","setCompareRunsMode","classNamePrefix","activeTab","dangerouslyAppendEmotionCSS","activeKey","tabKey","ExperimentViewRunsControls","updateExpandRows","filteredParamKeys","filteredMetricKeys","filteredTagKeys","downloadRunsCsv","useRunSortOptions","ColumnSortByOrder","ATTRIBUTE_COLUMN_SORT_LABEL","sortLabelKey","sortLabel","showActionButtons","sortKeyChanged","compiledOrderByKey","newOrderBy","newOrderAscending","columnToAdd","isOrderAscending","currentFacets","changeColumnSelectorVisible","toggleExpandedRows","multipleDatasetsArePresent","datasetsInRun","ToggleButton","newCompareRunsMode","MLFlowAgGridImpl","MLFlowAgGridLoader","fallback","cssTheme","ExperimentViewRunsEmptyTable","isFiltered","onClearFilters","noResultsWrapper","noResults","Empty","button","description","image","FilterIcon","LoggingRunsDocUrl","BeakerIcon","CLASS_OUT_OF_VIEWPORT","CLASS_IS_HIDDEN","CLASS_IS_MINIMIZED","AG_GRID_CLS","ExperimentViewRunsTableAddColumnCTA","gridContainerElement","isInitialized","moreAvailableRunsTableColumnCount","ctaRef","savedContainerRef","immediateMoreRunsAvailable","initialize","targetElement","rootElement","refLeftElem","refCenterElem","refHeaderElem","refBodyViewport","gridAreaWidth","leftColContainerWidth","leftColContainerHeight","centerColContainerWidth","colContainerHeight","headerHeight","_savedContainerRef$cu","_savedContainerRef$cu2","_savedContainerRef$cu3","_savedContainerRef$cu4","calculatedLeft","calculatedTop","classList","remove","loadMoreRowHeight","calculatedHeight","columnContainer","buttonContainer","PlusCircleIcon","buttonIcon","caption","grey200","borderTop","willChange","pointerEvents","strong","ExperimentViewRunsTableStatusBar","isLoading","allRunsCount","statusBar","PreviewSidebar","content","headerText","empty","borderDecorative","rowGap","ExperimentViewRunsTable","onAddColumnClicked","rowsData","gridApi","setGridApi","setColumnApi","prevSelectRunUuids","expandersVisible","row","_row$runDateAndNestIn","onSelectionChange","api","selectedUUIDs","getSelectedRows","aggregate","curr","handleRowSelected","event","selectedRunRows","isSelected","isParent","childrenIdsToSelect","forEachNode","_node$data","childRunDateInfo","childrenRunUuid","setSelected","newOrderByKey","toggleRowExpanded","parentId","currentRunsExpanded","togglePinnedRow","uuid","getRowNode","redrawRows","rowNodes","toggleRowVisibility","runUuidOrToggle","gridReadyHandler","columnDefs","showLoadingOverlay","hideOverlay","setRowData","uniqueId","allAvailableColumnsCount","hasSelectedAllColumns","displayAddColumnsCTA","useLayoutEffect","deselectAll","sizeColumnsToFit","resetRowHeights","rowHeightGetterFn","EXPERIMENT_RUNS_TABLE_ROW_HEIGHT","getDatasetsCellHeight","datasetColumnId","_data$datasets","datasetsCount","sidebarPreviewData","setSidebarPreviewData","handleCellClicked","_column$getParent","column","columnGroupId","getParent","getGroupId","header","getColId","displayPreviewSidebar","tableAreaWrapper","cx","agGridOverrides","defaultColDef","rowSelection","onGridReady","onSelectionChanged","getRowHeight","onRowSelected","suppressRowClickSelection","suppressColumnMoveAnimation","suppressScrollOnNewData","isFullWidthRow","fullWidthCellRenderer","fullWidthCellRendererParams","suppressFieldDotNotation","enableCellTextSelection","components","agColumnHeader","loadingOverlayComponent","suppressNoRowsOverlay","loadingOverlayComponentParams","showImmediately","rowBuffer","onCellClicked","gridColors","rowBackground","rowBackgroundHover","rowBackgroundSelected","rowBackgroundHoverSelected","columnSortedBy","blue100","headerBackground","grey100","headerTextColor","headerGroupTextColor","headerBorderColor","checkboxBorderColor","checkboxBorderColorChecked","checkboxBackgroundColorChecked","actionPrimaryBackgroundDefault","getGridColors","opacity","borderRight","flex","SearchExperimentRunsViewState","hiddenChildRunsSelected","artifactViewState","selectedTables","groupByCols","outputColumn","intersectingOnly","RunsCompareChartType","RunsCompareCardConfig","BAR","runsCountToCompare","static","RunsCompareBarCardConfig","SCATTER","RunsCompareScatterCardConfig","PARALLEL","RunsCompareParallelCardConfig","LINE","RunsCompareLineCardConfig","RunsCompareContourCardConfig","primaryMetricKey","primary_metric_data","resultChartSet","metricsToRender","metricsKey","_primary_metric_data$","_primary_metric_data$2","chartType","getEmptyChartCardByType","getUUID","xaxis","yaxis","lineSmoothness","scaleType","xAxisKey","CONTOUR","zaxis","selectedParams","selectedMetrics","_rect","_rect2","_rect3","_rect4","source","apply","SvgChartBar","svgRef","titleId","viewBox","fill","xmlns","d","stroke","strokeLinecap","x","y","_path2","_path3","SvgChartContour","SvgChartLine","strokeWidth","strokeLinejoin","_path4","_path5","SvgChartParallel","_ellipse","_ellipse2","_ellipse3","SvgChartScatter","cy","rx","ry","fillOpacity","RunsCompareAddChartMenu","onAddChart","addChartButton","iconWrapper","ChartBarIcon","ChartLineIcon","ChartParallelIcon","ChartScatterIcon","ChartContourIcon","iconSize","useMutableHoverCallback","mutableRef","highlightChartTracesFn","traceSelector","parentSelector","hoverIndex","selectIndex","_parent$querySelector","_parent$querySelector3","deselected","_parent$querySelector2","_parent$querySelector4","_parent$querySelector5","_parent$querySelector6","querySelectorAll","highlightBarTraces","highlightLineTraces","highlightScatterTraces","useCompareRunsTraceHighlight","containerDiv","selectedRunUuid","highlightFn","selectedTraceIndex","hoveredPointIndex","setHoveredPointIndex","PLOT_CONFIG","displaylogo","scrollZoom","doubleClick","showTips","CompareRunsMetricsBarPlot","compareRunsChartDefaultMargin","onUpdate","onHover","onUnhover","barWidth","displayRunNames","useDefaultHoverBox","displayMetricKey","plotData","ids","_d$metrics$metricKey","normalizeChartValue","textValues","_d$metrics$metricKey2","val","places","toFixed","getFixedPointValue","containsNegatives","textposition","textfont","hovertemplate","hoverinfo","hoverlabel","compareRunsChartHoverlabel","orientation","marker","layoutHeight","layoutWidth","setContainerDiv","isDynamicSizeSupported","useDynamicPlotSize","layout","setLayout","showticklabels","tickfont","fixedrange","hoverCallback","_points$0$pointIndex","_points$","_points$2","points","pointIndex","unhoverCallback","mutableHoverCallback","commonRunsChartStyles","chartWrapper","highlightStyles","LazyPlot","useResizeHandler","chart","config","CompareRunsTooltipContext","ContextMenuVisibility","extractHTMLAncestorElement","element","Element","HTMLElement","currentElement","parentElement","CompareRunsTooltipWrapper","contextData","hoverOnly","containerRef","ctxMenuRef","currentPos","contextMenuShown","setContextMenuShown","HIDDEN","tooltipDisplayParams","setTooltipDisplayParams","hoveredRunUuid","setHoveredRunUuid","additionalAxisData","setAdditionalAxisData","focusedRunData","mutableContextMenuShownRef","mutableHoveredRunUuid","mutableTooltipDisplayParams","applyPositioning","targetX","targetY","menuRect","getBoundingClientRect","containerRect","getCoordinatesForTargetElement","_containerRef$current","targetRect","offsetX","offsetY","mouseMove","HOVER","nativeEvent","updateTooltip","hoverData","additionalRunData","_focusedRunData$curre","VISIBLE","currentRunUuid","mouseDownCapture","pageX","pageY","tooltipAreaClicked","_focusedRunData$curre2","stopPropagation","closeContextMenu","domRoot","getRootNode","rootClickListener","_focusedRunData$curre3","contains","addEventListener","capture","removeEventListener","resetTooltip","_focusedRunData$curre4","onMouseMove","onMouseDownCapture","onClickCapture","contextMenuContainer","contextMenuWrapper","userSelect","isHovering","useCompareRunsTooltip","setTooltip","overlayElement","bottom","RunsCompareChartCardWrapper","subtitle","onDelete","onEdit","fullWidth","tooltip","chartEntry","chartEntryTitle","InfoTooltip","gridTemplateRows","borderRadiusBase","chartComponentWrapper","barChartCardDefaultMargin","b","l","pad","RunsCompareBarChartCard","chartRunData","slicedRuns","reverse","barChartCardWrapper","_defs","SvgParallelChartPlaceholder","x1","y1","x2","y2","gradientUnits","stopColor","ParallelCoordinatesPlot","MAX_NUMBER_STRINGS","processParallelCoordinateData","allRuns","shift","stringRuns","numberRuns","seenVals","tempRuns","has","filterParallelCoordinateData","computeSelectedAttrs","attrs","runvalue","attr","Suspense","LegacySkeleton","EmptyParallelCoordsPlaceholder","ParallelChartSvg","RunsCompareParallelChartCard","isConfigured","parallelCoordsData","_config$selectedParam","_config$selectedMetri","configured","parallelChartCardWrapper","LazyParallelCoordinatesPlot","axesRotateThreshold","CompareRunsScatterPlot","xAxis","yAxis","markerSize","useTheme","xValues","yValues","tooltipData","runData","_xAxisData$xAxis$key","_yAxisData$yAxis$key","xAxisData","yAxisData","primary","customdata","newLayout","_points$$customdata","pointCustomDataRunUuid","scatterChartHighlightStyles","RunsCompareScatterChartCard","scatterChartCardWrapper","DEFAULT_COLOR_SCALE","CompareRunsContourPlot","zAxis","reverseScale","compareRunsChartDefaultContourMargin","colorScale","zValues","_zAxisData$zAxis$key","zAxisData","z","layers","zAxisTitle","connectgaps","contours","coloring","colorscale","reversescale","ticks","standoff","_scatterPoints$pointI","_customdata","scatterPoints","curveNumber","RunsCompareContourChartCard","contourChartCardWrapper","prepareMetricHistoryByAxisType","metricHistory","axisType","timestamp","minTimestamp","minBy","CompareRunsMetricsLinePlot","lineShape","runEntry","_runEntry$metricsHist","metricsHistory","EMA","hovertext","shape","xAxisKeyLabel","yAxisParams","showlegend","_points$0$curveNumber","_points$3","_points$4","immediateLayout","RunsCompareLineChartCard","isMetricHistoryLoading","lineChartCardWrapper","RunsCompareCharts","cardsConfig","onRemoveChart","onStartEditChart","parallelChartCards","remainingChartCards","c","parallelChartsWrapper","cardConfig","chartsWrapper","chartGroupWrapper","RunsCompareConfigureField","RunsCompareMetricParamSelect","isEmpty","selectFull","showSearch","OptGroup","Option","RunsCompareRunNumberSelect","countOption","optionValue","runsCompareRunCountDefaultOptions","RunsCompareConfigureBarChart","onStateChange","updateMetric","updateVisibleRunCount","emptyMetricsList","RunsCompareConfigureParallelChart","updateSelectedParams","updateSelectedMetrics","emptyParamsList","RunsCompareConfigureLineChart","updateXAxisKey","updateYAxisType","isLogType","updateSmoothing","Radio","Group","QuestionMarkIcon","timeStepQuestionMarkIcon","Switch","useFetchCompareRunsMetricHistory","currentStoreMetrics","setError","setRequests","setRequestsPending","currentRequests","addRequests","settleRequests","runUuidsToFetch","_currentStoreMetrics$","isInStore","isPendingRequest","getMetricHistoryApiBulk","RunsCompareConfigureLineChartPreview","previewData","metricKeysToFetch","previewDataWithHistory","previewRun","RunsCompareConfigureContourChart","updateAxis","axis","_state$xaxis","_state$yaxis","_state$zaxis","firstMetric","firstParam","scatterPlotDefaultOptions","RunsCompareConfigureScatterChart","normalizeValue","decimalPlaces","castToNumber","truncateString","ValuesBox","activeRun","xAxisValues","createBarChartValuesBox","createScatterChartValuesBox","_activeRun$metrics$xK","_activeRun$params$xKe","_activeRun$metrics$yK","_activeRun$params$yKe","xKey","yKey","xValue","yValue","createContourChartValuesBox","_activeRun$metrics$xK2","_activeRun$params$xKe2","_activeRun$metrics$yK2","_activeRun$params$yKe2","_activeRun$metrics$zK","_activeRun$params$zKe","zKey","zValue","createLineChartValuesBox","_activeRun$metricsHis","_activeRun$metricsHis2","createParallelChartValuesBox","RunsCompareTooltipBody","onHideRun","contentWrapper","actionsWrapper","previewComponentsMap","_cardConfig$selectedP","_cardConfig$selectedM","filteredData","RunsCompareConfigureModal","currentFormState","setCurrentFormState","isEditing","updateChartType","emptyChartCard","okButtonProps","cancelText","okText","wrapper","chartTypeOption","PreviewComponent","renderPreviewChartType","controlsWrapper","backgroundSecondary","RunsCompare","paramsByRunUuid","latestMetricsByRunUuid","comparedRuns","initiallyLoaded","setInitiallyLoaded","configuredCardConfig","setConfiguredCardConfig","addNewChartCard","startEditChart","chartCard","automlEntry","AUTOML_EVALUATION_METRIC_TAG","mlflowPrimaryEntry","MLFLOW_EXPERIMENT_PRIMARY_METRIC_NAME","chartRunDataWithHistory","useMultipleChartsMetricHistory","cardsRequiringMetricHistory","runsRequiringMetricHistory","maxRunCount","metricsRequiringHistory","card","baseRun","getBaseChartConfigs","tooltipContextValue","configToDelete","_current$compareRunCh2","setup","configuredCard","serializedCard","serialize","_current$compareRunCh","existingChartCard","FETCHED_RUN_NOTIFICATION_KEY","useFetchedRunsNotification","notification","getMessage","childRuns","fetchedRuns","existingRunInfos","runsWithParent","_run$data","runTagsList","EXPERIMENT_PARENT_ID_TAG","countFetchedRuns","close","duration","isEvaluationRun","_runData$tags","_runData$tags$MLFLOW_","MLFLOW_RUN_TYPE_TAG","MLFLOW_RUN_TYPE_VALUE_EVALUATION","PromptEngineeringContext","getMissingParams","pendingDataLoading","getEvaluableRowCount","evaluateCell","evaluateAllClick","runColumnsBeingEvaluated","canEvaluateInRunColumn","toggleExpandedHeader","isHeaderExpanded","PromptEngineeringContextProvider","tableData","setIsHeaderExpanded","expanded","rowKey","canEvaluateOnRun","requiredInput","groupByCellValues","startEvaluatingRunColumn","stopEvaluatingRunColumn","useEvaluateAllRows","evaluationTableData","currentTableData","currentRunsBeingEvaluated","setEvaluatedRuns","processQueueForRun","requiredInputs","nextEvaluableRow","tableRow","cellValues","containsAllParamValuesForRow","existingRunUuid","inputValues","compiledPrompt","evaluatePromptTableValue","evaluationData","evaluationPendingDataLoadingByRunUuid","DEFAULT_PROMPTLAB_OUTPUT_COLUMN","missingParams","usePromptEngineeringContext","EvaluationRunHeaderModelIndicator","promptEvaluationDataForRun","gatewayRoute","stop","stopSequences","fontSizeSm","EvaluationRunHeaderDatasetIndicator","_run$datasets","handleDatasetSelected","ExperimentViewDatasetWithContext","displayTextAsLink","EvaluationTableHeader","groupHeaderContent","flexBasis","EvaluationRunHeaderCellRenderer","onDuplicateRun","evaluableRowCount","evaluateAllButtonEnabled","evaluatingAllInProgress","evaluateAllTooltipContent","ExperimentRoutes","EvaluationCellEvaluateButton","isRunEvaluable","missingParamsToEvaluate","missingParamList","HighlightedText","parts","part","yellow200","EvaluationTextCellRenderer","_pendingDataLoading$r","_data$outputMetadataB","isGroupByColumn","isGatewayRoutesLoading","isCellEvaluating","outputMetadata","outputMetadataByRunUuid","isPending","isPendingInputRow","highlightedText","evaluationTime","EVALUATION_ARTIFACTS_TEXT_COLUMN_WIDTH","initialWidthGroupBy","initialWidthOutput","EvaluationGroupByHeaderCellRenderer","truncate","enlargedIconStyle","EvaluationTableActionsColumnRenderer","ChevronRightIcon","EvaluationTableActionsCellRenderer","onAddNewInputs","displayAddNewInputsButton","EvaluationArtifactCompareTable","resultList","groupByColumns","onCellClick","isPreviewPaneVisible","outputColumnName","setColumns","pendingData","evaluationPendingDataByRunUuid","gridWrapperRef","handleHideRun","refreshHeader","handleDuplicateRun","clearFocusedCell","visibleRows","getRenderedNodes","refreshCells","force","showAddNewInputsModal","AddNewInputsModal","useEvaluationAddNewInputsModal","modalVisible","setModalVisible","requiredInputKeys","setRequiredInputKeys","setInputValues","allValuesProvided","inputName","successCallback","setSuccessCallback","async","setInputValue","requiredInputsForRuns","inputValuesWithRunNames","uniq","flat","runNames","hasMore","scrollGridToTop","_gridWrapperRef$curre","gridViewport","ensureIndexVisible","evaluateAddInputValues","emptyMessage","getId","outputColumnIndicator","cols","cellRendererSelector","rowIndex","col","isLastGroupByColumns","headerClass","isFirstColumn","runsContainHeaderMetadata","setHeaderHeight","getEvaluationArtifactsTableHeaderHeight","createTableStyles","rowHeight","suppressHorizontalScroll","rowData","TextRendererCellRenderer","GroupHeaderCellRenderer","RunHeaderCellRenderer","ActionsColumnRenderer","ActionsCellRenderer","blue300","extractGroupByValuesFromEntry","groupByMappings","groupBy","_entry$groupBy","groupByHashKey","keyValue","groupByValues","isMacKeyboard","_userAgentData","test","userAgentData","platform","systemModifierKey","useBrowserKeyShortcutListener","modifierKeys","fn","altOrOptKey","ctrlOrCmdKey","shiftKey","handler","altKey","EvaluationArtifactCompareView","setSelectedTables","setGroupByCols","setOutputColumn","useEvaluationArtifactViewState","showSearchSpinner","setShowSearchSpinner","debouncedFilter","setDebouncedFilter","userDeselectedAllColumns","setUserDeselectedAllColumns","isSyncingArtifacts","EvaluationSyncStatusElement","useEvaluationArtifactWriteBack","evaluationArtifactsBeingUploaded","evaluationDraftInputValues","setSyncingArtifacts","discard","discardPendingEvaluationData","unsyncedDataEntriesCount","draftInputValuesCount","runsBeingSynchronizedCount","runArtifacts","isSynced","synchronizeArtifactData","writeBackEvaluationArtifactsAction","pendingUnevaluatedDraftInputValues","keyCombination","handleTableToggle","currentValue","handleGroupByToggle","newValues","visibleRunsUuids","evaluationArtifactsByRunUuid","tables","tablesByRun","comparedRunRows","_run$tags","_run$tags$MLFLOW_LOGG","rawLoggedArtifactsDeclaration","MLFLOW_LOGGED_ARTIFACTS_TAG","tablesInRun","RunLoggedArtifactType","TABLE","path","SyntaxError","allUniqueTables","tablesIntersection","tableName","_tablesByRun$runUuid","table","_evaluationData$evalu","evaluationArtifactsLoadingByRunUuid","artifactsByRun","comparedRunUuids","tableNames","columnsIntersection","allTableEntries","allColumnsForAllTables","tableColumns","useEvaluationArtifactColumns","tableRows","useEvaluationArtifactTableData","pendingDataByRun","draftInputValues","comparedRunsUuids","outputCellsValueMap","groupByCellsValueMap","pendingRowKeys","draftInputValueSet","visibleGroupByValues","colName","draftInputRowKey","outputMetadataByCellsValueMap","runsWithEntries","baseEntries","_entry$outputColumn","parseFloat","cellsEntry","pendingEntries","pendingEntry","_entryData$outputColu","entryData","allRowKeys","existingTableRow","existingKey","promptLabInputVariableNames","allInputNames","tablesToFetch","getEvaluationTableArtifact","areTablesSelected","areRunsSelected","isViewConfigured","filteredRows","regexp","groupByValue","noColumnsSelected","columnNotAvailableAnymore","firstColumn","groupByColumnCandidates","availableGroupByColumns","availableOutputColumns","nextColumnCandidate","columnGap","columnNames","columnName","createCurrentTime","mountTime","setMilliseconds","ExperimentViewRunsImpl","onMaximizedChange","setVisibleRuns","setViewState","expandRowsStore","useChartViewByDefault","hasAutomaticallyChangedModeAlready","useAutoExpandRunRows","allRunsData","evaluationRunIds","runsIdsToExpand","_runDateAndNestInfo$c","newPartialViewState","currentViewState","addColumnClicked","setReferenceTime","isDrawerOpen","setIsDrawerOpen","selectedDatasetWithRun","setSelectedDatasetWithRun","prepareRunsGridData","nestChildren","notificationsFn","notificationContainer","useLegacyNotification","showFetchedRunsNotifications","loadMoreRunsCallback","datasetSelected","createRunsTableWrapper","ExperimentViewDatasetDrawer","loadingFooter","getExperimentRunsActions","ExperimentViewRunsConnect","mapStateToProps","experimentTagsByExperimentId","tagsByRunUuid","ExperimentViewRunsInjectFilters","ExperimentViewRunsInjectContext","ExperimentViewRuns","ExperimentView","experimentsById","oldExperiments","newExperiments","firstExperiment","elementHeight","hideableElementHeight","observeHeight","useElementHeight","hideableElementsContainer","setHideableElementsContainer","setElementHeight","scrollHeight","setIsMaximized","searchDatasetsApi","getErrorCode","ErrorCodes","PERMISSION_DENIED","getMessageField","RESOURCE_DOES_NOT_EXIST","NotFoundPage","experimentViewWrapper","paragraph","getExperimentActions","setCompareExperiments","ExperimentPage","updatePageTitle","throttleMs","setLayoutWidth","setLayoutHeight","setDimensions","setDimensionsThrottled","leading","unmounted","observer","observerEntry","paintOrder","bgcolor","bordercolor","font","parsedValue","isFinite","MAX_VALUE","POSITIVE_INFINITY","sign","fullStr","strLen","charsToShow","frontChars","ceil","backChars","_interopRequireDefault","require","exports","_default","default"],"sourceRoot":""}