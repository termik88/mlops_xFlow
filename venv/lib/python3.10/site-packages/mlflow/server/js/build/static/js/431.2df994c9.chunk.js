"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[431],{65431:function(e,t,r){r.r(t),r.d(t,{ExperimentPage:function(){return Zo},default:function(){return wo}});var n=r(91604),a=r(5710),i=r(74116),s=r(26530),o=r(74403),l=r(97206),c=r(5625);const d=c.I0;var u=r(65069);const p=(0,n.createContext)(null),m=e=>{let{children:t,actions:r}=e;const[a,i]=(0,n.useState)([]),[c,m]=(0,n.useState)(!1),[h,g]=(0,n.useState)(null),f=d(),v=(0,n.useCallback)((e=>{g(null),(()=>{const t=e.map((e=>{const t=r.getExperimentApi(e);return f(t).catch((e=>{s.default.logErrorAndNotifyUser(e)})),t.meta.id}));i((e=>(0,o.isEqual)(t,e)?e:t))})()}),[r,f]),y=(0,n.useMemo)((()=>({fetchExperiments:v,isLoadingExperiment:c,requestError:h,actions:r})),[r,v,c,h]);return(0,u.tZ)(p.Provider,{value:y,children:(0,u.tZ)(l.ZP,{shouldOptimisticallyRender:!0,requestIds:a,children:(e,r,n)=>(m(n.some((e=>a.includes(e.id)&&e.active))),h||n.forEach((e=>{e.error&&g(e.error)})),t)})})};var h=r(73797),g=r(97267),f=r(46276),v=r(72914);var y=r.p+"static/media/permission-denied-lock.16036747d57cd663d7df223781a447b2.svg",b=r(5034);function x(e){let{errorMessage:t}=e;const{theme:r}=(0,b.u)();return(0,u.BX)("div",{className:"center",children:[(0,u.tZ)("img",{style:{height:300,marginTop:80},src:y,alt:"permission denied"}),(0,u.tZ)("h1",{style:{paddingTop:10},children:"Permission Denied"}),(0,u.tZ)("h2",{"data-testid":"error-message",css:(0,v.iv)({color:r.colors.textSecondary},""),children:t||"The current user does not have permission to view this page."})]})}var C=r(25222);const Z=e=>{let{artifactLocation:t}=e;return(0,u.tZ)(u.HY,{children:t})},w=n.memo((e=>{let{experiment:t}=e;return(0,u.BX)("div",{css:k.container,children:[(0,u.BX)(b.j.Text,{color:"secondary",children:[(0,u.tZ)(C.Z,{id:"PZGZHV",defaultMessage:"Experiment ID"}),": ",t.experiment_id]}),(0,u.BX)(b.j.Text,{color:"secondary",children:[(0,u.tZ)(C.Z,{id:"8/7V3S",defaultMessage:"Artifact Location"}),": ",(0,u.tZ)(Z,{artifactLocation:t.artifact_location})]})]})})),k={container:e=>({display:"flex",gap:e.spacing.lg})};var S=r(78064),M=r(98328),R=r(15660),E=r(86169);const T=()=>{const e=(0,n.useContext)(p);if(!e)throw new Error("Trying to use GetExperimentsContext actions outside of the context!");return e},B=n.memo((e=>{let{experiment:t}=e;const r=(0,c.v9)((e=>{const r=(0,R.aq)(t.experiment_id,e);return r?(e=>{var t;return(null===(t=Object.values(e).find((e=>e.getKey()===E._)))||void 0===t?void 0:t.value)||void 0})(r):""})),[a,i]=(0,n.useState)(!1),{actions:{setExperimentTagApi:s}}=T(),o=d(),l=(0,n.useCallback)((e=>{const r=s(t.experiment_id,E._,e);o(r).then((()=>i(!1)))}),[t.experiment_id,s,o]);return(0,u.tZ)(S.a,{title:(0,u.BX)("span",{css:I.collapsibleSectionHeader,children:[(0,u.tZ)(C.Z,{id:"wDwAdX",defaultMessage:"Description"})," ",!a&&(0,u.tZ)(b.B,{type:"link",onClick:()=>i(!0),children:(0,u.tZ)(C.Z,{id:"2YEXRM",defaultMessage:"Edit"})})]}),forceOpen:a,defaultCollapsed:!r,"data-test-id":"experiment-notes-section",children:(0,u.tZ)(M.U,{defaultMarkdown:r,onSubmit:l,onCancel:()=>i(!1),showEditor:a})})})),I={collapsibleSectionHeader:{height:"32px",lineHeight:"32px"}};var A=r(75677);const L=e=>{let{experiment:t}=e;const r=(0,a.Z)();return(0,u.tZ)(b.j.Text,{size:"xl",dangerouslySetAntdProps:{copyable:{text:t.name,icon:(0,u.tZ)(h.TIy,{}),tooltips:[r.formatMessage({id:"A7R0ii",defaultMessage:"Copy path"}),r.formatMessage({id:"JCboZ7",defaultMessage:"Path copied"})]}}})};var D={name:"1739oy8",styles:"z-index:1"};const N=e=>{let{copyText:t,showLabel:r=!0,icon:a}=e;const[i,s]=(0,n.useState)(!1);return(0,u.tZ)(b.T,{title:(0,u.tZ)(C.Z,{id:"X+boXI",defaultMessage:"Copied"}),dangerouslySetAntdProps:{visible:i},children:(0,u.tZ)(b.B,{type:"primary",onClick:()=>{navigator.clipboard.writeText(t),s(!0),setTimeout((()=>{s(!1)}),3e3)},onMouseLeave:()=>{s(!1)},icon:a,css:D,children:r&&(0,u.tZ)(C.Z,{id:"1Iq+NW",defaultMessage:"Copy"})})})};var P={name:"490tlg",styles:"display:flex;gap:4px"};const H=e=>{let{copyText:t}=e;return(0,u.BX)("div",{css:P,children:[(0,u.tZ)(b.e,{readOnly:!0,value:t,"data-test-id":"copy-box"}),(0,u.tZ)(N,{copyText:t})]})},O=e=>{let{visible:t,onCancel:r,link:n}=e;return(0,u.tZ)(h.u_l,{title:(0,u.tZ)(C.Z,{id:"ktiuki",defaultMessage:"Get Link"}),visible:t,onCancel:r,children:(0,u.tZ)(H,{copyText:n})})},X=()=>{const[e,t]=(0,n.useState)(!1);return(0,u.BX)(u.HY,{children:[(0,u.tZ)(O,{link:window.location.href,visible:e,onCancel:()=>t(!1)}),(0,u.tZ)(b.B,{type:"primary",onClick:()=>t(!0),"data-test-id":"share-button",children:(0,u.tZ)(C.Z,{id:"2oFAO4",defaultMessage:"Share"})})]})};var z=r(3969);var U={name:"ny5p0o",styles:"margin-left:16px"},V={name:"158icaa",styles:"margin-left:4px"};const _=n.memo((e=>{let{experiment:t}=e;const r=(0,n.useMemo)((()=>t.name.split("/").pop()),[t.name]),a=(0,z.E)();return(0,u.tZ)(A.mr,{title:(0,u.BX)("div",{css:W.headerWrapper,children:[r," ",(0,u.tZ)(L,{experiment:t})," ",a&&(0,u.BX)("a",{href:a,target:"_blank",rel:"noreferrer",children:[(0,u.tZ)(b.B,{css:U,type:"link",size:"small",children:(0,u.tZ)(C.Z,{id:"d78wwA",defaultMessage:"Provide Feedback"})}),(0,u.tZ)(b.U,{css:V})]})]}),breadcrumbs:[],children:(0,u.tZ)(X,{})})})),W={sendFeedbackPopoverContent:{display:"flex",maxWidth:250,flexDirection:"column",alignItems:"flex-end"},headerWrapper:e=>({display:"inline-flex",gap:e.spacing.sm,alignItems:"center"})},F=n.memo((e=>{let{experiments:t}=e;const r=(0,n.useMemo)((()=>(0,u.tZ)(C.Z,{id:"Dhn7Mb",defaultMessage:"Displaying Runs from {numExperiments} Experiments",values:{numExperiments:t.length}})),[t.length]);return(0,u.tZ)(A.mr,{title:r,breadcrumbs:[],children:(0,u.tZ)(X,{})})}));var K=r(53033),j=r(13558);const $=(e,t)=>{const{experiments:r}=t,n=r.map((e=>e.experiment_id)),a=n.length>1,i=Object.values(e.entities.runInfosByUuid).filter((e=>{let{experiment_id:t}=e;return n.includes(t)})).map((e=>{let{run_uuid:t}=e;return t})),{modelVersionsByRunUuid:s,runUuidsMatchingFilter:o}=e.entities,l=((e,t,r)=>{let{lifecycleFilter:n=K.VW.ACTIVE,modelVersionFilter:a=K.CN.ALL_RUNS,datasetsFilter:i=[]}=r;const{modelVersionsByRunUuid:s}=t.entities;return e.map((e=>[(0,R.hQ)(e,t),(0,R._g)(e,t)])).filter((e=>{let[t,r]=e;return n===K.VW.ACTIVE?"active"===t.lifecycle_stage:"deleted"===t.lifecycle_stage})).filter((e=>{let[t,r]=e;return a===K.CN.ALL_RUNS||(a===K.CN.WITH_MODEL_VERSIONS?t.run_uuid in s:a===K.CN.WTIHOUT_MODEL_VERSIONS?!(t.run_uuid in s):(console.warn("Invalid input to model version filter - defaulting to showing all runs."),!0))})).filter((e=>{let[t,r]=e;return!i||0===i.length||!!r&&r.some((e=>{const t=e.dataset.name,r=e.dataset.digest,n=e.tags?e.tags.find((e=>"mlflow.data.context"===e.key)):void 0;return i.some((e=>{let{name:a,digest:i,context:s}=e;return a===t&&i===r&&(n?s===n.value:void 0===s)}))}))})).map((e=>{let[t,r]=e;return t}))})(i,e,t),c=new Set,d=new Set,u=l.map((t=>e.entities.runDatasetsByUuid[t.run_uuid])),p=l.map((t=>{const r=(0,j.nQ)(t.run_uuid,e),n=Object.values(r||{});return n.forEach((e=>{c.add(e.key)})),n})),m=l.map((t=>{const r=Object.values((0,R.Qf)(t.run_uuid,e));return r.forEach((e=>{d.add(e.key)})),r})),h=l.map((t=>(0,R.Ml)(t.run_uuid,e))),g=n[0];return{modelVersionsByRunUuid:s,experimentTags:a?{}:(0,R.aq)(g,e),runInfos:l,paramsList:m,tagsList:h,metricsList:p,runUuidsMatchingFilter:o,datasetsList:u,metricKeyList:Array.from(c.values()).sort(),paramKeyList:Array.from(d.values()).sort()}};var q=r(73409);class Y extends n.Component{handleSortBy(){const{canonicalSortKey:e,orderByAsc:t,orderByKey:r}=this.props;let n=!t;e!==r&&(n=!1),this.props.onSortBy(e,n)}render(){const{enableSorting:e,canonicalSortKey:t,displayName:r,getClassName:n=(()=>""),orderByKey:a,orderByAsc:i}=this.props;return(0,u.BX)("div",{role:"columnheader",css:G.headerLabelWrapper(e),className:n(t),onClick:e?()=>this.handleSortBy():void 0,children:[(0,u.tZ)("span",{"data-test-id":`sort-header-${r}`,children:r}),e&&t===a?i?(0,u.tZ)(h.TV4,{}):(0,u.tZ)(h.mcG,{}):null]})}}const G={headerLabelWrapper:e=>t=>({height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 12px",svg:{color:t.colors.textSecondary},"&:hover":{color:e?t.colors.actionTertiaryTextHover:"unset",svg:{color:t.colors.actionTertiaryTextHover}}}),headerSortIcon:{marginRight:4}},J=()=>(0,u.tZ)(h.oOx,{css:e=>({color:e.colors.textValidationDanger})}),Q=()=>(0,u.tZ)(h.rE2,{css:e=>({color:e.colors.textValidationSuccess})}),ee=e=>{switch(e){case"FAILED":case"KILLED":return(0,u.tZ)(J,{});case"FINISHED":return(0,u.tZ)(Q,{});case"SCHEDULED":return(0,u.tZ)(h.T39,{});default:return null}},te=n.memo((e=>{let{value:{startTime:t,referenceTime:r,runStatus:n}}=e;return(0,u.BX)("span",{css:re.cellWrapper,title:s.default.formatTimestamp(t),children:[ee(n),s.default.timeSinceStr(t,r)]})})),re={cellWrapper:e=>({display:"flex",alignItems:"center",gap:e.spacing.sm,svg:{width:14,height:14}})};var ne=r(84268),ae=r(54419);const ie=n.memo((e=>{let{data:t,value:r}=e;return(0,u.tZ)(ne.rU,{to:ae.Z.getExperimentPageRoute(t.experimentId),title:r.name,children:r.basename})})),se=e=>{let{text:t,maxSize:r,className:a,allowShowMore:i=!1}=e;if(t.length<=r)return(0,u.tZ)("span",{className:a,children:t});const s=`${t.substr(0,r)}...`,[o,l]=(0,n.useState)(!1);return(0,u.BX)("span",{className:a,children:[o?t:s,i&&(0,u.tZ)(b.B,{type:"link",onClick:()=>l(!o),size:"small",css:oe.expandButton,"data-test-id":"trimmed-text-button",children:o?"collapse":"expand"})]})},oe={expandButton:{display:"inline-block"}};var le=r.p+"static/media/logged-model.dd9b21ff4fb07f3cadeada8046a2693b.svg";var ce=r.p+"static/media/registered-model.24429a4f6158e57b01b3928e2605aa25.svg",de=r(99725);const ue=n.memo((e=>{const{registeredModels:t,loggedModels:r,experimentId:n,runUuid:a}=e.value,i=s.default.mergeLoggedAndRegisteredModels(r,t);if(i&&i.length){const e=i[0];let t;if(e.registeredModelName){const{registeredModelName:r,registeredModelVersion:n}=e;let a=s.default.getIframeCorrectedRoute((0,de.u5)(r,n)),i=r;const o=`${r} version ${n}`;t=(0,u.BX)(u.HY,{children:[(0,u.tZ)("img",{"data-test-id":"registered-model-icon",alt:"",title:"Registered Model",src:ce}),(0,u.tZ)(b.T,{title:o,children:(0,u.BX)("a",{href:a,className:"registered-model-link",target:"_blank",rel:"noreferrer",children:[(0,u.tZ)(se,{text:i,maxSize:10,className:"model-name"}),`/${n}`]})})]})}else if(e.flavors){const r=e.flavors?e.flavors[0]:"Model",i=s.default.getIframeCorrectedRoute(`${ae.Z.getRunPageRoute(n,a)}/artifactPath/${e.artifactPath}`);t=(0,u.BX)(u.HY,{children:[(0,u.tZ)("img",{"data-test-id":"logged-model-icon",alt:"",title:"Logged Model",src:le}),(0,u.tZ)("a",{href:i,target:"_blank",className:"logged-model-link",children:r})]})}return(0,u.BX)("div",{className:"logged-model-cell",css:pe.imageWrapper,children:[t,r.length>1?`, ${r.length-1} more`:""]})}return(0,u.tZ)(u.HY,{children:"-"})})),pe={imageWrapper:{img:{height:"15px",position:"relative",marginRight:"4px"}}},me=n.memo((e=>{let{value:t}=e;const r=s.default.renderSource(t,void 0,void 0);return r?(0,u.BX)(u.HY,{children:[s.default.renderSourceTypeIcon(t),r]}):(0,u.tZ)(u.HY,{children:"-"})})),he=n.memo((e=>{let{value:{version:t,name:r,type:n}}=e;return s.default.renderSourceVersion(t,r,n)||(0,u.tZ)(u.HY,{children:"-"})}));var ge=r(2570);const fe={mouseEnterDelay:0,mouseLeaveDelay:0},ve=n.memo((e=>{const{pinned:t,hidden:r}=e.value;return(0,u.BX)("div",{css:ye.actionsContainer,children:[(0,u.tZ)(b.T,{dangerouslySetAntdProps:fe,placement:"right",title:r?(0,u.tZ)(C.Z,{id:"xmpvlI",defaultMessage:"Unhide run"}):(0,u.tZ)(C.Z,{id:"qTjYVU",defaultMessage:"Hide run"}),children:(0,u.BX)("label",{css:ye.actionCheckbox,className:"is-visibility-toggle",children:[(0,u.tZ)("input",{type:"checkbox",checked:!r,onChange:()=>{e.onToggleVisibility(e.data.runUuid)}}),r?(0,u.tZ)(h.wJG,{}):(0,u.tZ)(h.bMb,{})]})}),e.data.pinnable&&(0,u.tZ)(b.T,{dangerouslySetAntdProps:fe,placement:"right",title:t?(0,u.tZ)(C.Z,{id:"ugm2f6",defaultMessage:"Unpin run"}):(0,u.tZ)(C.Z,{id:"fjiojF",defaultMessage:"Pin run"}),children:(0,u.BX)("label",{css:ye.actionCheckbox,className:"is-pin-toggle","data-testid":"column-pin-toggle",children:[(0,u.tZ)("input",{type:"checkbox",checked:t,onChange:()=>{e.onTogglePin(e.data.runUuid)}}),t?(0,u.tZ)(h.D$V,{}):(0,u.tZ)(h.qQX,{})]})})]})}),((e,t)=>e.value.hidden===t.value.hidden&&e.value.pinned===t.value.pinned)),ye={actionsContainer:()=>({display:"flex",gap:18}),actionCheckbox:e=>({input:{width:0,appearance:"none"},cursor:"pointer",display:"flex",svg:{width:14,height:14,cursor:"pointer"},"&.is-pin-toggle svg":{color:"transparent",".ag-row:hover &":{color:e.colors.grey600}},"&.is-visibility-toggle svg":{color:e.colors.grey400,".ag-row:hover &":{color:e.colors.grey600}},"& input:checked + span svg":{color:e.colors.grey600}})},be=n.memo((e=>(0,u.BX)(b.M.Root,{modal:!1,children:[(0,u.tZ)(b.M.Trigger,{asChild:!0,children:(0,u.tZ)("button",{css:xe.actionButton,"data-testid":"experiment-view-runs-visibility-column-header",children:(0,u.tZ)(h.bMb,{})})}),(0,u.BX)(b.M.Content,{children:[(0,u.BX)(b.M.Item,{onClick:()=>e.onToggleVisibility(ge.yz.HIDEALL),"data-testid":"experiment-view-runs-visibility-hide-all",children:[(0,u.tZ)(b.M.IconWrapper,{children:(0,u.tZ)(h.wJG,{})}),(0,u.tZ)(C.Z,{id:"UEESlL",defaultMessage:"Hide all runs"})]}),(0,u.BX)(b.M.Item,{onClick:()=>e.onToggleVisibility(ge.yz.SHOWALL),"data-testid":"experiment-view-runs-visibility-show-all",children:[(0,u.tZ)(b.M.IconWrapper,{children:(0,u.tZ)(h.bMb,{})}),(0,u.tZ)(C.Z,{id:"4yjF8O",defaultMessage:"Show all runs"})]})]})]}))),xe={actionButton:e=>({background:"transparent",border:"none",cursor:"pointer",padding:"8px",".ag-checkbox:not(.ag-hidden) + &":{padding:"0 1px"},svg:{width:14,height:14,cursor:"pointer",color:e.colors.grey600}})},Ce=n.memo((e=>{let{onExpand:t,data:{runName:r,experimentId:n,runUuid:a,runDateAndNestInfo:i,color:s}}=e;const{hasExpander:o,expanderOpen:l,childrenIds:c,level:d}=i||{},p=!isNaN(d)&&o;return(0,u.BX)("div",{css:Ze.cellWrapper,children:[(0,u.tZ)("div",{css:Ze.expanderWrapper,children:(0,u.tZ)("div",{css:Ze.nestLevel(d),children:p&&(0,u.tZ)(b.B,{css:Ze.expanderButton,size:"small",onClick:()=>{t(a,c)},type:"link",icon:l?(0,u.tZ)(h.uSo,{}):(0,u.tZ)(h.IAe,{})},"Expander-"+a)})}),(0,u.BX)(ne.rU,{to:ae.Z.getRunPageRoute(n,a),css:Ze.runLink,children:[(0,u.tZ)("div",{css:Ze.colorPill,"data-testid":"experiment-view-table-run-color",style:{backgroundColor:s}}),(0,u.tZ)("span",{css:Ze.runName,children:r})]})]})})),Ze={link:e=>({display:"inline-block",minWidth:e.typography.fontSizeBase,minHeight:e.typography.fontSizeBase}),cellWrapper:{display:"flex"},expanderButton:{svg:{width:12,height:12}},runLink:{overflow:"hidden",display:"flex",gap:8,alignItems:"center"},runName:{overflow:"hidden",textOverflow:"ellipsis"},expanderWrapper:{display:"none",".ag-grid-expanders-visible &":{display:"block"}},colorPill:{width:12,height:12,borderRadius:6,flexShrink:0,"@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)":{marginBottom:1}},nestLevel:e=>t=>({display:"flex",justifyContent:"flex-end",width:(e+1)*t.spacing.lg,height:t.spacing.lg})};var we={name:"gikiyg",styles:"display:flex;justify-content:center;align-items:center;height:32px"};const ke=n.memo((e=>{let{loadMoreRunsFunc:t}=e;return(0,u.tZ)("div",{css:we,children:(0,u.tZ)(b.B,{type:"primary",onClick:t,size:"small",children:(0,u.tZ)(C.Z,{id:"9CqEWy",defaultMessage:"Load more"})})})}));var Se=r(77909);var Me={name:"rnnx2x",styles:"font-size:12px"},Re={name:"rnnx2x",styles:"font-size:12px"};const Ee=e=>{let{datasetWithTags:t,onDatasetSelected:r,appendComma:n=!1,inPopover:a=!1}=e;const{theme:i}=(0,b.u)(),{dataset:s,tags:o}=t;if(!s)return null;const l=null===o||void 0===o?void 0:o.find((e=>{let{key:t}=e;return t===q.Ak}));return(0,u.BX)("div",{css:(0,v.iv)({display:"flex",flexShrink:0,alignItems:"center",overflow:"hidden",marginRight:i.spacing.xs},""),children:[(0,u.tZ)(h.$eq,{css:(0,v.iv)({color:i.colors.textSecondary,marginRight:i.spacing.xs},"")})," ",(0,u.tZ)("span",{css:(0,v.iv)({minWidth:32,marginRight:i.spacing.xs,flexShrink:0},""),children:a?(0,u.tZ)(h.J2e.Close,{asChild:!0,children:(0,u.tZ)(b.B,{type:"link",onClick:r,children:(0,u.BX)("span",{css:Me,children:[s.name," (",s.digest,")"]})})}):(0,u.tZ)(b.B,{type:"link",onClick:r,children:(0,u.BX)("span",{children:[s.name," (",s.digest,")"]})})}),l&&(0,u.tZ)(h.Vp9,{css:(0,v.iv)({textTransform:"capitalize",marginRight:i.spacing.xs},""),children:(0,u.tZ)("span",{css:Re,children:l.value})}),n&&(0,u.tZ)(u.HY,{children:","})]})};var Te={name:"zjik7",styles:"display:flex"},Be={name:"eq7f8j",styles:"display:flex;align-items:flex-end"},Ie={name:"h1n7cn",styles:"max-height:400px;overflow:auto"};const Ae=n.memo((e=>{let{value:t,data:r,onDatasetSelected:a,expandRows:i}=e;const s=(0,n.useRef)(null),[l,c]=(0,n.useState)(0),d=(0,n.useMemo)((()=>t.slice(0,3)),[t]),{theme:p}=(0,b.u)();(0,n.useEffect)((()=>{if(!s.current)return()=>{};const e=(0,o.throttle)((e=>{let[t]=e;if(i){const e=t.contentRect.height;let r=0,n=0;for(let a=0;a<t.target.children.length;a++){const i=t.target.children.item(a);if(n+i.clientHeight>e)break;n+=i.clientHeight,r++}c(r)}else{const e=t.contentRect.width;let r=0,n=0;for(let a=0;a<t.target.children.length;a++){const i=t.target.children.item(a);if(n+i.clientWidth>=e)break;n+=i.clientWidth,r++}c(r)}}),100),t=new ResizeObserver(e);return t.observe(s.current),()=>t.disconnect()}),[i]);const m=t.length-l;if(!t||t.length<1)return(0,u.tZ)(u.HY,{children:"-"});const g=i?d:t;return(0,u.BX)("div",{css:Te,children:[(0,u.tZ)("div",{css:(0,v.iv)({overflow:"hidden",display:"flex",flexDirection:i?"column":"row"},""),ref:s,children:g.map(((e,t)=>(0,u.tZ)(Ee,{appendComma:!i&&t<d.length-1,datasetWithTags:e,onDatasetSelected:()=>null===a||void 0===a?void 0:a(e,r)},`${e.dataset.name}-${e.dataset.digest}`)))}),m>0&&(0,u.BX)("div",{css:Be,children:[!i&&(0,u.tZ)("span",{css:(0,v.iv)({paddingLeft:p.spacing.xs,paddingRight:p.spacing.xs},""),children:"\u2026"}),(0,u.BX)(h.J2e.Root,{modal:!1,children:[(0,u.tZ)(h.J2e.Trigger,{asChild:!0,children:(0,u.tZ)(b.B,{size:"small",style:{borderRadius:"8px",width:"40px"},children:(0,u.BX)(b.j.Text,{color:"secondary",children:["+",m]})})}),(0,u.tZ)(h.J2e.Content,{align:"start",css:Ie,children:t.slice(t.length-m).map((e=>(0,u.tZ)("div",{css:(0,v.iv)({height:p.general.heightSm,display:"flex",alignItems:"center"},""),children:(0,u.tZ)(Ee,{datasetWithTags:e,onDatasetSelected:()=>null===a||void 0===a?void 0:a(e,r),inPopover:!0})},`${e.dataset.name}-${e.dataset.digest}`)))})]})]})]})})),Le=e=>e?70:104,De=(e,t)=>e+".`"+t+"`",Ne=(e,t)=>e.startsWith(t),Pe=(e,t)=>e.substring(t.length+2).slice(0,-1),He=e=>`${ge.uX}-${e}`,Oe=e=>`${ge.im}-${e}`,Xe=e=>`${ge.qr}-${e}`,ze={[q.XZ.USER]:De(q.D5.ATTRIBUTES,"User"),[q.XZ.RUN_NAME]:De(q.D5.ATTRIBUTES,"Run Name"),[q.XZ.SOURCE]:De(q.D5.ATTRIBUTES,"Source"),[q.XZ.VERSION]:De(q.D5.ATTRIBUTES,"Version")},Ue=e=>{let{data:t}=e;return t.runUuid},Ve=e=>{let{rowNode:t}=e;return t.data.isLoadMoreRow},_e=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=[q.z.USER,q.z.SOURCE,q.z.VERSION,q.z.MODELS];return(0,Se.GW)()&&t.push(q.z.DATASET),e&&t.push(q.z.EXPERIMENT_NAME),t},We=e=>{let{searchFacetsState:t,onSortBy:r,compareExperiments:a,onTogglePin:i,onToggleVisibility:l,onExpand:c,paramKeyList:d,metricKeyList:u,tagKeyList:p,columnApi:m,onDatasetSelected:h,isComparingRuns:g,expandRows:f}=e;const{orderByAsc:v,orderByKey:y,selectedColumns:b}=t,x=(e=>{let{paramKeyList:t,metricKeyList:r,tagKeyList:a}=e;const i=(0,n.useRef)(new Set),s=(0,n.useRef)(new Set),o=(0,n.useRef)(new Set),l=(0,n.useMemo)((()=>(t.forEach((e=>s.current.add(e))),Array.from(s.current))),[t]),c=(0,n.useMemo)((()=>(r.forEach((e=>i.current.add(e))),Array.from(i.current))),[r]),d=(0,n.useMemo)((()=>(a.forEach((e=>o.current.add(e))),Array.from(o.current))),[a]);return(0,n.useMemo)((()=>({paramKeys:l,metricKeys:c,tagKeys:d})),[c,l,d])})({metricKeyList:u,tagKeyList:p,paramKeyList:d}),C=(0,n.useMemo)((()=>{const e={orderByKey:y,orderByAsc:v,onSortBy:r},t=e=>e===y?"is-ordered-by":void 0,n=e=>t(e),d=e=>{let{colDef:r}=e;return t(r.headerComponentParams.canonicalSortKey)},u=[];if(u.push({valueGetter:e=>{let{data:{pinned:t,hidden:r}}=e;return{pinned:t,hidden:r}},checkboxSelection:!g,headerComponent:"RowActionsHeaderCellRenderer",headerComponentParams:{onToggleVisibility:l},headerCheckboxSelection:!g,headerName:"",cellClass:"is-checkbox-cell",cellRenderer:"RowActionsCellRenderer",cellRendererParams:{onTogglePin:i,onToggleVisibility:l},pinned:"left",minWidth:Le(g),width:Le(g),maxWidth:Le(g),resizable:!1}),u.push({headerName:q.z.RUN_NAME,colId:ze[q.XZ.RUN_NAME],headerTooltip:q.XZ.RUN_NAME,pinned:"left",sortable:!0,field:"runDateAndNestInfo",cellRenderer:"RunNameCellRenderer",cellRendererParams:{onExpand:c},equals:(e,t)=>(0,o.isEqual)(e,t),headerComponentParams:{...e,canonicalSortKey:q.XZ.RUN_NAME,getClassName:n},cellClass:d,initialWidth:310,resizable:!g}),g)return u;u.push({headerName:q.z.DATE,headerTooltip:q.XZ.DATE,pinned:"left",sortable:!0,field:"runDateAndNestInfo",cellRenderer:"DateCellRenderer",cellRendererParams:{onExpand:c},equals:(e,t)=>(0,o.isEqual)(e,t),headerComponentParams:{...e,canonicalSortKey:q.XZ.DATE,getClassName:n},cellClass:d,initialWidth:150}),(0,Se.GW)()&&u.push({headerName:q.z.DATASET,colId:De(q.D5.ATTRIBUTES,q.z.DATASET),headerTooltip:q.z.DATASET,sortable:!1,field:"datasets",cellRenderer:"DatasetsCellRenderer",cellRendererParams:{onDatasetSelected:h,expandRows:f},cellClass:"is-multiline-cell",initialWidth:300}),u.push({headerName:q.z.DURATION,field:"duration",initialWidth:80,cellClass:d}),a&&u.push({headerName:q.z.EXPERIMENT_NAME,colId:De(q.D5.ATTRIBUTES,q.z.EXPERIMENT_NAME),field:"experimentName",cellRenderer:"ExperimentNameCellRenderer",equals:(e,t)=>(0,o.isEqual)(e,t),initialWidth:140,cellClass:d,initialHide:!0}),u.push({headerName:q.z.USER,colId:ze[q.XZ.USER],headerTooltip:q.XZ.USER,field:"user",sortable:!0,headerComponentParams:{...e,canonicalSortKey:q.XZ.USER,getClassName:n},cellClass:d,initialHide:!0}),u.push({headerName:q.z.SOURCE,colId:ze[q.XZ.SOURCE],field:"tags",cellRenderer:"SourceCellRenderer",equals:(e,t)=>s.default.getSourceName(e)===s.default.getSourceName(t),sortable:!0,headerComponentParams:{...e,canonicalSortKey:q.XZ.SOURCE,getClassName:n},cellClass:d,initialHide:!0}),u.push({headerName:q.z.VERSION,colId:ze[q.XZ.VERSION],field:"version",cellRenderer:"VersionCellRenderer",equals:(e,t)=>(0,o.isEqual)(e,t),sortable:!0,headerComponentParams:{...e,canonicalSortKey:q.XZ.VERSION,getClassName:n},cellClass:d,initialHide:!0}),u.push({headerName:q.z.MODELS,colId:De(q.D5.ATTRIBUTES,q.z.MODELS),field:"models",cellRenderer:"ModelsCellRenderer",initialWidth:200,equals:(e,t)=>(0,o.isEqual)(e,t),initialHide:!0});const{metricKeys:p,paramKeys:m,tagKeys:b}=x;return p.length&&u.push({headerName:"Metrics",groupId:q.D5.METRICS,children:p.map((t=>{const r=De(q.D5.METRICS,t);return{headerName:t,colId:r,headerTooltip:(0,ge.yC)(q.D5.METRICS,t),field:Oe(t),tooltipField:Oe(t),initialWidth:100,initialHide:!0,sortable:!0,headerComponentParams:{...e,canonicalSortKey:r,getClassName:n},cellClass:e=>`${d(e)} is-previewable-cell`}}))}),m.length&&u.push({headerName:"Parameters",groupId:q.D5.PARAMS,children:m.map((t=>{const r=De(q.D5.PARAMS,t);return{colId:r,headerName:t,headerTooltip:(0,ge.yC)(q.D5.PARAMS,t),field:He(t),tooltipField:He(t),initialHide:!0,initialWidth:100,sortable:!0,headerComponentParams:{...e,canonicalSortKey:r,getClassName:n},cellClass:e=>`${d(e)} is-previewable-cell`}}))}),b.length&&u.push({headerName:"Tags",colId:q.D5.TAGS,children:b.map((e=>({colId:De(q.D5.TAGS,e),headerName:e,initialHide:!0,initialWidth:100,headerTooltip:(0,ge.yC)(q.D5.TAGS,e),field:Xe(e),tooltipField:Xe(e)})))}),u}),[y,v,r,i,l,c,a,x,g,h,f]),Z=(0,n.useMemo)((()=>[..._e(!0).map((e=>De(q.D5.ATTRIBUTES,e))),...x.paramKeys.map((e=>De(q.D5.PARAMS,e))),...x.metricKeys.map((e=>De(q.D5.METRICS,e))),...x.tagKeys.map((e=>De(q.D5.TAGS,e)))]),[x]);return(0,n.useEffect)((()=>{if(m&&!g)for(const e of Z){const t=b.includes(e);m.setColumnVisible(e,t)}}),[b,m,Z,g]),C},Fe={initialWidth:100,autoSizePadding:0,headerComponentParams:{menuIcon:"fa-bars"},resizable:!0,filter:!0,suppressMenu:!0,suppressMovable:!0};var Ke=r(68294);class je extends n.Component{constructor(e){super(e),this.handleSubmit=this.handleSubmit.bind(this)}handleSubmit(){const e=[];return this.props.selectedRunIds.forEach((t=>{e.push(this.props.deleteRunApi(t))})),Promise.all(e).catch((()=>{this.props.openErrorModal("While deleting an experiment run, an error occurred.")}))}render(){const e=this.props.selectedRunIds.length;return(0,u.tZ)(Ke.s,{isOpen:this.props.isOpen,onClose:this.props.onClose,handleSubmit:this.handleSubmit,title:`Delete Experiment ${s.default.pluralize("Run",e)}`,helpText:(0,u.BX)("div",{children:[(0,u.tZ)("p",{children:(0,u.BX)("b",{children:[e," experiment ",s.default.pluralize("run",e)," will be deleted."]})}),""]}),confirmButtonText:"Delete"})}}const $e={deleteRunApi:i.Gd,openErrorModal:i.yQ};var qe=(0,c.$j)(null,$e)(je),Ye=r(96648);class Ge extends n.Component{constructor(e){super(e),this.handleSubmit=this.handleSubmit.bind(this)}handleSubmit(){const e=[];return this.props.selectedRunIds.forEach((t=>{e.push(this.props.restoreRunApi(t))})),Promise.all(e).catch((e=>{let t="While restoring an experiment run, an error occurred.";e.textJson&&"RESOURCE_LIMIT_EXCEEDED"===e.textJson.error_code&&(t=t+" "+e.textJson.message),this.props.openErrorModal(t)}))}render(){const e=this.props.selectedRunIds.length;return(0,u.tZ)(Ke.s,{isOpen:this.props.isOpen,onClose:this.props.onClose,handleSubmit:this.handleSubmit,title:`Restore Experiment ${s.default.pluralize("Run",e)}`,helpText:`${e} experiment ${s.default.pluralize("run",e)} will be restored.`,confirmButtonText:"Restore"})}}const Je={restoreRunApi:i.Y1,openErrorModal:i.yQ};var Qe=(0,c.$j)(null,Je)(Ge),et=r(33871),tt=r.n(et);const rt=()=>{const e=(0,ne.UO)(),t=(0,ne.TH)(),r=(0,n.useMemo)((()=>decodeURIComponent(t.search)),[t.search]),a=(0,n.useMemo)((()=>{const e=tt().parse(r.substring(1));if(e.experiments){const t=e.experiments;return(null===t||void 0===t?void 0:t.toString())||""}return""}),[r]);return(0,n.useMemo)((()=>{if(null!==e&&void 0!==e&&e.experimentId)return[null===e||void 0===e?void 0:e.experimentId];if(a)try{return JSON.parse(a)}catch{return s.default.logErrorAndNotifyUser(`Could not parse experiment query parameter ${a}`),""}return[]}),[a,null===e||void 0===e?void 0:e.experimentId])},nt=e=>{const{lifecycleFilter:t,datasetsFilter:r,modelVersionFilter:n,searchFilter:a,startTime:i,orderByAsc:s,orderByKey:o}=new it;return{...e,lifecycleFilter:t,datasetsFilter:r,modelVersionFilter:n,searchFilter:a,startTime:i,orderByAsc:s,orderByKey:o}},at=e=>{const{lifecycleFilter:t,modelVersionFilter:r,datasetsFilter:n,searchFilter:a,startTime:i}=e;return Boolean(t!==q.FJ||r!==q.oj||0!==n.length||a||i!==q.wi)};class it{constructor(){this.searchFilter="",this.orderByKey=q.gB,this.orderByAsc=q.yG,this.startTime=q.wi,this.lifecycleFilter=q.FJ,this.datasetsFilter=[],this.modelVersionFilter=q.oj,this.selectedColumns=(()=>{const e=[De(q.D5.ATTRIBUTES,q.z.SOURCE),De(q.D5.ATTRIBUTES,q.z.MODELS)];return(0,Se.GW)()&&e.push(De(q.D5.ATTRIBUTES,q.z.DATASET)),e})(),this.runsExpanded={},this.runsPinned=[],this.runsHidden=[],this.compareRunsMode=void 0,this.compareRunCharts=void 0}}var st=r(96120),ot=r(39270);const lt={ALL:null,LAST_HOUR:36e5,LAST_24_HOURS:864e5,LAST_7_DAYS:6048e5,LAST_30_DAYS:2592e6,LAST_YEAR:31104e6},ct=(e,t,r,n)=>{const a=t.lifecycleFilter===K.VW.ACTIVE?ot.bW.ACTIVE_ONLY:ot.bW.DELETED_ONLY,{runsPinned:i}=t,s=(e=>{let{orderByKey:t,orderByAsc:r}=e;return t?r?[t+" ASC"]:[t+" DESC"]:[]})(t),o=((e,t)=>{let{startTime:r}=e;const n=lt[r];return r&&n&&"ALL"!==r?"attributes.start_time >= "+(t-n):null})(t,r),l=(e=>{let{datasetsFilter:t}=e;return 0===t.length?null:`dataset.name IN (${t.map((e=>`'${e.name}'`)).join(",")}) AND dataset.digest IN (${t.map((e=>`'${e.digest}'`)).join(",")})`})(t),c=((e,t,r)=>{let{searchFilter:n}=e;const a=[];if(n&&a.push(n),t&&a.push(t),r&&a.push(r),0!==a.length)return a.join(" and ")})(t,o,l),d=(e=>{let{orderByKey:t,searchFilter:r}=e;return!t&&!r||t===q.XZ.DATE})(t);return{experimentIds:e,filter:c,runViewType:a,orderBy:s,shouldFetchParents:d,pageToken:n,runsPinned:i}};var dt=r(77616),ut=r(71186);const pt=e=>(0,o.isArray)(e)?e.join():e,mt={searchFilter:{deserializeLocalStorage:pt,deserializeQueryString:pt},datasetsFilter:{serializeQueryString(e){const t=e.map((e=>{let{name:t,digest:r,context:n}=e;return{name:t,digest:r,context:n}}));return(0,ut.g4)(JSON.stringify(t))},deserializeQueryString(e){try{const t=JSON.parse((0,ut.DL)(e));return Array.isArray(t)?t:[]}catch{return[]}}},compareRunCharts:{serializeQueryString(e){return(0,ut.g4)(JSON.stringify(e))},deserializeQueryString(e){try{const t=JSON.parse((0,ut.DL)(e));if(!Array.isArray(t))return;return t}catch{return}}},compareRunsMode:{serializeLocalStorage(){}}},ht=e=>{const t={...e};for(const n of Object.keys(t)){var r;const e=null===(r=mt[n])||void 0===r?void 0:r.serializeQueryString;e&&(t[n]=e(t[n]))}return t},gt=e=>{const t={...e};for(const n of Object.keys(t)){var r;const e=null===(r=mt[n])||void 0===r?void 0:r.serializeLocalStorage;e&&(t[n]=e(t[n]))}return t},ft=Object.keys(new it),vt=(e,t,r,n)=>{if("value"===n){if("true"===e)return!0;if("false"===e)return!1;if(void 0===e)return""}return t(e)},yt=(e,t)=>Object.assign(new it,{...e,...t});function bt(e,t){const r=dt.Z.getStoreForComponent("ExperimentPage",t),n=gt(e);r.saveComponentState(n)}function xt(e){const t=ht(e);return tt().stringify(t,{addQueryPrefix:!0,arrayFormat:"comma",encodeValuesOnly:!0})}function Ct(e,t){let r=new it;try{const e=dt.Z.getStoreForComponent("ExperimentPage",t).loadComponentState();if((!(n=e).runsExpanded||(0,o.isObject)(n.runsExpanded))&&(!n.selectedColumns||(0,o.isArray)(n.selectedColumns))){const t=(e=>{const t={...e};for(const n of Object.keys(t)){var r;const e=null===(r=mt[n])||void 0===r?void 0:r.deserializeLocalStorage;e&&(t[n]=e(t[n]))}return t})(e);r=yt(r,t)}}catch{s.default.logErrorAndNotifyUser(`Error: malformed persisted search state for experiment(s) ${t}`)}var n;const a=decodeURIComponent(e),i=tt().parse(a,{ignoreQueryPrefix:!0,comma:!0,arrayLimit:500,decoder:vt}),{restData:l,stateData:c}=function(e){const t={},r={};for(const n in e)if(e.hasOwnProperty(n)){const a=ft.includes(n);Object.assign(a?t:r,{[n]:e[n]})}return{stateData:t,restData:r}}(i),d=(e=>{const t={...e};for(const n of Object.keys(t)){var r;const e=null===(r=mt[n])||void 0===r?void 0:r.deserializeQueryString;e&&(t[n]=e(t[n]))}return t})(c);if(!(Object.keys(d).length<1)){const e=Object.assign(new it,d);r=yt(r,e)}return bt(r,t),{state:r,queryString:xt({...l,...r})}}const Zt=(0,n.createContext)(null),wt=e=>{let{children:t,actions:r}=e;const a=(0,ne.s0)(),i=rt(),c=d(),p=(0,ne.TH)(),[m,h]=(0,n.useState)(""),[g,f]=(0,n.useState)(!1),[v,y]=(0,n.useState)(""),[b,x]=(0,n.useState)(!1),[C,Z]=(0,n.useState)(null),w=(0,n.useMemo)((()=>JSON.stringify(i.sort())),[i]),k=(0,n.useRef)(""),[S,M]=(0,n.useState)(new it),R=(0,n.useRef)([]),E=(0,n.useRef)(""),T=(0,n.useRef)(""),B=(0,n.useRef)(!0),I=(0,n.useCallback)((()=>B.current),[]),A=(0,n.useCallback)((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),a=arguments.length>3?arguments[3]:void 0;const i=Boolean(a);i||(T.current=n);const l=(i?r.loadMoreRunsApi:r.searchRunsApi)(ct(t,e,n,a||void 0));f(!0);const d=c(l).then((e=>{const{value:t}=e;return E.current=t.next_page_token,x(Boolean(t.next_page_token)),((e,t,r)=>{const n=e.filter((e=>e.data.tags.some((e=>e.key===ge.vf))));(0,o.chunk)(n,st.mc).forEach((e=>{const n=t({run_id:e.map((e=>e.info.run_id))});r(n)}))})(t.runs||[],r.searchModelVersionsApi,c),R.current.some((e=>e.id===l.meta.id&&!e.active))&&f(!1),t.runs||[]})).catch((e=>{s.default.logErrorAndNotifyUser(e,0),f(!1)}));return h(l.meta.id),d}),[c,r]),L=(0,n.useCallback)((()=>A(S,i,T.current||void 0,E.current||void 0)),[A,S,i]),D=(0,n.useCallback)((()=>{A(S,i)}),[i,A,S]),N=(0,n.useCallback)(((e,t)=>{const r=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const n=tt().parse(r,{ignoreQueryPrefix:!0,comma:!0,arrayLimit:500,decoder:vt}),{experiments:a}=n;return bt(e,t),xt({experiments:a,...e})}(e,w,p.search);k.current=r,p.search!==r&&a(`${p.pathname}${r}`,{replace:t})}),[a,p,w]),P=(0,n.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{forceRefresh:r=!1,preservePristine:n=!1,replaceHistory:a=!1}=t;M((t=>{const n=(0,o.isFunction)(e)?e(t):{...t,...e};var s,l;return!r&&(s=t,l=n,(0,o.isEqual)(s.searchFilter,l.searchFilter)&&(0,o.isEqual)(s.orderByAsc,l.orderByAsc)&&(0,o.isEqual)(s.orderByKey,l.orderByKey)&&(0,o.isEqual)(s.lifecycleFilter,l.lifecycleFilter)&&(0,o.isEqual)(s.startTime,l.startTime)&&(0,o.isEqual)(s.datasetsFilter,l.datasetsFilter))||A(n,i),N(n,a),n})),n||(B.current=!1)}),[i,A,N]),H=(0,n.useCallback)((()=>P({},{forceRefresh:!0,preservePristine:!0})),[P]);(0,n.useEffect)((()=>{if(p.search&&k.current===p.search)return;const{state:e}=Ct(p.search,w);P(e,{replaceHistory:!0,forceRefresh:!0,preservePristine:!0})}),[p.search,P,w]);const O=(0,n.useMemo)((()=>({actions:r,searchFacetsState:S,fetchExperimentRuns:D,updateSearchFacets:P,loadMoreRuns:L,requestError:C,isLoadingRuns:g,moreRunsAvailable:b,isPristine:I,refreshRuns:H})),[r,S,D,L,C,g,P,b,I,H]);return(0,u.tZ)(Zt.Provider,{value:O,children:(0,u.tZ)(l.ZP,{shouldOptimisticallyRender:!0,requestIds:m?[m]:[],children:(e,r,n)=>(R.current=n,n.forEach((e=>{Z(e.error)})),t)})})},kt=()=>{const e=(0,n.useContext)(Zt);if(!e)throw new Error("Trying to use SearchExperimentRunsContext actions outside of the context!");return e},St=e=>{let{showDeleteRunModal:t,showRestoreRunModal:r,showRenameRunModal:a,runsSelected:i,onCloseDeleteRunModal:s,onCloseRestoreRunModal:o,onCloseRenameRunModal:l,renamedRunName:c}=e;const{updateSearchFacets:d}=kt(),p=Object.entries(i).filter((e=>{let[,t]=e;return t})).map((e=>{let[t]=e;return t})),m=(0,n.useCallback)((()=>d({},{forceRefresh:!0,preservePristine:!0})),[d]);return(0,u.BX)(u.HY,{children:[(0,u.tZ)(qe,{isOpen:t,onClose:s,selectedRunIds:p}),(0,u.tZ)(Qe,{isOpen:r,onClose:o,selectedRunIds:p}),(0,u.tZ)(Ye.UQ,{runUuid:p[0],onClose:l,runName:c,isOpen:a,onSuccess:()=>m()})]})},Mt=e=>{let{children:t}=e;return(0,u.tZ)(u.HY,{children:t})},Rt=n.memo((e=>{let{viewState:t,runsData:r,searchFacetsState:a}=e;const{runsSelected:i}=t,{runInfos:s}=r,{lifecycleFilter:o}=a,l=(0,ne.s0)(),[c,d]=(0,n.useState)(!1),[p,m]=(0,n.useState)(!1),[h,g]=(0,n.useState)(!1),[f,v]=(0,n.useState)(""),y=(0,n.useCallback)((()=>{const e=Object.keys(i),t=s.find((t=>t.run_uuid===e[0]));t&&(v(t.run_name),g(!0))}),[s,i]),x=(0,n.useCallback)((()=>{const e=Object.keys(i),t=s.filter((t=>{let{run_uuid:r}=t;return e.includes(r)})).map((e=>{let{experiment_id:t}=e;return t}));l(ae.Z.getCompareRunPageRoute(e,[...new Set(t)].sort()))}),[l,s,i]),Z=(0,n.useCallback)((()=>d(!0)),[]),w=(0,n.useCallback)((()=>m(!0)),[]),k=(0,n.useCallback)((()=>d(!1)),[]),S=(0,n.useCallback)((()=>m(!1)),[]),M=(0,n.useCallback)((()=>g(!1)),[]),R=Object.values(t.runsSelected).filter(Boolean).length,E=R>0,T=1===R,B=R>1;return(0,u.BX)(u.HY,{children:[(0,u.BX)("div",{css:Et.controlBar,children:[(0,u.tZ)(b.B,{"data-testid":"run-rename-button",onClick:y,disabled:!T,children:(0,u.tZ)(C.Z,{id:"oWPgX7",defaultMessage:"Rename"})}),o===q.VW.ACTIVE?(0,u.tZ)(b.B,{"data-testid":"runs-delete-button",disabled:!E,onClick:Z,danger:!0,children:(0,u.tZ)(C.Z,{id:"3Rb4sG",defaultMessage:"Delete"})}):null,o===q.VW.DELETED?(0,u.tZ)(b.B,{"data-testid":"runs-restore-button",disabled:!E,onClick:w,children:(0,u.tZ)(C.Z,{id:"Potju2",defaultMessage:"Restore"})}):null,(0,u.tZ)("div",{css:Et.buttonSeparator}),(0,u.tZ)(Mt,{children:(0,u.tZ)(b.B,{"data-testid":"runs-compare-button",disabled:!B,onClick:x,children:(0,u.tZ)(C.Z,{id:"RaGnOQ",defaultMessage:"Compare"})})})]}),(0,u.tZ)(St,{runsSelected:i,onCloseRenameRunModal:M,onCloseDeleteRunModal:k,onCloseRestoreRunModal:S,showDeleteRunModal:c,showRestoreRunModal:p,showRenameRunModal:h,renamedRunName:f})]})})),Et={buttonSeparator:e=>({borderLeft:`1px solid ${e.colors.border}`,marginLeft:e.spacing.xs,marginRight:e.spacing.xs,height:"100%"}),controlBar:e=>({display:"flex",gap:e.spacing.sm,alignItems:"center"})},Tt=n.forwardRef(((e,t)=>{const{pressed:r,onClick:n,icon:a,onBlur:i,onFocus:s,onMouseEnter:o,onMouseLeave:l}=e,{theme:c}=(0,b.u)();return(0,u.tZ)("button",{onClick:n,css:(0,v.iv)({cursor:"pointer",width:c.general.heightSm,height:c.general.heightSm,borderRadius:c.borders.borderRadiusMd,lineHeight:c.typography.lineHeightBase,padding:0,border:0,display:"flex",alignItems:"center",justifyContent:"center",background:r?c.colors.actionDefaultBackgroundPress:"transparent",color:r?c.colors.actionDefaultTextPress:c.colors.textSecondary,"&:hover":{background:c.colors.actionDefaultBackgroundHover,color:c.colors.actionDefaultTextHover}},""),ref:t,onBlur:i,onFocus:s,onMouseEnter:o,onMouseLeave:l,children:a})}));var Bt=r(4942),It=r(71002),At=r(87462),Lt=r(3017),Dt=r(55819),Nt=r.n(Dt),Pt=r(47337),Ht=r(75356),Ot=r(29439);function Xt(e){var t,r=e.prefixCls,a=e.value,i=e.current,s=e.offset,o=void 0===s?0:s;return o&&(t={position:"absolute",top:"".concat(o,"00%"),left:0}),n.createElement("span",{style:t,className:Nt()("".concat(r,"-only-unit"),{current:i})},a)}function zt(e,t,r){for(var n=e,a=0;(n+10)%10!==t;)n+=r,a+=r;return a}function Ut(e){var t,r,a=e.prefixCls,i=e.count,s=e.value,o=Number(s),l=Math.abs(i),c=n.useState(o),d=(0,Ot.Z)(c,2),u=d[0],p=d[1],m=n.useState(l),h=(0,Ot.Z)(m,2),g=h[0],f=h[1],v=function(){p(o),f(l)};if(n.useEffect((function(){var e=setTimeout((function(){v()}),1e3);return function(){clearTimeout(e)}}),[o]),u===o||Number.isNaN(o)||Number.isNaN(u))t=[n.createElement(Xt,(0,At.Z)({},e,{key:o,current:!0}))],r={transition:"none"};else{t=[];for(var y=o+10,b=[],x=o;x<=y;x+=1)b.push(x);var C=b.findIndex((function(e){return e%10===u}));t=b.map((function(t,r){var a=t%10;return n.createElement(Xt,(0,At.Z)({},e,{key:t,value:a,offset:r-C,current:r===C}))})),r={transform:"translateY(".concat(-zt(u,o,g<l?1:-1),"00%)")}}return n.createElement("span",{className:"".concat(a,"-only"),style:r,onTransitionEnd:v},t)}var Vt=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r},_t=function(e){var t=e.prefixCls,r=e.count,a=e.className,i=e.motionClassName,s=e.style,o=e.title,l=e.show,c=e.component,d=void 0===c?"sup":c,u=e.children,p=Vt(e,["prefixCls","count","className","motionClassName","style","title","show","component","children"]),m=(0,n.useContext(Pt.E_).getPrefixCls)("scroll-number",t),h=(0,At.Z)((0,At.Z)({},p),{"data-show":l,style:s,className:Nt()(m,a,i),title:o}),g=r;if(r&&Number(r)%1===0){var f=String(r).split("");g=f.map((function(e,t){return n.createElement(Ut,{prefixCls:m,count:Number(r),value:e,key:f.length-t})}))}return s&&s.borderColor&&(h.style=(0,At.Z)((0,At.Z)({},s),{boxShadow:"0 0 0 1px ".concat(s.borderColor," inset")})),u?(0,Ht.Tm)(u,(function(e){return{className:Nt()("".concat(m,"-custom-component"),null===e||void 0===e?void 0:e.className,i)}})):n.createElement(d,h,g)},Wt=r(22446);function Ft(e){return-1!==Wt.Y.indexOf(e)}var Kt=function(e){var t,r=e.className,a=e.prefixCls,i=e.style,s=e.color,o=e.children,l=e.text,c=e.placement,d=void 0===c?"end":c,u=n.useContext(Pt.E_),p=u.getPrefixCls,m=u.direction,h=p("ribbon",a),g=Ft(s),f=Nt()(h,"".concat(h,"-placement-").concat(d),(t={},(0,Bt.Z)(t,"".concat(h,"-rtl"),"rtl"===m),(0,Bt.Z)(t,"".concat(h,"-color-").concat(s),g),t),r),v={},y={};return s&&!g&&(v.background=s,y.color=s),n.createElement("div",{className:"".concat(h,"-wrapper")},o,n.createElement("div",{className:f,style:(0,At.Z)((0,At.Z)({},v),i)},n.createElement("span",{className:"".concat(h,"-text")},l),n.createElement("div",{className:"".concat(h,"-corner"),style:y})))},jt=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r},$t=function(e){var t,r,a=e.prefixCls,i=e.scrollNumberPrefixCls,s=e.children,o=e.status,l=e.text,c=e.color,d=e.count,u=void 0===d?null:d,p=e.overflowCount,m=void 0===p?99:p,h=e.dot,g=void 0!==h&&h,f=e.size,v=void 0===f?"default":f,y=e.title,b=e.offset,x=e.style,C=e.className,Z=e.showZero,w=void 0!==Z&&Z,k=jt(e,["prefixCls","scrollNumberPrefixCls","children","status","text","color","count","overflowCount","dot","size","title","offset","style","className","showZero"]),S=n.useContext(Pt.E_),M=S.getPrefixCls,R=S.direction,E=M("badge",a),T=u>m?"".concat(m,"+"):u,B=null!==o&&void 0!==o||null!==c&&void 0!==c,I="0"===T||0===T,A=g&&!I||B,L=A?"":T,D=(0,n.useMemo)((function(){return(null===L||void 0===L||""===L||I&&!w)&&!A}),[L,I,w,A]),N=(0,n.useRef)(u);D||(N.current=u);var P=N.current,H=(0,n.useRef)(L);D||(H.current=L);var O=H.current,X=(0,n.useRef)(A);D||(X.current=A);var z=(0,n.useMemo)((function(){if(!b)return(0,At.Z)({},x);var e={marginTop:b[1]};return"rtl"===R?e.left=parseInt(b[0],10):e.right=-parseInt(b[0],10),(0,At.Z)((0,At.Z)({},e),x)}),[R,b,x]),U=null!==y&&void 0!==y?y:"string"===typeof P||"number"===typeof P?P:void 0,V=D||!l?null:n.createElement("span",{className:"".concat(E,"-status-text")},l),_=P&&"object"===(0,It.Z)(P)?(0,Ht.Tm)(P,(function(e){return{style:(0,At.Z)((0,At.Z)({},z),e.style)}})):void 0,W=Nt()((t={},(0,Bt.Z)(t,"".concat(E,"-status-dot"),B),(0,Bt.Z)(t,"".concat(E,"-status-").concat(o),!!o),(0,Bt.Z)(t,"".concat(E,"-status-").concat(c),Ft(c)),t)),F={};c&&!Ft(c)&&(F.background=c);var K=Nt()(E,(r={},(0,Bt.Z)(r,"".concat(E,"-status"),B),(0,Bt.Z)(r,"".concat(E,"-not-a-wrapper"),!s),(0,Bt.Z)(r,"".concat(E,"-rtl"),"rtl"===R),r),C);if(!s&&B){var j=z.color;return n.createElement("span",(0,At.Z)({},k,{className:K,style:z}),n.createElement("span",{className:W,style:F}),n.createElement("span",{style:{color:j},className:"".concat(E,"-status-text")},l))}return n.createElement("span",(0,At.Z)({},k,{className:K}),s,n.createElement(Lt.Z,{visible:!D,motionName:"".concat(E,"-zoom"),motionAppear:!1},(function(e){var t,r=e.className,a=M("scroll-number",i),s=X.current,l=Nt()((t={},(0,Bt.Z)(t,"".concat(E,"-dot"),s),(0,Bt.Z)(t,"".concat(E,"-count"),!s),(0,Bt.Z)(t,"".concat(E,"-count-sm"),"small"===v),(0,Bt.Z)(t,"".concat(E,"-multiple-words"),!s&&O&&O.toString().length>1),(0,Bt.Z)(t,"".concat(E,"-status-").concat(o),!!o),(0,Bt.Z)(t,"".concat(E,"-status-").concat(c),Ft(c)),t)),d=(0,At.Z)({},z);return c&&!Ft(c)&&((d=d||{}).background=c),n.createElement(_t,{prefixCls:a,show:!D,motionClassName:r,className:l,count:O,title:U,style:d,key:"scrollNumber"},_)})),V)};$t.Ribbon=Kt;var qt=$t;const Yt=n.memo((e=>{let{runInfos:t}=e;const{actions:{searchRunsPayload:r},updateSearchFacets:a}=kt(),i=rt(),[s,o]=(0,n.useState)(0),[l,c]=(0,n.useState)(0),d=(0,n.useCallback)((()=>a({},{forceRefresh:!0,preservePristine:!0})),[a]);return(0,n.useEffect)((()=>{c(0),o((()=>Date.now()))}),[t]),(0,n.useEffect)((()=>{if(!s)return;const e=setInterval((()=>{const e={experimentIds:i,filter:`attributes.start_time > ${s}`,maxResults:q.mz};r(e).then((e=>{var t;const r=(null===(t=e.runs)||void 0===t?void 0:t.length)||0;c(r)}))}),q.FK);return()=>clearInterval(e)}),[s,r,i]),(0,u.tZ)(qt,{count:l,offset:[-5,5],css:Gt.pill,overflowCount:q.mz-1,children:(0,u.tZ)(b.T,{title:(0,u.tZ)(C.Z,{id:"ag05Pe",defaultMessage:"Refresh"}),children:(0,u.tZ)(b.B,{onClick:d,"data-testid":"runs-refresh-button",icon:(0,u.tZ)(h.bnu,{})})})})})),Gt={pill:e=>({sup:{backgroundColor:e.colors.lime,zIndex:1}})},Jt=(0,c.$j)((e=>({runInfos:e.entities.runInfosByUuid})),void 0,void 0,{areStatesEqual:(e,t)=>e.entities.runInfosByUuid===t.entities.runInfosByUuid})(Yt),Qt=e=>(0,n.useMemo)((()=>dt.Z.getStoreForComponent("ExperimentView",e)),[e]),er=()=>(0,u.BX)("div",{className:"search-input-tooltip-content",children:[(0,u.tZ)(C.Z,{id:"kIlkgf",defaultMessage:"Search runs using a simplified version of the SQL {whereBold} clause.",values:{whereBold:(0,u.tZ)("b",{children:"WHERE"})}})," ",(0,u.tZ)(C.Z,{id:"nYKZy4",defaultMessage:"<link>Learn more</link>",values:{link:e=>(0,u.tZ)("a",{href:g.Kp,target:"_blank",rel:"noopener noreferrer",children:e})}}),(0,u.tZ)("br",{}),(0,u.tZ)(C.Z,{id:"U3btBc",defaultMessage:"Examples:"}),(0,u.tZ)("br",{}),"\u2022 metrics.rmse >= 0.8",(0,u.tZ)("br",{}),"\u2022 metrics.`f1 score` < 1",(0,u.tZ)("br",{}),"\u2022 params.model = 'tree'",(0,u.tZ)("br",{}),"\u2022 attributes.run_name = 'my run'",(0,u.tZ)("br",{}),"\u2022 tags.`mlflow.user` = 'myUser'",(0,u.tZ)("br",{}),"\u2022 metric.f1_score > 0.9 AND params.model = 'tree'",(0,u.tZ)("br",{}),"\u2022 dataset.name IN ('dataset1', 'dataset2')",(0,u.tZ)("br",{}),"\u2022 attributes.run_id IN ('a1b2c3d4', 'e5f6g7h8')",(0,u.tZ)("br",{}),"\u2022 tags.model_class LIKE 'sklearn.linear_model%'"]});const tr=["run_id","run_name","status","artifact_uri","user_id","start_time","end_time","created"].map((e=>({value:`attributes.${e}`})));var rr={name:"lugakg",styles:"font-weight:normal"};const nr=(e,t)=>{const r=e.split(RegExp(t.replace(".","\\."),"ig")),n=e.match(RegExp(t.replace(".","\\."),"ig"));return(0,u.tZ)("span",{css:rr,"data-test-id":e,children:r.map(((e,t)=>(0,u.BX)(u.HY,{children:[e,t!==r.length-1&&n&&(0,u.tZ)("b",{children:n[t]})]})))})};const ar="tooltipLastPopup";var ir={name:"1ua1wyk",styles:"width:560px"};const sr=e=>{const{runsData:t,searchFacetsState:r,updateSearchFacets:a,requestError:i}=e,[s,l]=(0,n.useState)(""),[c,d]=(0,n.useState)(void 0),[p,m]=(0,n.useState)(!1),[g,f]=(0,n.useState)(!1),v=(0,n.useRef)({metricNames:[],paramNames:[],tagNames:[]}),[y,x]=(0,n.useState)({Metrics:10,Parameters:10,Tags:10}),C=(0,n.useRef)([]),[Z,w]=(0,n.useState)(void 0);(0,n.useEffect)((()=>{l(r.searchFilter)}),[r]);const k=(0,n.useMemo)((()=>{const e=v.current,r=((e,t)=>{const r=(e,t)=>[...new Set([...e,...t])],n=e=>e.flatMap((e=>Object.keys(e)));return{metricNames:r(t.metricNames,e.metricKeyList),paramNames:r(t.paramNames,e.paramKeyList),tagNames:r(n(t.tagNames),n(e.tagsList)).filter((e=>!e.startsWith("mlflow."))).map((e=>e.includes('"')||e.includes(" ")||e.includes(".")?`\`${e}\``:e.includes("`")?`"${e}"`:e))}})(t,e);return v.current=r,[{label:"Metrics",options:(n=r).metricNames.map((e=>({value:`metrics.${e}`})))},{label:"Parameters",options:n.paramNames.map((e=>({value:`params.${e}`})))},{label:"Tags",options:n.tagNames.map((e=>({value:`tags.${e}`})))},{label:"Attributes",options:tr}];var n}),[t]);(0,n.useEffect)((()=>{const e=C.current,t=(e=>{const t=/>|<|>=|<=|=|!=|like|ilike/gi,r=(e=>{const t=/and[\s]+/gi,r=[];let n,a;for(;a=t.lastIndex,n=t.exec(e);)r.push({clause:e.substring(a,n.index),startIndex:a});return r.push({clause:e.substring(a),startIndex:a}),r})(e),n=[];return r.forEach((e=>{const r=e.clause.split(t)[0],{startIndex:a}=e;n.push({name:r,startIndex:0+a,endIndex:r.length+a})})),n})(s);if(C.current=t,g)return void f(!1);const r=t.map((e=>e.name)),n=e.map((e=>e.name));if(!(0,o.isEqual)(r,n)&&t.length>=e.length){let r=0;for(;r<t.length;){if(r>=e.length||t[r].name.trim()!==e[r].name.trim())return d(!0),void w(t[r]);r++}}d(!1)}),[s]);const S=(0,n.useMemo)((()=>Z?((e,t,r)=>e.map((e=>{const n=e.options.filter((e=>e.value.toLowerCase().includes(t.name.toLowerCase().trim()))).map((e=>({value:e.value,label:nr(e.value,t.name.trim())}))),a=r[e.label],i=[...n.slice(0,a),...n.length>a?[{label:"...",value:`..._${e.label}`}]:[]];return{label:e.label,options:i}})).filter((e=>e.options.length>0)))(k,Z,y):[]),[k,Z,y]),M=(0,n.useCallback)(((e,t)=>{if(Z)if(e.startsWith("...")){d(!0);const e=t.value.split("_")[1];x((t=>({...t,[e]:t[e]+10})))}else{const t=s.substring(0,Z.startIndex),r=s.substring(Z.endIndex);l(t+e+" "+r),f(!0),d(!1)}}),[s,l,Z,d]),R=(0,n.useCallback)((()=>{a(nt)}),[a]),E=Qt(ar),[T,B]=(0,n.useState)((()=>{const e=Math.floor(Date.now()/1e3),t=E.getItem(ar);return!t||parseInt(t,10)<e-604800})),I=n.useRef(null);(0,n.useEffect)((()=>{if(i&&T){var e;const t=Math.floor(Date.now()/1e3);E.setItem(ar,t),B(!1),null===(e=I.current)||void 0===e||e.click()}}),[i]);const A=0===S.flatMap((e=>e.options)).length,L=c&&p&&!A,D=(0,n.useCallback)((e=>{"Enter"===e.key&&(L?d(!1):a({searchFilter:s})),"Escape"===e.key&&(e.preventDefault(),L&&d(!1))}),[L,s,a]);return(0,u.tZ)("div",{css:or.searchBox,children:(0,u.tZ)(h.QcG,{dropdownMatchSelectWidth:560,css:ir,defaultOpen:!1,defaultActiveFirstOption:!0,open:L,options:S,onSelect:M,value:s,"data-test-id":"runs-search-autocomplete",dropdownRender:e=>(0,u.tZ)("div",{css:or.dropdownOverride,children:e}),children:(0,u.tZ)(b.e,{value:s,prefix:(0,u.tZ)(h.W1M,{css:or.searchBarIcon}),onKeyDown:D,onClick:()=>m(!0),onBlur:()=>m(!1),onChange:e=>l(e.target.value),placeholder:'metrics.rmse < 1 and params.model = "tree"',"data-test-id":"search-box",suffix:(0,u.BX)("div",{css:or.searchInputSuffix,children:[s&&(0,u.tZ)(b.B,{onClick:R,type:"link","data-test-id":"clear-button",children:(0,u.tZ)(b.C,{})}),(0,u.tZ)(b.T,{title:(0,u.tZ)(er,{}),placement:"right",dangerouslySetAntdProps:{overlayInnerStyle:{width:"150%"},trigger:"click"},children:(0,u.tZ)("div",{ref:I,children:(0,u.tZ)(b.d,{css:or.searchBarIcon})})})]})})})})},or={searchBox:e=>({display:"flex",gap:e.spacing.sm,width:430}),searchBarIcon:e=>({svg:{width:16,height:16,color:e.colors.textSecondary}}),searchInputSuffix:{display:"flex",gap:4,alignItems:"center"},dropdownOverride:{".du-bois-light-select-item-option-active:not(.du-bois-light-select-item-option-disabled)":{backgroundColor:"#e6f1f5"}}},lr=(e,t)=>e.digest===t.digest&&e.name===t.name&&e.context===t.context;var cr=r(54048),dr=r(94837),ur=r.n(dr),pr=(0,cr.Z)(ur(),{});pr.registerLanguage=function(e,t){return ur().register(t)};var mr=pr,hr=r(9319);var gr={'code[class*="language-"]':{fontFamily:'Consolas, Menlo, Monaco, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", "Courier New", Courier, monospace',fontSize:"14px",lineHeight:"1.375",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",background:"#2a2734",color:"#5DFAFC"},'pre[class*="language-"]':{fontFamily:'Consolas, Menlo, Monaco, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", "Courier New", Courier, monospace',fontSize:"14px",lineHeight:"1.375",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",background:"#2a2734",color:"#5DFAFC",padding:"1em",margin:".5em 0",overflow:"auto"},'pre > code[class*="language-"]':{fontSize:"1em"},'pre[class*="language-"]::-moz-selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"] ::-moz-selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"]::-moz-selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"] ::-moz-selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"]::selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"] ::selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"]::selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"] ::selection':{textShadow:"none",background:"#6a51e6"},':not(pre) > code[class*="language-"]':{padding:".1em",borderRadius:".3em"},comment:{color:"#6c6783"},prolog:{color:"#6c6783"},doctype:{color:"#6c6783"},cdata:{color:"#6c6783"},punctuation:{color:"#6c6783"},namespace:{Opacity:".7"},tag:{color:"#3AACE2"},operator:{color:"#3AACE2"},number:{color:"#3AACE2"},property:{color:"#5DFAFC"},function:{color:"#5DFAFC"},"tag-id":{color:"#eeebff"},selector:{color:"#eeebff"},"atrule-id":{color:"#eeebff"},"code.language-javascript":{color:"#c4b9fe"},"attr-name":{color:"#c4b9fe"},"code.language-css":{color:"#ffffff"},"code.language-scss":{color:"#ffffff"},boolean:{color:"#ffffff"},string:{color:"#ffffff"},entity:{color:"#ffffff",cursor:"help"},url:{color:"#ffffff"},".language-css .token.string":{color:"#ffffff"},".language-scss .token.string":{color:"#ffffff"},".style .token.string":{color:"#ffffff"},"attr-value":{color:"#ffffff"},keyword:{color:"#ffffff"},control:{color:"#ffffff"},directive:{color:"#ffffff"},unit:{color:"#ffffff"},statement:{color:"#ffffff"},regex:{color:"#ffffff"},atrule:{color:"#ffffff"},placeholder:{color:"#ffffff"},variable:{color:"#ffffff"},deleted:{textDecoration:"line-through"},inserted:{borderBottom:"1px dotted #eeebff",textDecoration:"none"},italic:{fontStyle:"italic"},important:{fontWeight:"bold",color:"#c4b9fe"},bold:{fontWeight:"bold"},"pre > code.highlight":{Outline:".4em solid #8a75f5",OutlineOffset:".4em"},".line-numbers.line-numbers .line-numbers-rows":{borderRightColor:"#2c2937"},".line-numbers .line-numbers-rows > span:before":{color:"#3c3949"},".line-highlight.line-highlight":{background:"linear-gradient(to right, rgba(224, 145, 66, 0.2) 70%, rgba(224, 145, 66, 0))"}};var fr={'code[class*="language-"]':{textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",color:"rgb(77, 77, 76)",background:"#fafafa",fontFamily:"Monaco, Menlo, Ubuntu Mono, Consolas, source-code-pro, monospace",fontSize:"12px",lineHeight:"1.5em",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none"},'pre[class*="language-"]':{textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",color:"rgb(77, 77, 76)",background:"#fafafa",fontFamily:"Monaco, Menlo, Ubuntu Mono, Consolas, source-code-pro, monospace",fontSize:"12px",lineHeight:"1.5em",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",overflow:"auto",position:"relative",margin:"0.5em 0",padding:"1.25em 1em"},'code[class*="language-"]::-moz-selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"]::-moz-selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"] ::-moz-selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"] ::-moz-selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"]::selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"]::selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"] ::selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"] ::selection':{background:"#cceae7",color:"#263238"},':not(pre) > code[class*="language-"]':{whiteSpace:"normal",borderRadius:"0.2em",padding:"0.1em"},".language-css > code":{color:"#f5871f"},".language-sass > code":{color:"#f5871f"},".language-scss > code":{color:"#f5871f"},'[class*="language-"] .namespace':{Opacity:"0.7"},atrule:{color:"#7c4dff"},"attr-name":{color:"#39adb5"},"attr-value":{color:"#f6a434"},attribute:{color:"#f6a434"},boolean:{color:"#7c4dff"},builtin:{color:"#39adb5"},cdata:{color:"#39adb5"},char:{color:"#39adb5"},class:{color:"#39adb5"},"class-name":{color:"#6182b8"},comment:{color:"#8e908c"},constant:{color:"#7c4dff"},deleted:{color:"#e53935"},doctype:{color:"#aabfc9"},entity:{color:"#e53935"},function:{color:"#4271ae"},hexcode:{color:"#f5871f"},id:{color:"#7c4dff",fontWeight:"bold"},important:{color:"#7c4dff",fontWeight:"bold"},inserted:{color:"#39adb5"},keyword:{color:"#8959a8"},number:{color:"#f5871f"},operator:{color:"#3e999f"},prolog:{color:"#aabfc9"},property:{color:"#39adb5"},"pseudo-class":{color:"#f6a434"},"pseudo-element":{color:"#f6a434"},punctuation:{color:"rgb(77, 77, 76)"},regex:{color:"#6182b8"},selector:{color:"#e53935"},string:{color:"#3ba85f"},symbol:{color:"#7c4dff"},tag:{color:"#e53935"},unit:{color:"#f5871f"},url:{color:"#e53935"},variable:{color:"#c72d4c"}};mr.registerLanguage("python",hr.Z);const vr={light:fr,duotoneDark:gr};function yr(e){let{theme:t="light",language:r,actions:n,style:a,children:i,showLineNumbers:s,lineNumberStyle:l}=e;const c={border:"none",borderRadius:0,margin:0,padding:"24px",...a};return(0,u.tZ)(u.HY,{children:(0,u.tZ)(mr,{showLineNumbers:s,lineNumberStyle:l,language:r,style:vr[t],customStyle:c,codeTagProps:{style:(0,o.pick)(a,"backgroundColor")},children:i})})}var br={name:"1voqbl3",styles:"margin-top:0;font-weight:normal"};const xr=e=>{let{isOpen:t,closeModal:r,experimentId:n}=e;const{theme:a}=(0,b.u)(),i=`\n  import mlflow \n  from sklearn.model_selection import train_test_split \n  from sklearn.datasets import load_diabetes\n  import RandomForestRegressor \n  \n  # set the experiment id\n  mlflow.set_experiment(experiment_id="${n}")\n  \n  mlflow.autolog() \n  db = load_diabetes() \n  \n  X_train, X_test, y_train, y_test = train_test_split(db.data, db.target) \n  \n  # Create and train models. \n  rf = RandomForestRegressor(n_estimators=100, max_depth=6, max_features=3) \n  rf.fit(X_train, y_train) \n  \n  # Use the model to make predictions on the test dataset. \n  predictions = rf.predict(X_test)\n  `,s=`\n  import mlflow\n  import openai\n  \n  # you must set the OPENAI_API_KEY environment variable\n  assert "OPENAI_API_KEY" in os.environ, "Please set the OPENAI_API_KEY environment variable."\n  \n  # set the experiment id\n  mlflow.set_experiment(experiment_id="${n}")\n  \n  system_prompt = "The following is a conversation with an AI assistant. The assistant is helpful and very friendly."\n  \n  # start a run\n  mlflow.start_run()\n  mlflow.log_param("system_prompt", system_prompt)\n  \n  # Create a question answering model using prompt engineering with OpenAI. Log the model\n  # to MLflow Tracking\n  logged_model = mlflow.openai.log_model(\n      model="gpt-3.5-turbo",\n      task=openai.ChatCompletion,\n      artifact_path="model",\n      messages=[\n          {"role": "system", "content": system_prompt},\n          {"role": "user", "content": "{question}"},\n      ],\n  )\n  \n  # Evaluate the model on some example questions\n  questions = pd.DataFrame(\n      {\n          "question": [\n              "How do you create a run with MLflow?",\n              "How do you log a model with MLflow?",\n              "What is the capital of France?",\n          ]\n      }\n  )\n  mlflow.evaluate(\n      model=logged_model.model_uri,\n      model_type="question-answering",\n      data=questions,\n  )\n  mlflow.end_run()\n  `;return(0,u.tZ)(h.u_l,{verticalSizing:"maxed_out",visible:t,onCancel:r,onOk:r,footer:(0,u.tZ)("div",{css:(0,v.iv)({display:"flex",gap:a.spacing.sm,justifyContent:"flex-end"},""),children:(0,u.tZ)(b.B,{onClick:r,type:"primary",children:(0,u.tZ)(C.Z,{id:"ttyLD4",defaultMessage:"Okay"})})}),title:(0,u.BX)("div",{children:[(0,u.tZ)(b.j.Title,{level:2,css:(0,v.iv)({marginTop:a.spacing.sm,marginBottom:a.spacing.xs},""),children:(0,u.tZ)(C.Z,{id:"iF1UfU",defaultMessage:"New run using notebook"})}),(0,u.tZ)(b.j.Hint,{css:br,children:"Run this code snippet in a notebook or locally, to create an experiment run"})]}),children:(0,u.BX)(h.Tabs,{children:[(0,u.tZ)(h.Jml,{tab:(0,u.tZ)(C.Z,{id:"71dHIO",defaultMessage:"Classical ML"}),children:(0,u.tZ)(yr,{style:{padding:"5px"},language:"python",actions:(0,u.tZ)("div",{style:{marginRight:"8px"},children:(0,u.tZ)(N,{copyText:i,showLabel:!1,icon:(0,u.tZ)(h.TIy,{})})}),children:i})},"classical-ml"),(0,u.tZ)(h.Jml,{tab:(0,u.tZ)(C.Z,{id:"xBVMQz",defaultMessage:"LLM"}),children:(0,u.tZ)(yr,{style:{padding:"5px"},language:"python",actions:(0,u.tZ)("div",{style:{marginRight:"8px"},children:(0,u.tZ)(N,{copyText:s,showLabel:!1,icon:(0,u.tZ)(h.TIy,{})})}),children:s})},"llm")]})})};var Cr=r(42251),Zr=r(12048);const wr=["abundant","able","abrasive","adorable","adaptable","adventurous","aged","agreeable","ambitious","amazing","amusing","angry","auspicious","awesome","bald","beautiful","bemused","bedecked","big","bittersweet","blushing","bold","bouncy","brawny","bright","burly","bustling","calm","capable","carefree","capricious","caring","casual","charming","chill","classy","clean","clumsy","colorful","crawling","dapper","debonair","dashing","defiant","delicate","delightful","dazzling","efficient","enchanting","entertaining","enthused","exultant","fearless","flawless","fortunate","fun","funny","gaudy","gentle","gifted","glamorous","grandiose","gregarious","handsome","hilarious","honorable","illustrious","incongruous","indecisive","industrious","intelligent","inquisitive","intrigued","invincible","judicious","kindly","languid","learned","legendary","likeable","loud","luminous","luxuriant","lyrical","magnificent","marvelous","masked","melodic","merciful","mercurial","monumental","mysterious","nebulous","nervous","nimble","nosy","omniscient","orderly","overjoyed","peaceful","painted","persistent","placid","polite","popular","powerful","puzzled","rambunctious","rare","rebellious","respected","resilient","righteous","receptive","redolent","resilient","rogue","rumbling","salty","sassy","secretive","selective","sedate","serious","shivering","skillful","sincere","skittish","silent","smiling","sneaky","sophisticated","spiffy","stately","suave","stylish","tasteful","thoughtful","thundering","traveling","treasured","trusting","unequaled","upset","unique","unleashed","useful","upbeat","unruly","valuable","vaunted","victorious","welcoming","whimsical","wistful","wise","worried","youthful","zealous"],kr=["ant","ape","asp","auk","bass","bat","bear","bee","bird","boar","bug","calf","carp","cat","chimp","cod","colt","conch","cow","crab","crane","croc","crow","cub","deer","doe","dog","dolphin","donkey","dove","duck","eel","elk","fawn","finch","fish","flea","fly","foal","fowl","fox","frog","gnat","gnu","goat","goose","grouse","grub","gull","hare","hawk","hen","hog","horse","hound","jay","kit","kite","koi","lamb","lark","loon","lynx","mare","midge","mink","mole","moose","moth","mouse","mule","newt","owl","ox","panda","penguin","perch","pig","pug","quail","ram","rat","ray","robin","roo","rook","seal","shad","shark","sheep","shoat","shrew","shrike","shrimp","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sow","sponge","squid","squirrel","stag","steed","stoat","stork","swan","tern","toad","trout","turtle","vole","wasp","whale","wolf","worm","wren","yak","zebra"],Sr=(e,t)=>{const r=Math.floor(Math.random()*wr.length),n=Math.floor(Math.random()*kr.length);return[wr[r],kr[n],Math.floor(Math.random()*10**t)].join(e)};var Mr=r(56401),Rr=r(36329);const Er=[{type:"slider",name:"temperature",string:(0,Rr.Em)({id:"Jrri/Y",defaultMessage:"Temperature"}),helpString:(0,Rr.Em)({id:"5yWkFd",defaultMessage:"Increase or decrease the confidence level of the language model."}),max:1,min:.01,step:.01},{type:"input",name:"max_tokens",string:(0,Rr.Em)({id:"qR3llD",defaultMessage:"Max tokens"}),helpString:(0,Rr.Em)({id:"cEwSR8",defaultMessage:"Maximum number of language tokens returned from evaluation."}),max:65536,min:1,step:1},{type:"list",name:"stop",string:(0,Rr.Em)({id:"FAfPOl",defaultMessage:"Stop Sequences"}),helpString:(0,Rr.Em)({id:"J2XCE/",defaultMessage:"Specify sequences that signal the model to stop generating text."})}],Tr={temperature:.01,max_tokens:100},Br=()=>{const[e,t]=(0,n.useState)(Tr),r=(0,n.useCallback)(((e,r)=>{t((t=>({...t,[e]:r})))}),[]);return{parameterDefinitions:Er,parameters:e,updateParameter:r}};var Ir=r(20402);const Ar=e=>{let{disabled:t=!1,parameters:r,updateParameter:n}=e;const{parameterDefinitions:a}=Br(),{theme:i}=(0,b.u)();return(0,u.tZ)(u.HY,{children:a.map((e=>(0,u.tZ)("div",{css:(0,v.iv)({marginBottom:i.spacing.md},""),children:(0,u.BX)(u.HY,{children:[(0,u.BX)(h.lNd.Label,{htmlFor:e.name,children:[(0,u.tZ)(C.Z,{...e.string}),(0,u.tZ)(b.T,{title:(0,u.tZ)(C.Z,{...e.helpString}),placement:"right",children:(0,u.tZ)(b.d,{css:(0,v.iv)({marginLeft:i.spacing.sm,verticalAlign:"text-top",color:i.colors.textSecondary},"")})})]}),(0,u.tZ)(h.lNd.Hint,{}),"temperature"===e.name&&(0,u.tZ)(Ir.O,{"data-testid":e.name,disabled:t,max:e.max,min:e.min,step:e.step,defaultValue:r[e.name]||0,handleLineSmoothChange:t=>n(e.name,t)}),"input"===e.type&&(0,u.tZ)(b.e,{"data-testid":e.name,type:"number",disabled:t,max:e.max,min:e.min,step:e.step,value:r[e.name]||0,onChange:t=>n(e.name,parseInt(t.target.value,10))}),"list"===e.type&&(0,u.tZ)(h.Select,{allowClear:!0,mode:"tags",style:{width:"100%"},open:!1,disabled:t,onChange:t=>n(e.name,t),value:r[e.name]||[],dangerouslySetAntdProps:{suffixIcon:null}})]})},e.name)))})},Lr=" }}",Dr="new_variable",Nr=(0,Rr.Em)({id:"lM0z8k",defaultMessage:"The following variable names contain spaces which is disallowed: {invalidNames}"}),Pr=e=>{let{violations:t}=e;const{namesWithSpaces:r}=t,{formatMessage:n}=(0,a.Z)();return(0,u.tZ)(u.HY,{children:r.length>0&&(0,u.tZ)(b.j.Text,{color:"warning",size:"sm","aria-label":n(Nr,{invalidNames:r.join(", ")}),children:(0,u.tZ)(C.Z,{...Nr,values:{invalidNames:(0,u.tZ)(u.HY,{children:r.map((e=>(0,u.tZ)("code",{children:e},e)))})}})})})};var Hr=r(52232);const Or=[{prompt:["You are a marketing consultant for a technology company. Develop a marketing strategy report for {{ company_name }} aiming to {{ company_goal }}"],variables:[{name:"company_name",value:"XYZ Company"},{name:"company_goal",value:"Increase top-line revenue"}]},{prompt:['You are a helpful and friendly customer support chatbot. Answer the users question "{{ user_question }}" clearly, based on the following documentation: {{ documentation }}'],variables:[{name:"user_question",value:"Is MLflow open source?"},{name:"documentation",value:"MLflow is an open source platform for managing the end-to-end machine learning lifecycle."}]},{prompt:['Summarize the given text "{{ text }}" into a concise and coherent summary, capturing the main ideas and key points. Make sure that the summary does not exceed {{ word_count }} words.'],variables:[{name:"text",value:"Although C. septempunctata larvae and adults mainly eat aphids, they also feed on Thysanoptera, Aleyrodidae, on the larvae of Psyllidae and Cicadellidae, and on eggs and larvae of some beetles and butterflies. There are one or two generations per year. Adults overwinter in ground litter in parks, gardens and forest edges and under tree bark and rocks. C. septempunctata has a broad ecological range, generally living wherever there are aphids for it to eat. This includes, amongst other biotopes, meadows, fields, Pontic\u2013Caspian steppe, parkland, gardens, Western European broadleaf forests and mixed forests. In the United Kingdom, there are fears that the seven-spot ladybird is being outcompeted for food by the harlequin ladybird. An adult seven-spot ladybird may reach a body length of 7.6\u201312.7 mm (0.3\u20130.5 in). Their distinctive spots and conspicuous colours warn of their toxicity, making them unappealing to predators. The species can secrete a fluid from joints in their legs which gives them a foul taste. A threatened ladybird may both play dead and secrete the unappetising substance to protect itself. The seven-spot ladybird synthesizes the toxic alkaloids, N-oxide coccinelline and its free base precoccinelline; depending on sex and diet, the spot size and coloration can provide some indication of how toxic the individual insect is to potential predators."},{name:"word_count",value:"75"}]},{prompt:["Generate a list of ten titles for my book. The book is about {{ topic }}. Each title should be between {{ word_range }} words long.","### Examples of great titles ###","{{ examples }}"],variables:[{name:"topic",value:"my journey as an adventurer who has lived an unconventional life, meeting many different personalities and finally finding peace in gardening."},{name:"word_range",value:"two to five"},{name:"examples",value:'"Long walk to freedom", "Wishful drinking", "I know why the caged bird sings"'}]},{prompt:["Generate a SQL query from a user\u2019s question, using the information from the table.","Question: {{ user_question }}","Table Information: {{ table_information }}"],variables:[{name:"user_question",value:"Which product generated the most sales this month?"},{name:"table_information",value:"CREATE TABLE Sales (SaleID INT PRIMARY KEY, ProductID INT, SaleDate DATE, CustomerID INT, QuantitySold INT, UnitPrice DECIMAL(10, 2));"}]}],{TextArea:Xr}=b.e,zr=e=>{let{isOpen:t,closeExamples:r,closeModal:n,updatePromptTemplate:a,updateInputVariableValue:i}=e;const{theme:s}=(0,b.u)();return(0,u.tZ)(h.u_l,{verticalSizing:"maxed_out",visible:t,onCancel:n,title:(0,u.tZ)("div",{children:(0,u.BX)(b.j.Title,{level:2,css:(0,v.iv)({marginTop:s.spacing.sm,marginBottom:s.spacing.xs},""),children:[(0,u.tZ)(b.B,{css:(0,v.iv)({marginRight:s.spacing.sm,marginBottom:s.spacing.sm},""),icon:(0,u.tZ)(h.Y4O,{}),onClick:r}),(0,u.tZ)(C.Z,{id:"KzC+38",defaultMessage:"Prompt template examples"})]})}),dangerouslySetAntdProps:{width:1200},children:Or.map((e=>(0,u.BX)("div",{css:(0,v.iv)({display:"flex",flexDirection:"column",gap:s.spacing.md},""),children:[(0,u.BX)("div",{css:(0,v.iv)({boxSizing:"border-box",border:`1px solid ${s.colors.actionDefaultBorderDefault}`,borderRadius:s.borders.borderRadiusMd,background:s.colors.backgroundPrimary,padding:s.spacing.md,margin:0,overflow:"hidden",display:"flex",flexDirection:"column",gap:`${s.spacing.xs}px`},""),children:[(0,u.BX)(b.j.Title,{level:4,children:[(0,u.tZ)(C.Z,{id:"GDzD7I",defaultMessage:"Prompt Template"}),(0,u.tZ)(b.B,{type:"tertiary",size:"small",style:{float:"right"},onClick:()=>(e=>{a(e.prompt.join("\n")),e.variables.forEach((e=>{let{name:t,value:r}=e;i(t,r)})),r()})(e),children:(0,u.tZ)(C.Z,{id:"Np53PR",defaultMessage:"Try this template"})})]}),e.prompt.map((e=>(0,u.tZ)(b.j.Paragraph,{children:e},e))),(0,u.tZ)(Hr.Z,{css:(0,v.iv)({marginTop:s.spacing.xs,marginBottom:s.spacing.xs},"")}),e.variables.map((e=>{let{name:t,value:r}=e;return(0,u.BX)("div",{children:[(0,u.tZ)(b.j.Title,{level:4,children:t}),(0,u.tZ)(b.j.Paragraph,{children:r})]},t)}))]}),(0,u.tZ)(h.LZC,{})]},e.prompt.join("\n"))))})};const{TextArea:Ur}=b.e;var Vr={name:"1ll9bqd",styles:"cursor:default"},_r={name:"1voqbl3",styles:"margin-top:0;font-weight:normal"},Wr={name:"t691yx",styles:"display:grid;grid-template-columns:300px 1fr;gap:48px"},Fr={name:"1d3w5wq",styles:"width:100%"};const Kr=e=>{let{isOpen:t,closeModal:r,runBeingDuplicated:l,visibleRuns:d=[]}=e;const[p]=rt(),{theme:m}=(0,b.u)(),{parameters:g,updateParameter:f}=Br(),[y,x]=(0,n.useState)(""),[Z,w]=(0,n.useState)(""),[k,S]=(0,n.useState)(!1),[M,R]=(0,n.useState)(!1),[E,T]=(0,n.useState)(null),[B,I]=(0,n.useState)(""),[A,L]=(0,n.useState)({}),[D,N]=(0,n.useState)(!1),[P,H]=(0,n.useState)(!1),O=(0,n.useRef)(null),X=(0,c.I0)();(0,n.useEffect)((()=>{X((0,Cr.cL)()).catch((e=>{s.default.logErrorAndNotifyUser((null===e||void 0===e?void 0:e.message)||e)}))}),[X]);const z=(0,a.Z)(),{updateInputVariables:U,inputVariables:V,inputVariableValues:_,updateInputVariableValue:W,inputVariableNameViolations:F,clearInputVariableValues:K}=(()=>{const[e,t]=(0,n.useState)((0,Mr.xN)("")),[r,a]=(0,n.useState)({namesWithSpaces:[]}),[i,s]=(0,n.useState)(Mr.c$),l=(0,n.useCallback)((()=>s({})),[]),c=(0,n.useMemo)((()=>(0,o.debounce)((e=>{t((t=>{const r=(0,Mr.xN)(e);return(0,o.isEqual)(r,t)?t:r})),a((0,Mr.Iy)(e))}),250)),[]),d=(0,n.useCallback)(((e,t)=>{s((r=>({...r,[e]:t})))}),[]),u=(0,n.useMemo)((()=>(0,o.fromPairs)(Object.entries(i).filter((t=>{let[r]=t;return e.includes(r)})))),[i,e]);return{updateInputVariables:c,inputVariables:e,inputVariableValues:u,updateInputVariableValue:d,inputVariableNameViolations:r,clearInputVariableValues:l}})(),{handleAddVariableToTemplate:j,savePromptTemplateInputRef:$,promptTemplate:q,updatePromptTemplate:Y}=(()=>{const[e,t]=(0,n.useState)(Mr.N3),r=(0,n.useRef)(),a=(0,n.useCallback)((()=>{t((e=>{const t=`${e} {{ ${Dr}${Lr}`;return requestAnimationFrame((()=>{const e=r.current;e&&(e.focus(),e.setSelectionRange(t.length-12-3,t.length-3))})),t}))}),[t]);return{savePromptTemplateInputRef:(0,n.useCallback)((e=>{var t;r.current=null===e||void 0===e||null===(t=e.resizableTextArea)||void 0===t?void 0:t.textArea}),[]),handleAddVariableToTemplate:a,promptTemplate:e,updatePromptTemplate:t}})();(0,n.useEffect)((()=>{t&&!l&&w(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,n="";for(let a=0;a<10;a++)if(n=Sr(e,t),n.length<r)return n;return n.slice(0,r)}())}),[t,l]),(0,n.useEffect)((()=>{U(q)}),[q,U]),(0,n.useEffect)((()=>{if(l){const{promptTemplate:e,routeName:t,parameters:r}=(0,Mr.rP)(l);(0,Mr.oV)(l),e&&Y(e),r.temperature&&f("temperature",r.temperature),r.max_tokens&&f("max_tokens",r.max_tokens),t&&x(t),I(""),N(!1);const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=e.match(/\s\((\d+)\)$/),n=r?e.substring(0,e.length-r[0].length):e;let a=r?parseInt(r[1],10)+1:1;for(;t.includes(n+" ("+a+")");)a++;return n+" ("+a+")"}(l.runName,d.map((e=>{let{runName:t}=e;return t})));w(n),K()}}),[l,K,f,Y,d]);const G=(0,c.v9)((e=>{let{modelGateway:t}=e;return t.modelGatewayRoutes})),J=(0,n.useMemo)((()=>(0,o.sortBy)(Object.values(G).filter((e=>[Zr.nr.LLM_V1_COMPLETIONS,Zr.nr.LLM_V1_CHAT].includes(e.route_type))),"name")),[G]),Q=(0,c.v9)((e=>{let{modelGateway:t}=e;return t.modelGatewayRoutesLoading}));(0,n.useEffect)((()=>{B&&N(!0)}),[_,q,g,y]);const{refreshRuns:ee,updateSearchFacets:te}=kt(),re=(0,n.useCallback)((()=>{const e=G[y],t=Math.random().toString(36);if(O.current=t,!e)throw new Error("No model route found!");T(null),R(!0);const r=(0,Mr.Ky)(q,_);X((0,Cr.N)(e,{inputText:r,parameters:g})).then((e=>{let{value:r,action:n}=e;if(O.current===t){const{text:e,metadata:a}=Zr.zT.parseEvaluationResponse(r),i=performance.now()-n.meta.startTime;I(e);const s={...a,latency:i},o=Object.entries(s).reduce(((e,t)=>{let[r,n]=t;return{...e,[`MLFLOW_${r}`]:n}}),{});L(o),N(!1),R(!1),O.current===t&&(O.current=null)}})).catch((e=>{const r=e.getGatewayErrorMessage()||e.getUserVisibleError(),n=z.formatMessage({id:"JAFH9v",defaultMessage:'AI gateway returned the following error: "{errorMessage}"'},{errorMessage:r});s.default.logErrorAndNotifyUser(n),R(!1),T(n),O.current===t&&(O.current=null)}))}),[X,_,G,g,q,y,z]),ne=(0,n.useCallback)((()=>{O.current&&(R(!1),O.current=null)}),[R]),ae=z.formatMessage({id:"EOlibi",defaultMessage:"Model"}),ie=z.formatMessage({id:"r6ANEE",defaultMessage:"Select route"}),se=q.trim().length>0,oe=(0,n.useMemo)((()=>V.every((e=>{var t;return null===(t=_[e])||void 0===t?void 0:t.trim()}))),[V,_]),le=Z.trim().length>0,ce=y&&se&&oe,de=Boolean(y&&se&&oe&&B&&!D&&V.length>0&&le&&!E),ue=(0,n.useMemo)((()=>y?se?oe?B?D?z.formatMessage({id:"/K6wBr",defaultMessage:"Input data or prompt template have changed since last evaluation of the output"}):0===V.length?z.formatMessage({id:"z+0t/R",defaultMessage:"You need to define at least one input variable"}):le?null:z.formatMessage({id:"dYbJha",defaultMessage:"Please provide run name"}):z.formatMessage({id:"gUhc5g",defaultMessage:"You need to evaluate the resulting output first"}):z.formatMessage({id:"flJNTA",defaultMessage:"You need to provide values for all defined inputs"}):z.formatMessage({id:"dHAuWp",defaultMessage:"You need to provide a prompt template"}):z.formatMessage({id:"0TZCn5",defaultMessage:"You need to select a route from the AI gateway dropdown first"})),[oe,V.length,z,D,B,se,y,le]),pe=(0,n.useMemo)((()=>y?se?oe?null:z.formatMessage({id:"flJNTA",defaultMessage:"You need to provide values for all defined inputs"}):z.formatMessage({id:"dHAuWp",defaultMessage:"You need to provide a prompt template"}):z.formatMessage({id:"0TZCn5",defaultMessage:"You need to select a route from the AI gateway dropdown first"})),[oe,z,se,y]),me=(0,n.useMemo)((()=>E?(0,u.tZ)(h.bZj,{message:E,closable:!1,type:"error",css:(0,v.iv)({marginBottom:m.spacing.sm,marginTop:m.spacing.sm},"")}):M?(0,u.tZ)("div",{css:(0,v.iv)({marginTop:m.spacing.sm},""),children:(0,u.tZ)(h.hM6,{lines:5})}):(0,u.tZ)(Ur,{rows:5,css:Vr,"data-testid":"prompt-output",value:B,readOnly:!0})),[E,M,B,m]),he=(0,n.useMemo)((()=>A?M?null:(0,u.BX)("div",{css:(0,v.iv)({display:"flex",gap:m.spacing.xs,alignItems:"center"},""),children:[Mr.h in A&&(0,u.BX)(b.j.Hint,{size:"sm",children:[Math.round(Number(A[Mr.h]))," ms","MLFLOW_total_tokens"in A?",":""]}),Mr.i7 in A&&(0,u.tZ)(b.j.Hint,{size:"sm",children:(0,u.tZ)(C.Z,{id:"/nPZbt",defaultMessage:"{totalTokens} total tokens",values:{totalTokens:A[Mr.i7]}})})]}):null),[A,B,M,m]);return t&&P?(0,u.tZ)(zr,{isOpen:t&&P,closeExamples:()=>H(!1),closeModal:r,updatePromptTemplate:Y,updateInputVariableValue:W}):(0,u.BX)(h.u_l,{verticalSizing:"maxed_out",visible:t,onCancel:r,onOk:r,footer:(0,u.BX)("div",{css:(0,v.iv)({display:"flex",gap:m.spacing.sm,justifyContent:"flex-end"},""),children:[(0,u.tZ)(b.B,{onClick:r,children:(0,u.tZ)(C.Z,{id:"mqTFL+",defaultMessage:"Cancel"})}),(0,u.tZ)(b.T,{title:ue,children:(0,u.tZ)(b.B,{onClick:()=>{S(!0);const e=(0,Mr.Ky)(q,_);X((0,i.Ct)({experimentId:p,promptTemplate:q,modelInput:e,modelParameters:g,modelRouteName:y,promptParameters:_,modelOutput:B,runName:Z,modelOutputParameters:A})).then((()=>{ee(),r(),S(!1),te((e=>"ARTIFACT"!==e.compareRunsMode?{...e,compareRunsMode:"ARTIFACT"}:e))})).catch((e=>{s.default.logErrorAndNotifyUser((null===e||void 0===e?void 0:e.message)||e),S(!1)}))},"data-testid":"button-create-run",type:"primary",disabled:!de,children:(0,u.tZ)(C.Z,{id:"8Uwpjw",defaultMessage:"Create run"})})})]}),title:(0,u.BX)("div",{children:[(0,u.tZ)(b.j.Title,{level:2,css:(0,v.iv)({marginTop:m.spacing.sm,marginBottom:m.spacing.xs},""),children:(0,u.tZ)(C.Z,{id:"sLhmy7",defaultMessage:"New run"})}),(0,u.tZ)(b.j.Hint,{css:_r,children:"Create a new run using a large-language model by giving it a prompt template and model parameters"})]}),dangerouslySetAntdProps:{width:1200},children:[(0,u.BX)("div",{css:Wr,children:[(0,u.BX)("div",{children:[(0,u.BX)("div",{css:(0,v.iv)({...jr.formItem,display:"flex",alignItems:"center"},""),children:[(0,u.BX)(h.M6x,{label:y?ae:ie,modal:!1,value:y?[y]:void 0,children:[(0,u.tZ)(h.Aa0,{css:Fr,allowClear:!1}),(0,u.tZ)(h.hJM,{loading:Q,maxHeight:400,matchTriggerWidth:!0,children:!Q&&(0,u.tZ)(h.X_T,{children:(0,u.tZ)(h.MWX,{autoFocus:!0,children:J.map((e=>(0,u.BX)(h.PC4,{value:e.name,onChange:e=>{x(e)},checked:y===e.name,children:[e.name,(0,u.tZ)(h.Bpn,{children:e.model.name})]},e.name)))})})})]}),(0,u.tZ)(b.T,{title:(0,u.tZ)(C.Z,{id:"bc/aGy",defaultMessage:"These routes come from the AI Gateway. Check out the AI Gateway preview documentation to get started"}),placement:"right",children:(0,u.tZ)(b.d,{css:(0,v.iv)({marginLeft:m.spacing.sm,color:m.colors.textSecondary},"")})})]}),y&&(0,u.tZ)(Ar,{parameters:g,updateParameter:f}),(0,u.tZ)("div",{css:jr.formItem,children:(0,u.BX)(u.HY,{children:[(0,u.BX)(h.lNd.Label,{htmlFor:"new_run_name",children:[(0,u.tZ)(C.Z,{id:"Zqj4VA",defaultMessage:"New run name"}),!Z.trim()&&(0,u.tZ)(h.lNd.Message,{type:"error",message:z.formatMessage({id:"dYbJha",defaultMessage:"Please provide run name"})})]}),(0,u.tZ)(b.e,{id:"new_run_name","data-testid":"run-name-input",required:!0,value:Z,onChange:e=>w(e.target.value)})]})})]}),(0,u.BX)("div",{children:[(0,u.BX)("div",{css:jr.formItem,children:[(0,u.BX)(u.HY,{children:[(0,u.BX)(h.lNd.Label,{htmlFor:"prompt_template",children:[(0,u.tZ)(C.Z,{id:"uBTAtY",defaultMessage:"Prompt Template"}),(0,u.tZ)(b.B,{onClick:()=>H(!0),style:{marginLeft:"auto"},children:(0,u.tZ)(C.Z,{id:"13vJft",defaultMessage:"View Examples"})})]}),(0,u.tZ)(h.lNd.Hint,{children:(0,u.tZ)(C.Z,{id:"gC2Kxm",defaultMessage:"Give instructions to the model. Use '{{ }}' or the \"Add new variable\" button to add variables to your prompt."})})]}),(0,u.tZ)(Ur,{id:"prompt_template",autoSize:!0,"data-testid":"prompt-template-input",value:q,onChange:e=>Y(e.target.value),ref:$}),(0,u.tZ)(Pr,{violations:F})]}),V.map((e=>(0,u.tZ)("div",{css:jr.formItem,children:(0,u.BX)(u.HY,{children:[(0,u.tZ)(h.lNd.Label,{htmlFor:e,children:(0,u.tZ)("span",{children:e})}),(0,u.tZ)(Ur,{id:e,autoSize:!0,value:_[e]?_[e]:"",onChange:t=>W(e,t.target.value)})]})},e))),(0,u.tZ)("div",{css:jr.formItem,children:(0,u.tZ)(b.B,{icon:(0,u.tZ)(h.pOD,{}),onClick:j,children:(0,u.tZ)(C.Z,{id:"71hvMu",defaultMessage:"Add new variable"})})}),(0,u.BX)("div",{css:jr.formItem,children:[(0,u.tZ)(b.T,{title:pe,children:(0,u.tZ)(b.B,{"data-testid":"button-evaluate",icon:(0,u.tZ)(h.o1U,{}),onClick:re,disabled:!ce,loading:M,children:(0,u.tZ)(C.Z,{id:"72uGpl",defaultMessage:"Evaluate"})})}),(0,u.tZ)(b.B,{"data-testid":"button-cancel",icon:(0,u.tZ)(h.wNq,{}),onClick:ne,disabled:!M,css:(0,v.iv)({marginLeft:m.spacing.sm},""),children:(0,u.tZ)(C.Z,{id:"CTEh+b",defaultMessage:"Cancel"})})]}),(0,u.BX)(h.lNd.Label,{children:[(0,u.tZ)(C.Z,{id:"ydoHrJ",defaultMessage:"Output"})," ",D&&(0,u.tZ)(b.T,{title:(0,u.tZ)(C.Z,{id:"gc+GrI",defaultMessage:"Model, input data or prompt have changed since last evaluation of the output"}),children:(0,u.tZ)(h.aNP,{})})]}),(0,u.tZ)(h.lNd.Hint,{children:(0,u.tZ)(C.Z,{id:"JtQQMn",defaultMessage:"This is the output generated by the LLM using the prompt template and input values defined above."})}),me,he]})]}),k&&(0,u.tZ)("div",{css:(0,v.iv)({inset:0,backgroundColor:m.colors.overlayOverlay,position:"absolute",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1},""),children:(0,u.tZ)(b.S,{})})]})},jr={formItem:{marginBottom:16}},$r=n.createContext({createNewRun:()=>{}}),qr=e=>{let{children:t,visibleRuns:r}=e;const[a,i]=(0,n.useState)(!1),[s,o]=(0,n.useState)(null),l=(0,n.useMemo)((()=>({createNewRun:e=>{i(!0),o(e||null)}})),[]);return(0,u.BX)($r.Provider,{value:l,children:[t,(0,u.tZ)(Kr,{visibleRuns:r,isOpen:a,closeModal:()=>i(!1),runBeingDuplicated:s})]})},Yr=()=>(0,n.useContext)($r),Gr=n.memo((e=>{let{searchFacetsState:t,updateSearchFacets:r,experimentId:i,runsData:s,viewState:o,updateViewState:l,onDownloadCsv:d,requestError:p,additionalControls:m}=e;const g=rt().length>1,{compareRunsMode:f,startTime:y,lifecycleFilter:x,datasetsFilter:Z}=t,w=(0,a.Z)(),{createNewRun:k}=Yr(),[S,M]=(0,n.useState)(!1),{theme:R}=(0,b.u)(),E=(0,n.useMemo)((()=>(0,ge.u5)(w)),[w]),T=x===q.VW.ACTIVE?w.formatMessage({id:"0pdAuV",defaultMessage:"Active"}):w.formatMessage({id:"yJpGwW",defaultMessage:"Deleted"}),B=(0,u.tZ)(u.HY,{children:(0,u.tZ)(C.Z,{id:"+fb25b",defaultMessage:"Time created"})}),I=void 0===f||"ARTIFACT"===f,A=(0,c.v9)((e=>e.entities.datasetsByExperimentId[i])),L=(0,n.useCallback)((e=>{r((t=>({...t,datasetsFilter:Z.some((t=>lr(t,e)))?Z.filter((t=>!lr(t,e))):[...Z,e]})))}),[r,Z]),D=void 0!==A;return(0,u.BX)("div",{css:Jr.groupBar,children:[(0,u.BX)("div",{css:Jr.controlBar,children:[(0,u.tZ)(sr,{runsData:s,searchFacetsState:t,updateSearchFacets:r,requestError:p}),(0,u.BX)(h.M6x,{label:B,value:"ALL"!==y?[E[y]]:[],children:[(0,u.tZ)(h.Aa0,{allowClear:"ALL"!==y,onClear:()=>r({startTime:"ALL"}),"data-test-id":"start-time-select-dropdown"}),(0,u.tZ)(h.hJM,{children:(0,u.tZ)(h.X_T,{children:Object.keys(E).map((e=>(0,u.tZ)(h.PC4,{checked:e===y,title:E[e],"data-test-id":`start-time-select-${e}`,value:e,onChange:()=>r({startTime:e}),children:E[e]},e)))})})]}),(0,u.BX)(h.M6x,{label:(0,u.tZ)(C.Z,{id:"iLFoPb",defaultMessage:"State"}),value:[T],children:[(0,u.tZ)(h.Aa0,{allowClear:!1,"data-testid":"lifecycle-filter"}),(0,u.tZ)(h.hJM,{children:(0,u.BX)(h.X_T,{children:[(0,u.tZ)(h.PC4,{checked:x===q.VW.ACTIVE,"data-testid":"active-runs-menu-item",value:q.VW.ACTIVE,onChange:()=>r({lifecycleFilter:q.VW.ACTIVE}),children:(0,u.tZ)(C.Z,{id:"0pdAuV",defaultMessage:"Active"})},q.VW.ACTIVE),(0,u.tZ)(h.PC4,{checked:x===q.VW.DELETED,"data-testid":"deleted-runs-menu-item",value:q.VW.DELETED,onChange:()=>r({lifecycleFilter:q.VW.DELETED}),children:(0,u.tZ)(C.Z,{id:"yJpGwW",defaultMessage:"Deleted"})},q.VW.DELETED)]})})]}),(0,Se.hk)()&&(0,u.tZ)(h.M6x,{label:(0,u.tZ)(C.Z,{id:"IZ95jb",defaultMessage:"Datasets"}),value:Z.map((e=>e.name)),multiSelect:!0,children:(0,u.BX)(b.T,{title:!D&&(0,u.tZ)(C.Z,{id:"VRESE/",defaultMessage:"No datasets registered for this experiment's runs."}),children:[(0,u.tZ)(h.Aa0,{allowClear:!0,onClear:()=>r({datasetsFilter:[]}),"data-test-id":"datasets-select-dropdown",showTagAfterValueCount:1,disabled:!D}),D&&(0,u.tZ)(h.hJM,{maxHeight:600,children:(0,u.tZ)(h.X_T,{children:(0,u.tZ)(h.MWX,{children:A.map((e=>(0,u.BX)(h.VKe,{checked:Z.some((t=>lr(t,e))),title:e.name,"data-test-id":`dataset-dropdown-${e.name}`,value:e.name,onChange:()=>L(e),children:[e.name," (",e.digest,")"," ",e.context&&(0,u.tZ)(h.Vp9,{css:(0,v.iv)({textTransform:"capitalize",marginRight:R.spacing.xs},""),children:e.context})]},e.name+e.digest+e.context)))})})})]})}),m]}),(0,u.tZ)("div",{css:Jr.groupSeparator}),(0,u.BX)("div",{css:Jr.controlBar,children:[(0,u.tZ)(h.Ltx,{trigger:["click"],placement:"bottomRight",overlay:(0,u.tZ)(h.v2r,{children:(0,u.BX)(h.v2r.Item,{className:"csv-button",onClick:d,children:[(0,u.tZ)(h._8t,{})," ",(0,u.tZ)(C.Z,{id:"rOnjGB",defaultMessage:"Download CSV"})]})}),children:(0,u.tZ)(b.B,{type:"tertiary",icon:(0,u.tZ)(h.VZO,{})})}),(0,u.tZ)(xr,{isOpen:S,closeModal:()=>M(!1),experimentId:i}),!g&&(0,u.tZ)(b.T,{title:(0,u.tZ)(C.Z,{id:"17vAZ0",defaultMessage:"Click to {isMaximized, select, true {restore} other {maximize}} the view",values:{isMaximized:o.viewMaximized}}),children:(0,u.tZ)(Tt,{pressed:o.viewMaximized,icon:o.viewMaximized?(0,u.tZ)(h.wvt,{}):(0,u.tZ)(h.$_3,{}),onClick:()=>l({viewMaximized:!o.viewMaximized})})},o.viewMaximized.toString()),(0,Se.Hi)()&&I&&(0,u.tZ)(b.T,{title:(0,u.tZ)(C.Z,{id:"eZOxx1",defaultMessage:"Toggle the preview sidepane"}),children:(0,u.tZ)(Tt,{pressed:o.previewPaneVisible,icon:(0,u.tZ)(h.BSo,{}),onClick:()=>l({previewPaneVisible:!o.previewPaneVisible})})}),(0,u.tZ)(Jt,{}),(0,Se.sq)()&&!g&&(0,u.BX)(b.M.Root,{children:[(0,u.tZ)(b.M.Trigger,{asChild:!0,children:(0,u.tZ)(b.B,{type:"primary",icon:(0,u.tZ)(h.pOD,{}),children:(0,u.tZ)(C.Z,{id:"PEYesH",defaultMessage:"New run"})})}),(0,u.BX)(b.M.Content,{children:[(0,u.BX)(b.M.Item,{onSelect:()=>k(),children:[" ",(0,u.tZ)(C.Z,{id:"UmwZQv",defaultMessage:"using Prompt Engineering"})," ",(0,u.tZ)(h.Vp9,{style:{marginLeft:"4px"},color:"turquoise",children:(0,u.tZ)(C.Z,{id:"8qJt7/",defaultMessage:"Experimental"})})]}),(0,u.BX)(b.M.Item,{onSelect:()=>M(!0),children:[" ",(0,u.tZ)(C.Z,{id:"vNRmQa",defaultMessage:"using Notebook"})]})]})]})]})]})})),Jr={groupBar:{display:"grid",gridTemplateColumns:"auto 1fr auto"},controlBar:e=>({display:"flex",gap:e.spacing.sm,alignItems:"center",flexWrap:"wrap"}),groupSeparator:e=>({minWidth:e.spacing.sm}),columnSwitch:{margin:"5px"},searchBox:e=>({display:"flex",gap:e.spacing.sm,width:560}),lifecycleFilters:e=>({display:"flex",gap:8,alignItems:"center",marginTop:e.spacing.sm,marginBottom:e.spacing.sm,marginLeft:2*e.spacing.lg})};var Qr={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"},en={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const tn=n.memo((e=>{let{searchFacetsState:t,sortOptions:r,onSortKeyChanged:a}=e;const{orderByKey:i,orderByAsc:s}=t,{theme:o}=(0,b.u)(),l=(0,n.useMemo)((()=>`${i}${q.T_}${s?q.aU:q.iX}`),[s,i]),c=(0,n.useMemo)((()=>{const e=r.find((e=>e.value===l));let t=null===e||void 0===e?void 0:e.label;if(!t){const e=i.match(/^.+\.`(.+)`$/);e&&(t=e[1])}return(0,u.BX)("span",{css:Qr,children:[s?(0,u.tZ)(h.TV4,{}):(0,u.tZ)(h.mcG,{})," ",(0,u.tZ)(C.Z,{id:"llrWuc",defaultMessage:"Sort"}),": ",t]})}),[l,s,i,r]),d=e=>{a({value:e})};return(0,u.BX)(h.M6x,{label:c,children:[(0,u.tZ)(h.Aa0,{onClear:()=>{a({value:""})},"data-test-id":"sort-select-dropdown"}),(0,u.tZ)(h.hJM,{minWidth:250,children:(0,u.tZ)(h.X_T,{children:(0,u.tZ)(h.MWX,{children:r.map((e=>(0,u.tZ)(h.PC4,{value:e.value,onChange:d,checked:e.value===l,"data-test-id":`sort-select-${e.label}-${e.order}`,children:(0,u.BX)("span",{css:en,children:[e.order===q.aU?(0,u.tZ)(h.Hf3,{}):(0,u.tZ)(h.veu,{}),(0,ut.mJ)(e.label,50)]})},e.value)))})})})]})})),rn="GROUP",nn=De(rn,q.D5.ATTRIBUTES),an=De(rn,q.D5.PARAMS),sn=De(rn,q.D5.METRICS),on=De(rn,q.D5.TAGS),ln=(e,t)=>e.filter((e=>e.toLowerCase().includes(t.toLowerCase()))),cn=(e,t)=>{if(!t)return e;const r=e.toLowerCase().indexOf(t.toLowerCase()),n=e.substring(0,r),a=e.substring(r,r+t.length),i=e.substring(r+t.length);return r>-1?(0,u.BX)("span",{children:[n,(0,u.tZ)("strong",{children:a}),i]}):e},dn=n.memo((e=>{let{runsData:t,columnSelectorVisible:r,onChangeColumnSelectorVisible:a,updateSearchFacets:i,selectedColumns:o}=e;const l=rt(),[c,d]=(0,n.useState)(""),p=(0,n.useRef)(null),m=(0,n.useRef)(null),g=(0,n.useRef)(null),f=(0,n.useMemo)((()=>(e=>{const t=[q.z.USER,q.z.SOURCE,q.z.VERSION,q.z.MODELS];return e&&t.unshift(q.z.EXPERIMENT_NAME),(0,Se.GW)()&&t.unshift(q.z.DATASET),t})(l.length>1)),[l.length]),v=(0,n.useCallback)((e=>i((t=>{const r=e(t.selectedColumns),n=Array.from(new Set(r));return{...t,selectedColumns:n}}))),[i]),y=(0,n.useMemo)((()=>s.default.getVisibleTagKeyList(t.tagsList)),[t]),x=(0,n.useMemo)((()=>({[q.D5.ATTRIBUTES]:f.map((e=>De(q.D5.ATTRIBUTES,e))),[q.D5.PARAMS]:t.paramKeyList.map((e=>De(q.D5.PARAMS,e))),[q.D5.METRICS]:t.metricKeyList.map((e=>De(q.D5.METRICS,e))),[q.D5.TAGS]:y.map((e=>De(q.D5.TAGS,e)))})),[t,f,y]),Z=(0,n.useMemo)((()=>{const e=[],r=ln(f,c),n=ln(t.paramKeyList,c),a=ln(t.metricKeyList,c),i=ln(y,c);return r.length&&e.push({key:nn,title:"Attributes",children:r.map((e=>({key:De(q.D5.ATTRIBUTES,e),title:cn(e,c)})))}),a.length&&e.push({key:sn,title:`Metrics (${a.length})`,children:a.map((e=>({key:De(q.D5.METRICS,e),title:cn(e,c)})))}),n.length&&e.push({key:an,title:`Parameters (${n.length})`,children:n.map((e=>({key:De(q.D5.PARAMS,e),title:cn(e,c)})))}),i.length&&e.push({key:on,title:`Tags (${i.length})`,children:i.map((e=>({key:De(q.D5.TAGS,e),title:e})))}),e}),[f,c,t,y]),w=(0,n.useCallback)(((e,t)=>{v(e?e=>e.filter((e=>!t.includes(e))):e=>[...e,...t])}),[v]),k=(0,n.useCallback)(((e,t)=>{v(t?t=>t.filter((t=>t!==e)):t=>[...t,e])}),[v]);(0,n.useEffect)((()=>{r&&(d(""),requestAnimationFrame((()=>{var e,t;null===m||void 0===m||null===(e=m.current)||void 0===e||e.scrollTo(0,0),null===(t=p.current)||void 0===t||t.focus({preventScroll:!0}),g.current&&g.current.scrollIntoView({block:"nearest",behavior:"smooth"})})))}),[r]);const S=(0,n.useCallback)(((e,t)=>{let{node:{key:r,checked:n}}=t;if(Ne(r.toString(),rn)){const e=Pe(r.toString(),rn),t=x[e];t&&w(n,ln(t,c))}else k(r.toString(),n)}),[x,w,k,c]),M=(0,n.useCallback)((e=>{if("ArrowDown"===e.key){const e=(null===(t=m.current)||void 0===t?void 0:t.querySelector('[role="tree"] input'))||null;e&&e.focus()}var t}),[]),R=(0,u.BX)("div",{css:pn.dropdown,children:[(0,u.tZ)("div",{css:e=>({padding:e.spacing.md}),children:(0,u.tZ)(b.e,{value:c,prefix:(0,u.tZ)(h.W1M,{}),placeholder:"Search columns",allowClear:!0,ref:p,onChange:e=>{d(e.target.value)},onKeyDown:M})}),(0,u.tZ)("div",{ref:m,css:pn.scrollableContainer,children:(0,u.tZ)(h.mpN,{"data-testid":"column-selector-tree",mode:"checkable",dangerouslySetAntdProps:{checkedKeys:o,onCheck:S},defaultExpandedKeys:[nn,an,sn,on],treeData:Z})})]});return(0,u.tZ)(h.Ltx,{overlay:R,placement:"bottomLeft",trigger:["click"],visible:r,onVisibleChange:a,children:(0,u.BX)(b.B,{ref:g,style:{display:"flex",alignItems:"center"},"data-testid":"column-selection-dropdown",icon:(0,u.tZ)(h.SeN,{}),children:[(0,u.tZ)(C.Z,{id:"ny+fBZ",defaultMessage:"Columns"})," ",(0,u.tZ)(h.v4q,{})]})})})),un=e=>{const{updateSearchFacets:t,searchFacetsState:r}=kt();return(0,u.tZ)(dn,{...e,selectedColumns:r.selectedColumns,updateSearchFacets:t})},pn={dropdown:e=>({backgroundColor:e.colors.white,width:400,border:"1px solid",borderColor:e.colors.border}),scrollableContainer:e=>({maxHeight:480,overflowY:"scroll",overflowX:"hidden",paddingBottom:e.spacing.md,"span[title]":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}})};const mn="seenBefore";var hn={name:"b98nv4",styles:"position:absolute;inset:0"},gn={name:"1ww443i",styles:"max-width:200px"},fn={name:"2qga7i",styles:"text-align:right"};const vn=e=>{let{multipleRunsSelected:t,isComparingRuns:r}=e;const a=Qt("compareRunsTooltip"),[i,s]=(0,n.useState)(t&&!a.getItem(mn));(0,n.useEffect)((()=>{const e=a.getItem(mn);s(!(!t||r||e))}),[t,r,a]);const o=(0,n.useCallback)((e=>{s(e),a.setItem(mn,!0)}),[s,a]);return(0,u.tZ)(u.HY,{children:(0,u.BX)(h.J2e.Root,{open:i,children:[(0,u.tZ)(h.J2e.Trigger,{asChild:!0,children:(0,u.tZ)("div",{css:hn})}),(0,u.BX)(h.J2e.Content,{align:"start",children:[(0,u.BX)("div",{css:gn,children:[(0,u.tZ)(b.j.Paragraph,{children:(0,u.tZ)(C.Z,{id:"1ECve7",defaultMessage:"You can now switch to the chart view to compare runs"})}),(0,u.tZ)("div",{css:fn,children:(0,u.tZ)(b.B,{onClick:()=>o(!1),type:"primary",children:(0,u.tZ)(C.Z,{id:"khknxG",defaultMessage:"Got it"})})})]}),(0,u.tZ)(h.J2e.Arrow,{})]})]})})},yn=e=>{let{compareRunsMode:t,setCompareRunsMode:r,viewState:n}=e;const a=void 0!==t,{classNamePrefix:i}=(0,b.u)(),s=t||"TABLE";return(0,u.BX)(h.Tabs,{dangerouslyAppendEmotionCSS:{[`.${i}-tabs-nav`]:{marginBottom:0,"::before":{border:"none"}}},activeKey:s,onChange:e=>r("TABLE"===e?void 0:e),children:[(0,u.tZ)(h.Tabs.TabPane,{tab:(0,u.tZ)("span",{"data-testid":"experiment-runs-mode-switch-list",children:(0,u.tZ)(C.Z,{id:"YOz/Dk",defaultMessage:"Table"})})},"TABLE"),(0,u.tZ)(h.Tabs.TabPane,{tab:(0,u.BX)(u.HY,{children:[(0,u.tZ)("span",{"data-testid":"experiment-runs-mode-switch-compare",children:(0,u.tZ)(C.Z,{id:"KOQzJx",defaultMessage:"Chart"})}),(0,u.tZ)(vn,{isComparingRuns:a,multipleRunsSelected:Object.keys(n.runsSelected).length>1})]})},"CHART"),(0,Se.Hi)()&&(0,u.tZ)(h.Tabs.TabPane,{tab:(0,u.BX)("span",{"data-testid":"experiment-runs-mode-switch-evaluation",children:[(0,u.tZ)(C.Z,{id:"SCqKp8",defaultMessage:"Evaluation"})," ",(0,u.tZ)(h.Vp9,{style:{marginLeft:"4px"},color:"turquoise",children:(0,u.tZ)(C.Z,{id:"8qJt7/",defaultMessage:"Experimental"})})]})},"ARTIFACT")]})},bn=n.memo((e=>{let{runsData:t,viewState:r,updateViewState:a,updateSearchFacets:i,searchFacetsState:o,experimentId:l,requestError:c,expandRows:d,updateExpandRows:p}=e;const{paramKeyList:m,metricKeyList:g,tagsList:f}=t,{compareRunsMode:y}=o,x=void 0!==y,{theme:Z}=(0,b.u)(),w=m,k=g,S=s.default.getVisibleTagKeyList(f),M=(0,n.useCallback)((()=>(0,ge.XM)(t,S,w,k)),[k,w,S,t]),R=((e,t)=>(0,n.useMemo)((()=>{let r=[];const n=[q.aU,q.iX];return r=[...Object.keys(q.Ul).reduce(((e,t)=>{const r=q.Ul[t];return n.forEach((n=>{e.push({label:r,value:q.XZ[t]+q.T_+n,order:n})})),e}),[]),...e.reduce(((e,t)=>(n.forEach((r=>{e.push({label:t,value:`${De(q.D5.METRICS,t)}${q.T_}${r}`,order:r})})),e)),[]),...t.reduce(((e,t)=>(n.forEach((r=>{e.push({label:t,value:`${De(q.D5.PARAMS,t)}${q.T_}${r}`,order:r})})),e)),[])],r}),[e,t]))(k,w),E=Object.values(r.runsSelected).filter(Boolean).length,T=E>1||1===E||E>0,B=(0,n.useCallback)((e=>{let{value:t}=e;const[r,n]=t.split(q.T_),a=ze[r]||r,s=n===q.aU;i((e=>{const{selectedColumns:t}=e;return t.includes(a)||t.push(a),{...e,selectedColumns:t,orderByKey:r,orderByAsc:s}}))}),[i]),I=(0,n.useCallback)((e=>a({columnSelectorVisible:e})),[a]),A=(0,n.useCallback)((()=>p(!d)),[d,p]),L=(0,n.useMemo)((()=>t.datasetsList.some((e=>(null===e||void 0===e?void 0:e.length)>1))),[t]);return(0,u.BX)("div",{css:(0,v.iv)({display:"flex",gap:Z.spacing.sm,flexDirection:"column",marginTop:r.viewMaximized?void 0:Z.spacing.md},""),children:[T&&(0,u.tZ)(Rt,{runsData:t,searchFacetsState:o,viewState:r}),!T&&(0,u.tZ)(Gr,{onDownloadCsv:M,updateSearchFacets:i,searchFacetsState:o,experimentId:l,viewState:r,updateViewState:a,runsData:t,requestError:c,additionalControls:(0,u.BX)(u.HY,{children:[(0,u.tZ)(tn,{onSortKeyChanged:B,searchFacetsState:o,sortOptions:R}),!x&&(0,u.tZ)(un,{columnSelectorVisible:r.columnSelectorVisible,onChangeColumnSelectorVisible:I,runsData:t}),!x&&(0,Se.GW)()&&L&&(0,u.tZ)(h.COr,{onClick:A,children:(0,u.tZ)(C.Z,{id:"mRc7MY",defaultMessage:"Expand rows"})})]})}),(0,u.tZ)("div",{children:(0,u.tZ)(yn,{compareRunsMode:y,setCompareRunsMode:e=>i({compareRunsMode:e}),viewState:r})})]})})),xn=n.lazy((()=>Promise.all([r.e(225),r.e(412)]).then(r.bind(r,39412)))),Cn=e=>(0,u.tZ)(n.Suspense,{fallback:(0,u.tZ)("div",{css:e=>({display:"flex",justifyContent:"center",margin:e.spacing.md}),children:(0,u.tZ)(b.S,{})}),children:(0,u.tZ)(xn,{...e})}),Zn=e=>{let{isFiltered:t,onClearFilters:r}=e;return(0,u.tZ)("div",{css:wn.noResultsWrapper,children:(0,u.tZ)("div",{css:wn.noResults,children:t?(0,u.tZ)(h.HYy,{button:(0,u.tZ)(b.B,{type:"primary",onClick:r,children:(0,u.tZ)(C.Z,{id:"pEpexK",defaultMessage:"Clear filters"})}),description:(0,u.tZ)(C.Z,{id:"Nnsm0p",defaultMessage:"All runs in this experiment have been filtered. Change or clear filters to view runs."}),title:(0,u.tZ)(C.Z,{id:"Tl63jz",defaultMessage:"All runs are filtered"}),image:(0,u.tZ)(h.k1n,{})}):(0,u.tZ)(h.HYy,{description:(0,u.tZ)(C.Z,{id:"coo35p",defaultMessage:"No runs have been logged yet. <link>Learn more</link> about how to create ML model training runs in this experiment.",values:{link:e=>(0,u.tZ)("a",{target:"_blank",href:g.gM,rel:"noreferrer",children:e})}}),title:(0,u.tZ)(C.Z,{id:"sByLVU",defaultMessage:"No runs logged"}),image:(0,u.tZ)(h.uOV,{})})})})},wn={noResults:{maxWidth:360},noResultsWrapper:e=>({marginTop:e.spacing.lg,inset:0,backgroundColor:e.colors.backgroundPrimary,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"})},kn="is-out-of-viewport",Sn="is-hidden",Mn="is-minimized",Rn=".ag-root",En=".ag-pinned-left-cols-container",Tn=".ag-center-cols-container",Bn=".ag-header",In=".ag-body-viewport",An=e=>{let{onClick:t,gridContainerElement:r,isInitialized:a,visible:i,moreRunsAvailable:s,moreAvailableRunsTableColumnCount:o=0}=e;const l=(0,n.useRef)(null),c=(0,n.useRef)(),d=(0,n.useRef)(Boolean(s));(0,n.useEffect)((()=>{d.current=Boolean(s)}),[s]);const p=(0,n.useCallback)((e=>{if(!l.current||!window.ResizeObserver||!e)return;const t=l.current,r=e.querySelector(Rn),n=e.querySelector(En),a=e.querySelector(Tn),i=e.querySelector(Bn),s=e.querySelector(In);let o=0,u=0,p=0,m=0,h=0,g=0;if(n&&a&&i&&r&&s){const e=new ResizeObserver((e=>{var l,f,v,y;for(const t of e)t.target===r&&(o=t.contentRect.width),t.target===n&&(u=t.contentRect.width,p=t.contentRect.height),t.target===s&&(h=t.contentRect.height),t.target===i&&(g=t.contentRect.height),t.target===a&&(m=t.contentRect.width);const b=u+m,x=g;b+180>=o?null===(l=c.current)||void 0===l||l.classList.add(kn):null===(f=c.current)||void 0===f||f.classList.remove(kn);const C=d.current?32:0,Z=p<h?p-C:h;Z<100?null===(v=c.current)||void 0===v||v.classList.add(Mn):null===(y=c.current)||void 0===y||y.classList.remove(Mn),t.style.transform=`translate3d(${b}px, ${x}px, 0)`,t.style.height=`${Z+1}px`}));return e.observe(n),e.observe(a),e.observe(i),e.observe(r),e.observe(s),()=>e.disconnect()}}),[]);return(0,n.useEffect)((()=>{a&&r&&(c.current=r,p(r))}),[p,a,r]),window.ResizeObserver?(0,u.tZ)("div",{ref:l,css:Ln.columnContainer,className:i?"":Sn,children:i&&(0,u.tZ)("div",{css:Ln.buttonContainer,children:(0,u.BX)(b.B,{css:Ln.button,type:"link",onClick:t,children:[(0,u.tZ)(h.wl8,{css:Ln.buttonIcon}),(0,u.tZ)("div",{css:Ln.caption,children:(0,u.tZ)(C.Z,{id:"npHb2a",defaultMessage:"Show more columns {count, select, 0 {} other {({count} total)}}",values:{count:o}})})]})})}):null},Ln={columnContainer:e=>({width:180,height:0,position:"absolute",border:`1px solid ${e.colors.grey200}`,borderTop:0,top:0,left:0,willChange:"transform",transform:"translate3d(0, 0, 0)",[`.${Mn} &`]:{display:"flex",alignItems:"center"},[`&.${Sn}, .${kn} &`]:{display:"none"},pointerEvents:"none",display:"flex",alignItems:"center"}),buttonContainer:e=>({top:0,paddingLeft:e.spacing.lg,paddingRight:e.spacing.lg,width:"100%",[`.${Mn} &`]:{paddingTop:e.spacing.xs},pointerEvents:"all"}),button:{whiteSpace:"pre-wrap",width:"100%"},buttonIcon:e=>({color:e.colors.textSecondary}),caption:e=>({color:e.colors.textSecondary,[`.${Mn} &`]:{display:"none"}})},Dn=e=>(0,u.tZ)("strong",{children:e}),Nn=e=>{let{isLoading:t,allRunsCount:r}=e;return(0,u.BX)("div",{css:Pn.statusBar,children:[(0,u.tZ)(b.j.Text,{size:"sm",color:t?"secondary":void 0,children:(0,u.tZ)(C.Z,{id:"gLj8lU",defaultMessage:"<strong>{length}</strong> matching {length, plural, =0 {runs} =1 {run} other {runs}}",values:{strong:Dn,length:r}})}),t&&(0,u.tZ)(b.S,{size:"small"})]})},Pn={statusBar:e=>({height:28,display:"flex",gap:8,marginTop:-1,position:"relative",alignItems:"center",borderTop:`1px solid ${e.colors.border}`})};var Hn={name:"1089mxj",styles:"white-space:pre-wrap"};const On=e=>{let{content:t,copyText:r,headerText:n,empty:a,onClose:i}=e;const{theme:s}=(0,b.u)();return(0,u.tZ)("div",{css:(0,v.iv)({width:300,padding:s.spacing.sm,paddingRight:0,borderLeft:`1px solid ${s.colors.borderDecorative}`,overflow:"auto",height:"100%"},""),"data-testid":"preview-sidebar-content",children:t?(0,u.BX)(u.HY,{children:[(0,u.BX)("div",{css:(0,v.iv)({display:"grid",gridTemplateColumns:"1fr auto auto",rowGap:s.spacing.sm,alignItems:"center"},""),children:[n&&(0,u.tZ)(b.j.Title,{level:4,children:n}),r&&(0,u.tZ)(N,{copyText:r,showLabel:!1,icon:(0,u.tZ)(h.TIy,{})}),i&&(0,u.tZ)(b.B,{type:"primary",icon:(0,u.tZ)(b.C,{}),onClick:i})]}),(0,u.tZ)("div",{css:Hn,children:t})]}):(0,u.tZ)("div",{css:(0,v.iv)({marginTop:s.spacing.md},""),children:a})})},Xn=n.memo((e=>{let{experiments:t,searchFacetsState:r,runsData:a,isLoading:i,moreRunsAvailable:l,updateSearchFacets:c,updateViewState:d,onAddColumnClicked:p,rowsData:m,loadMoreRunsFunc:g,onDatasetSelected:f,expandRows:v,viewState:y}=e;const{compareRunsMode:x}=r,Z=void 0!==x,{paramKeyList:w,metricKeyList:k,tagsList:S}=a,[M,R]=(0,n.useState)(),[E,T]=(0,n.useState)(),B=(0,n.useRef)([]),I=(0,n.useMemo)((()=>s.default.getVisibleTagKeyList(S)),[S]),A=(0,n.useRef)(null),L=(0,n.useMemo)((()=>m.some((e=>{var t;return null===(t=e.runDateAndNestInfo)||void 0===t?void 0:t.hasExpander}))),[m]),D=(0,n.useCallback)((e=>{let{api:t}=e;const r=t.getSelectedRows().filter((e=>!e.isLoadMoreRow)).map((e=>{let{runInfo:t}=e;return t.run_uuid}));d({runsSelected:r.reduce(((e,t)=>({...e,[t]:!0})),{})}),B.current=r}),[d]),N=(0,n.useCallback)((e=>{const t=e.api.getSelectedRows().filter((e=>!e.isLoadMoreRow));if(B.current&&t.length!==B.current.length){const t=Boolean(e.node.isSelected()),{runDateAndNestInfo:r}=e.data;if(!r)return;const{isParent:n,expanderOpen:a,childrenIds:i}=r;if(n&&a&&i){const r=i;e.api.forEachNode((e=>{var n;if(null!==(n=e.data)&&void 0!==n&&n.isLoadMoreRow)return;const{runInfo:a,runDateAndNestInfo:i}=e.data,s=a.run_uuid;r.includes(s)&&(null!==i&&void 0!==i&&i.childrenIds&&r.push(...i.childrenIds),e.setSelected(t,!1,!0))}))}}}),[]),P=(0,n.useCallback)(((e,t)=>{c({orderByKey:e,orderByAsc:t})}),[c]),H=(0,n.useCallback)((e=>c((t=>{let{runsExpanded:r,...n}=t;return{...n,runsExpanded:{...r,[e]:!r[e]}}}))),[c]),O=(0,n.useCallback)((e=>{c((t=>({...t,runsPinned:t.runsPinned.includes(e)?t.runsPinned.filter((t=>t!==e)):[...t.runsPinned,e]}))),requestAnimationFrame((()=>{if(!M)return;const t=M.getRowNode(e);t&&M.redrawRows({rowNodes:[t]})}))}),[M,c]),X=(0,n.useCallback)((e=>{c((t=>{if(e===ge.yz.SHOWALL)return{...t,runsHidden:[]};if(e===ge.yz.HIDEALL)return{...t,runsHidden:m.map((e=>e.runUuid))};const r=e;return{...t,runsHidden:t.runsHidden.includes(r)?t.runsHidden.filter((e=>e!==r)):[...t.runsHidden,r]}}))}),[c,m]),z=(0,n.useCallback)((e=>{R(e.api),T(e.columnApi)}),[]),U=We({searchFacetsState:r,onSortBy:P,onExpand:H,compareExperiments:t.length>1,onTogglePin:O,onToggleVisibility:X,metricKeyList:k,paramKeyList:w,tagKeyList:I,columnApi:E,isComparingRuns:Z,onDatasetSelected:f,expandRows:v});(0,n.useEffect)((()=>{if(M)if(i)M.showLoadingOverlay();else{if(M.hideOverlay(),m.length&&l)return void M.setRowData([...m,{runUuid:(0,o.uniqueId)("load_more"),isLoadMoreRow:!0}]);M.setRowData(m)}}),[M,m,i,l,g]);const V=(0,n.useMemo)((()=>_e(t.length>1).length+(k.length+w.length+I.length)),[t.length,I.length,k.length,w.length]),_=r.selectedColumns.length>=V,W=Math.max(0,V-r.selectedColumns.length),F=!_&&!Z&&m.length>0,K=(0,n.useMemo)((()=>a.runInfos.filter((e=>r.runsPinned.includes(e.run_uuid)||a.runUuidsMatchingFilter.includes(e.run_uuid))).length),[a,r.runsPinned]);(0,n.useLayoutEffect)((()=>{M&&(Z&&(M.deselectAll(),M.sizeColumnsToFit()),M.resetRowHeights())}),[M,Z]);const j=(0,n.useCallback)((e=>Z||!v?ge.G9:((e,t)=>{const r=De(q.D5.ATTRIBUTES,q.z.DATASET);if((0,Se.GW)()&&e.selectedColumns.includes(r)){var n;const{data:e}=t,r=Math.min((null===(n=e.datasets)||void 0===n?void 0:n.length)||1,3);return ge.G9*r}return ge.G9})(r,e)),[r,Z,v]);(0,n.useEffect)((()=>{(0,Se.GW)()&&(null===M||void 0===M||M.resetRowHeights())}),[M,r.selectedColumns,v]);const[$,G]=(0,n.useState)(null),J=(0,n.useCallback)((e=>{var t;let{column:r,data:n,value:a}=e;const i=null===(t=r.getParent())||void 0===t?void 0:t.getGroupId();(i===q.D5.METRICS||i===q.D5.PARAMS)&&(G({value:a,header:`Run name: ${n.runName}, Column name: ${r.getColId()}`}),d({previewPaneVisible:!0}))}),[d]),Q=!Z&&y.previewPaneVisible;return(0,u.BX)("div",{css:e=>({display:"grid",gridTemplateColumns:Q?"1fr auto":"1fr",borderTop:`1px solid ${e.colors.border}`}),children:[(0,u.BX)("div",{css:zn.tableAreaWrapper,children:[(0,u.BX)("div",{ref:A,className:Nt()("ag-theme-balham ag-grid-sticky",{"ag-grid-expanders-visible":L}),css:zn.agGridOverrides,children:[(0,u.tZ)(Cn,{defaultColDef:Fe,columnDefs:U,rowSelection:"multiple",onGridReady:z,onSelectionChanged:D,getRowHeight:j,headerHeight:ge.G9,onRowSelected:N,suppressRowClickSelection:!0,suppressColumnMoveAnimation:!0,suppressScrollOnNewData:!0,isFullWidthRow:Ve,fullWidthCellRenderer:"LoadMoreRowRenderer",fullWidthCellRendererParams:{loadMoreRunsFunc:g},suppressFieldDotNotation:!0,enableCellTextSelection:!0,components:{agColumnHeader:Y,loadingOverlayComponent:b.S,LoadMoreRowRenderer:ke,SourceCellRenderer:me,ModelsCellRenderer:ue,VersionCellRenderer:he,DateCellRenderer:te,ExperimentNameCellRenderer:ie,RowActionsCellRenderer:ve,RowActionsHeaderCellRenderer:be,RunNameCellRenderer:Ce,DatasetsCellRenderer:Ae},suppressNoRowsOverlay:!0,loadingOverlayComponent:"loadingOverlayComponent",loadingOverlayComponentParams:{showImmediately:!0},getRowId:Ue,rowBuffer:101,onCellClicked:J}),F&&(0,u.tZ)(An,{gridContainerElement:A.current,isInitialized:Boolean(M),onClick:p,visible:!i,moreRunsAvailable:l,moreAvailableRunsTableColumnCount:W})]}),m.length<1&&!i&&(0,u.tZ)(Zn,{onClearFilters:()=>c(nt),isFiltered:at(r)}),(0,u.tZ)(Nn,{allRunsCount:K,isLoading:i})]}),Q&&(0,u.tZ)(On,{content:null===$||void 0===$?void 0:$.value,copyText:null===$||void 0===$?void 0:$.value,headerText:null===$||void 0===$?void 0:$.header,onClose:()=>d({previewPaneVisible:!1}),empty:(0,u.tZ)(h.HYy,{description:(0,u.tZ)(C.Z,{id:"cAKSkQ",defaultMessage:"Select a cell to display preview"})})})]})})),zn={tableAreaWrapper:{display:"flex",flexDirection:"column",position:"relative"},agGridOverrides:e=>{const t=(e=>({rowBackground:e.colors.backgroundPrimary,rowBackgroundHover:`${e.colors.grey600}0A`,rowBackgroundSelected:`${e.colors.grey600}14`,rowBackgroundHoverSelected:`${e.colors.grey600}1F`,columnSortedBy:`${e.colors.blue100}b3`,headerBackground:e.colors.grey100,headerTextColor:"#2E3840",headerGroupTextColor:e.colors.textSecondary,borderColor:e.colors.grey200,headerBorderColor:"transparent",checkboxBorderColor:e.colors.actionDefaultBorderDefault,checkboxBorderColorChecked:e.colors.backgroundPrimary,checkboxBackgroundColorChecked:e.colors.actionPrimaryBackgroundDefault}))(e);return{height:"100%",position:"relative","&.ag-theme-balham":{"--ag-border-color":t.borderColor,"--ag-row-border-color":t.borderColor,"--ag-odd-row-background-color":t.rowBackground,"--ag-row-hover-color":t.rowBackgroundHover,"--ag-selected-row-background-color":t.rowBackgroundSelected,"--ag-header-foreground-color":t.headerTextColor,"--ag-header-background-color":t.headerBackground,"&.ag-grid-sticky .ag-header":{position:"sticky",top:0,zIndex:1},"&.ag-grid-sticky .ag-root":{overflow:"visible"},"&.ag-grid-sticky .ag-root-wrapper":{border:"0",borderRadius:"4px",overflow:"visible"},".ag-header::after":{content:'""',position:"absolute",top:ge.G9,left:0,right:0,height:1,backgroundColor:t.borderColor},".ag-cell":{display:"flex",overflow:"hidden","& > .ag-cell-wrapper":{overflow:"hidden"}},".ag-header-cell":{padding:0},".ag-header-cell .ag-checkbox":{padding:"0 7px",borderLeft:"1px solid transparent"},".ag-cell.is-ordered-by, .ag-header-cell > .is-ordered-by":{backgroundColor:t.columnSortedBy},".ag-header-row":{"--ag-border-color":t.headerBorderColor},".ag-header-row.ag-header-row-column-group":{"--ag-header-foreground-color":t.headerGroupTextColor},".ag-row.ag-row-selected.ag-row-hover":{backgroundColor:t.rowBackgroundHoverSelected},".ag-header:not(:hover) .ag-header-cell::after, .ag-header:not(:hover) .ag-header-group-cell::after":{opacity:0},".ag-pinned-left-header":{borderRight:"none"},".ag-overlay-loading-wrapper":{paddingTop:4*e.spacing.md,alignItems:"center",zIndex:2},".ag-overlay-loading-wrapper .ag-react-container":{flex:1},".ag-center-cols-container":{minHeight:0},".ag-full-width-row":{borderBottom:0,backgroundColor:"transparent",zIndex:1,"&.ag-row-hover":{backgroundColor:"transparent"}},".is-checkbox-cell":{display:"flex",alignItems:"center",paddingLeft:7,".is-multiline-cell .ag-cell-value":{height:"100%"}},".is-previewable-cell":{cursor:"pointer"},".ag-header-cell .ag-checkbox .ag-input-wrapper:not(.ag-indeterminate):not(.ag-checked)":{"--ag-checkbox-background-color":t.headerBackground},".ag-cell-wrapper .ag-selection-checkbox":{marginRight:20},".is-checkbox-cell, .ag-header-cell .ag-checkbox":{".ag-checkbox-input-wrapper::after":{color:t.checkboxBorderColor},".ag-checkbox-input-wrapper.ag-checked":{"--ag-checkbox-background-color":t.checkboxBackgroundColorChecked,"--ag-checkbox-checked-color":t.checkboxBorderColorChecked,"&::after":{color:t.checkboxBorderColorChecked}}}}}}};var Un=r(79108);class Vn{constructor(){this.runsSelected={},this.hiddenChildRunsSelected={},this.columnSelectorVisible=!1,this.previewPaneVisible=!1,this.viewMaximized=!1,this.artifactViewState={selectedTables:[],groupByCols:[],outputColumn:"",intersectingOnly:!1}}}var _n=r(89173),Wn=r(78438);let Fn=function(e){return e.BAR="BAR",e.LINE="LINE",e.SCATTER="SCATTER",e.CONTOUR="CONTOUR",e.PARALLEL="PARALLEL",e}({});class Kn{constructor(e){this.uuid=void 0,this.type=Fn.BAR,this.runsCountToCompare=10,this.uuid=e}static serialize(e){return Object.keys(e).reduce(((t,r)=>({...t,[r]:e[r]})),{})}static getEmptyChartCardByType(e,t){return e===Fn.BAR?new qn(t):e===Fn.SCATTER?new jn(t):e===Fn.PARALLEL?new Gn(t):e===Fn.LINE?new $n(t):new Yn(t)}static getBaseChartConfigs(e,t){const r=[],n=new Set;e&&n.add(e);for(const a of Object.keys(t))n.add(a);return[...n].slice(0,30).forEach((e=>{var n,a;let i=Fn.BAR;void 0!==(null===(n=t[e])||void 0===n?void 0:n.step)&&(null===(a=t[e])||void 0===a?void 0:a.step)>=2&&(i=Fn.LINE),r.push({...Kn.getEmptyChartCardByType(i,(0,Wn.Fs)()),metricKey:e})})),r.push(Kn.getEmptyChartCardByType(Fn.PARALLEL,(0,Wn.Fs)())),r}}class jn extends Kn{constructor(){super(...arguments),this.type=Fn.SCATTER,this.xaxis={key:"",type:"METRIC"},this.yaxis={key:"",type:"METRIC"},this.runsCountToCompare=100}}class $n extends Kn{constructor(){super(...arguments),this.type=Fn.LINE,this.metricKey="",this.lineSmoothness=0,this.scaleType="linear",this.xAxisKey="step"}}class qn extends Kn{constructor(){super(...arguments),this.type=Fn.BAR,this.metricKey=""}}class Yn extends Kn{constructor(){super(...arguments),this.type=Fn.CONTOUR,this.xaxis={key:"",type:"METRIC"},this.yaxis={key:"",type:"METRIC"},this.zaxis={key:"",type:"METRIC"}}}class Gn extends Kn{constructor(){super(...arguments),this.type=Fn.PARALLEL,this.selectedParams=[],this.selectedMetrics=[]}}var Jn,Qn,ea,ta,ra;function na(){return na=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},na.apply(this,arguments)}function aa(e,t){let{title:r,titleId:a,...i}=e;return n.createElement("svg",na({width:18,height:16,viewBox:"0 0 18 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":a},i),r?n.createElement("title",{id:a},r):null,Jn||(Jn=n.createElement("path",{d:"M1 0.813599V15.1865H17",stroke:"#A3AEB8",strokeLinecap:"round"})),Qn||(Qn=n.createElement("rect",{x:3.16943,y:10.5763,width:2.16949,height:3.25424,fill:"#338ECC"})),ea||(ea=n.createElement("rect",{x:6.42371,y:5.15259,width:2.16949,height:8.67797,fill:"#338ECC"})),ta||(ta=n.createElement("rect",{x:9.67798,y:8.40686,width:2.16949,height:5.42373,fill:"#338ECC"})),ra||(ra=n.createElement("rect",{x:12.9323,y:1.89832,width:2.16949,height:11.9322,fill:"#338ECC"})))}const ia=n.forwardRef(aa);var sa,oa,la;r.p;function ca(){return ca=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ca.apply(this,arguments)}function da(e,t){let{title:r,titleId:a,...i}=e;return n.createElement("svg",ca({width:18,height:18,viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":a},i),r?n.createElement("title",{id:a},r):null,sa||(sa=n.createElement("path",{d:"M1 1V17H17",stroke:"#A3AEB8",strokeLinecap:"round"})),oa||(oa=n.createElement("path",{d:"M12.9749 4.94148C12.9188 4.71702 12.221 4.73284 12.0618 4.71515C11.1779 4.61693 10.2817 4.66052 9.39271 4.66052C8.11919 4.66052 7.15648 4.97961 6.24753 5.90922C5.86197 6.30355 5.5235 6.77684 5.23295 7.24378C4.99434 7.62726 4.65544 7.93479 4.40569 8.31299C3.93777 9.02154 3.56281 9.80723 3.56281 10.6699C3.56281 11.1806 3.37479 11.598 3.76962 12.0669C4.19449 12.5714 4.6863 12.9507 5.27978 13.2649C5.88594 13.5858 6.42202 13.8619 7.13723 13.8619C7.74338 13.8619 8.34952 13.8619 8.95567 13.8619C9.45735 13.8619 9.96042 13.8731 10.4619 13.8619C11.1412 13.8468 11.9484 13.1895 12.413 12.7381C13.581 11.6035 14.2393 9.88016 14.2393 8.24665C14.2393 7.69923 14.3797 7.17063 14.3797 6.62723C14.3797 6.40084 14.4779 5.87696 14.2744 5.71411C13.9268 5.43606 13.5785 5.13789 13.1857 4.94148",stroke:"#338ECC",strokeLinecap:"round"})),la||(la=n.createElement("path",{d:"M11.9213 6.83789C11.2761 6.83789 10.6309 6.83789 9.98577 6.83789C9.19776 6.83789 8.80182 7.44144 8.2844 7.97734C7.58163 8.70521 7.28544 9.67306 7.28544 10.666C7.28544 10.9641 7.22004 11.177 7.46104 11.3645C7.6831 11.5372 8.10719 11.6142 8.37806 11.6142C9.07316 11.6142 9.91042 11.5583 10.4462 11.0523C10.9277 10.5975 11.473 10.3701 11.8159 9.75284C12.045 9.34042 12.2022 8.86324 12.2022 8.38317C12.2022 8.14903 12.2022 7.9149 12.2022 7.68077C12.2022 7.4241 12.0208 7.38817 11.9213 7.18909",stroke:"#338ECC",strokeLinecap:"round"})))}const ua=n.forwardRef(da);var pa,ma;r.p;function ha(){return ha=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ha.apply(this,arguments)}function ga(e,t){let{title:r,titleId:a,...i}=e;return n.createElement("svg",ha({width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":a},i),r?n.createElement("title",{id:a},r):null,pa||(pa=n.createElement("path",{d:"M4.38977 15.717L8.79655 10.8113L12.5254 14.9622L19.644 7.03772",stroke:"#338ECC",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})),ma||(ma=n.createElement("path",{d:"M1 1V21H21",stroke:"#A3AEB8",strokeLinecap:"round"})))}const fa=n.forwardRef(ga);var va,ya,ba,xa,Ca;r.p;function Za(){return Za=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Za.apply(this,arguments)}function wa(e,t){let{title:r,titleId:a,...i}=e;return n.createElement("svg",Za({width:18,height:18,viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":a},i),r?n.createElement("title",{id:a},r):null,va||(va=n.createElement("path",{d:"M1 1V17H17",stroke:"#A3AEB8",strokeLinecap:"round"})),ya||(ya=n.createElement("path",{d:"M4.21875 3.58289C4.55663 3.58289 4.88067 3.68935 5.21469 3.73008C5.6474 3.78285 6.02137 3.96513 6.37191 4.21552C6.76902 4.49917 7.0271 4.74589 7.24101 5.18954C7.44337 5.60925 7.59378 6.06989 7.72958 6.51432C7.86002 6.94121 8.09708 7.33726 8.19153 7.77803C8.25347 8.0671 8.34514 8.32427 8.44678 8.60015C8.58028 8.96252 8.80086 9.27915 8.96667 9.62583C9.15145 10.0122 9.216 10.4461 9.34876 10.8551C9.57831 11.5623 9.91132 12.4763 10.7205 12.6731C11.4284 12.8453 12.1459 12.8845 12.8705 12.8845C13.0981 12.8845 13.3979 12.898 13.5831 12.7499C13.6402 12.7042 13.7451 12.6907 13.8164 12.6591C13.8752 12.6329 14.0919 12.5871 14.1123 12.5463",stroke:"#CCE3F2",strokeLinecap:"round"})),ba||(ba=n.createElement("path",{d:"M4.16162 12.9805C4.32512 12.9805 4.4895 12.9859 4.65284 12.9805C4.84076 12.9742 5.0468 12.7952 5.2099 12.707C5.62236 12.4841 5.99426 12.0648 6.24299 11.6739C6.49491 11.2781 6.8776 10.9871 7.0887 10.5649C7.27767 10.187 7.50992 9.80749 7.73691 9.45078C7.93911 9.13304 8.10211 8.77722 8.28637 8.44554C8.43088 8.18544 8.45 7.88672 8.60542 7.62768C8.94898 7.05509 9.16215 6.418 9.45873 5.82484C9.72614 5.29001 9.96898 4.82426 10.4159 4.42207C10.5753 4.27853 10.8984 4.21824 11.0995 4.14861C11.3303 4.06873 11.579 4.02714 11.8136 3.93592C12.0394 3.84807 12.2521 3.84383 12.4795 3.77386C12.6993 3.70623 12.9319 3.63713 13.1632 3.63713C13.5192 3.63713 13.9089 3.59155 14.2798 3.59155",stroke:"#CCE3F2",strokeLinecap:"round"})),xa||(xa=n.createElement("path",{d:"M3.79248 2.74207V13.8225",stroke:"#338ECC",strokeLinecap:"round"})),Ca||(Ca=n.createElement("path",{d:"M14.873 3.04419V13.7217",stroke:"#338ECC",strokeLinecap:"round"})))}const ka=n.forwardRef(wa);var Sa,Ma,Ra,Ea,Ta,Ba,Ia;r.p;function Aa(){return Aa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Aa.apply(this,arguments)}function La(e,t){let{title:r,titleId:a,...i}=e;return n.createElement("svg",Aa({width:18,height:16,viewBox:"0 0 18 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":a},i),r?n.createElement("title",{id:a},r):null,Sa||(Sa=n.createElement("path",{d:"M1 0.813599V15.1865H17",stroke:"#A3AEB8",strokeLinecap:"round"})),Ma||(Ma=n.createElement("circle",{cx:3.98301,cy:12.4746,r:1.35593,fill:"#338ECC"})),Ra||(Ra=n.createElement("ellipse",{cx:9.40684,cy:10.8475,rx:1.35593,ry:1.35593,fill:"#338ECC"})),Ea||(Ea=n.createElement("circle",{cx:5.6102,cy:8.1356,r:1.35593,fill:"#338ECC",fillOpacity:.25})),Ta||(Ta=n.createElement("circle",{cx:9.40684,cy:6.50852,r:1.35593,fill:"#338ECC"})),Ba||(Ba=n.createElement("ellipse",{cx:13.7457,cy:5.96616,rx:1.35593,ry:1.35593,fill:"#338ECC",fillOpacity:.25})),Ia||(Ia=n.createElement("ellipse",{cx:16.4576,cy:2.46128,rx:1.35593,ry:1.35593,fill:"#338ECC"})))}const Da=n.forwardRef(La);r.p;const Na=e=>{let{onAddChart:t}=e;return(0,u.BX)(b.M.Root,{modal:!1,children:[(0,u.tZ)(b.M.Trigger,{asChild:!0,children:(0,u.tZ)(b.B,{css:Pa.addChartButton,icon:(0,u.tZ)(h.pOD,{}),"data-testid":"experiment-view-compare-runs-add-chart",children:"Add chart"})}),(0,u.BX)(b.M.Content,{align:"end",children:[(0,u.BX)(b.M.Item,{onClick:()=>t(Fn.BAR),"data-testid":"experiment-view-compare-runs-chart-type-bar",children:[(0,u.tZ)(b.M.IconWrapper,{css:Pa.iconWrapper,children:(0,u.tZ)(ia,{})}),"Bar chart"]}),(0,u.BX)(b.M.Item,{onClick:()=>t(Fn.LINE),"data-testid":"experiment-view-compare-runs-chart-type-line",children:[(0,u.tZ)(b.M.IconWrapper,{css:Pa.iconWrapper,children:(0,u.tZ)(fa,{})}),"Line chart"]}),(0,u.BX)(b.M.Item,{onClick:()=>t(Fn.PARALLEL),"data-testid":"experiment-view-compare-runs-chart-type-parallel",children:[(0,u.tZ)(b.M.IconWrapper,{css:Pa.iconWrapper,children:(0,u.tZ)(ka,{})}),"Parallel coordinates"]}),(0,u.BX)(b.M.Item,{onClick:()=>t(Fn.SCATTER),"data-testid":"experiment-view-compare-runs-chart-type-scatter",children:[(0,u.tZ)(b.M.IconWrapper,{css:Pa.iconWrapper,children:(0,u.tZ)(Da,{})}),"Scatter chart"]}),(0,u.BX)(b.M.Item,{onClick:()=>t(Fn.CONTOUR),"data-testid":"experiment-view-compare-runs-chart-type-contour",children:[(0,u.tZ)(b.M.IconWrapper,{css:Pa.iconWrapper,children:(0,u.tZ)(ua,{})}),"Contour chart"]})]})]})},Pa={addChartButton:e=>({backgroundColor:`${e.colors.backgroundPrimary} !important`}),iconWrapper:e=>({width:e.general.iconSize+e.spacing.xs})};var Ha=r(79424);const Oa=e=>{const t=(0,n.useRef)(e);return(0,n.useEffect)((()=>{t.current=e}),[e]),e=>{t.current(e)}},Xa=(e,t)=>(r,n,a)=>{var i,s;const o=-1===n&&-1===a;var l,c,d,u;(null===(i=r.querySelector(".is-hover-highlight"))||void 0===i||i.classList.remove("is-hover-highlight"),n>-1)&&(null===(l=r.querySelectorAll(e)[n])||void 0===l||l.classList.add("is-hover-highlight"));(null===(s=r.querySelector(".is-selection-highlight"))||void 0===s||s.classList.remove("is-selection-highlight"),a>-1)&&(null===(c=r.querySelectorAll(e)[a])||void 0===c||c.classList.add("is-selection-highlight"));o?null===(d=r.querySelector(t))||void 0===d||d.classList.remove("is-highlight"):null===(u=r.querySelector(t))||void 0===u||u.classList.add("is-highlight")},za=Xa("svg .trace.bars g.point",".trace.bars"),Ua=Xa("svg .scatterlayer g.trace",".scatterlayer"),Va=Xa("svg .scatterlayer path.point",".trace.scatter"),_a=(e,t,r,a)=>{const i=(0,n.useMemo)((()=>e?r.findIndex((e=>e.runInfo.run_uuid===t)):-1),[r,e,t]),[s,o]=(0,n.useState)(-1);return(0,n.useEffect)((()=>{e&&a(e,s,i)}),[a,e,i,s]),{selectedTraceIndex:i,hoveredPointIndex:s,setHoveredPointIndex:o}};var Wa=r(1132);const Fa={displaylogo:!1,scrollZoom:!0,doubleClick:"autosize",showTips:!1},Ka=n.memo((e=>{let{runsData:t,metricKey:r,className:i,margin:s=Wa.MP,onUpdate:o,onHover:l,onUnhover:c,barWidth:d=.5,width:p,height:m,displayRunNames:h=!0,useDefaultHoverBox:g=!0,displayMetricKey:f=!0,selectedRunUuid:v}=e;const y=(0,n.useMemo)((()=>{const e=t.map((e=>e.runInfo.run_uuid)),n=t.map((e=>{var t;return(0,Wa.To)(null===(t=e.metrics[r])||void 0===t?void 0:t.value)})),a=t.map((e=>{var t;return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"number"===typeof e?e.toFixed(t):e}(null===(t=e.metrics[r])||void 0===t?void 0:t.value)})),i=t.map((e=>e.color)),s=n.some((e=>e&&e<0));return[{y:e,x:n,text:a,textposition:s?"auto":"outside",textfont:{size:11},type:"bar",hovertemplate:g?"%{label}<extra></extra>":void 0,hoverinfo:g?"y":"none",hoverlabel:g?Wa.Lg:void 0,width:d,orientation:"h",marker:{color:i}}]}),[t,r,d,g]),{layoutHeight:b,layoutWidth:x,setContainerDiv:C,containerDiv:Z,isDynamicSizeSupported:w}=(0,Wa.Ih)(),{formatMessage:k}=(0,a.Z)(),[S,M]=(0,n.useState)({width:p||x,height:m||b,margin:s,xaxis:{title:f?r:void 0},yaxis:{showticklabels:h,title:h?k({id:"+hQ+de",defaultMessage:"Run name"}):void 0,tickfont:{size:11},fixedrange:!0}});(0,n.useEffect)((()=>{M((e=>({...e,width:p||x,height:m||b,margin:s,xaxis:{...e.xaxis,title:f?r:void 0}})))}),[x,b,s,r,p,m,f]);const{setHoveredPointIndex:R}=_a(Z,v,t,za),E=(0,n.useCallback)((e=>{var t,r,n;let{points:a,event:i}=e;R(null!==(t=null===(r=a[0])||void 0===r?void 0:r.pointIndex)&&void 0!==t?t:-1);const s=null===(n=a[0])||void 0===n?void 0:n.label;s&&(null===l||void 0===l||l(s,i))}),[l,R]),T=(0,n.useCallback)((()=>{null===c||void 0===c||c(),R(-1)}),[c,R]),B=Oa(E);return(0,u.tZ)("div",{css:[Wa.QW.chartWrapper,ja.highlightStyles,""],className:i,ref:C,children:(0,u.tZ)(Ha.L,{data:y,useResizeHandler:!w,css:Wa.QW.chart,onUpdate:o,layout:S,config:Fa,onHover:B,onUnhover:T})})})),ja={highlightStyles:{".trace.bars g.point path":{transition:"var(--trace-transition)"},".trace.bars.is-highlight g.point path":{opacity:"var(--trace-opacity-dimmed-high) !important"},".trace.bars g.point.is-hover-highlight path":{opacity:"var(--trace-opacity-highlighted) !important"},".trace.bars g.point.is-selection-highlight path":{opacity:"var(--trace-opacity-highlighted) !important",stroke:"var(--trace-stroke-color)",strokeWidth:"var(--trace-stroke-width) !important"}}},$a=n.createContext(null);let qa=function(e){return e[e.HIDDEN=0]="HIDDEN",e[e.HOVER=1]="HOVER",e[e.VISIBLE=2]="VISIBLE",e}({});const Ya=e=>{if(null===e||!(e instanceof Element))return null;if(e instanceof HTMLElement)return e;let t=e;for(;t&&!(t instanceof HTMLElement);)t=t.parentElement;return t},Ga=e=>{let{className:t,children:r,contextData:a,component:i,hoverOnly:s=!1}=e;const o=(0,n.useRef)(null),l=(0,n.useRef)(null),c=(0,n.useRef)({x:0,y:0}),[d,p]=(0,n.useState)(qa.HIDDEN),[m,h]=(0,n.useState)(null),[g,f]=(0,n.useState)(""),[v,y]=(0,n.useState)(null),b=(0,n.useRef)(null),x=(0,n.useRef)(d),C=(0,n.useRef)(g),Z=(0,n.useRef)(m),w=(0,n.useCallback)((()=>{if(!l.current||!o.current)return;let e=c.current.x,t=c.current.y;const r=l.current.getBoundingClientRect(),n=o.current.getBoundingClientRect();c.current.x+r.width>=n.width&&(e-=r.width),c.current.y+r.height>=n.height&&(t-=r.height),l.current.style.left="0px",l.current.style.top="0px",l.current.style.transform=`translate3d(${e+1}px, ${t+1}px, 0)`}),[]);(0,n.useEffect)((()=>{x.current=d}),[d]);const k=(0,n.useCallback)(((e,t)=>{var r;const n=e.getBoundingClientRect(),a=(null===(r=o.current)||void 0===r?void 0:r.getBoundingClientRect())||{left:0,top:0};return{x:t.offsetX+(n.left-a.left),y:t.offsetY+(n.top-a.top)}}),[]),S=(0,n.useCallback)((e=>{if(x.current===qa.HOVER&&l.current&&o.current){b.current=null;const t=Ya(e.target);t&&(c.current=k(t,e.nativeEvent),w())}}),[w,k]),M=(0,n.useCallback)(((e,t,r,n)=>{var a;C.current=e,Z.current=t,x.current!==qa.VISIBLE&&(h(t),!e&&null!==(a=b.current)&&void 0!==a&&a.runUuid||f((t=>(n&&y(n),x.current===qa.HIDDEN||x.current===qa.HOVER&&e!==t?(p(qa.HOVER),e):t))))}),[]),R=(0,n.useCallback)((e=>{s||0===e.button&&C.current&&(b.current={x:e.nativeEvent.pageX,y:e.nativeEvent.pageY,runUuid:C.current})}),[s]),E=(0,n.useCallback)((e=>{var t;if(null!==(t=b.current)&&void 0!==t&&t.runUuid&&e.nativeEvent.pageX===b.current.x&&e.nativeEvent.pageY===b.current.y){if(x.current===qa.VISIBLE){f(b.current.runUuid);const t=Ya(e.nativeEvent.target);t&&(c.current=k(t,e.nativeEvent),w())}else p(qa.VISIBLE);e.stopPropagation()}b.current=null}),[w,k]),T=(0,n.useCallback)((()=>p(qa.HIDDEN)),[]);(0,n.useLayoutEffect)((()=>{if(!o.current)return;const e=o.current.getRootNode(),t=e=>{var t;if(x.current!==qa.VISIBLE)return;const r=Ya(e.target);if(!r)return;r instanceof HTMLElement&&(null===l||void 0===l?void 0:l.current)instanceof HTMLElement&&l.current.contains(r)||null!==(t=b.current)&&void 0!==t&&t.runUuid||p(qa.HIDDEN)};return e.addEventListener("click",t,{capture:!0}),()=>{e.removeEventListener("click",t,{capture:!0})}}),[k,w]);const B=(0,n.useCallback)((()=>{var e;C.current="",null!==(e=b.current)&&void 0!==e&&e.runUuid||x.current===qa.VISIBLE||(f(""),p(qa.HIDDEN))}),[]),I=(0,n.useMemo)((()=>d!==qa.VISIBLE?null:g),[d,g]),A=(0,n.useMemo)((()=>({updateTooltip:M,resetTooltip:B,selectedRunUuid:I,closeContextMenu:T})),[M,B,I,T]);return(0,u.BX)($a.Provider,{value:A,children:[(0,u.tZ)("div",{onMouseMove:S,onMouseDownCapture:R,onClickCapture:E,children:r}),(0,u.tZ)("div",{css:Qa.contextMenuContainer,className:t,ref:o,children:d!==qa.HIDDEN&&g&&(0,u.tZ)("div",{ref:l,css:Qa.contextMenuWrapper,"data-testid":"tooltip-container",style:{userSelect:d===qa.HOVER?"none":"unset",pointerEvents:d===qa.HOVER?"none":"all"},children:(0,u.tZ)(i,{runUuid:g,additionalAxisData:v,hoverData:m,contextData:a,isHovering:d===qa.HOVER,closeContextMenu:T})})})]})},Ja=e=>{const t=(0,n.useContext)($a);if(!t)throw new Error("You must invoke useCompareRunsTooltip() in a component being ancestor of <CompareRunsTooltipWrapper />!");const{updateTooltip:r,resetTooltip:a,selectedRunUuid:i,closeContextMenu:s}=t,o=(0,n.useCallback)((function(){r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e,arguments.length>1?arguments[1]:void 0,arguments.length>2?arguments[2]:void 0)}),[r,e]);return{setTooltip:o,resetTooltip:a,selectedRunUuid:i,closeContextMenu:s}},Qa={contextMenuContainer:{overflow:"hidden",top:0,left:0,width:"100%",height:"100%",position:"fixed",pointerEvents:"none"},contextMenuWrapper:e=>({zIndex:1,position:"absolute",padding:e.spacing.sm,backgroundColor:"white",border:`1px solid ${e.colors.border}`,left:-999,top:-999}),overlayElement:()=>({"&::after":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"transparent"}})};var ei={name:"d3v9zr",styles:"overflow:hidden"},ti={name:"72wqca",styles:"margin-bottom:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"};const ri=e=>{let{title:t,subtitle:r,onDelete:n,onEdit:a,children:i,fullWidth:s=!1,tooltip:o=""}=e;return(0,u.BX)("div",{css:ni.chartEntry(s),"data-testid":"experiment-view-compare-runs-card",children:[(0,u.BX)("div",{css:ni.chartEntryTitle,children:[(0,u.BX)("div",{css:ei,children:[(0,u.tZ)(b.j.Title,{title:String(t),level:4,css:ti,children:t}),r&&(0,u.tZ)("span",{css:ni.subtitle,children:r}),o&&(0,u.tZ)(h.bEE,{title:o})]}),(0,u.BX)(b.M.Root,{modal:!1,children:[(0,u.tZ)(b.M.Trigger,{asChild:!0,children:(0,u.tZ)(b.B,{type:"tertiary",icon:(0,u.tZ)(h.VZO,{}),"data-testid":"experiment-view-compare-runs-card-menu"})}),(0,u.BX)(b.M.Content,{align:"end",minWidth:100,children:[(0,u.tZ)(b.M.Item,{onClick:a,"data-testid":"experiment-view-compare-runs-card-edit",children:"Configure"}),(0,u.tZ)(b.M.Item,{onClick:n,"data-testid":"experiment-view-compare-runs-card-delete",children:"Delete"})]})]})]}),i]})},ni={chartEntry:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t=>({height:360,maxWidth:e?"unset":800,overflow:"hidden",display:"grid",gridTemplateRows:"auto 1fr",backgroundColor:t.colors.backgroundPrimary,padding:t.spacing.md,border:`1px solid ${t.colors.border}`,borderRadius:t.general.borderRadiusBase})},chartComponentWrapper:()=>({overflow:"hidden"}),chartEntryTitle:()=>({display:"grid",gridTemplateColumns:"1fr auto",alignItems:"flex-start"}),subtitle:e=>({color:e.colors.textSecondary,fontSize:11,marginRight:4})},ai={t:24,b:48,r:0,l:4,pad:0},ii=e=>{let{config:t,chartRunData:r,onDelete:a,onEdit:i}=e;const s=(0,n.useMemo)((()=>r.slice(0,t.runsCountToCompare||10).reverse()),[r,t]),{setTooltip:o,resetTooltip:l,selectedRunUuid:c}=Ja(t);return(0,u.tZ)(ri,{onEdit:i,onDelete:a,title:t.metricKey,subtitle:(0,u.BX)(u.HY,{children:["Comparing first ",s.length," runs"]}),children:(0,u.tZ)("div",{css:si.barChartCardWrapper,children:(0,u.tZ)(Ka,{runsData:s,metricKey:t.metricKey,displayRunNames:!1,displayMetricKey:!1,useDefaultHoverBox:!1,margin:ai,onHover:o,onUnhover:l,selectedRunUuid:c})})})},si={barChartCardWrapper:{overflow:"hidden"}};var oi,li,ci,di;function ui(){return ui=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ui.apply(this,arguments)}function pi(e,t){let{title:r,titleId:a,...i}=e;return n.createElement("svg",ui({width:80,height:42,viewBox:"0 0 80 42",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":a},i),r?n.createElement("title",{id:a},r):null,oi||(oi=n.createElement("path",{d:"M1.28418 2.34094L39.4998 17.0908L76.3746 7.87216",stroke:"#CF797B",strokeLinecap:"round"})),li||(li=n.createElement("path",{d:"M1.95459 20.443L40.1702 25.1361L77.045 21.1134M1.95459 36.5338L40.1702 35.1929L77.045 25.1361",stroke:"#A88E6F",strokeLinecap:"round"})),ci||(ci=n.createElement("g",{opacity:.8},n.createElement("path",{d:"M1.28418 1V40.3341",stroke:"#338ECC",strokeLinecap:"round"}),n.createElement("path",{d:"M40.6189 2.07251V39.9763",stroke:"#338ECC",strokeLinecap:"round"}),n.createElement("path",{d:"M77.7156 2.07251V39.9763",stroke:"url(#paint0_linear_2781_406689)",strokeWidth:4,strokeLinecap:"square"}))),di||(di=n.createElement("defs",null,n.createElement("linearGradient",{id:"paint0_linear_2781_406689",x1:78.2156,y1:2.07251,x2:78.2156,y2:39.9763,gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#D04F5E"}),n.createElement("stop",{offset:1,stopColor:"#4D9734"})))))}const mi=n.forwardRef(pi);r.p;const hi=n.lazy((()=>Promise.all([r.e(807),r.e(97)]).then(r.bind(r,63308)))),gi=30;function fi(e,t,r){return function(e){const t=Object.keys(e[0]);t.shift();let r=e;return t.forEach((e=>{const t=r.filter((t=>!isNaN(Number(t[e]))&&null!==t[e]));if(t.length>=r.length/2)return void(r=t);const n=new Set,a=[];for(const i of r){const t=i[e];n.size===gi&&n.has(String(t))?a.push(i):n.size<gi&&isNaN(Number(t))&&(n.add(String(t)),a.push(i))}r=a})),r}(e.map((e=>{const n={uuid:e.runInfo.run_uuid};function a(e,t){if(Array.isArray(e))for(const r of e)n[r]=r in t?t[r].value:null}return a(t,e.params),a(r,e.metrics),n})))}var vi=e=>(0,u.tZ)(n.Suspense,{fallback:(0,u.tZ)(h.Qck,{}),children:(0,u.tZ)(hi,{...e})});var yi={name:"1neqb0a",styles:"display:flex;flex:1;justify-content:center;align-items:center"},bi={name:"10zh1lj",styles:"display:flex;flex-direction:column;align-items:center;max-width:360px"},xi={name:"yz1nei",styles:"margin-top:16px"},Ci={name:"18uqayh",styles:"margin-bottom:16px"};const Zi=e=>{let{onEdit:t}=e;return(0,u.tZ)("div",{css:yi,children:(0,u.BX)("div",{css:bi,children:[(0,u.tZ)(mi,{}),(0,u.tZ)(b.j.Title,{css:xi,color:"secondary",level:3,children:"Compare parameter importance"}),(0,u.tZ)(b.j.Text,{css:Ci,color:"secondary",children:"Use the parallel coordinates chart to compare how various parameters in model affect your model metrics."}),(0,u.tZ)(b.B,{type:"primary",onClick:t,children:"Configure chart"})]})})},wi=e=>{let{config:t,chartRunData:r,onDelete:a,onEdit:i}=e;const[s,o]=(0,n.useMemo)((()=>{var e,n;const a=((null===(e=t.selectedParams)||void 0===e?void 0:e.length)||0)+((null===(n=t.selectedMetrics)||void 0===n?void 0:n.length)||0)>=2;return[a,a?fi(r,t.selectedParams,t.selectedMetrics):[]]}),[t,r]),{setTooltip:l,resetTooltip:c,selectedRunUuid:d,closeContextMenu:p}=Ja(t);return(0,u.tZ)(ri,{onEdit:i,onDelete:a,title:"Parallel Coordinates",subtitle:s?(0,u.BX)(u.HY,{children:["Comparing ",o.length," runs"]}):null,fullWidth:!0,tooltip:"The Parallel Coordinates Chart now only shows runs with columns that are either numbers or strings. If a column has string entries, the runs corresponding to the 30 most recent unique values will be shown.",children:s?o.length?(0,u.tZ)("div",{css:ki.parallelChartCardWrapper,children:(0,u.tZ)(vi,{data:o,selectedParams:t.selectedParams,selectedMetrics:t.selectedMetrics,onHover:l,onUnhover:c,axesRotateThreshold:8,selectedRunUuid:d,closeContextMenu:p})}):null:(0,u.tZ)(Zi,{onEdit:i})})},ki={parallelChartCardWrapper:{display:"flex",overflow:"hidden",cursor:"pointer"}};var Si=r(64218);const Mi={displaylogo:!1,scrollZoom:!0},Ri=n.memo((e=>{let{runsData:t,xAxis:r,yAxis:a,markerSize:i=10,className:s,margin:o=Wa.MP,onUpdate:l,onHover:c,onUnhover:d,width:p,height:m,useDefaultHoverBox:h=!0,selectedRunUuid:g}=e;const f=(0,Si.u)(),{layoutHeight:v,layoutWidth:y,setContainerDiv:b,containerDiv:x,isDynamicSizeSupported:C}=(0,Wa.Ih)(),Z=(0,n.useMemo)((()=>{const e=[],n=[],s=[],o=[];for(const i of t){var l,c;const{runInfo:{run_uuid:t,run_name:d},metrics:u,params:p,color:m}=i,h="METRIC"===r.type?u:p,g="METRIC"===a.type?u:p,v=(null===h||void 0===h||null===(l=h[r.key])||void 0===l?void 0:l.value)||void 0,y=(null===g||void 0===g||null===(c=g[a.key])||void 0===c?void 0:c.value)||void 0;v&&y&&(e.push(v),n.push(y),s.push(m||f.colors.primary),o.push([t,d||t]))}return[{x:e,y:n,customdata:o,hovertemplate:h?"<b>%{customdata[1]}:</b><br><b>%{xaxis.title.text}:</b> %{x:.2f}<br><b>%{yaxis.title.text}:</b> %{y:.2f}<br><extra></extra>":void 0,hoverinfo:h?void 0:"none",hoverlabel:h?Wa.Lg:void 0,type:"scatter",mode:"markers",marker:{size:i,color:s}}]}),[t,r,a,f,i,h]),[w,k]=(0,n.useState)({width:p||y,height:m||v,margin:o,xaxis:{title:r.key},yaxis:{title:a.key}});(0,n.useEffect)((()=>{k((e=>{const t={...e,width:p||y,height:m||v,margin:o};return t.xaxis&&(t.xaxis.title=r.key),t.yaxis&&(t.yaxis.title=a.key),t}))}),[y,v,o,r.key,a.key,p,m]);const{setHoveredPointIndex:S}=_a(x,g,t,Va),M=(0,n.useCallback)((e=>{var t,r,n,a;let{points:i}=e;const s=null===(t=i[0])||void 0===t||null===(r=t.customdata)||void 0===r?void 0:r[0];S(null!==(n=null===(a=i[0])||void 0===a?void 0:a.pointIndex)&&void 0!==n?n:-1),s&&(null===c||void 0===c||c(s))}),[c,S]),R=(0,n.useCallback)((()=>{null===d||void 0===d||d(),S(-1)}),[d,S]),E=Oa(M);return(0,u.tZ)("div",{css:[Wa.QW.chartWrapper,Wa.QW.scatterChartHighlightStyles,""],className:s,ref:b,children:(0,u.tZ)(Ha.L,{data:Z,useResizeHandler:!C,css:Wa.QW.chart,layout:w,config:Mi,onUpdate:l,onHover:E,onUnhover:R})})})),Ei=e=>{let{config:t,chartRunData:r,onDelete:a,onEdit:i}=e;const s=(0,n.useMemo)((()=>r.slice(0,t.runsCountToCompare||10).reverse()),[r,t]),{setTooltip:o,resetTooltip:l,selectedRunUuid:c}=Ja(t);return(0,u.tZ)(ri,{onEdit:i,onDelete:a,title:`${t.xaxis.key} vs. ${t.yaxis.key}`,subtitle:(0,u.BX)(u.HY,{children:["Comparing first ",s.length," runs"]}),children:(0,u.tZ)("div",{css:Ti.scatterChartCardWrapper,children:(0,u.tZ)(Ri,{runsData:s,xAxis:t.xaxis,yAxis:t.yaxis,onHover:o,onUnhover:l,useDefaultHoverBox:!1,selectedRunUuid:c})})})},Ti={scatterChartCardWrapper:{overflow:"hidden"}},Bi={displaylogo:!1,scrollZoom:!0},Ii=[[0,"rgb(5,10,172)"],[.35,"rgb(40,60,190)"],[.5,"rgb(70,100,245)"],[.6,"rgb(90,120,245)"],[.7,"rgb(106,137,247)"],[1,"rgb(220,220,220)"]],Ai=n.memo((e=>{let{runsData:t,xAxis:r,yAxis:a,zAxis:i,markerSize:s=10,className:o,reverseScale:l,margin:c=Wa.r$,colorScale:d=Ii,onUpdate:p,onHover:m,onUnhover:h,width:g,height:f,useDefaultHoverBox:v=!0,selectedRunUuid:y}=e;const b=(0,Si.u)(),{layoutHeight:x,layoutWidth:C,setContainerDiv:Z,containerDiv:w,isDynamicSizeSupported:k}=(0,Wa.Ih)(),S=(0,n.useMemo)((()=>{const e=[],n=[],o=[],c=[],u=[];for(const s of t){var p,m,h;const{runInfo:{run_uuid:t,run_name:l},metrics:d,params:g,color:f}=s,v="METRIC"===r.type?d:g,y="METRIC"===a.type?d:g,x="METRIC"===i.type?d:g,C=(null===v||void 0===v||null===(p=v[r.key])||void 0===p?void 0:p.value)||void 0,Z=(null===y||void 0===y||null===(m=y[a.key])||void 0===m?void 0:m.value)||void 0,w=(null===x||void 0===x||null===(h=x[i.key])||void 0===h?void 0:h.value)||void 0;C&&Z&&w&&(e.push(C),n.push(Z),o.push(w),c.push(f||b.colors.primary),u.push([t,l||t,w]))}const g=[{x:e,y:n,customdata:u,hovertemplate:v?(f=i.key,`<b>%{customdata[1]}:</b><br><b>%{xaxis.title.text}:</b> %{x:.2f}<br><b>%{yaxis.title.text}:</b> %{y:.2f}<br><b>${f}:</b> %{customdata[2]:.2f}<extra></extra>`):void 0,hoverinfo:v?void 0:"none",hoverlabel:v?Wa.Lg:void 0,type:"scatter",mode:"markers",marker:{size:s,color:c,line:{color:"black",width:1}}}];var f;return t.length>1&&g.unshift({x:e,y:n,z:o,type:"contour",connectgaps:!0,hoverinfo:"none",contours:{coloring:"heatmap"},colorscale:d,reversescale:l}),g}),[d,l,s,t,r.type,r.key,a.type,a.key,i.type,i.key,b.colors.primary,v]),[M,R]=(0,n.useState)({width:g||C,height:f||x,margin:c,xaxis:{title:r.key},yaxis:{ticks:"inside",title:{standoff:32,text:a.key}}});(0,n.useEffect)((()=>{R((e=>{const t={...e,width:g||C,height:f||x,margin:c};return t.xaxis&&(t.xaxis.title=r.key),t.yaxis&&(t.yaxis.title={standoff:32,text:a.key}),t}))}),[C,x,c,r.key,a.key,g,f]);const{setHoveredPointIndex:E}=_a(w,y,t,Va),T=(0,n.useCallback)((e=>{var t,r;let{points:n}=e;const a=n.find((e=>{let{curveNumber:t}=e;return 1===t}));if(E(null!==(t=null===a||void 0===a?void 0:a.pointIndex)&&void 0!==t?t:-1),!a)return;const i=null===a||void 0===a||null===(r=a.customdata)||void 0===r?void 0:r[0];i&&(null===m||void 0===m||m(i))}),[m,E]),B=(0,n.useCallback)((()=>{null===h||void 0===h||h(),E(-1)}),[h,E]),I=Oa(T);return(0,u.tZ)("div",{css:[Wa.QW.chartWrapper,Wa.QW.scatterChartHighlightStyles,""],className:o,ref:Z,children:(0,u.tZ)(Ha.L,{data:S,useResizeHandler:!k,css:Wa.QW.chart,onUpdate:p,layout:M,config:Bi,onHover:I,onUnhover:B})})})),Li=e=>{let{config:t,chartRunData:r,onDelete:a,onEdit:i}=e;const s=(0,n.useMemo)((()=>r.slice(0,t.runsCountToCompare||10).reverse()),[r,t]),{setTooltip:o,resetTooltip:l,selectedRunUuid:c}=Ja(t);return(0,u.tZ)(ri,{onEdit:i,onDelete:a,title:`${t.xaxis.key} vs. ${t.yaxis.key} vs. ${t.zaxis.key}`,subtitle:(0,u.BX)(u.HY,{children:["Comparing first ",s.length," runs"]}),children:(0,u.tZ)("div",{css:Di.contourChartCardWrapper,children:(0,u.tZ)(Ai,{runsData:s,xAxis:t.xaxis,yAxis:t.yaxis,zAxis:t.zaxis,useDefaultHoverBox:!1,onHover:o,onUnhover:l,selectedRunUuid:c})})})},Di={contourChartCardWrapper:{overflow:"hidden"}};var Ni=r(68347);const Pi={displaylogo:!1,doubleClick:"autosize",scrollZoom:!0},Hi=(e,t)=>{if(!e)return[];if("time-relative"===t){const{timestamp:t}=(0,o.minBy)(e,"timestamp")||{};if(t)return e.map((e=>(e.timestamp-t)/1e3))}else if("time"===t)return e.map((e=>e.timestamp));return e.map((e=>e.step))},Oi=n.memo((e=>{let{runsData:t,metricKey:r,scaleType:i="linear",xAxisKey:s="step",lineSmoothness:o=70,className:l,margin:c=Wa.MP,lineShape:d="spline",onUpdate:p,onHover:m,onUnhover:h,width:g,height:f,useDefaultHoverBox:v=!0,selectedRunUuid:y}=e;const b=(0,n.useMemo)((()=>t.map((e=>{var t,n;return e.metricsHistory?{uuid:e.runInfo.run_uuid,name:e.runInfo.run_name,x:Hi(e.metricsHistory[r],s),y:(0,Ni.Zk)(null===(t=e.metricsHistory[r])||void 0===t?void 0:t.map((e=>(0,Wa.To)(e.value))),o),hovertext:e.runInfo.run_name,text:"x",textposition:"outside",textfont:{size:11},hovertemplate:v?(n=e.runInfo.run_name,`<b>${n}</b>:<br><b>%{xaxis.title.text}:</b> %{x}<br><b>%{yaxis.title.text}:</b> %{y:.2f}<br><extra></extra>`):void 0,hoverinfo:v?void 0:"none",hoverlabel:v?Wa.Lg:void 0,type:"scatter",line:{shape:d},marker:{color:e.color}}:{}}))),[t,d,s,o,r,v]),{layoutHeight:x,layoutWidth:C,setContainerDiv:Z,containerDiv:w,isDynamicSizeSupported:k}=(0,Wa.Ih)(),{formatMessage:S}=(0,a.Z)(),{setHoveredPointIndex:M}=_a(w,y,t,Ua),R=(0,n.useMemo)((()=>S("time"===s?{id:"y0rS56",defaultMessage:"Time"}:"time-relative"===s?{id:"d/lwTE",defaultMessage:"Time (s)"}:{id:"vPUy4a",defaultMessage:"Step"})),[S,s]),E=(0,n.useMemo)((()=>({tickfont:{size:11},type:"log"===i?"log":"linear"})),[i]),[T,B]=(0,n.useState)({width:g||C,height:f||x,margin:c,xaxis:{title:R},yaxis:E});(0,n.useEffect)((()=>{B((e=>({...e,width:g||C,height:f||x,margin:c,yaxis:E,showlegend:!1})))}),[C,x,c,E,g,f,R]);const I=(0,n.useCallback)((e=>{var t,r,n,a,i;let{points:s,event:o}=e;M(null!==(t=null===(r=s[0])||void 0===r?void 0:r.curveNumber)&&void 0!==t?t:-1);const l=(null===(n=s[0])||void 0===n?void 0:n.data).uuid,c={value:null===(a=s[0])||void 0===a?void 0:a.x,index:null===(i=s[0])||void 0===i?void 0:i.pointIndex,label:R};l&&(null===m||void 0===m||m(l,o,c))}),[m,M,R]),A=(0,n.useCallback)((()=>{null===h||void 0===h||h(),M(-1)}),[h,M]),L=T;L.xaxis&&(L.xaxis.title=R,L.xaxis.type="time"===s?"date":void 0),L.yaxis&&(L.yaxis.title=r);const D=Oa(I);return(0,u.tZ)("div",{css:[Wa.QW.chartWrapper,Xi.highlightStyles,""],className:l,ref:Z,children:(0,u.tZ)(Ha.L,{data:b,useResizeHandler:!k,css:Wa.QW.chart,onUpdate:p,layout:L,config:Pi,onHover:D,onUnhover:A})})})),Xi={highlightStyles:{".scatterlayer g.trace":{transition:"var(--trace-transition)"},".scatterlayer.is-highlight g.trace":{opacity:"var(--trace-opacity-dimmed-low) !important"},".scatterlayer g.trace.is-hover-highlight":{opacity:"var(--trace-opacity-highlighted) !important"},".scatterlayer g.trace.is-selection-highlight":{opacity:"var(--trace-opacity-highlighted) !important"},".scatterlayer g.trace.is-selection-highlight path.point":{stroke:"var(--trace-stroke-color)",strokeWidth:"var(--trace-stroke-width) !important"}}},zi=e=>{let{config:t,chartRunData:r,isMetricHistoryLoading:a,onDelete:i,onEdit:s}=e;const o=(0,n.useMemo)((()=>r.slice(0,t.runsCountToCompare||10).reverse()),[r,t]),{setTooltip:l,resetTooltip:c,selectedRunUuid:d}=Ja(t);return(0,u.tZ)(ri,{onEdit:s,onDelete:i,title:t.metricKey,subtitle:(0,u.BX)(u.HY,{children:["Comparing first ",o.length," runs"]}),children:(0,u.tZ)("div",{css:Ui.lineChartCardWrapper,children:a?(0,u.tZ)(h.Qck,{}):(0,u.tZ)(Oi,{runsData:o,metricKey:t.metricKey,scaleType:t.scaleType,xAxisKey:t.xAxisKey,lineSmoothness:t.lineSmoothness,useDefaultHoverBox:!1,onHover:l,onUnhover:c,selectedRunUuid:d})})})},Ui={lineChartCardWrapper:{overflow:"hidden"}},Vi=e=>{let{chartRunData:t,cardsConfig:r,isMetricHistoryLoading:a,onRemoveChart:i,onStartEditChart:s}=e;const[o,l]=(0,n.useMemo)((()=>Array.isArray(r)?[r.filter((e=>e.type===Fn.PARALLEL)),r.filter((e=>e.type!==Fn.PARALLEL))]:[[],[]]),[r]);return(0,u.BX)(u.HY,{children:[o.length?(0,u.tZ)("div",{css:_i.parallelChartsWrapper,children:o.map((e=>(0,u.tZ)(wi,{config:e,chartRunData:t,onEdit:()=>s(e),onDelete:()=>i(e)})))}):null,(0,u.tZ)("div",{css:_i.chartsWrapper,children:l.map((e=>e.type===Fn.BAR?(0,u.tZ)(ii,{config:e,chartRunData:t,onEdit:()=>s(e),onDelete:()=>i(e)}):e.type===Fn.LINE?(0,u.tZ)(zi,{config:e,chartRunData:t,onEdit:()=>s(e),onDelete:()=>i(e),isMetricHistoryLoading:a}):e.type===Fn.SCATTER?(0,u.tZ)(Ei,{config:e,chartRunData:t,onEdit:()=>s(e),onDelete:()=>i(e)}):e.type===Fn.CONTOUR?(0,u.tZ)(Li,{config:e,chartRunData:t,onEdit:()=>s(e),onDelete:()=>i(e)}):null))})]})},_i={chartGroupWrapper:e=>({display:"flex",flexDirection:"column",gap:e.spacing.md}),parallelChartsWrapper:e=>({display:"flex",flexDirection:"column",gap:e.spacing.md,marginBottom:e.spacing.md}),chartsWrapper:e=>({display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(520px, 1fr))",gap:e.spacing.md})},Wi=e=>{let{title:t,children:r}=e;return(0,u.BX)("div",{css:e=>({marginBottom:2*e.spacing.md}),"data-testid":"experiment-view-compare-runs-config-field",children:[(0,u.BX)(b.j.Title,{level:4,children:[t,":"]}),r]})},Fi=e=>{let{value:t,onChange:r,metricKeyList:n,paramKeyList:i}=e;const{formatMessage:s}=(0,a.Z)(),o=!(null!==i&&void 0!==i&&i.length)&&!(null!==n&&void 0!==n&&n.length);return(0,u.BX)(h.Select,{css:$i.selectFull,value:o?s({id:"3VURvw",defaultMessage:"No metrics or parameters available"}):t,disabled:o,onChange:r,dangerouslySetAntdProps:{showSearch:!0},children:[null!==n&&void 0!==n&&n.length?(0,u.tZ)(h.Select.OptGroup,{label:s({id:"jH0+gA",defaultMessage:"Metrics"}),children:n.map((e=>(0,u.tZ)(h.Select.Option,{value:De("METRIC",e),children:e},De("METRIC",e))))}):null,null!==i&&void 0!==i&&i.length?(0,u.tZ)(h.Select.OptGroup,{label:s({id:"kWUhea",defaultMessage:"Params"}),children:i.map((e=>(0,u.tZ)(h.Select.Option,{value:De("PARAM",e),children:e},De("PARAM",e))))}):null]})},Ki=e=>{let{onChange:t,value:r,options:n}=e;const{formatMessage:i}=(0,a.Z)();return(0,u.tZ)(Wi,{title:i({id:"AW2rVK",defaultMessage:"Max. no of runs shown"}),children:(0,u.tZ)(h.Select,{css:$i.selectFull,value:r,onChange:t,children:n.map((e=>{const t="number"===typeof e?e:e.value,r="number"===typeof e?e:e.label;return(0,u.tZ)(h.Select.Option,{value:t,children:r},t)}))})})},ji=[{value:5,label:(0,u.tZ)(C.Z,{id:"Mc6Dhy",defaultMessage:"5"})},{value:10,label:(0,u.tZ)(C.Z,{id:"2K8tsp",defaultMessage:"10"})},{value:20,label:(0,u.tZ)(C.Z,{id:"zwO8+l",defaultMessage:"20"})}],$i={selectFull:{width:"100%"}},qi=e=>{let{state:t,onStateChange:r,metricKeyList:a}=e;const i=(0,n.useCallback)((e=>{r((t=>({...t,metricKey:e})))}),[r]),s=(0,n.useCallback)((e=>{r((t=>({...t,runsCountToCompare:e})))}),[r]);(0,n.useEffect)((()=>{!t.metricKey&&null!==a&&void 0!==a&&a[0]&&i(a[0])}),[t.metricKey,i,a]);const o=0===a.length;return(0,u.BX)(u.HY,{children:[(0,u.tZ)(Wi,{title:"Metric",children:(0,u.tZ)(h.Select,{css:Yi.selectFull,value:o?"No metrics available":t.metricKey,onChange:i,disabled:o,dangerouslySetAntdProps:{showSearch:!0},children:a.map((e=>(0,u.tZ)(h.Select.Option,{value:e,"data-testid":`metric-${e}`,children:e},e)))})}),(0,u.tZ)(Ki,{value:t.runsCountToCompare,onChange:s,options:ji})]})},Yi={selectFull:{width:"100%"}},Gi=e=>{let{state:t,onStateChange:r,metricKeyList:a,paramKeyList:i}=e;const s=(0,n.useCallback)((e=>{r((t=>({...t,selectedParams:e})))}),[r]),o=(0,n.useCallback)((e=>{r((t=>({...t,selectedMetrics:e})))}),[r]),l=0===a.length,c=0===i.length;return(0,u.BX)(u.HY,{children:[(0,u.tZ)(Wi,{title:"Params",children:(0,u.tZ)(h.Select,{mode:c?void 0:"multiple",onChange:s,style:{width:300},value:c?"No parameters available":t.selectedParams,disabled:c,children:i.map((e=>(0,u.tZ)(h.Select.Option,{value:e,children:e})))})}),(0,u.tZ)(Wi,{title:"Metrics",children:(0,u.tZ)(h.Select,{mode:l?void 0:"multiple",onChange:o,style:{width:300},value:l?"No metrics available":t.selectedMetrics,disabled:l,children:a.map((e=>(0,u.tZ)(h.Select.Option,{value:e,children:e})))})})]})},Ji=e=>{let{state:t,onStateChange:r,metricKeyList:a}=e;const i=(0,n.useCallback)((e=>{r((t=>({...t,metricKey:e})))}),[r]),s=(0,n.useCallback)((e=>{r((t=>({...t,xAxisKey:e})))}),[r]),o=(0,n.useCallback)((e=>r((t=>({...t,scaleType:e?"log":"linear"})))),[r]),l=(0,n.useCallback)((e=>{r((t=>({...t,lineSmoothness:e})))}),[r]),c=(0,n.useCallback)((e=>{r((t=>({...t,runsCountToCompare:e})))}),[r]);(0,n.useEffect)((()=>{!t.metricKey&&null!==a&&void 0!==a&&a[0]&&i(a[0])}),[t.metricKey,i,a]);const d=0===a.length;return(0,u.BX)(u.HY,{children:[(0,u.tZ)(Wi,{title:"Metric (Y-axis)",children:(0,u.tZ)(h.Select,{css:Qi.selectFull,value:d?"No metrics available":t.metricKey,onChange:i,disabled:d,dangerouslySetAntdProps:{showSearch:!0},children:a.map((e=>(0,u.tZ)(h.Select.Option,{value:e,"data-testid":`metric-${e}`,children:e},e)))})}),(0,u.tZ)(Wi,{title:"X-axis",children:(0,u.BX)(h.Y8K.Group,{value:t.xAxisKey,onChange:e=>{let{target:{value:t}}=e;return s(t)},children:[(0,u.tZ)(h.Y8K,{value:"step",children:"Step"}),(0,u.BX)(h.Y8K,{value:"time",children:["Time (wall)",(0,u.BX)(b.T,{title:(0,u.tZ)(C.Z,{id:"nlXn2G",defaultMessage:"Absolute date and time"}),placement:"right",children:[" ",(0,u.tZ)(h.AMp,{css:Qi.timeStepQuestionMarkIcon})]})]}),(0,u.BX)(h.Y8K,{value:"time-relative",children:["Time (relative)",(0,u.BX)(b.T,{title:(0,u.tZ)(C.Z,{id:"NwNrl4",defaultMessage:"Amount of time that has passed since the first metric value was logged"}),placement:"right",children:[" ",(0,u.tZ)(h.AMp,{css:Qi.timeStepQuestionMarkIcon})]})]})]})}),(0,u.tZ)(Wi,{title:"Y-axis log scale",children:(0,u.tZ)(h.rsf,{checked:"log"===t.scaleType,onChange:o,label:"Enabled"})}),(0,u.tZ)(Wi,{title:"Line smoothness",children:(0,u.tZ)(Ir.O,{"data-testid":"smoothness-toggle",min:0,max:100,handleLineSmoothChange:l,defaultValue:t.lineSmoothness?t.lineSmoothness:0})}),(0,u.tZ)(Ki,{value:t.runsCountToCompare,onChange:c,options:[5,10,20]})]})},Qi={selectFull:{width:"100%"},timeStepQuestionMarkIcon:()=>({svg:{width:12,height:12}})},es=(e,t,r)=>{const a=d(),[s,o]=(0,n.useState)(null),[l,c]=(0,n.useState)({}),u=(0,n.useCallback)(((e,t,r)=>{c((n=>{const a={...n};for(const i of e){a[`${i}-${t}`]=r}return a}))}),[c]),p=(0,n.useCallback)(((e,t)=>u(e,t,!0)),[u]),m=(0,n.useCallback)(((e,t)=>u(e,t,!1)),[u]),h=(0,n.useMemo)((()=>{const r=t.map((e=>e.runInfo.run_uuid));for(const t of r)for(const r of e){if(l[`${t}-${r}`])return!0}return!1}),[e,l,t]);return(0,n.useEffect)((()=>{if(e.length)for(const n of e){if(!n)continue;const e=t.map((e=>e.runInfo.run_uuid)).filter((e=>{var t;const a=Boolean(null===(t=r[e])||void 0===t?void 0:t[n]),i=l[`${e}-${n}`];return!a&&!i}));e.length&&(p(e,n),a((0,i.zL)(e,n)).then((()=>{m(e,n)})).catch((e=>{o(e)})))}}),[p,r,a,m,e,l,t]),{isLoading:h,error:s}},ts=(0,c.$j)((e=>{let{entities:{metricsByRunUuid:t}}=e;return{metricsByRunUuid:t}}),void 0,void 0,{areStatesEqual:(e,t)=>e.entities.metricsByRunUuid===t.entities.metricsByRunUuid})((e=>{let{previewData:t,cardConfig:r,metricsByRunUuid:a}=e;const i=(0,n.useMemo)((()=>[r.metricKey]),[r.metricKey]),{isLoading:s,error:o}=es(i,t,a),l=(0,n.useMemo)((()=>t.map((e=>({...e,metricsHistory:a[e.runInfo.run_uuid]})))),[t,a]),{resetTooltip:c,setTooltip:d}=Ja(r);return s?(0,u.tZ)(h.Qck,{}):o?(0,u.tZ)(u.HY,{children:"Error occured!"}):(0,u.tZ)(Oi,{runsData:l,metricKey:r.metricKey,scaleType:r.scaleType,lineSmoothness:r.lineSmoothness,xAxisKey:r.xAxisKey,useDefaultHoverBox:!1,onHover:d,onUnhover:c})}));var rs={name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"};const ns=e=>{let{state:t,onStateChange:r,metricKeyList:i,paramKeyList:s}=e;const{formatMessage:o}=(0,a.Z)(),l=(0,n.useCallback)(((e,t)=>{const n=Ne(e,"METRIC")?"METRIC":"PARAM",a=Pe(e,n);r((e=>({...e,[t]:{key:a,type:n}})))}),[r]),c=(0,n.useCallback)((e=>{r((t=>({...t,runsCountToCompare:e})))}),[r]);return(0,n.useEffect)((()=>{var e,r,n;const a=null===i||void 0===i?void 0:i[0],o=null===s||void 0===s?void 0:s[0];null!==(e=t.xaxis)&&void 0!==e&&e.key||(a?l(De("METRIC",a),"xaxis"):o&&l(De("PARAM",o),"xaxis")),null!==(r=t.yaxis)&&void 0!==r&&r.key||(a?l(De("METRIC",a),"yaxis"):o&&l(De("PARAM",o),"yaxis")),null!==(n=t.zaxis)&&void 0!==n&&n.key||(a?l(De("METRIC",a),"zaxis"):o&&l(De("PARAM",o),"zaxis"))}),[t.xaxis,t.yaxis,t.zaxis,l,i,s]),(0,u.BX)(u.HY,{children:[(0,u.tZ)(Wi,{title:o({id:"2Us2jl",defaultMessage:"X axis"}),children:(0,u.tZ)(Fi,{value:t.xaxis.key?De(t.xaxis.type,t.xaxis.key):"",onChange:e=>{l(e,"xaxis")},paramKeyList:s,metricKeyList:i})}),(0,u.tZ)(Wi,{title:o({id:"8YmId5",defaultMessage:"Y axis"}),children:(0,u.tZ)(Fi,{value:t.yaxis.key?De(t.yaxis.type,t.yaxis.key):"",onChange:e=>{l(e,"yaxis")},paramKeyList:s,metricKeyList:i})}),(0,u.tZ)(Wi,{title:o({id:"cB0/61",defaultMessage:"Z axis"}),children:(0,u.tZ)(Fi,{value:t.zaxis.key?De(t.zaxis.type,t.zaxis.key):"",onChange:e=>{l(e,"zaxis")},paramKeyList:s,metricKeyList:i})}),(0,u.tZ)(Ki,{value:t.runsCountToCompare,onChange:c,options:[5,10,20]})]})},as=ji;as.push({value:100,label:(0,u.tZ)(C.Z,{id:"Bbm59f",defaultMessage:"100"})},{value:250,label:(0,u.tZ)(C.Z,{id:"W8bOkn",defaultMessage:"250"})},{value:500,label:(0,u.tZ)(C.Z,{id:"Bnruyp",defaultMessage:"500"})});const is=e=>{let{state:t,onStateChange:r,metricKeyList:i,paramKeyList:s}=e;const{formatMessage:o}=(0,a.Z)(),l=(0,n.useCallback)(((e,t)=>{const n=Ne(e,"METRIC")?"METRIC":"PARAM",a=Pe(e,n);r((e=>({...e,[t]:{key:a,type:n}})))}),[r]),c=(0,n.useCallback)((e=>{r((t=>({...t,runsCountToCompare:e})))}),[r]);return(0,n.useEffect)((()=>{var e,r;const n=null===i||void 0===i?void 0:i[0],a=null===s||void 0===s?void 0:s[0];null!==(e=t.xaxis)&&void 0!==e&&e.key||(n?l(De("METRIC",n),"xaxis"):a&&l(De("PARAM",a),"xaxis")),null!==(r=t.yaxis)&&void 0!==r&&r.key||(n?l(De("METRIC",n),"yaxis"):a&&l(De("PARAM",a),"yaxis"))}),[t.xaxis,t.yaxis,l,i,s]),(0,u.BX)(u.HY,{children:[(0,u.tZ)(Wi,{title:o({id:"vBKFgp",defaultMessage:"X axis"}),children:(0,u.tZ)(Fi,{value:t.xaxis.key?De(t.xaxis.type,t.xaxis.key):"",onChange:e=>{l(e,"xaxis")},paramKeyList:s,metricKeyList:i})}),(0,u.tZ)(Wi,{title:o({id:"DaF+KK",defaultMessage:"Y axis"}),children:(0,u.tZ)(Fi,{value:t.yaxis.key?De(t.yaxis.type,t.yaxis.key):"",onChange:e=>{l(e,"yaxis")},paramKeyList:s,metricKeyList:i})}),(0,u.tZ)(Ki,{value:t.runsCountToCompare,onChange:c,options:as})]})},ss=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;if("number"===typeof e)return e.toFixed(t);const r=Number(e);return isNaN(r)?(0,Wa.aS)(e,8):r.toFixed(t)},os=e=>{let{activeRun:t,cardConfig:r,isHovering:n,xAxisValues:a}=e;return r.type===Fn.BAR?((e,t)=>{const{metricKey:r}=e,n=null===t||void 0===t?void 0:t.metrics[r];return n?(0,u.BX)("div",{css:cs.value,children:[(0,u.BX)("strong",{children:[n.key,":"]})," ",ss(n.value)]}):null})(r,t):r.type===Fn.SCATTER?((e,t)=>{var r,n,a,i;const{xaxis:s,yaxis:o}=e,l=s.key,c=o.key,d="METRIC"===s.type?null===(r=t.metrics[l])||void 0===r?void 0:r.value:null===(n=t.params[l])||void 0===n?void 0:n.value,p="METRIC"===o.type?null===(a=t.metrics[c])||void 0===a?void 0:a.value:null===(i=t.params[c])||void 0===i?void 0:i.value;return(0,u.BX)(u.HY,{children:[d&&(0,u.BX)("div",{css:cs.value,children:[(0,u.BX)("strong",{children:["X (",l,"):"]})," ",ss(d)]}),p&&(0,u.BX)("div",{css:cs.value,children:[(0,u.BX)("strong",{children:["Y (",c,"):"]})," ",ss(p)]})]})})(r,t):r.type===Fn.CONTOUR?((e,t)=>{var r,n,a,i,s,o;const{xaxis:l,yaxis:c,zaxis:d}=e,p=l.key,m=c.key,h=d.key,g="METRIC"===l.type?null===(r=t.metrics[p])||void 0===r?void 0:r.value:null===(n=t.params[p])||void 0===n?void 0:n.value,f="METRIC"===c.type?null===(a=t.metrics[m])||void 0===a?void 0:a.value:null===(i=t.params[m])||void 0===i?void 0:i.value,v="METRIC"===d.type?null===(s=t.metrics[h])||void 0===s?void 0:s.value:null===(o=t.params[h])||void 0===o?void 0:o.value;return(0,u.BX)(u.HY,{children:[g&&(0,u.BX)("div",{css:cs.value,children:[(0,u.BX)("strong",{children:["X (",p,"):"]})," ",ss(g)]}),f&&(0,u.BX)("div",{css:cs.value,children:[(0,u.BX)("strong",{children:["Y (",m,"):"]})," ",ss(f)]}),v&&(0,u.BX)("div",{css:cs.value,children:[(0,u.BX)("strong",{children:["Z (",h,"):"]})," ",ss(v)]})]})})(r,t):r.type===Fn.LINE?((e,t,r)=>{var n,a,i;const{metricKey:s}=e,o=null!==(n=r&&(null===t||void 0===t||null===(a=t.metricsHistory)||void 0===a||null===(i=a[s])||void 0===i?void 0:i[null===r||void 0===r?void 0:r.index]))&&void 0!==n?n:null===t||void 0===t?void 0:t.metrics[s];return o?(0,u.BX)(u.HY,{children:[r&&(0,u.BX)("div",{css:cs.value,children:[(0,u.BX)("strong",{children:[r.label,":"]})," ",r.value]}),(0,u.BX)("div",{css:cs.value,children:[(0,u.BX)("strong",{children:[o.key,":"]})," ",ss(o.value)]})]}):null})(r,t,a):r.type===Fn.PARALLEL?((e,t,r)=>{const{selectedParams:n,selectedMetrics:a}=e,i=n.map((e=>{const r=null===t||void 0===t?void 0:t.params[e];return!r||(0,u.BX)("div",{children:[(0,u.BX)("strong",{children:[r.key,":"]})," ",ss(r.value)]})})),s=a.map((e=>{const r=null===t||void 0===t?void 0:t.metrics[e];return!r||(0,u.BX)("div",{children:[(0,u.BX)("strong",{children:[r.key,":"]})," ",ss(r.value)]})}));return r?(0,u.BX)(u.HY,{children:[i.slice(0,3),s[s.length-1],(i.length>3||s.length>1)&&(0,u.tZ)("div",{children:"..."})]}):(0,u.BX)(u.HY,{children:[i,s]})})(r,t,n):null},ls=e=>{let{closeContextMenu:t,contextData:r,additionalAxisData:n,hoverData:a,runUuid:i,isHovering:s}=e;const{runs:o,onTogglePin:l,onHideRun:c}=r,[d]=rt(),p=null===o||void 0===o?void 0:o.find((e=>e.runInfo.run_uuid===i));return p?(0,u.BX)("div",{children:[(0,u.BX)("div",{css:cs.contentWrapper,children:[(0,u.BX)("div",{css:cs.header,children:[(0,u.tZ)("div",{css:cs.colorPill,style:{backgroundColor:p.color}}),(0,u.tZ)(ne.rU,{to:ae.Z.getRunPageRoute(d,i),target:"_blank",css:cs.runLink,onClick:t,children:p.runInfo.run_name||p.runInfo.run_uuid})]}),!s&&(0,u.tZ)(b.B,{size:"small",onClick:t,icon:(0,u.tZ)(b.C,{})})]}),(0,u.tZ)(os,{isHovering:s,activeRun:p,cardConfig:a,xAxisValues:n}),(0,u.BX)("div",{css:cs.actionsWrapper,children:[p.pinnable&&l&&(0,u.tZ)(b.T,{title:p.pinned?(0,u.tZ)(C.Z,{id:"ugm2f6",defaultMessage:"Unpin run"}):(0,u.tZ)(C.Z,{id:"58xhem",defaultMessage:"Click to pin the run"}),placement:"bottom",children:(0,u.tZ)(b.B,{size:"small",onClick:()=>{l(i),t()},icon:p.pinned?(0,u.tZ)(h.D$V,{}):(0,u.tZ)(h.qQX,{})})}),c&&(0,u.tZ)(b.T,{title:(0,u.tZ)(C.Z,{id:"eE5VIF",defaultMessage:"Click to hide the run"}),placement:"bottom",children:(0,u.tZ)(b.B,{"data-testid":"experiment-view-compare-runs-tooltip-visibility-button",size:"small",onClick:()=>{c(i),t()},icon:(0,u.tZ)(h.bMb,{})})})]})]}):null},cs={runLink:e=>({color:e.colors.primary,"&:hover":{}}),actionsWrapper:{marginTop:8,display:"flex",gap:8,alignItems:"center"},header:{display:"flex",gap:8,alignItems:"center"},value:{maxWidth:300,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},contentWrapper:{display:"flex",gap:8,alignItems:"center",marginBottom:12,justifyContent:"space-between",height:24},colorPill:{width:12,height:12,borderRadius:"100%"}};const ds={[Fn.BAR]:e=>{let{previewData:t,cardConfig:r}=e;const{resetTooltip:n,setTooltip:a}=Ja(r);return(0,u.tZ)(Ka,{useDefaultHoverBox:!1,displayRunNames:!1,displayMetricKey:!1,metricKey:r.metricKey,runsData:t,margin:ai,onHover:a,onUnhover:n})},[Fn.CONTOUR]:e=>{let{previewData:t,cardConfig:r}=e;const{resetTooltip:n,setTooltip:a}=Ja(r);return(0,u.tZ)(Ai,{xAxis:r.xaxis,yAxis:r.yaxis,zAxis:r.zaxis,runsData:t,onHover:a,onUnhover:n,useDefaultHoverBox:!1})},[Fn.LINE]:ts,[Fn.PARALLEL]:e=>{var t,r;let{previewData:n,cardConfig:a}=e;const i=((null===(t=a.selectedParams)||void 0===t?void 0:t.length)||0)+((null===(r=a.selectedMetrics)||void 0===r?void 0:r.length)||0)>=2,{setTooltip:s,resetTooltip:o}=Ja(a),l=i?fi(n,a.selectedParams,a.selectedMetrics):[];return i?l.length?(0,u.tZ)(vi,{selectedMetrics:a.selectedMetrics,selectedParams:a.selectedParams,data:l,axesRotateThreshold:6,onHover:s,onUnhover:o}):null:(0,u.tZ)("div",{css:rs,children:"Select at least two metrics and params first"})},[Fn.SCATTER]:e=>{let{previewData:t,cardConfig:r}=e;const{resetTooltip:n,setTooltip:a}=Ja(r);return(0,u.tZ)(Ri,{xAxis:r.xaxis,yAxis:r.yaxis,runsData:t,onHover:a,onUnhover:n,useDefaultHoverBox:!1})}};var us={name:"1uahl7",styles:"width:1280px"},ps={name:"1d3w5wq",styles:"width:100%"};const ms=e=>{let{onCancel:t,onSubmit:r,config:i,chartRunData:s,metricKeyList:o,paramKeyList:l}=e;const[c,d]=(0,n.useState)(i),p=Boolean(c.uuid),m=(0,n.useCallback)((e=>{if(!e)return;const t=Kn.getEmptyChartCardByType(e);t&&d(t)}),[]),g=(0,n.useMemo)((()=>s.slice(0,c.runsCountToCompare).reverse()),[s,c.runsCountToCompare]),{formatMessage:f}=(0,a.Z)();return(0,u.tZ)(h.u_l,{visible:!0,onCancel:t,onOk:()=>r(c),title:f(p?{id:"kBXHTA",defaultMessage:"Edit chart"}:{id:"6y36Fr",defaultMessage:"Add new chart"}),okButtonProps:{"data-testid":"experiment-view-compare-runs-chart-modal-confirm"},cancelText:f({id:"TlVXcS",defaultMessage:"Cancel"}),okText:f(p?{id:"vPnoNk",defaultMessage:"Save changes"}:{id:"UzZf+2",defaultMessage:"Add chart"}),size:"wide",css:us,children:(0,u.BX)("div",{css:hs.wrapper,children:[(0,u.BX)("div",{children:[!p&&(0,u.tZ)(Wi,{title:"Type",children:(0,u.BX)(h.Select,{css:ps,value:c.type,onChange:m,children:[(0,u.tZ)(h.Select.Option,{value:Fn.BAR,children:(0,u.BX)("div",{css:hs.chartTypeOption,children:[(0,u.tZ)(ia,{}),"Bar chart"]})}),(0,u.tZ)(h.Select.Option,{value:Fn.SCATTER,children:(0,u.BX)("div",{css:hs.chartTypeOption,children:[(0,u.tZ)(Da,{}),"Scatter chart"]})}),(0,u.tZ)(h.Select.Option,{value:Fn.LINE,children:(0,u.BX)("div",{css:hs.chartTypeOption,children:[(0,u.tZ)(fa,{}),"Line chart"]})}),(0,u.tZ)(h.Select.Option,{value:Fn.PARALLEL,children:(0,u.BX)("div",{css:hs.chartTypeOption,children:[(0,u.tZ)(ka,{}),"Parallel coordinates"]})}),(0,u.tZ)(h.Select.Option,{value:Fn.CONTOUR,children:(0,u.BX)("div",{css:hs.chartTypeOption,children:[(0,u.tZ)(ua,{}),"Contour chart"]})})]})}),(v=c.type,v===Fn.BAR?(0,u.tZ)(qi,{metricKeyList:o,state:c,onStateChange:d}):v===Fn.CONTOUR?(0,u.tZ)(ns,{metricKeyList:o,paramKeyList:l,state:c,onStateChange:d}):v===Fn.LINE?(0,u.tZ)(Ji,{metricKeyList:o,state:c,onStateChange:d}):v===Fn.PARALLEL?(0,u.tZ)(Gi,{metricKeyList:o,paramKeyList:l,state:c,onStateChange:d}):v===Fn.SCATTER?(0,u.tZ)(is,{metricKeyList:o,paramKeyList:l,state:c,onStateChange:d}):null)]}),(0,u.tZ)(Ga,{contextData:{runs:s},component:ls,hoverOnly:!0,children:(0,u.tZ)("div",{css:hs.chartWrapper,children:(e=>{if(!e)return null;const t=ds[e];return t?(0,u.tZ)(t,{previewData:g,cardConfig:c}):null})(c.type)})})]})});var v},hs={chartTypeOption:e=>({display:"grid",gridTemplateColumns:`${e.general.iconSize+e.spacing.xs}px 1fr`,gap:e.spacing.xs,alignItems:"center"}),wrapper:{display:"grid",gridTemplateColumns:"300px 1fr",gap:32},field:{display:"grid",gridTemplateColumns:"80px 1fr",marginBottom:16},chartWrapper:{height:400}},gs={controlsWrapper:e=>({position:"sticky",top:0,marginBottom:e.spacing.md,display:"flex",justifyContent:"flex-end",zIndex:2,backgroundColor:e.colors.backgroundSecondary,paddingTop:e.spacing.md,paddingBottom:e.spacing.md}),wrapper:e=>({borderTop:`1px solid ${e.colors.border}`,borderLeft:`1px solid ${e.colors.border}`,marginLeft:-1,position:"relative",backgroundColor:e.colors.backgroundSecondary,paddingLeft:e.spacing.md,paddingRight:e.spacing.md,paddingBottom:e.spacing.md,zIndex:1,overflowY:"auto"})},fs=(0,c.$j)((e=>{let{entities:t}=e;const{paramsByRunUuid:r,latestMetricsByRunUuid:n,metricsByRunUuid:a}=t;return{paramsByRunUuid:r,latestMetricsByRunUuid:n,metricsByRunUuid:a}}),void 0,void 0,{areStatesEqual:(e,t)=>e.entities===t.entities})((e=>{let{comparedRuns:t,isLoading:r,searchFacetsState:a,updateSearchFacets:i,latestMetricsByRunUuid:s,metricsByRunUuid:l,paramsByRunUuid:c,metricKeyList:d,paramKeyList:p,experimentTags:m}=e;const[g,f]=(0,n.useState)(!1),[v,y]=(0,n.useState)(null),b=(0,n.useCallback)((e=>{y(Kn.getEmptyChartCardByType(e))}),[]),x=(0,n.useCallback)((e=>{y(e)}),[]);(0,n.useEffect)((()=>{g||r||f(!0)}),[g,r]);const C=(0,n.useMemo)((()=>{const e=m[q.uN],t=m[q.JG];return(null===e||void 0===e?void 0:e.value)||(null===t||void 0===t?void 0:t.value)||d[0]||""}),[m,d]),Z=(0,n.useMemo)((()=>t.filter((e=>!e.hidden)).map((e=>({runInfo:e.runInfo,metrics:s[e.runUuid]||{},params:c[e.runUuid]||{},color:e.color,pinned:e.pinned,pinnable:e.pinnable,metricsHistory:{}})))),[t,s,c]),{isLoading:w,chartRunDataWithHistory:k}=((e,t,r)=>{const a=(0,n.useMemo)((()=>e.filter((e=>e.type===Fn.LINE))),[e]),i=(0,n.useMemo)((()=>{if(!a.length)return[];const e=(0,o.max)(a.map((e=>e.runsCountToCompare||10)));return t.slice(0,e)}),[a,t]),s=(0,n.useMemo)((()=>Array.from(new Set(a.map((e=>e.metricKey))))),[a]),{isLoading:l}=es(s,i,r);return{isLoading:l,chartRunDataWithHistory:(0,n.useMemo)((()=>i.length?t.map((e=>({...e,metricsHistory:r[e.runInfo.run_uuid]||void 0}))):t),[i,r,t])}})(a.compareRunCharts||[],Z,l);(0,n.useEffect)((()=>{!a.compareRunCharts&&k.length>0&&i((e=>({...e,compareRunCharts:Kn.getBaseChartConfigs(C,k[0].metrics)})),{replaceHistory:!0})}),[a.compareRunCharts,C,i,k]);const S=(0,n.useCallback)((e=>{i((t=>({...t,runsPinned:t.runsPinned.includes(e)?t.runsPinned.filter((t=>t!==e)):[...t.runsPinned,e]})))}),[i]),M=(0,n.useCallback)((e=>{i((t=>({...t,runsHidden:[...t.runsHidden,e]})))}),[i]),R=(0,n.useMemo)((()=>({runs:k,onTogglePin:S,onHideRun:M})),[k,M,S]);return g?(0,u.BX)("div",{css:gs.wrapper,"data-testid":"experiment-view-compare-runs-chart-area",children:[(0,u.tZ)("div",{css:gs.controlsWrapper,children:(0,u.tZ)(Na,{onAddChart:b})}),(0,u.tZ)(Ga,{contextData:R,component:ls,children:(0,u.tZ)(Vi,{chartRunData:k,cardsConfig:a.compareRunCharts||[],onStartEditChart:x,onRemoveChart:e=>{i((t=>{var r;return{...t,compareRunCharts:null===(r=t.compareRunCharts)||void 0===r?void 0:r.filter((t=>t.uuid!==e.uuid))}}))},isMetricHistoryLoading:w})}),v&&(0,u.tZ)(ms,{chartRunData:k,metricKeyList:d,paramKeyList:p,config:v,onSubmit:e=>{const t=Kn.serialize({...e,uuid:(0,Wn.Fs)()});e.uuid?i((r=>{var n;return{...r,compareRunCharts:null===(n=r.compareRunCharts)||void 0===n?void 0:n.map((r=>r.uuid===e.uuid?t:r))}})):i((e=>({...e,compareRunCharts:e.compareRunCharts&&[...e.compareRunCharts,t]}))),y(null)},onCancel:()=>y(null)})]}):(0,u.tZ)("div",{css:gs.wrapper,children:(0,u.tZ)(h.Qck,{})})})),vs="FETCHED_RUN_NOTIFICATION_KEY",ys=e=>{const{formatMessage:t}=(0,a.Z)(),r=(0,n.useCallback)(((e,r)=>e===r?t({id:"KJbYrw",defaultMessage:"Loaded {childRuns} child {childRuns, plural, =1 {run} other {runs}}"},{childRuns:r}):t({id:"ziIhFQ",defaultMessage:"Loaded {allRuns} {allRuns, plural, =1 {run} other {runs}}, including {childRuns} child {childRuns, plural, =1 {run} other {runs}}"},{allRuns:e,childRuns:r})),[t]);return(0,n.useCallback)(((t,n)=>{if(Array.isArray(t)){const{allRuns:a,childRuns:i}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=e.filter((e=>!t.some((t=>t.run_uuid===e.info.run_uuid)))),n=r.filter((e=>{var t;const r=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.tags;return Array.isArray(r)&&r.some((e=>e.key===ge.ss&&Boolean(e.value)))}));return{allRuns:r.length,childRuns:n.length}}(t,n);if(i<1)return;e.close(vs),e.info({message:r(a,i),duration:3,placement:"bottomRight",key:vs})}}),[e,r])};var bs=r(68915);const xs=e=>{var t,r;return(null===(t=e.tags)||void 0===t||null===(r=t[q.kt])||void 0===r?void 0:r.value)===q.Bj};var Cs=r(31894);const Zs=n.createContext({getMissingParams:()=>[],pendingDataLoading:{},getEvaluableRowCount:()=>0,evaluateCell:()=>{},evaluateAllClick:()=>{},runColumnsBeingEvaluated:[],canEvaluateInRunColumn:()=>!1,toggleExpandedHeader:()=>{},isHeaderExpanded:!1}),ws=e=>{let{tableData:t,outputColumn:r,children:i}=e;const o=(0,a.Z)(),[l,d]=(0,n.useState)(!1),p=(0,n.useCallback)((()=>d((e=>!e))),[]),m=(0,n.useCallback)(((e,r)=>{if(!(0,Mr.Fc)(e))return null;const n=t.find((e=>e.key===r));if(!n)return null;const{promptTemplate:a}=(0,Mr.rP)(e);if(!a)return null;return(0,Mr.xN)(a).filter((e=>!n.groupByCellValues[e]))}),[t]),h=(0,c.I0)(),{startEvaluatingRunColumn:g,stopEvaluatingRunColumn:f,runColumnsBeingEvaluated:v}=((e,t)=>{const r=(0,n.useRef)(e),a=(0,n.useRef)([]);(0,n.useEffect)((()=>{r.current=e}),[e]);const[i,o]=(0,n.useState)([]);(0,n.useEffect)((()=>{a.current=i}),[i]);const l=(0,c.I0)(),d=(0,n.useCallback)((e=>{const n=r.current,{parameters:i,promptTemplate:c,routeName:u}=(0,Mr.rP)(e);if(!c)return;const p=(0,Mr.xN)(c),m=n.find((t=>!t.cellValues[e.runUuid]&&((e,t)=>0===t.filter((t=>!e.groupByCellValues[t])).length)(t,p)));if(!m)return void o((t=>t.filter((t=>t!==e.runUuid))));const h=m.key,g=m.groupByCellValues;if(!c)return;const f=(0,Mr.Ky)(c,g);u&&l((0,Cs.GE)({routeName:u,compiledPrompt:f,inputValues:g,outputColumn:t,rowKey:h,parameters:i,run:e})).then((()=>{a.current.includes(e.runUuid)&&d(e)})).catch((t=>{s.default.logErrorAndNotifyUser(t),o((t=>t.filter((t=>t!==e.runUuid))))}))}),[l,t]),u=(0,n.useCallback)((e=>{o((t=>[...t,e.runUuid])),d(e)}),[d]),p=(0,n.useCallback)((e=>{o((t=>t.filter((t=>t!==e.runUuid))))}),[]);return{runColumnsBeingEvaluated:i,startEvaluatingRunColumn:u,stopEvaluatingRunColumn:p}})(t,r),y=(0,c.v9)((e=>{let{evaluationData:t}=e;return t.evaluationPendingDataLoadingByRunUuid})),b=(0,n.useCallback)((e=>r===Mr.JL&&(0,Mr.Fc)(e)),[r]),x=(0,n.useCallback)((e=>t.filter((t=>{if(t.cellValues[e.runUuid])return!1;const r=m(e,t.key);return 0===(null===r||void 0===r?void 0:r.length)})).length),[t,m]),C=(0,n.useCallback)((e=>{v.includes(e.runUuid)?f(e):g(e)}),[v,g,f]),Z=(0,n.useCallback)(((e,n)=>{const a=t.find((e=>{let{key:t}=e;return t===n}));if(!a)return;const i=a.groupByCellValues,{parameters:l,promptTemplate:c,routeName:d}=(0,Mr.rP)(e);if(!c)return;const u=(0,Mr.Ky)(c,i);d&&h((0,Cs.GE)({routeName:d,compiledPrompt:u,inputValues:i,outputColumn:r,rowKey:n,parameters:l,run:e})).catch((e=>{const t=e.getGatewayErrorMessage()||e.getUserVisibleError(),r=o.formatMessage({id:"JAFH9v",defaultMessage:'AI gateway returned the following error: "{errorMessage}"'},{errorMessage:t});s.default.logErrorAndNotifyUser(r)}))}),[t,h,r,o]),w=(0,n.useMemo)((()=>({getMissingParams:m,getEvaluableRowCount:x,evaluateCell:Z,evaluateAllClick:C,pendingDataLoading:y,canEvaluateInRunColumn:b,runColumnsBeingEvaluated:v,isHeaderExpanded:l,toggleExpandedHeader:p})),[m,x,C,Z,y,b,v,l,p]);return(0,u.tZ)(Zs.Provider,{value:w,children:i})},ks=()=>(0,n.useContext)(Zs);var Ss={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ms={name:"lyel5l",styles:"font-size:0"},Rs={name:"1hetg88",styles:"max-width:300px"};const Es=e=>{let{run:t}=e;const{theme:r}=(0,b.u)(),{isHeaderExpanded:n}=ks(),a=(0,Mr.rP)(t),i=(0,c.v9)((e=>{let{modelGateway:t}=e;return a.routeName?t.modelGatewayRoutes[a.routeName]:null}));if(!(0,Mr.Fc)(t)||!a)return null;const{parameters:s,promptTemplate:o,routeName:l}=a,{stop:d=[]}=s;return(0,u.BX)("div",{css:(0,v.iv)({marginTop:r.spacing.xs,flex:1,display:"flex",flexDirection:"column",gap:r.spacing.sm,overflowX:"hidden",width:"100%"},""),children:[(0,u.tZ)(b.j.Hint,{children:i?i.model.name:l}),n&&(0,u.BX)(u.HY,{children:[(0,u.tZ)(b.j.Hint,{children:(0,u.tZ)(C.Z,{id:"HGBit9",defaultMessage:"Temperature: {temperature}",values:s})}),(0,u.tZ)(b.j.Hint,{children:(0,u.tZ)(C.Z,{id:"6K04VZ",defaultMessage:"Max. tokens: {max_tokens}",values:s})}),d.length?(0,u.tZ)(b.j.Hint,{css:Ss,children:(0,u.tZ)(C.Z,{id:"iC2Owx",defaultMessage:"Stop sequences: {stopSequences}",values:{stopSequences:null===d||void 0===d?void 0:d.join(", ")}})}):null,(0,u.tZ)("div",{css:Ms,children:(0,u.BX)(h.J2e.Root,{children:[(0,u.tZ)(h.J2e.Trigger,{asChild:!0,children:(0,u.tZ)(b.B,{type:"link",size:"small",css:(0,v.iv)({fontSize:r.typography.fontSizeSm},""),children:(0,u.tZ)(C.Z,{id:"XX8+x1",defaultMessage:"View prompt template"})})}),(0,u.BX)(h.J2e.Content,{css:Rs,children:[(0,u.tZ)(h.J2e.Arrow,{}),o]})]})})]})]})};var Ts=r(7118);var Bs={name:"1iwgvlm",styles:"flex-shrink:1;flex-grow:1;overflow:hidden"},Is={name:"1kd7iwj",styles:"flex-shrink:0;flex-grow:1;display:flex;align-items:flex-end"};const As=e=>{var t;let{run:r,onDatasetSelected:a}=e;const{theme:i}=(0,b.u)(),s=(0,n.useCallback)((e=>a(e,r)),[a,r]);return(null===(t=r.datasets)||void 0===t?void 0:t.length)<1?null:(0,u.BX)("div",{css:(0,v.iv)({display:"flex",alignItems:"center",gap:i.spacing.xs,overflow:"hidden"},""),children:[(0,u.tZ)("div",{css:Bs,children:(0,u.tZ)(b.B,{type:"link",onClick:()=>s(r.datasets[0]),children:(0,u.tZ)(Ts.O,{datasetWithTags:r.datasets[0],displayTextAsLink:!0,css:(0,v.iv)({marginTop:i.spacing.xs/2,marginBottom:i.spacing.xs/2},"")})})}),r.datasets.length>1&&(0,u.tZ)("div",{css:Is,children:(0,u.BX)(h.J2e.Root,{modal:!1,children:[(0,u.tZ)(h.J2e.Trigger,{asChild:!0,children:(0,u.tZ)(b.B,{size:"small",style:{borderRadius:"8px",width:"40px"},children:(0,u.BX)(b.j.Text,{color:"secondary",children:["+",r.datasets.length-1]})})}),(0,u.tZ)(h.J2e.Content,{align:"start",children:r.datasets.slice(1).filter(Boolean).map((e=>(0,u.tZ)("div",{css:(0,v.iv)({height:i.general.heightSm,display:"flex",alignItems:"center"},""),children:(0,u.tZ)(b.B,{type:"link",onClick:()=>s(e),children:(0,u.tZ)(Ts.O,{datasetWithTags:e,displayTextAsLink:!0})})},`${e.dataset.name}-${e.dataset.digest}`)))})]})})]})};var Ls={name:"1on1b16",styles:"width:100%;height:100%;display:flex;flex-direction:column"};const Ds=e=>{let{children:t,className:r,groupHeaderContent:n=null}=e;const{theme:a}=(0,b.u)();return(0,u.BX)("div",{css:Ls,children:[(0,u.tZ)("div",{css:(0,v.iv)({width:"100%",flexBasis:40,display:"flex",alignItems:"center",padding:a.spacing.sm,borderBottom:`1px solid ${a.colors.borderDecorative}`},""),className:"header-group-cell",children:n}),(0,u.tZ)("div",{css:(0,v.iv)({width:"100%",flex:1,display:"flex",justifyContent:"flex-start",alignItems:"flex-start",padding:a.spacing.xs,borderRight:`1px solid ${a.colors.borderDecorative}`},""),className:r,children:t})]})};var Ns={name:"8xhv84",styles:"width:100%;display:flex"},Ps={name:"82a6rk",styles:"flex:1"};const Hs=e=>{let{run:t,onHideRun:r,onDuplicateRun:i,onDatasetSelected:s,groupHeaderContent:o=null}=e;const{theme:l}=(0,b.u)(),{getEvaluableRowCount:c,evaluateAllClick:d,runColumnsBeingEvaluated:p,canEvaluateInRunColumn:m}=ks(),g=(0,a.Z)(),f=c(t),y=f>0,x=p.includes(t.runUuid),Z=(0,n.useMemo)((()=>y?y&&!x?g.formatMessage({id:"2gmOVq",defaultMessage:"Process {evaluableRowCount} rows without evaluation output"},{evaluableRowCount:f}):null:g.formatMessage({id:"7m2B5x",defaultMessage:"There are no evaluable rows within this column"})),[f,y,x,g]);return(0,u.BX)(Ds,{css:(0,v.iv)({justifyContent:"flex-start",padding:l.spacing.sm,paddingBottom:0,paddingTop:l.spacing.sm,flexDirection:"column",gap:l.spacing.xs/2,overflow:"hidden"},""),groupHeaderContent:o,children:[(0,u.BX)("div",{css:Ns,children:[(0,u.BX)(ne.rU,{css:(0,v.iv)({display:"flex",gap:l.spacing.sm,alignItems:"center"},""),to:ae.Z.getRunPageRoute(t.experimentId,t.runUuid),target:"_blank",children:[(0,u.tZ)("div",{css:(0,v.iv)({backgroundColor:t.color,width:12,height:12,borderRadius:6},"")}),t.runName]}),(0,u.tZ)("div",{css:(0,v.iv)({flexBasis:l.spacing.sm},"")}),(0,u.tZ)(b.B,{onClick:()=>r(t.runUuid),size:"small",icon:(0,u.tZ)(h.bMb,{})}),(0,u.tZ)("div",{css:Ps}),(0,Se.sq)()&&m(t)&&(0,u.BX)(u.HY,{children:[(0,u.tZ)("div",{css:(0,v.iv)({flexBasis:l.spacing.sm},"")}),(0,u.tZ)(b.T,{title:Z,children:(0,u.tZ)(b.B,{disabled:!y,size:"small",onClick:()=>d(t),icon:x?(0,u.tZ)(h.wNq,{}):(0,u.tZ)(h.o1U,{}),children:x?(0,u.tZ)(C.Z,{id:"plw4Kp",defaultMessage:"Stop evaluating"}):(0,u.tZ)(C.Z,{id:"JnIbS3",defaultMessage:"Evaluate all"})})})]}),(0,u.tZ)("div",{css:(0,v.iv)({flexBasis:l.spacing.sm},"")}),(0,Se.sq)()&&(0,Mr.Fc)(t)&&(0,u.BX)(b.M.Root,{modal:!1,children:[(0,u.tZ)(b.M.Trigger,{asChild:!0,children:(0,u.tZ)(b.B,{size:"small",icon:(0,u.tZ)(h.VZO,{})})}),(0,u.tZ)(b.M.Content,{children:(0,u.tZ)(b.M.Item,{onClick:()=>i(t),children:(0,u.tZ)(C.Z,{id:"1YGQOY",defaultMessage:"Duplicate run"})})})]})]}),(0,Se.sq)()&&(0,Mr.Fc)(t)?(0,u.tZ)(Es,{run:t}):(0,Se.GW)()&&(0,u.tZ)(As,{run:t,onDatasetSelected:s})]})},Os=e=>{let{disabled:t,isLoading:r,run:n,rowKey:a}=e;const i=(0,Mr.Fc)(n),{evaluateCell:s,getMissingParams:o}=ks(),l=n&&o(n,a)||null;return l&&l.length>0?(0,u.tZ)(b.T,{title:(0,u.tZ)(C.Z,{id:"yAuDRt",defaultMessage:'Evaluation is not possible because values for the following inputs cannot be determined: {missingParamList}. Add input columns to the "group by" settings or use "Add row" button to define new parameter set.',values:{missingParamList:(0,u.tZ)("code",{children:l.join(", ")})}}),children:(0,u.tZ)(b.d,{})}):i?(0,u.tZ)(b.B,{loading:r,disabled:t,size:"small",onMouseDownCapture:e=>e.stopPropagation(),onClickCapture:e=>{e.stopPropagation(),s(n,a)},icon:(0,u.tZ)(h.o1U,{}),children:(0,u.tZ)(u.HY,{children:"Evaluate"})}):(0,u.tZ)(b.T,{title:(0,u.tZ)(C.Z,{id:"tnTuzM",defaultMessage:"You cannot evaluate this cell, this run was not created using AI gateway route"}),children:(0,u.tZ)(b.d,{})})};const Xs=n.memo((e=>{let{text:t,highlight:r}=e;const{theme:a}=(0,b.u)();if(!r)return(0,u.tZ)(u.HY,{children:t});const i=t.split(new RegExp(`(${r})`,"gi"));return(0,u.tZ)(u.HY,{children:i.map(((e,t)=>(0,u.tZ)(n.Fragment,{children:e.toLowerCase()===r.toLowerCase()?(0,u.tZ)("span",{css:(0,v.iv)({backgroundColor:a.colors.yellow200},""),children:e}):e},t)))})}));var zs={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"},Us={name:"52b6nu",styles:"display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:7"},Vs={name:"1jwcxx3",styles:"font-style:italic"};const _s=e=>{var t,r;let{value:n,context:a,isGroupByColumn:i,run:s,data:o}=e;const{theme:l}=(0,b.u)(),{pendingDataLoading:d,canEvaluateInRunColumn:p}=ks(),m=(0,c.v9)((e=>{let{modelGateway:t}=e;return t.modelGatewayRoutesLoading})),g=s&&(null===(t=d[s.runUuid])||void 0===t?void 0:t[null===o||void 0===o?void 0:o.key]),f=s&&(null===(r=o.outputMetadataByRunUuid)||void 0===r?void 0:r[s.runUuid])||null,y=null!==f&&void 0!==f&&f.isPending||o.isPendingInputRow?l.colors.backgroundSecondary:l.colors.backgroundPrimary;return(0,u.BX)("div",{css:(0,v.iv)({height:"100%",whiteSpace:"normal",padding:l.spacing.sm,overflow:"hidden",position:"relative",cursor:"pointer",backgroundColor:y,"&:hover":{backgroundColor:l.colors.actionDefaultBackgroundHover}},""),children:[g?(0,u.tZ)(h.hM6,{lines:3}):(0,u.tZ)(u.HY,{children:n?(0,u.tZ)("span",{css:Us,children:i&&a.highlightedText?(0,u.tZ)(Xs,{text:n,highlight:a.highlightedText}):n.substring(0,512)}):(0,u.tZ)(b.j.Text,{color:"info",css:zs,children:(0,u.tZ)(C.Z,{id:"aQxQIF",defaultMessage:"(empty)"})})}),(0,Se.sq)()&&s&&p(s)&&(0,u.BX)("div",{css:(0,v.iv)({position:"absolute",left:8,bottom:8,right:8,display:"flex",gap:l.spacing.sm,alignItems:"center",justifyContent:"space-between"},""),children:[(0,u.BX)("div",{css:(0,v.iv)({display:"flex",alignItems:"center",gap:l.spacing.xs},""),children:[!n&&(0,u.tZ)(Os,{disabled:g,isLoading:m,run:s,rowKey:o.key}),((null===f||void 0===f?void 0:f.isPending)||o.isPendingInputRow)&&(0,u.tZ)(b.j.Hint,{size:"sm",css:Vs,children:(0,u.tZ)(C.Z,{id:"2fvQaF",defaultMessage:"Unsaved"})})]}),f&&!g&&(0,u.BX)("div",{css:(0,v.iv)({display:"flex",gap:l.spacing.xs,alignItems:"center"},""),children:[f.evaluationTime&&(0,u.BX)(b.j.Hint,{size:"sm",children:[Math.round(f.evaluationTime)," ms",f.totalTokens?",":""]}),f.totalTokens&&(0,u.tZ)(b.j.Hint,{size:"sm",children:(0,u.tZ)(C.Z,{id:"/nPZbt",defaultMessage:"{totalTokens} total tokens",values:{totalTokens:f.totalTokens}})})]})]})]})},Ws={initialWidthGroupBy:200,initialWidthOutput:360,maxWidth:500,minWidth:140};var Fs={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const Ks=e=>{let{displayName:t}=e;const{theme:r}=(0,b.u)();return(0,u.tZ)(Ds,{css:(0,v.iv)({justifyContent:"flex-start",padding:r.spacing.sm},""),children:(0,u.tZ)(b.T,{title:(0,o.truncate)(t,{length:250}),children:(0,u.tZ)(b.j.Text,{bold:!0,css:Fs,children:t})})})};var js={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const $s={svg:{width:20,height:20}},qs=()=>{const{toggleExpandedHeader:e,isHeaderExpanded:t}=ks();return(0,u.tZ)(Ds,{children:(0,u.tZ)(b.T,{placement:"right",title:(0,u.tZ)(C.Z,{id:"lDGQGa",defaultMessage:"Toggle detailed view"}),children:(0,u.tZ)(b.B,{icon:t?(0,u.tZ)(h.v4q,{css:$s}):(0,u.tZ)(b.a,{css:$s}),onClick:e})})})},Ys=e=>{let{onAddNewInputs:t,displayAddNewInputsButton:r}=e;const{theme:n}=(0,b.u)();return r?(0,u.tZ)("div",{css:(0,v.iv)({width:"100%",height:"100%",display:"flex",flexDirection:"column",padding:n.spacing.xs},""),children:(0,u.tZ)(b.T,{placement:"right",title:(0,u.tZ)(C.Z,{id:"PNfcez",defaultMessage:"Add row"}),children:(0,u.tZ)(b.B,{icon:(0,u.tZ)(h.pOD,{}),onClick:t})})}):null};var Gs={name:"3ytxc3",styles:"height:100%;overflow:hidden"};const Js=e=>{let{resultList:t,visibleRuns:r,groupByColumns:i,onCellClick:s,onHideRun:l,onDatasetSelected:d,highlightedText:p="",isPreviewPaneVisible:m,outputColumnName:g}=e;const[f,y]=(0,n.useState)([]),[x,Z]=(0,n.useState)(null),w=(0,c.v9)((e=>{let{evaluationData:t}=e;return t.evaluationPendingDataByRunUuid})),k=(0,n.useRef)(null),{isHeaderExpanded:S}=ks(),{createNewRun:M}=Yr(),R=(0,n.useCallback)((e=>{null===x||void 0===x||x.refreshHeader(),l(e)}),[x,l]),E=(0,n.useCallback)((e=>{null===x||void 0===x||x.refreshHeader(),M(e)}),[M,x]);(0,n.useEffect)((()=>{x&&!m&&x.clearFocusedCell()}),[x,m]),(0,n.useEffect)((()=>{if(!x)return;const e=x.getRenderedNodes();x.refreshCells({force:!0,rowNodes:e})}),[x,w,p]);const{showAddNewInputsModal:T,AddNewInputsModal:B}=(()=>{const[e,t]=(0,n.useState)(!1),[r,a]=(0,n.useState)([]),[i,s]=(0,n.useState)({}),l=(0,n.useMemo)((()=>r.every((e=>{let{inputName:t}=e;return i[t]}))),[i,r]),[c,d]=(0,n.useState)((async()=>{})),p=(0,n.useCallback)(((e,t)=>{s((r=>({...r,[e]:t})))}),[]),m=(0,n.useCallback)(((e,r)=>{const n=e.filter(Mr.Fc).map((e=>({runName:e.runName,params:(0,Mr.oV)(e)}))),i=(0,o.uniq)(n.map((e=>{let{params:t}=e;return t})).flat()).map((e=>({inputName:e,runNames:n.filter((t=>t.params.includes(e))).map((e=>{let{runName:t}=e;return t}))})));t(!0),a(i),s({}),d((()=>r))}),[]),{theme:g}=(0,b.u)(),f=(0,u.tZ)(h.u_l,{title:(0,u.tZ)(C.Z,{id:"JnidmZ",defaultMessage:"Add row"}),okButtonProps:{disabled:!l},okText:(0,u.tZ)(C.Z,{id:"eeLqSn",defaultMessage:"Submit"}),cancelText:(0,u.tZ)(C.Z,{id:"jwALGI",defaultMessage:"Cancel"}),onOk:()=>{c(i),t(!1)},visible:e,onCancel:()=>t(!1),children:r.map((e=>{let{inputName:t,runNames:r}=e;return(0,u.BX)("div",{css:(0,v.iv)({marginBottom:g.spacing.md},""),children:[(0,u.tZ)(b.j.Text,{bold:!0,children:t}),(0,u.tZ)(b.j.Hint,{css:js,children:(0,u.tZ)(C.Z,{id:"s35HDG",defaultMessage:"Used by {runNames} {hasMore, select, true {and other runs} other {}}",values:{runNames:r.slice(0,5).join(", "),hasMore:r.length>5}})}),(0,u.tZ)("div",{css:(0,v.iv)({marginTop:g.spacing.sm},""),children:(0,u.tZ)(b.e.TextArea,{value:i[t],onChange:e=>p(t,e.target.value)})})]},t)}))});return{showAddNewInputsModal:m,AddNewInputsModal:f}})(),I=(0,c.I0)(),A=(0,n.useCallback)((()=>{var e;const t=null===(e=k.current)||void 0===e?void 0:e.querySelector(".ag-body-viewport");t?t.scrollTo({top:0,behavior:"smooth"}):null===x||void 0===x||x.ensureIndexVisible(0,"top")}),[x]),L=(0,n.useMemo)((()=>r.map(Mr.oV).flat().length>0),[r]),D=(0,n.useCallback)((()=>{T(r,(e=>{I((0,Cs.Jw)(e)),A()}))}),[A,T,I,r]),{theme:N}=(0,b.u)(),P=(0,a.Z)(),H=(0,n.useCallback)((e=>{let{value:t,colDef:r,column:n}=e;const a=P.formatMessage({id:"aQxQIF",defaultMessage:"(empty)"});return null===s||void 0===s?void 0:s(t||a,r.headerName||n.getId())}),[P,s]),O=(0,n.useMemo)((()=>(0,u.tZ)(b.j.Text,{bold:!0,children:g})),[g]);return(0,n.useEffect)((()=>{const e=[],{initialWidthGroupBy:t,initialWidthOutput:n,maxWidth:a,minWidth:s}=Ws;(0,Se.sq)()&&r.some((e=>(0,Mr.Fc)(e)))&&e.push({resizable:!1,pinned:!0,width:40,headerComponent:"ActionsColumnRenderer",cellRendererSelector:e=>{let{rowIndex:t}=e;return 0===t?{component:"ActionsCellRenderer",params:{displayAddNewInputsButton:L,onAddNewInputs:D}}:void 0},cellClass:"leading-column-cell"}),i.forEach(((r,n)=>{const o=n===i.length-1;e.push({resizable:!0,initialWidth:t,minWidth:s,maxWidth:a,headerName:r,valueGetter:e=>{let{data:t}=e;return t.groupByCellValues[r]},suppressMovable:!0,cellRenderer:"TextRendererCellRenderer",headerClass:o?"last-group-by-header-cell":void 0,cellRendererParams:{isGroupByColumn:!0},headerComponent:"GroupHeaderCellRenderer",headerComponentParams:{displayAddNewInputsButton:L,onAddNewInputs:D},colId:r,onCellClicked:H})})),r.forEach(((t,r)=>{const i=0===r;e.push({resizable:!0,initialWidth:n,minWidth:s,maxWidth:a,headerName:t.runName,colId:t.runUuid,valueGetter:e=>{let{data:r}=e;return r.cellValues[t.runUuid]},suppressMovable:!0,cellRenderer:"TextRendererCellRenderer",cellRendererParams:{run:t},headerComponent:"RunHeaderCellRenderer",headerComponentParams:{run:t,onDuplicateRun:E,onHideRun:R,onDatasetSelected:d,groupHeaderContent:i?O:null},onCellClicked:H})})),y(e)}),[r,i,R,E,d,D,L,H,O]),(0,n.useEffect)((()=>{if(!x)return;const e=r.some((e=>{var t;return(0,Mr.Fc)(e)||(null===(t=e.datasets)||void 0===t?void 0:t.length)>0}));x.setHeaderHeight(function(){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?40+(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?175:62):80}(S,e))}),[x,S,r]),(0,u.BX)("div",{css:Gs,ref:k,children:[(0,u.tZ)(Cn,{css:Qs(N),context:{highlightedText:p},rowHeight:190,onGridReady:e=>{let{api:t}=e;return Z(t)},getRowId:e=>{let{data:t}=e;return t.key},suppressHorizontalScroll:!1,columnDefs:f,rowData:t,components:{TextRendererCellRenderer:_s,GroupHeaderCellRenderer:Ks,RunHeaderCellRenderer:Hs,ActionsColumnRenderer:qs,ActionsCellRenderer:Ys}}),B]})},Qs=e=>({".ag-row:not(.ag-row-first), .ag-body-viewport":{borderTop:`1px solid ${e.colors.borderDecorative}`},".ag-row-last":{borderBottom:`1px solid ${e.colors.borderDecorative}`},".ag-cell, .last-group-by-header-cell .header-group-cell":{borderRight:`1px solid ${e.colors.borderDecorative}`},".ag-cell-focus:not(.leading-column-cell)::after":{content:'""',position:"absolute",inset:0,boxShadow:`inset 0 0 0px 2px ${e.colors.blue300}`,pointerEvents:"none"}}),eo=(e,t)=>{const r=t.map((t=>{var r;return[t,null===(r=e[t])||void 0===r?void 0:r.toString()]})),n=r.map((e=>{let[,t]=e;return String(t)})).join(".");return{key:n,groupByValues:(0,o.fromPairs)(r)}},to=()=>{var e;return/mac/i.test(null===(e=window.navigator.userAgentData)||void 0===e?void 0:e.platform)||/mac/i.test(window.navigator.platform)},ro=to()?"metaKey":"ctrlKey",no=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;const{altOrOptKey:a=!1,ctrlOrCmdKey:i=!1,shiftKey:s=!1}=t;return(0,n.useEffect)((()=>{const t=t=>{if((!i||t[ro])&&(!a||t.altKey)&&(!s||t.shiftKey)&&t.key===e){r()&&t.preventDefault()}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)}),[e,r,i,a,s]),{isMacKeyboard:to}};var ao={name:"1hetg88",styles:"max-width:300px"},io={name:"111arwn",styles:"width:300px;min-width:300px"},so={name:"1hetg88",styles:"max-width:300px"},oo={name:"1hetg88",styles:"max-width:300px"};const lo=e=>{let{comparedRuns:t,updateSearchFacets:r,onDatasetSelected:l,viewState:d,updateViewState:p}=e;const m=(0,a.Z)(),{theme:g}=(0,b.u)(),f=(0,n.useMemo)((()=>t.filter((e=>{let{hidden:t}=e;return!t})).slice(0,10)),[t]),{selectedTables:y,groupByCols:x,outputColumn:Z,setSelectedTables:w,setGroupByCols:k,setOutputColumn:S}=((e,t)=>{const{artifactViewState:r={}}=e,[a,i]=(0,n.useState)(r.selectedTables||[]),[s,o]=(0,n.useState)(r.groupByCols||[]),[l,c]=(0,n.useState)(r.outputColumn||"");return(0,n.useEffect)((()=>t({artifactViewState:{selectedTables:a,groupByCols:s,outputColumn:l}})),[t,a,s,l]),{selectedTables:a,groupByCols:s,outputColumn:l,setSelectedTables:i,setGroupByCols:o,setOutputColumn:c}})(d,p),[M,R]=(0,n.useState)(!1),[E,T]=(0,n.useState)(""),[B,I]=(0,n.useState)(""),[A,L]=(0,n.useState)(!1),{isSyncingArtifacts:D,EvaluationSyncStatusElement:N}=(()=>{const{evaluationPendingDataByRunUuid:e,evaluationArtifactsBeingUploaded:t,evaluationDraftInputValues:r}=(0,c.v9)((e=>{let{evaluationData:t}=e;return t})),[a,i]=(0,n.useState)(!1),o=(0,c.I0)(),l=(0,n.useCallback)((()=>{o((0,Cs.XT)())}),[o]),d=Object.values(e).flat().length,p=r.length,m=Object.values(t).filter((e=>Object.values(e).some((e=>e)))).length;(0,n.useEffect)((()=>{0===d&&i(!1)}),[d]);const h=(0,n.useCallback)((()=>(0===d||a||(i(!0),o((0,Cs.RO)()).catch((e=>{s.default.logErrorAndNotifyUser(e)}))),!0)),[o,d,a]),{isMacKeyboard:g}=no("s",{ctrlOrCmdKey:!0},h),{theme:f}=(0,b.u)(),y=p>0&&0===d,x=d>0||y?(0,u.BX)("div",{css:(0,v.iv)({backgroundColor:f.colors.backgroundPrimary,border:`1px solid ${f.colors.border}`,padding:f.spacing.md,marginBottom:f.spacing.sm,display:"flex",justifyContent:"space-between",alignItems:"center"},""),children:[y?(0,u.tZ)(C.Z,{id:"EPcEi9",defaultMessage:"You have added rows with new input values, but you still need to evaluate the new data in order to save it."}):a?(0,u.tZ)(b.j.Text,{children:(0,u.tZ)(C.Z,{id:"NGsTf/",defaultMessage:"Synchronizing artifacts for {runsBeingSynchronizedCount} runs...",values:{runsBeingSynchronizedCount:(0,u.tZ)("strong",{children:m})}})}):(0,u.tZ)(b.j.Text,{children:(0,u.tZ)(C.Z,{id:"BWpQZ7",defaultMessage:'You have <strong>{unsyncedDataEntriesCount}</strong> unsaved evaluated {unsyncedDataEntriesCount, plural, =1 {value} other {values}}. Click "Save" button or press {keyCombination} keys to synchronize the artifact data.',values:{strong:e=>(0,u.tZ)("strong",{children:e}),unsyncedDataEntriesCount:d,keyCombination:g()?"\u2318CMD+S":"CTRL+S"}})}),(0,u.BX)("div",{css:(0,v.iv)({display:"flex",gap:f.spacing.sm},""),children:[(0,u.tZ)(b.B,{disabled:a,onClick:l,children:(0,u.tZ)(C.Z,{id:"kNTkr+",defaultMessage:"Discard"})})," ",d>0&&(0,u.tZ)(b.B,{loading:a,type:"primary",onClick:h,children:(0,u.tZ)(C.Z,{id:"nhqO2Z",defaultMessage:"Save"})})]})]}):null;return{isSyncingArtifacts:a,EvaluationSyncStatusElement:x}})(),P=(0,c.I0)();(0,n.useEffect)((()=>{(0,Se.sq)()&&P((0,Cr.cL)()).catch((e=>{s.default.logErrorAndNotifyUser((null===e||void 0===e?void 0:e.message)||e)}))}),[P]);const H=(0,n.useCallback)((e=>w((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))),[w]),O=(0,n.useCallback)((e=>k((t=>{const r=t.includes(e)?t.filter((t=>t!==e)):[...t,e].sort();return L(0===r.length),r}))),[k]),X=(0,n.useMemo)((()=>f.map((e=>{let{runUuid:t}=e;return t}))),[f]),{evaluationArtifactsByRunUuid:z,evaluationPendingDataByRunUuid:U,evaluationDraftInputValues:V}=(0,c.v9)((e=>{let{evaluationData:t}=e;return t})),{tables:_,tablesByRun:W}=(F=f,(0,n.useMemo)((()=>{const e=(0,o.fromPairs)(F.map((e=>{var t,r;const n=null===(t=e.tags)||void 0===t||null===(r=t[q.yg])||void 0===r?void 0:r.value,a=new Set;if(n)try{JSON.parse(n).filter((e=>{let{type:t}=e;return t===K.yK.TABLE})).forEach((e=>{let{path:t}=e;a.add(t)}))}catch(i){if(i instanceof SyntaxError)throw new SyntaxError(`The "${q.yg}" tag in "${e.runName}" run is malformed!`);throw i}return[e.runUuid,Array.from(a)]})).filter((e=>{let[,t]=e;return t.length>0}))),t=Array.from(new Set(Object.values(e).flat())),r=t.filter((t=>F.every((r=>{var n;let{runUuid:a}=r;return null===(n=e[a])||void 0===n?void 0:n.includes(t)}))));return{tables:t,tablesByRun:e,tablesIntersection:r}}),[F]));var F;(0,n.useEffect)((()=>{_.length>0&&0===y.length&&w([_[0]])}),[_,w,y.length]);const j=(0,c.v9)((e=>{let{evaluationData:t,modelGateway:r}=e;return r.modelGatewayRoutesLoading||X.some((e=>y.some((r=>{var n;return null===(n=t.evaluationArtifactsLoadingByRunUuid[e])||void 0===n?void 0:n[r]}))))})),{columns:$}=(Y=z,G=X,J=y,(0,n.useMemo)((()=>{if(0===J.length||0===G.length)return{columns:[],columnsIntersection:[]};const e=G.map((e=>Object.values(Y[e]||{}).filter((e=>{let{path:t}=e;return J.includes(t)})))).flat(),t=e.filter((e=>{let{path:t}=e;return J.includes(t)})).map((e=>{let{columns:t}=e;return t})).flat(),r=Array.from(new Set(t)),n=r.filter((t=>e.every((e=>{let{columns:r}=e;return r.includes(t)}))));return{columns:r,columnsIntersection:n}}),[G,Y,J]));var Y,G,J;const Q=((e,t,r,a,i,s,l)=>(0,n.useMemo)((()=>{const n=[],c={},d={},u=[];for(const e of r){const t=s.map((t=>[t,e[t]])),r=t.map((e=>{let[,t]=e;return t})).join(".");d[r]=(0,o.fromPairs)(t),u.push(r)}const p={},m=a.map((t=>{const r=Object.values(e[t]||{}).filter((e=>{let{path:t}=e;return i.includes(t)})).map((e=>{let{entries:t}=e;return t})).flat();return[t,r]}));for(const[e,t]of m)for(const r of t){var h;const{key:t,groupByValues:n}=eo(r,s);if(Object.values(n).every((e=>!e)))continue;d[t]||(d[t]=n),(r[Mr.h]||r[Mr.i7])&&(p[t]||(p[t]={}),p[t][e]||(p[t][e]={isPending:!1,evaluationTime:parseFloat(r[Mr.h]),totalTokens:r[Mr.i7]?parseInt(r[Mr.i7],10):void 0})),c[t]||(c[t]={});const a=c[t];a[e]=a[e]||(null===(h=r[l])||void 0===h?void 0:h.toString())}for(const[e,r]of Object.entries(t))for(const t of r){var g;const{entryData:r,...n}=t,{key:a,groupByValues:i}=eo(r,s);if(Object.values(i).every((e=>!e)))continue;d[a]||(d[a]=i,u.push(a)),p[a]||(p[a]={}),p[a][e]=n,c[a]||(c[a]={});const o=c[a];o[e]=(null===(g=r[l])||void 0===g?void 0:g.toString())||o[e]}const f=(0,o.sortBy)(Object.entries(d),(e=>{let[t]=e;return!u.includes(t)}));for(const[e,t]of f){const r=n.find((t=>{let{key:r}=t;return e===r}));r&&c[e]?(r.cellValues=c[e],r.outputMetadataByRunUuid=p[e]):n.push({key:e,groupByCellValues:t,cellValues:c[e]||{},outputMetadataByRunUuid:p[e],isPendingInputRow:u.includes(e)})}return n}),[a,e,s,r,i,l,t]))(z,U,V,X,y,x,Z),ee=(0,n.useMemo)((()=>{const e=f.filter(Mr.Fc).map(Mr.oV).flat();if(!e.length)return null;return Array.from(new Set(e)).filter((e=>$.includes(e)))}),[f,$]);(0,n.useEffect)((()=>{f.every(Mr.Fc)&&k([])}),[k,f]),(0,n.useEffect)((()=>{if(y.length)for(const e of f){if(!e)continue;const t=(W[e.runUuid]||[]).filter((e=>y.includes(e)));for(const r of t)P((0,i.h$)(e.runUuid,r,!1)).catch((e=>{s.default.logErrorAndNotifyUser(e.message||e)}))}}),[f,P,y,W]);const te=y.length>0,re=f.length>0,ne=!j&&te&&re,ae=(0,n.useMemo)((()=>{if(!B.trim())return Q;const e=new RegExp(B,"i");return Q.filter((t=>{let{groupByCellValues:r}=t;return Object.values(r).some((t=>null===t||void 0===t?void 0:t.match(e)))}))}),[Q,B]),ie=(0,n.useCallback)((e=>r((t=>({...t,runsHidden:[...t.runsHidden,e]})))),[r]);(0,n.useEffect)((()=>{if(j||A)return;const e=x.length<1,t=x.some((e=>!$.includes(e))),r=$[0],n=ee||(r?[r]:null);(e||t)&&n&&k(n.sort())}),[j,A,x,Z,$,k,ee]);const se=(0,n.useMemo)((()=>$.filter((e=>!e.startsWith("MLFLOW_")))),[$]),oe=(0,n.useMemo)((()=>$.filter((e=>!x.includes(e)&&!e.startsWith("MLFLOW_")))),[$,x]);(0,n.useEffect)((()=>{if(x.includes(Z)||!Z){const e=oe.includes(Mr.JL)?Mr.JL:oe[0];S(e||"")}}),[x,Z,oe,S]),(0,n.useEffect)((()=>{R(!0);const e=setTimeout((()=>I(E)),250);return()=>clearTimeout(e)}),[E]),(0,n.useEffect)((()=>{R(!1)}),[B]),(0,n.useEffect)((()=>{if(!oe.includes(Z)){const e=oe.includes(Mr.JL)?Mr.JL:oe[0];S(e||"")}}),[Z,oe,S]),(0,n.useEffect)((()=>{y.some((e=>!_.includes(e)))&&w([])}),[y,_,w]);const[le,ce]=(0,n.useState)(null),de=(0,n.useCallback)(((e,t)=>{ce({value:e,header:t}),p({previewPaneVisible:!0})}),[p]);return(0,u.BX)("div",{css:(0,v.iv)({borderTop:`1px solid ${g.colors.border}`,borderLeft:`1px solid ${g.colors.border}`,marginLeft:-1,zIndex:1,height:"100%",display:"grid",gridTemplateColumns:d.previewPaneVisible?"1fr auto":"1fr",overflow:"hidden"},""),children:[(0,u.BX)("div",{css:(0,v.iv)({paddingLeft:g.spacing.sm,paddingTop:g.spacing.sm,height:"100%",display:"grid",gridTemplateRows:"auto auto 1fr",overflow:"hidden",rowGap:g.spacing.sm,backgroundColor:g.colors.backgroundSecondary},""),children:[(0,u.BX)("div",{css:(0,v.iv)({display:"flex",alignItems:"center",gap:g.spacing.sm,overflow:"hidden",height:g.general.heightSm},""),children:[(0,u.BX)(h.M6x,{label:(0,u.tZ)(C.Z,{id:"syyEiR",defaultMessage:"Table"}),multiSelect:!0,value:y,children:[(0,u.tZ)(h.Aa0,{css:(0,v.iv)({maxWidth:300,backgroundColor:g.colors.backgroundPrimary},""),"data-testid":"dropdown-tables",onClear:()=>w([]),disabled:D}),(0,u.tZ)(h.hJM,{css:ao,children:(0,u.tZ)(h.X_T,{children:_.map((e=>(0,u.tZ)(h.VKe,{value:e,onChange:H,checked:y.includes(e),"data-testid":"dropdown-tables-option",children:e},e)))})})]}),(0,u.tZ)(b.T,{title:(0,u.tZ)(C.Z,{id:"VZRc73",defaultMessage:"Using the list of logged table artifacts, select at least one to start comparing results."}),children:(0,u.tZ)(b.d,{})})]}),j?(0,u.tZ)(h.Qck,{}):(0,u.BX)(u.HY,{children:[(0,u.BX)("div",{css:(0,v.iv)({display:"flex",columnGap:g.spacing.sm,alignItems:"center",overflow:"hidden",height:g.general.heightSm},""),children:[(0,u.tZ)(b.e,{prefix:(0,u.tZ)(h.W1M,{}),suffix:M&&(0,u.tZ)(b.S,{size:"small"}),css:io,onChange:e=>T(e.target.value),value:E,placeholder:m.formatMessage({id:"3D2Znf",defaultMessage:"Filter by {columnNames}"},{columnNames:x.join(", ")}),allowClear:!0,disabled:!ne||D}),(0,u.BX)(h.M6x,{value:x,multiSelect:!0,label:(0,u.tZ)(C.Z,{id:"fWm1UC",defaultMessage:"Group by"}),children:[(0,u.tZ)(h.Aa0,{disabled:!ne||D,allowClear:!1,showTagAfterValueCount:1,css:(0,v.iv)({maxWidth:300,backgroundColor:g.colors.backgroundPrimary},""),"aria-label":'Select "group by" columns'}),(0,u.tZ)(h.hJM,{css:so,children:(0,u.tZ)(h.X_T,{children:se.map((e=>(0,u.tZ)(h.VKe,{value:e,onChange:O,checked:x.includes(e),children:e},e)))})})]}),(0,u.BX)(h.M6x,{value:[Z],label:(0,u.tZ)(C.Z,{id:"ZqGzZd",defaultMessage:"Compare"}),children:[(0,u.tZ)(h.Aa0,{disabled:!ne||D,allowClear:!1,css:(0,v.iv)({maxWidth:300,backgroundColor:g.colors.backgroundPrimary},"")}),(0,u.tZ)(h.hJM,{css:oo,children:(0,u.tZ)(h.X_T,{children:oe.map((e=>(0,u.tZ)(h.PC4,{value:e,onChange:()=>S(e),checked:Z===e,children:e},e)))})})]})]}),ne&&!A?(0,u.tZ)("div",{css:(0,v.iv)({position:"relative",zIndex:1,overflowY:"hidden",height:"100%",backgroundColor:g.colors.backgroundPrimary},""),children:(0,u.tZ)(ws,{tableData:Q,outputColumn:Z,children:(0,u.tZ)(Js,{visibleRuns:f,groupByColumns:x,resultList:ae,onCellClick:de,onHideRun:ie,onDatasetSelected:l,highlightedText:B.trim(),isPreviewPaneVisible:d.previewPaneVisible,outputColumnName:Z})})}):(0,u.tZ)("div",{css:(0,v.iv)({marginTop:g.spacing.lg},""),children:(0,u.tZ)(h.HYy,{title:A?(0,u.tZ)(C.Z,{id:"owr9l2",defaultMessage:"No group by columns selected"}):re?(0,u.tZ)(C.Z,{id:"ZvJTXB",defaultMessage:"No tables selected"}):(0,u.tZ)(C.Z,{id:"BFzsMn",defaultMessage:"No runs selected"}),description:A?(0,u.tZ)(C.Z,{id:"lJQEW4",defaultMessage:'Using controls above, select at least one "group by" column.'}):re?(0,u.tZ)(C.Z,{id:"18/UVG",defaultMessage:"Using controls above, select at least one artifact containing table."}):(0,u.tZ)(C.Z,{id:"nPWZsh",defaultMessage:"Make sure that at least one experiment run is visible and available to compare"})})}),N]})]}),d.previewPaneVisible&&(0,u.tZ)(On,{content:null===le||void 0===le?void 0:le.value,copyText:null===le||void 0===le?void 0:le.value,headerText:null===le||void 0===le?void 0:le.header,onClose:()=>p({previewPaneVisible:!1}),empty:(0,u.tZ)(h.HYy,{description:(0,u.tZ)(C.Z,{id:"lTngfr",defaultMessage:"Select a cell to display preview"})})})]})},co=()=>{const e=new Date;return e.setMilliseconds(0),e},uo=n.memo((e=>{var t;const{experiments:r,runsData:a,onMaximizedChange:i}=e,{searchFacetsState:o,updateSearchFacets:l,isLoadingRuns:c,loadMoreRuns:d,moreRunsAvailable:p,isPristine:m,requestError:g}=kt(),[f,v]=(0,n.useState)([]),[y,b]=(0,n.useState)(new Vn),{experiment_id:x}=r[0],C=Qt(x),[Z,w]=(0,n.useState)(null!==(t="true"===C.getItem("expandRows"))&&void 0!==t&&t);(0,n.useEffect)((()=>{C.setItem("expandRows",Z)}),[Z,C]);const{paramKeyList:k,metricKeyList:S,tagsList:M,modelVersionsByRunUuid:R,paramsList:E,metricsList:T,runInfos:B,runUuidsMatchingFilter:I,datasetsList:A}=a,L=(0,n.useMemo)((()=>B.map(((e,t)=>({runInfo:e,params:E[t],metrics:T[t],tags:M[t],datasets:A[t]})))),[A,T,E,B,M]),{orderByKey:D,searchFilter:N,runsExpanded:P,runsPinned:H,runsHidden:O,compareRunsMode:X,datasetsFilter:z}=o,U=void 0!==X;((e,t,r)=>{const a=(0,n.useRef)(!1);(0,n.useEffect)((()=>{e||a.current||t.length>0&&(r({compareRunsMode:"CHART"}),a.current=!0)}),[e,t.length,r])})(c,S,l),((e,t,r,a,i)=>{(0,n.useEffect)((()=>{if(!r())return;const n=e.filter(xs).map((e=>{let{runInfo:t}=e;return t.run_uuid})),s=t.filter((e=>{var t;let{runDateAndNestInfo:r,runUuid:a}=e;return r.hasExpander&&"undefined"===typeof i[a]&&(null===(t=r.childrenIds)||void 0===t?void 0:t.some((e=>n.includes(e))))})).map((e=>{let{runUuid:t}=e;return t}));s.length&&a((e=>({...e,runsExpanded:s.reduce(((e,t)=>({...e,[t]:!0})),e.runsExpanded)})),{preservePristine:!0,replaceHistory:!0})}),[e,t,i,a,r])})(L,f,m,l,P);const V=(0,n.useCallback)((e=>b((t=>({...t,...e})))),[]),_=(0,n.useCallback)((()=>{V({columnSelectorVisible:!0})}),[V]),W=(0,n.useMemo)((()=>!D&&!N||D===q.XZ.DATE),[D,N]),[F,K]=(0,n.useState)(co);(0,n.useEffect)((()=>{K(co)}),[B]);const j=(0,n.useMemo)((()=>s.default.getVisibleTagKeyList(M)),[M]),[$,Y]=(0,n.useState)(!1),[G,J]=(0,n.useState)();(0,n.useEffect)((()=>{if(c)return;const e=(0,_n.zR)({experiments:r,paramKeyList:k,metricKeyList:S,modelVersionsByRunUuid:R,runsExpanded:P,tagKeyList:j,nestChildren:W,referenceTime:F,runData:L,runUuidsMatchingFilter:I,runsPinned:H,runsHidden:O});v(e)}),[L,c,r,S,R,k,P,j,W,F,H,O,I,g]);const[Q,ee]=(0,h.Npd)(),te=ys(Q),re=(0,n.useCallback)((()=>{p&&!c&&d().then((e=>{te(e,B)}))}),[p,c,d,B,te]);(0,n.useEffect)((()=>{null===i||void 0===i||i(y.viewMaximized)}),[y.viewMaximized,i]);const ne=(0,n.useCallback)(((e,t)=>{J({datasetWithTags:e,runData:t}),Y(!0)}),[]);return(0,u.BX)(qr,{visibleRuns:f,children:[(0,u.tZ)(bn,{viewState:y,updateViewState:V,runsData:a,searchFacetsState:o,updateSearchFacets:l,experimentId:x,requestError:g,expandRows:Z,updateExpandRows:w}),(0,u.BX)("div",{css:po.createRunsTableWrapper(U),children:[(0,u.tZ)(Xn,{experiments:r,runsData:a,searchFacetsState:o,viewState:y,isLoading:c,updateSearchFacets:l,updateViewState:V,onAddColumnClicked:_,rowsData:f,loadMoreRunsFunc:re,moreRunsAvailable:p,onDatasetSelected:ne,expandRows:Z}),"CHART"===X&&(0,u.tZ)(fs,{isLoading:c,comparedRuns:f,metricKeyList:a.metricKeyList,paramKeyList:a.paramKeyList,experimentTags:a.experimentTags,searchFacetsState:o,updateSearchFacets:l}),"ARTIFACT"===X&&(0,Se.Hi)()&&(0,u.tZ)(lo,{comparedRuns:f,viewState:y,updateViewState:V,updateSearchFacets:l,onDatasetSelected:ne}),ee,G&&(0,u.tZ)(bs.x,{isOpen:$,setIsOpen:Y,selectedDatasetWithRun:G,setSelectedDatasetWithRun:J})]})]})})),po={createRunsTableWrapper:e=>({minHeight:225,height:"100%",display:"grid",position:"relative",gridTemplateColumns:e?"310px 1fr":"1fr"}),loadingFooter:()=>({justifyContent:"center",alignItems:"center",display:"flex",height:"72px"})},mo={searchRunsApi:i.ht,loadMoreRunsApi:i.mx,searchRunsPayload:i.Yl,searchModelVersionsApi:Un.nI},ho=(0,c.$j)(((e,t)=>({runsData:$(e,t)})),void 0,void 0,{areStatesEqual:(e,t)=>e.entities.experimentTagsByExperimentId===t.entities.experimentTagsByExperimentId&&e.entities.latestMetricsByRunUuid===t.entities.latestMetricsByRunUuid&&e.entities.modelVersionsByRunUuid===t.entities.modelVersionsByRunUuid&&e.entities.paramsByRunUuid===t.entities.paramsByRunUuid&&e.entities.runInfosByUuid===t.entities.runInfosByUuid&&e.entities.runUuidsMatchingFilter===t.entities.runUuidsMatchingFilter&&e.entities.tagsByRunUuid===t.entities.tagsByRunUuid})(uo),go=e=>{const{searchFacetsState:t}=kt();return e.isLoading?(0,u.tZ)(h.Qck,{active:!0}):(0,u.tZ)(ho,{...e,modelVersionFilter:t.modelVersionFilter,lifecycleFilter:t.lifecycleFilter,datasetsFilter:t.datasetsFilter})},fo=e=>(0,u.tZ)(wt,{actions:mo,children:(0,u.tZ)(go,{...e})}),vo=n.memo(fo);var yo={name:"1h8i7is",styles:"overflow-y:hidden;flex-shrink:0;transition:max-height .12s"};const bo=()=>{const e=d(),t=rt(),r=(a=t,(0,c.v9)((e=>a.map((t=>e.entities.experimentsById[t])).filter(Boolean)),((e,t)=>(0,o.isEqual)(e,t))));var a;const[l]=r,{fetchExperiments:p,isLoadingExperiment:m,requestError:v}=T(),{elementHeight:y,observeHeight:b}=(()=>{const[e,t]=(0,n.useState)(null),[r,a]=(0,n.useState)(void 0);return(0,n.useEffect)((()=>{if(!e||!window.ResizeObserver)return;const t=new ResizeObserver((e=>{let[t]=e;t.target.scrollHeight&&a(t.target.scrollHeight)}));return t.observe(e),()=>t.disconnect()}),[e]),{elementHeight:r,observeHeight:t}})(),[C,Z]=(0,n.useState)(!1);(0,n.useEffect)((()=>{p(t)}),[p,t]),(0,n.useEffect)((()=>{const r=(0,i.wn)(t);e(r).catch((e=>{s.default.logErrorAndNotifyUser(e)}))}),[e,t]);const k=t.length>1;if(v&&v.getErrorCode()===g.SM.PERMISSION_DENIED)return(0,u.tZ)(x,{errorMessage:v.getMessageField()});if(v&&v.getErrorCode()===g.SM.RESOURCE_DOES_NOT_EXIST)return(0,u.tZ)(f.Z,{});const S=m||!r[0];return(0,u.BX)("div",{css:xo.experimentViewWrapper,children:[S?(0,u.tZ)(h.Qck,{title:!0,paragraph:!1,active:!0}):(0,u.tZ)(u.HY,{children:k?(0,u.tZ)(F,{experiments:r}):(0,u.BX)(u.HY,{children:[(0,u.tZ)(_,{experiment:l}),(0,u.tZ)("div",{style:{maxHeight:C?0:y},css:yo,children:(0,u.BX)("div",{ref:b,children:[(0,u.tZ)(w,{experiment:l}),(0,u.tZ)(B,{experiment:l})]})})]})}),(0,u.tZ)(vo,{experiments:r,isLoading:S,onMaximizedChange:Z})]})},xo={experimentViewWrapper:{height:"100%",display:"flex",flexDirection:"column"}};const Co={setExperimentTagApi:i.Yp,getExperimentApi:i.eu,setCompareExperiments:i.MY},Zo=()=>{const{formatMessage:e}=(0,a.Z)();return(0,n.useEffect)((()=>{const t=e({id:"5GCYzy",defaultMessage:"Experiment Runs - Databricks"});s.default.updatePageTitle(t)})),(0,u.tZ)(m,{actions:Co,children:(0,u.tZ)(bo,{})})};var wo=Zo},1132:function(e,t,r){r.d(t,{Ih:function(){return i},Lg:function(){return c},MP:function(){return o},QW:function(){return s},To:function(){return d},aS:function(){return u},r$:function(){return l}});var n=r(74403),a=r(91604);const i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;const[t,r]=(0,a.useState)(void 0),[i,s]=(0,a.useState)(void 0),o=Boolean(window.ResizeObserver),l=(0,a.useCallback)(((e,t)=>{r(e),s(t)}),[]),c=(0,a.useMemo)((()=>(0,n.throttle)(l,e,{leading:!0})),[l,e]),[d,u]=(0,a.useState)(null);return(0,a.useEffect)((()=>{let e=!1;if(!d||!window.ResizeObserver)return;const t=new ResizeObserver((t=>{let[r]=t;e||c(Math.round(r.contentRect.width),Math.round(r.contentRect.height))}));return t.observe(d),()=>{e=!0,t.disconnect()}}),[d,c]),{containerDiv:d,setContainerDiv:u,layoutWidth:t,layoutHeight:i,isDynamicSizeSupported:o}},s={scatterChartHighlightStyles:{".trace.scatter path.point":{transition:"var(--trace-transition)"},".trace.scatter.is-highlight path.point":{opacity:"var(--trace-opacity-dimmed-low) !important"},".trace.scatter path.point.is-hover-highlight":{opacity:"var(--trace-opacity-highlighted) !important"},".trace.scatter path.point.is-selection-highlight":{opacity:"var(--trace-opacity-highlighted) !important",stroke:"var(--trace-stroke-color)",strokeWidth:"var(--trace-stroke-width) !important"}},chartWrapper:()=>({width:"100%",height:"100%",overflow:"hidden",position:"relative",fontSize:0,lineHeight:0,".js-plotly-plot .plotly .cursor-ew-resize, .js-plotly-plot .plotly .cursor-crosshair":{cursor:"pointer"},".js-plotly-plot g.infolayer > g.g-ytitle > text":{stroke:"white",strokeWidth:16,paintOrder:"stroke"},"--trace-transition":"opacity .16s","--trace-opacity-highlighted":"1","--trace-opacity-dimmed-low":"0.45","--trace-opacity-dimmed-high":"0.55","--trace-stroke-color":"black","--trace-stroke-width":"1"}),chart:{width:"100%",height:"100%"}},o={t:0,b:48,r:0,l:48,pad:0},l={t:0,b:48,r:0,l:80,pad:0},c={bgcolor:"white",bordercolor:"#ccc",font:{color:"black"}},d=e=>{const t="string"===typeof e?parseFloat(e):e;return t?Number.isFinite(t)&&!Number.isNaN(t)?Math.abs(t)===Number.MAX_VALUE?Number.POSITIVE_INFINITY*Math.sign(t):e:void 0:t},u=(e,t)=>{if(e.length<=t)return e;const r=t-3,n=Math.ceil(r/2),a=Math.floor(r/2);return e.substr(0,n)+"..."+e.substr(e.length-a)}},9319:function(e,t,r){var n=r(64836);t.Z=void 0;var a=n(r(80004)).default;t.Z=a}}]);
//# sourceMappingURL=431.2df994c9.chunk.js.map